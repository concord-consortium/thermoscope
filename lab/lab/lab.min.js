!function(){function FastClick(e){"use strict";var t,n=this;if(this.trackingClick=!1,this.trackingClickStart=0,this.targetElement=null,this.touchStartX=0,this.touchStartY=0,this.lastTouchIdentifier=0,this.touchBoundary=10,this.layer=e,!e||!e.nodeType)throw new TypeError("Layer must be a document node");this.onClick=function(){return FastClick.prototype.onClick.apply(n,arguments)},this.onMouse=function(){return FastClick.prototype.onMouse.apply(n,arguments)},this.onTouchStart=function(){return FastClick.prototype.onTouchStart.apply(n,arguments)},this.onTouchMove=function(){return FastClick.prototype.onTouchMove.apply(n,arguments)},this.onTouchEnd=function(){return FastClick.prototype.onTouchEnd.apply(n,arguments)},this.onTouchCancel=function(){return FastClick.prototype.onTouchCancel.apply(n,arguments)},FastClick.notNeeded(e)||(this.deviceIsAndroid&&(e.addEventListener("mouseover",this.onMouse,!0),e.addEventListener("mousedown",this.onMouse,!0),e.addEventListener("mouseup",this.onMouse,!0)),e.addEventListener("click",this.onClick,!0),e.addEventListener("touchstart",this.onTouchStart,!1),e.addEventListener("touchmove",this.onTouchMove,!1),e.addEventListener("touchend",this.onTouchEnd,!1),e.addEventListener("touchcancel",this.onTouchCancel,!1),Event.prototype.stopImmediatePropagation||(e.removeEventListener=function(t,n,r){var i=Node.prototype.removeEventListener;"click"===t?i.call(e,t,n.hijacked||n,r):i.call(e,t,n,r)},e.addEventListener=function(t,n,r){var i=Node.prototype.addEventListener;"click"===t?i.call(e,t,n.hijacked||(n.hijacked=function(e){e.propagationStopped||n(e)}),r):i.call(e,t,n,r)}),"function"==typeof e.onclick&&(t=e.onclick,e.addEventListener("click",function(e){t(e)},!1),e.onclick=null))}function RGBColor(e){this.ok=!1,"#"==e.charAt(0)&&(e=e.substr(1,6)),e=e.replace(/ /g,""),e=e.toLowerCase();var t={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"00ffff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000000",blanchedalmond:"ffebcd",blue:"0000ff",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"00ffff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dodgerblue:"1e90ff",feldspar:"d19275",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"ff00ff",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgrey:"d3d3d3",lightgreen:"90ee90",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslateblue:"8470ff",lightslategray:"778899",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"00ff00",limegreen:"32cd32",linen:"faf0e6",magenta:"ff00ff",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370d8",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"d87093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",red:"ff0000",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",violetred:"d02090",wheat:"f5deb3",white:"ffffff",whitesmoke:"f5f5f5",yellow:"ffff00",yellowgreen:"9acd32"};for(var n in t)e==n&&(e=t[n]);for(var r=[{re:/^rgb\((\d{1,3}),\s*(\d{1,3}),\s*(\d{1,3})\)$/,example:["rgb(123, 234, 45)","rgb(255,234,245)"],process:function(e){return[parseInt(e[1]),parseInt(e[2]),parseInt(e[3])]}},{re:/^(\w{2})(\w{2})(\w{2})$/,example:["#00ff00","336699"],process:function(e){return[parseInt(e[1],16),parseInt(e[2],16),parseInt(e[3],16)]}},{re:/^(\w{1})(\w{1})(\w{1})$/,example:["#fb0","f0f"],process:function(e){return[parseInt(e[1]+e[1],16),parseInt(e[2]+e[2],16),parseInt(e[3]+e[3],16)]}}],i=0;i<r.length;i++){var o=r[i].re,a=r[i].process,s=o.exec(e);s&&(channels=a(s),this.r=channels[0],this.g=channels[1],this.b=channels[2],this.ok=!0)}this.r=this.r<0||isNaN(this.r)?0:this.r>255?255:this.r,this.g=this.g<0||isNaN(this.g)?0:this.g>255?255:this.g,this.b=this.b<0||isNaN(this.b)?0:this.b>255?255:this.b,this.toRGB=function(){return"rgb("+this.r+", "+this.g+", "+this.b+")"},this.toHex=function(){var e=this.r.toString(16),t=this.g.toString(16),n=this.b.toString(16);return 1==e.length&&(e="0"+e),1==t.length&&(t="0"+t),1==n.length&&(n="0"+n),"#"+e+t+n},this.getHelpXML=function(){for(var e=new Array,n=0;n<r.length;n++)for(var i=r[n].example,o=0;o<i.length;o++)e[e.length]=i[o];for(var a in t)e[e.length]=a;var s=document.createElement("ul");s.setAttribute("id","rgbcolor-examples");for(var n=0;n<e.length;n++)try{var l=document.createElement("li"),u=new RGBColor(e[n]),c=document.createElement("div");c.style.cssText="margin: 3px; border: 1px solid black; background:"+u.toHex()+"; color:"+u.toHex(),c.appendChild(document.createTextNode("test"));var d=document.createTextNode(" "+e[n]+" -> "+u.toRGB()+" -> "+u.toHex());l.appendChild(c),l.appendChild(d),s.appendChild(l)}catch(e){}return s}}var requirejs,require,define;!function(e){function t(e,t){return v.call(e,t)}function n(e,t){var n,r,i,o,a,s,l,u,c,d,p=t&&t.split("/"),f=m.map,h=f&&f["*"]||{};if(e&&"."===e.charAt(0))if(t){for(p=p.slice(0,p.length-1),e=p.concat(e.split("/")),u=0;u<e.length;u+=1)if(d=e[u],"."===d)e.splice(u,1),u-=1;else if(".."===d){if(1===u&&(".."===e[2]||".."===e[0]))break;u>0&&(e.splice(u-1,2),u-=2)}e=e.join("/")}else 0===e.indexOf("./")&&(e=e.substring(2));if((p||h)&&f){for(n=e.split("/"),u=n.length;u>0;u-=1){if(r=n.slice(0,u).join("/"),p)for(c=p.length;c>0;c-=1)if(i=f[p.slice(0,c).join("/")],i&&(i=i[r])){o=i,a=u;break}if(o)break;!s&&h&&h[r]&&(s=h[r],l=u)}!o&&s&&(o=s,a=l),o&&(n.splice(0,a,o),e=n.join("/"))}return e}function r(t,n){return function(){return c.apply(e,y.call(arguments,0).concat([t,n]))}}function i(e){return function(t){return n(t,e)}}function o(e){return function(t){f[e]=t}}function a(n){if(t(h,n)){var r=h[n];delete h[n],g[n]=!0,u.apply(e,r)}if(!t(f,n)&&!t(g,n))throw new Error("No "+n);return f[n]}function s(e){var t,n=e?e.indexOf("!"):-1;return n>-1&&(t=e.substring(0,n),e=e.substring(n+1,e.length)),[t,e]}function l(e){return function(){return m&&m.config&&m.config[e]||{}}}var u,c,d,p,f={},h={},m={},g={},v=Object.prototype.hasOwnProperty,y=[].slice;d=function(e,t){var r,o=s(e),l=o[0];return e=o[1],l&&(l=n(l,t),r=a(l)),l?e=r&&r.normalize?r.normalize(e,i(t)):n(e,t):(e=n(e,t),o=s(e),l=o[0],e=o[1],l&&(r=a(l))),{f:l?l+"!"+e:e,n:e,pr:l,p:r}},p={require:function(e){return r(e)},exports:function(e){var t=f[e];return"undefined"!=typeof t?t:f[e]={}},module:function(e){return{id:e,uri:"",exports:f[e],config:l(e)}}},u=function(n,i,s,l){var u,c,m,v,y,b,_=[];if(l=l||n,"function"==typeof s){for(i=!i.length&&s.length?["require","exports","module"]:i,y=0;y<i.length;y+=1)if(v=d(i[y],l),c=v.f,"require"===c)_[y]=p.require(n);else if("exports"===c)_[y]=p.exports(n),b=!0;else if("module"===c)u=_[y]=p.module(n);else if(t(f,c)||t(h,c)||t(g,c))_[y]=a(c);else{if(!v.p)throw new Error(n+" missing "+c);v.p.load(v.n,r(l,!0),o(c),{}),_[y]=f[c]}m=s.apply(f[n],_),n&&(u&&u.exports!==e&&u.exports!==f[n]?f[n]=u.exports:m===e&&b||(f[n]=m))}else n&&(f[n]=s)},requirejs=require=c=function(t,n,r,i,o){return"string"==typeof t?p[t]?p[t](n):a(d(t,n).f):(t.splice||(m=t,n.splice?(t=n,n=r,r=null):t=e),n=n||function(){},"function"==typeof r&&(r=i,i=o),i?u(e,t,n,r):setTimeout(function(){u(e,t,n,r)},4),c)},c.config=function(e){return m=e,m.deps&&c(m.deps,m.callback),c},define=function(e,n,r){n.splice||(r=n,n=[]),t(f,e)||t(h,e)||(h[e]=[e,n,r])},define.amd={jQuery:!0}}(),define("../../vendor/almond/almond",function(){}),define("lab.version",["require"],function(e){return{repo:{branch:"master",commit:{sha:"346e02e72a9c84cbdd64c04a928d72a895a63250",short_sha:"346e02e7",url:"https://github.com/concord-consortium/lab/commit/346e02e7",author:"Piotr Janik",email:"janikpiotrek@gmail.com",date:"2016-08-30 16:42:07 -0400",short_message:"Merge pull request #116 from lepulent/patch-1",message:"Merge pull request #116 from lepulent/patch-1\n\nsrc/locales/es/interactives/oil-and-water.json"},last_tag:"1.13.0",dirty:!0}}}),define("lab.config",[],function(){return{sharing:!0,logging:!1,tracing:!1,homeForSharing:"",homeEmbeddablePath:"/embeddable.html",rootUrl:"lab",modelsRootUrl:"",codap:!1,dataGamesProxyPrefix:"",utmCampaign:null,versionedHome:null}}),function(e,t,n,r,i,o){function a(e){var t,n=e.length,i=this,o=0,a=i.i=i.j=0,s=i.S=[];for(n||(e=[n++]);o<r;)s[o]=o++;for(o=0;o<r;o++)s[o]=s[a=h&a+e[o%n]+(t=s[o])],s[a]=t;(i.g=function(e){for(var t,n=0,o=i.i,a=i.j,s=i.S;e--;)t=s[o=h&o+1],n=n*r+s[h&(s[o]=s[a=h&a+t])+(s[a]=t)];return i.i=o,i.j=a,n})(r)}function s(e,t){var n,r=[],i=(typeof e)[0];if(t&&"o"==i)for(n in e)try{r.push(s(e[n],t-1))}catch(e){}return r.length?r:"s"==i?e:e+"\0"}function l(e,t){for(var n,r=e+"",i=0;i<r.length;)t[h&i]=h&(n^=19*t[h&i])+r.charCodeAt(i++);return c(t)}function u(n){try{return e.crypto.getRandomValues(n=new Uint8Array(r)),c(n)}catch(n){return[+new Date,e,e.navigator.plugins,e.screen,c(t)]}}function c(e){return String.fromCharCode.apply(0,e)}var d=n.pow(r,i),p=n.pow(2,o),f=2*p,h=r-1;n.seedrandom=function(e,o){var h=[],m=l(s(o?[e,c(t)]:0 in arguments?e:u(),3),h),g=new a(h);return l(c(g.S),t),n.random=function(){for(var e=g.g(i),t=d,n=0;e<p;)e=(e+n)*r,t*=r,n=g.g(1);for(;e>=f;)e/=2,t/=2,n>>>=1;return(e+n)/t},m},l(n.random(),t)}(this,[],Math,256,6,52),define("seedrandom",function(){}),define("arrays/index",["require","exports","module"],function(e,t,n){var r={};r.version="0.0.1",r.webgl="undefined"!=typeof window&&!!window.WebGLRenderingContext,r.typed=function(){try{return new Float64Array(0),!0}catch(e){return!1}}(),r.create=function(e,t,n){n||(n=r.webgl||r.typed?"Float32Array":"regular"),void 0===t&&(t=0);var i;if("regular"===n)i=new Array(e);else switch(n){case"Float64Array":i=new Float64Array(e);break;case"Float32Array":i=new Float32Array(e);break;case"Int32Array":i=new Int32Array(e);break;case"Int16Array":i=new Int16Array(e);break;case"Int8Array":i=new Int8Array(e);break;case"Uint32Array":i=new Uint32Array(e);break;case"Uint16Array":i=new Uint16Array(e);break;case"Uint8Array":i=new Uint8Array(e);break;case"Uint8ClampedArray":i=new Uint8ClampedArray(e);break;default:throw new Error("arrays: couldn't understand array type \""+n+'".')}return r.fill(i,t),i},r.fill=function(e,t){for(var n=-1,r=e.length;++n<r;)e[n]=t},r.constructor_function=function(e){if(e.buffer&&e.buffer.__proto__&&e.buffer.__proto__.constructor&&"[object Array]"===Object.prototype.toString.call(e))return e.__proto__.constructor;switch(e.constructor){case Array:return Array;case Float32Array:return Float32Array;case Uint8Array:return Uint8Array;case Float64Array:return Float64Array;case Int32Array:return Int32Array;case Int16Array:return Int16Array;case Int8Array:return Int8Array;case Uint32Array:return Uint32Array;case Uint16Array:return Uint16Array;case Uint8ClampedArray:return Uint8ClampedArray;default:throw new Error("arrays.constructor_function: must be an Array or Typed Array:   source: "+e)}},r.copy=function(e,t,n){for(var i=void 0!==n?n:e.length,o=-1;++o<i;)t[o]=e[o];return r.constructor_function(t)===Array&&(t.length=i),t},r.clone=function(e){var t,n,i,o=e.length;if(i=r.constructor_function(e),i===Array){for(n=new i(o),t=0;t<o;t++)n[t]=e[t];return n}if(e.buffer.slice)return n=new i(e.buffer.slice(0));for(n=new i(o),t=0;t<o;t++)n[t]=e[t];return n},r.between=function(e,t,n){return n<Math.max(e,t)&&n>Math.min(e,t)},r.max=function(e){return Math.max.apply(Math,e)},r.min=function(e){return Math.min.apply(Math,e)},r.maxTypedArray=function(e){var t,n,r=Number.MIN_VALUE,i=e.length;for(n=0;n<i;n++)t=e[n],r=t>r?t:r;return r},r.minTypedArray=function(e){var t,n,r=Number.MAX_VALUE,i=e.length;for(n=0;n<i;n++)t=e[n],r=t<r?t:r;return r},r.maxAnyArray=function(e){try{return Math.max.apply(Math,e)}catch(o){if(o instanceof TypeError){var t,n,r=Number.MIN_VALUE,i=e.length;for(n=0;n<i;n++)t=e[n],r=t>r?t:r;return r}}},r.minAnyArray=function(e){try{return Math.min.apply(Math,e)}catch(o){if(o instanceof TypeError){var t,n,r=Number.MAX_VALUE,i=e.length;for(n=0;n<i;n++)t=e[n],r=t<r?t:r;return r}}},r.average=function(e){var t,n=0,r=e.length;for(t=0;t<r;t++)n+=e[t];return n/r},r.extend=function(e,t){var n,i,o;if(i=r.constructor_function(e),i===Array){for(o=e.length,e.length=t;o<t;o++)e[o]=0;return e}return n=new i(t),n.set(e.subarray(0,t)),n},r.remove=function(e,t){var n,i=r.constructor_function(e);if(i!==Array)throw new Error("arrays.remove for typed arrays not implemented yet.");return n=e.slice(t+1),e.length=t,Array.prototype.push.apply(e,n),e},r.isArray=function(e){if(void 0===e||null===e)return!1;switch(Object.prototype.toString.call(e)){case"[object Array]":case"[object Float32Array]":case"[object Float64Array]":case"[object Uint8Array]":case"[object Uint16Array]":case"[object Uint32Array]":case"[object Uint8ClampedArray]":case"[object Int8Array]":case"[object Int16Array]":case"[object Int32Array]":return!0;default:return!1}};for(var i in r)r.hasOwnProperty(i)&&(t[i]=r[i])}),define("arrays",["arrays/index"],function(e){return e}),FastClick.prototype.deviceIsAndroid=navigator.userAgent.indexOf("Android")>0,FastClick.prototype.deviceIsIOS=/iP(ad|hone|od)/.test(navigator.userAgent),FastClick.prototype.deviceIsIOS4=FastClick.prototype.deviceIsIOS&&/OS 4_\d(_\d)?/.test(navigator.userAgent),FastClick.prototype.deviceIsIOSWithBadTarget=FastClick.prototype.deviceIsIOS&&/OS ([6-9]|\d{2})_\d/.test(navigator.userAgent),FastClick.prototype.needsClick=function(e){"use strict";switch(e.nodeName.toLowerCase()){case"button":case"select":case"textarea":if(e.disabled)return!0;break;case"input":if(this.deviceIsIOS&&"file"===e.type||e.disabled)return!0;break;case"label":case"video":return!0}return/\bneedsclick\b/.test(e.className)},FastClick.prototype.needsFocus=function(e){"use strict";switch(e.nodeName.toLowerCase()){case"textarea":return!0;case"select":return!this.deviceIsAndroid;case"input":switch(e.type){case"button":case"checkbox":case"file":case"image":case"radio":case"submit":return!1}return!e.disabled&&!e.readOnly;default:return/\bneedsfocus\b/.test(e.className)}},FastClick.prototype.sendClick=function(e,t){"use strict";var n,r;document.activeElement&&document.activeElement!==e&&document.activeElement.blur(),r=t.changedTouches[0],n=document.createEvent("MouseEvents"),n.initMouseEvent(this.determineEventType(e),!0,!0,window,1,r.screenX,r.screenY,r.clientX,r.clientY,!1,!1,!1,!1,0,null),n.forwardedTouchEvent=!0,e.dispatchEvent(n)},FastClick.prototype.determineEventType=function(e){"use strict;";return this.deviceIsAndroid&&"select"===e.tagName.toLowerCase()?"mousedown":"click"},FastClick.prototype.focus=function(e){"use strict";var t;this.deviceIsIOS&&e.setSelectionRange&&0!==e.type.indexOf("date")&&"time"!==e.type?(t=e.value.length,e.setSelectionRange(t,t)):e.focus()},FastClick.prototype.updateScrollParent=function(e){"use strict";var t,n;if(t=e.fastClickScrollParent,!t||!t.contains(e)){n=e;do{if(n.scrollHeight>n.offsetHeight){t=n,e.fastClickScrollParent=n;break}n=n.parentElement}while(n)}t&&(t.fastClickLastScrollTop=t.scrollTop)},FastClick.prototype.getTargetElementFromEventTarget=function(e){"use strict";return e.nodeType===Node.TEXT_NODE?e.parentNode:e},FastClick.prototype.onTouchStart=function(e){"use strict";var t,n,r;if(e.targetTouches.length>1)return!0;if(t=this.getTargetElementFromEventTarget(e.target),n=e.targetTouches[0],this.deviceIsIOS){if(r=window.getSelection(),r.rangeCount&&!r.isCollapsed)return!0;if(!this.deviceIsIOS4){if(n.identifier===this.lastTouchIdentifier)return e.preventDefault(),!1;this.lastTouchIdentifier=n.identifier,this.updateScrollParent(t)}}return this.trackingClick=!0,this.trackingClickStart=e.timeStamp,this.targetElement=t,this.touchStartX=n.pageX,this.touchStartY=n.pageY,e.timeStamp-this.lastClickTime<200&&e.preventDefault(),!0},FastClick.prototype.touchHasMoved=function(e){"use strict";var t=e.changedTouches[0],n=this.touchBoundary;return Math.abs(t.pageX-this.touchStartX)>n||Math.abs(t.pageY-this.touchStartY)>n},FastClick.prototype.onTouchMove=function(e){"use strict";return!this.trackingClick||((this.targetElement!==this.getTargetElementFromEventTarget(e.target)||this.touchHasMoved(e))&&(this.trackingClick=!1,this.targetElement=null),!0)},FastClick.prototype.findControl=function(e){"use strict";return void 0!==e.control?e.control:e.htmlFor?document.getElementById(e.htmlFor):e.querySelector("button, input:not([type=hidden]), keygen, meter, output, progress, select, textarea")},FastClick.prototype.onTouchEnd=function(e){"use strict";var t,n,r,i,o,a=this.targetElement;if(!this.trackingClick)return!0;if(e.timeStamp-this.lastClickTime<200)return this.cancelNextClick=!0,!0;if(this.cancelNextClick=!1,this.lastClickTime=e.timeStamp,n=this.trackingClickStart,this.trackingClick=!1,this.trackingClickStart=0,this.deviceIsIOSWithBadTarget&&(o=e.changedTouches[0],a=document.elementFromPoint(o.pageX-window.pageXOffset,o.pageY-window.pageYOffset)||a,a.fastClickScrollParent=this.targetElement.fastClickScrollParent),r=a.tagName.toLowerCase(),"label"===r){if(t=this.findControl(a)){if(this.focus(a),this.deviceIsAndroid)return!1;a=t}}else if(this.needsFocus(a))return e.timeStamp-n>100||this.deviceIsIOS&&window.top!==window&&"input"===r?(this.targetElement=null,!1):(this.focus(a),this.deviceIsIOS4&&"select"===r||(this.targetElement=null,e.preventDefault()),!1);return!(!this.deviceIsIOS||this.deviceIsIOS4||(i=a.fastClickScrollParent,!i||i.fastClickLastScrollTop===i.scrollTop))||(this.needsClick(a)||(e.preventDefault(),this.sendClick(a,e)),!1)},FastClick.prototype.onTouchCancel=function(){"use strict";this.trackingClick=!1,this.targetElement=null},FastClick.prototype.onMouse=function(e){"use strict";return!this.targetElement||(!!e.forwardedTouchEvent||(!e.cancelable||(!(!this.needsClick(this.targetElement)||this.cancelNextClick)||(e.stopImmediatePropagation?e.stopImmediatePropagation():e.propagationStopped=!0,e.stopPropagation(),e.preventDefault(),!1))))},FastClick.prototype.onClick=function(e){"use strict";var t;return this.trackingClick?(this.targetElement=null,this.trackingClick=!1,!0):"submit"===e.target.type&&0===e.detail||(t=this.onMouse(e),t||(this.targetElement=null),t)},FastClick.prototype.destroy=function(){"use strict";var e=this.layer;this.deviceIsAndroid&&(e.removeEventListener("mouseover",this.onMouse,!0),e.removeEventListener("mousedown",this.onMouse,!0),e.removeEventListener("mouseup",this.onMouse,!0)),e.removeEventListener("click",this.onClick,!0),e.removeEventListener("touchstart",this.onTouchStart,!1),e.removeEventListener("touchmove",this.onTouchMove,!1),e.removeEventListener("touchend",this.onTouchEnd,!1),e.removeEventListener("touchcancel",this.onTouchCancel,!1)},FastClick.notNeeded=function(e){"use strict";var t;if("undefined"==typeof window.ontouchstart)return!0;if(/Chrome\/[0-9]+/.test(navigator.userAgent)){if(!FastClick.prototype.deviceIsAndroid)return!0;if(t=document.querySelector("meta[name=viewport]"),t&&t.content.indexOf("user-scalable=no")!==-1)return!0}return"none"===e.style.msTouchAction},FastClick.attach=function(e){"use strict";return new FastClick(e)},"undefined"!=typeof define&&define.amd?define("fastclick",[],function(){"use strict";return FastClick}):"undefined"!=typeof module&&module.exports?(module.exports=FastClick.attach,module.exports.FastClick=FastClick):window.FastClick=FastClick,function(){var e=this,t=e._,n={},r=Array.prototype,i=Object.prototype,o=Function.prototype,a=r.push,s=r.slice,l=r.concat,u=(r.unshift,i.toString),c=i.hasOwnProperty,d=r.forEach,p=r.map,f=r.reduce,h=r.reduceRight,m=r.filter,g=r.every,v=r.some,y=r.indexOf,b=r.lastIndexOf,_=Array.isArray,x=Object.keys,w=o.bind,C=function(e){return e instanceof C?e:this instanceof C?void(this._wrapped=e):new C(e)};"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=C),exports._=C):e._=C,C.VERSION="1.4.2";var T=C.each=C.forEach=function(e,t,r){if(null!=e)if(d&&e.forEach===d)e.forEach(t,r);else if(e.length===+e.length){for(var i=0,o=e.length;i<o;i++)if(t.call(r,e[i],i,e)===n)return}else for(var a in e)if(C.has(e,a)&&t.call(r,e[a],a,e)===n)return};C.map=C.collect=function(e,t,n){var r=[];return null==e?r:p&&e.map===p?e.map(t,n):(T(e,function(e,i,o){r[r.length]=t.call(n,e,i,o)}),r)},C.reduce=C.foldl=C.inject=function(e,t,n,r){var i=arguments.length>2;if(null==e&&(e=[]),f&&e.reduce===f)return r&&(t=C.bind(t,r)),i?e.reduce(t,n):e.reduce(t);if(T(e,function(e,o,a){i?n=t.call(r,n,e,o,a):(n=e,i=!0)}),!i)throw new TypeError("Reduce of empty array with no initial value");return n},C.reduceRight=C.foldr=function(e,t,n,r){var i=arguments.length>2;if(null==e&&(e=[]),h&&e.reduceRight===h)return r&&(t=C.bind(t,r)),arguments.length>2?e.reduceRight(t,n):e.reduceRight(t);var o=e.length;if(o!==+o){var a=C.keys(e);o=a.length}if(T(e,function(s,l,u){l=a?a[--o]:--o,i?n=t.call(r,n,e[l],l,u):(n=e[l],i=!0)}),!i)throw new TypeError("Reduce of empty array with no initial value");return n},C.find=C.detect=function(e,t,n){var r;return S(e,function(e,i,o){if(t.call(n,e,i,o))return r=e,!0}),r},C.filter=C.select=function(e,t,n){var r=[];return null==e?r:m&&e.filter===m?e.filter(t,n):(T(e,function(e,i,o){t.call(n,e,i,o)&&(r[r.length]=e)}),r)},C.reject=function(e,t,n){return C.filter(e,function(e,r,i){return!t.call(n,e,r,i)},n)},C.every=C.all=function(e,t,r){t||(t=C.identity);var i=!0;return null==e?i:g&&e.every===g?e.every(t,r):(T(e,function(e,o,a){if(!(i=i&&t.call(r,e,o,a)))return n}),!!i)};var S=C.some=C.any=function(e,t,r){t||(t=C.identity);var i=!1;return null==e?i:v&&e.some===v?e.some(t,r):(T(e,function(e,o,a){if(i||(i=t.call(r,e,o,a)))return n}),!!i)};C.contains=C.include=function(e,t){return null!=e&&(y&&e.indexOf===y?e.indexOf(t)!=-1:S(e,function(e){return e===t}))},C.invoke=function(e,t){var n=s.call(arguments,2);return C.map(e,function(e){return(C.isFunction(t)?t:e[t]).apply(e,n)})},C.pluck=function(e,t){return C.map(e,function(e){return e[t]})},C.where=function(e,t){return C.isEmpty(t)?[]:C.filter(e,function(e){for(var n in t)if(t[n]!==e[n])return!1;return!0})},C.max=function(e,t,n){if(!t&&C.isArray(e)&&e[0]===+e[0]&&e.length<65535)return Math.max.apply(Math,e);if(!t&&C.isEmpty(e))return-(1/0);var r={computed:-(1/0)};return T(e,function(e,i,o){var a=t?t.call(n,e,i,o):e;a>=r.computed&&(r={value:e,computed:a})}),r.value},C.min=function(e,t,n){if(!t&&C.isArray(e)&&e[0]===+e[0]&&e.length<65535)return Math.min.apply(Math,e);if(!t&&C.isEmpty(e))return 1/0;var r={computed:1/0};return T(e,function(e,i,o){var a=t?t.call(n,e,i,o):e;a<r.computed&&(r={value:e,computed:a})}),r.value},C.shuffle=function(e){var t,n=0,r=[];return T(e,function(e){t=C.random(n++),r[n-1]=r[t],r[t]=e}),r};var A=function(e){return C.isFunction(e)?e:function(t){return t[e]}};C.sortBy=function(e,t,n){var r=A(t);return C.pluck(C.map(e,function(e,t,i){return{value:e,index:t,criteria:r.call(n,e,t,i)}}).sort(function(e,t){var n=e.criteria,r=t.criteria;if(n!==r){if(n>r||void 0===n)return 1;if(n<r||void 0===r)return-1}return e.index<t.index?-1:1}),"value")};var k=function(e,t,n,r){var i={},o=A(t);return T(e,function(t,a){var s=o.call(n,t,a,e);r(i,s,t)}),i};C.groupBy=function(e,t,n){return k(e,t,n,function(e,t,n){(C.has(e,t)?e[t]:e[t]=[]).push(n)})},C.countBy=function(e,t,n){return k(e,t,n,function(e,t,n){C.has(e,t)||(e[t]=0),e[t]++})},C.sortedIndex=function(e,t,n,r){n=null==n?C.identity:A(n);for(var i=n.call(r,t),o=0,a=e.length;o<a;){var s=o+a>>>1;n.call(r,e[s])<i?o=s+1:a=s}return o},C.toArray=function(e){return e?e.length===+e.length?s.call(e):C.values(e):[]},C.size=function(e){return null==e?0:e.length===+e.length?e.length:C.keys(e).length},C.first=C.head=C.take=function(e,t,n){if(null!=e)return null==t||n?e[0]:s.call(e,0,t)},C.initial=function(e,t,n){return s.call(e,0,e.length-(null==t||n?1:t))},C.last=function(e,t,n){if(null!=e)return null==t||n?e[e.length-1]:s.call(e,Math.max(e.length-t,0))},C.rest=C.tail=C.drop=function(e,t,n){return s.call(e,null==t||n?1:t)},C.compact=function(e){return C.filter(e,function(e){return!!e})};var P=function(e,t,n){return T(e,function(e){C.isArray(e)?t?a.apply(n,e):P(e,t,n):n.push(e)}),n};C.flatten=function(e,t){return P(e,t,[])},C.without=function(e){return C.difference(e,s.call(arguments,1))},C.uniq=C.unique=function(e,t,n,r){C.isFunction(t)&&(r=n,n=t,t=!1);var i=n?C.map(e,n,r):e,o=[],a=[];return T(i,function(n,r){(t?r&&a[a.length-1]===n:C.contains(a,n))||(a.push(n),o.push(e[r]))}),o},C.union=function(){return C.uniq(l.apply(r,arguments))},C.intersection=function(e){var t=s.call(arguments,1);return C.filter(C.uniq(e),function(e){return C.every(t,function(t){return C.indexOf(t,e)>=0})})},C.difference=function(e){var t=l.apply(r,s.call(arguments,1));return C.filter(e,function(e){return!C.contains(t,e)})},C.zip=function(){for(var e=s.call(arguments),t=C.max(C.pluck(e,"length")),n=new Array(t),r=0;r<t;r++)n[r]=C.pluck(e,""+r);return n},C.object=function(e,t){if(null==e)return{};for(var n={},r=0,i=e.length;r<i;r++)t?n[e[r]]=t[r]:n[e[r][0]]=e[r][1];return n},C.indexOf=function(e,t,n){if(null==e)return-1;var r=0,i=e.length;if(n){if("number"!=typeof n)return r=C.sortedIndex(e,t),e[r]===t?r:-1;r=n<0?Math.max(0,i+n):n}if(y&&e.indexOf===y)return e.indexOf(t,n);for(;r<i;r++)if(e[r]===t)return r;return-1},C.lastIndexOf=function(e,t,n){if(null==e)return-1;var r=null!=n;if(b&&e.lastIndexOf===b)return r?e.lastIndexOf(t,n):e.lastIndexOf(t);for(var i=r?n:e.length;i--;)if(e[i]===t)return i;return-1},C.range=function(e,t,n){arguments.length<=1&&(t=e||0,e=0),n=arguments[2]||1;for(var r=Math.max(Math.ceil((t-e)/n),0),i=0,o=new Array(r);i<r;)o[i++]=e,e+=n;return o};var E=function(){};C.bind=function(e,t){var n,r;if(e.bind===w&&w)return w.apply(e,s.call(arguments,1));if(!C.isFunction(e))throw new TypeError;return r=s.call(arguments,2),n=function(){if(!(this instanceof n))return e.apply(t,r.concat(s.call(arguments)));E.prototype=e.prototype;var i=new E,o=e.apply(i,r.concat(s.call(arguments)));return Object(o)===o?o:i}},C.bindAll=function(e){var t=s.call(arguments,1);return 0==t.length&&(t=C.functions(e)),T(t,function(t){e[t]=C.bind(e[t],e)}),e},C.memoize=function(e,t){var n={};return t||(t=C.identity),function(){var r=t.apply(this,arguments);return C.has(n,r)?n[r]:n[r]=e.apply(this,arguments)}},C.delay=function(e,t){var n=s.call(arguments,2);return setTimeout(function(){return e.apply(null,n)},t)},C.defer=function(e){return C.delay.apply(C,[e,1].concat(s.call(arguments,1)))},C.throttle=function(e,t){var n,r,i,o,a=0,s=function(){a=new Date,i=null,o=e.apply(n,r)};return function(){var l=new Date,u=t-(l-a);return n=this,r=arguments,u<=0?(clearTimeout(i),a=l,o=e.apply(n,r)):i||(i=setTimeout(s,u)),o}},C.debounce=function(e,t,n){var r,i;return function(){var o=this,a=arguments,s=function(){r=null,n||(i=e.apply(o,a))},l=n&&!r;return clearTimeout(r),r=setTimeout(s,t),l&&(i=e.apply(o,a)),i}},C.once=function(e){var t,n=!1;return function(){return n?t:(n=!0,t=e.apply(this,arguments),e=null,t)}},C.wrap=function(e,t){return function(){var n=[e];return a.apply(n,arguments),t.apply(this,n)}},C.compose=function(){var e=arguments;return function(){for(var t=arguments,n=e.length-1;n>=0;n--)t=[e[n].apply(this,t)];return t[0]}},C.after=function(e,t){return e<=0?t():function(){if(--e<1)return t.apply(this,arguments)}},C.keys=x||function(e){if(e!==Object(e))throw new TypeError("Invalid object");var t=[];for(var n in e)C.has(e,n)&&(t[t.length]=n);return t},C.values=function(e){var t=[];for(var n in e)C.has(e,n)&&t.push(e[n]);return t},C.pairs=function(e){var t=[];for(var n in e)C.has(e,n)&&t.push([n,e[n]]);return t},C.invert=function(e){var t={};for(var n in e)C.has(e,n)&&(t[e[n]]=n);return t},C.functions=C.methods=function(e){var t=[];for(var n in e)C.isFunction(e[n])&&t.push(n);return t.sort()},C.extend=function(e){return T(s.call(arguments,1),function(t){for(var n in t)e[n]=t[n]}),e},C.pick=function(e){var t={},n=l.apply(r,s.call(arguments,1));return T(n,function(n){n in e&&(t[n]=e[n])}),t},C.omit=function(e){var t={},n=l.apply(r,s.call(arguments,1));for(var i in e)C.contains(n,i)||(t[i]=e[i]);return t},C.defaults=function(e){return T(s.call(arguments,1),function(t){for(var n in t)null==e[n]&&(e[n]=t[n])}),e},C.clone=function(e){return C.isObject(e)?C.isArray(e)?e.slice():C.extend({},e):e},C.tap=function(e,t){return t(e),e};var O=function(e,t,n,r){if(e===t)return 0!==e||1/e==1/t;if(null==e||null==t)return e===t;e instanceof C&&(e=e._wrapped),t instanceof C&&(t=t._wrapped);var i=u.call(e);if(i!=u.call(t))return!1;switch(i){case"[object String]":return e==String(t);case"[object Number]":return e!=+e?t!=+t:0==e?1/e==1/t:e==+t;case"[object Date]":case"[object Boolean]":return+e==+t;case"[object RegExp]":return e.source==t.source&&e.global==t.global&&e.multiline==t.multiline&&e.ignoreCase==t.ignoreCase}if("object"!=typeof e||"object"!=typeof t)return!1;for(var o=n.length;o--;)if(n[o]==e)return r[o]==t;n.push(e),r.push(t);var a=0,s=!0;if("[object Array]"==i){if(a=e.length,s=a==t.length)for(;a--&&(s=O(e[a],t[a],n,r)););}else{var l=e.constructor,c=t.constructor;if(l!==c&&!(C.isFunction(l)&&l instanceof l&&C.isFunction(c)&&c instanceof c))return!1;for(var d in e)if(C.has(e,d)&&(a++,!(s=C.has(t,d)&&O(e[d],t[d],n,r))))break;if(s){for(d in t)if(C.has(t,d)&&!a--)break;s=!a}}return n.pop(),r.pop(),s};C.isEqual=function(e,t){return O(e,t,[],[])},C.isEmpty=function(e){if(null==e)return!0;if(C.isArray(e)||C.isString(e))return 0===e.length;for(var t in e)if(C.has(e,t))return!1;return!0},C.isElement=function(e){return!(!e||1!==e.nodeType)},C.isArray=_||function(e){return"[object Array]"==u.call(e)},C.isObject=function(e){return e===Object(e)},T(["Arguments","Function","String","Number","Date","RegExp"],function(e){C["is"+e]=function(t){return u.call(t)=="[object "+e+"]"}}),C.isArguments(arguments)||(C.isArguments=function(e){return!(!e||!C.has(e,"callee"))}),"function"!=typeof/./&&(C.isFunction=function(e){return"function"==typeof e}),C.isFinite=function(e){return isFinite(e)&&!isNaN(parseFloat(e))},C.isNaN=function(e){return C.isNumber(e)&&e!=+e},C.isBoolean=function(e){return e===!0||e===!1||"[object Boolean]"==u.call(e)},C.isNull=function(e){return null===e},C.isUndefined=function(e){return void 0===e},C.has=function(e,t){return c.call(e,t)},C.noConflict=function(){return e._=t,this},C.identity=function(e){return e},C.times=function(e,t,n){for(var r=0;r<e;r++)t.call(n,r)},C.random=function(e,t){return null==t&&(t=e,e=0),e+(0|Math.random()*(t-e+1))};var M={escape:{"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","/":"&#x2F;"}};M.unescape=C.invert(M.escape);var L={escape:new RegExp("["+C.keys(M.escape).join("")+"]","g"),unescape:new RegExp("("+C.keys(M.unescape).join("|")+")","g")
};C.each(["escape","unescape"],function(e){C[e]=function(t){return null==t?"":(""+t).replace(L[e],function(t){return M[e][t]})}}),C.result=function(e,t){if(null==e)return null;var n=e[t];return C.isFunction(n)?n.call(e):n},C.mixin=function(e){T(C.functions(e),function(t){var n=C[t]=e[t];C.prototype[t]=function(){var e=[this._wrapped];return a.apply(e,arguments),B.call(this,n.apply(C,e))}})};var N=0;C.uniqueId=function(e){var t=N++;return e?e+t:t},C.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var R=/(.)^/,I={"'":"'","\\":"\\","\r":"r","\n":"n","\t":"t","\u2028":"u2028","\u2029":"u2029"},D=/\\|'|\r|\n|\t|\u2028|\u2029/g;C.template=function(e,t,n){n=C.defaults({},n,C.templateSettings);var r=new RegExp([(n.escape||R).source,(n.interpolate||R).source,(n.evaluate||R).source].join("|")+"|$","g"),i=0,o="__p+='";e.replace(r,function(t,n,r,a,s){o+=e.slice(i,s).replace(D,function(e){return"\\"+I[e]}),o+=n?"'+\n((__t=("+n+"))==null?'':_.escape(__t))+\n'":r?"'+\n((__t=("+r+"))==null?'':__t)+\n'":a?"';\n"+a+"\n__p+='":"",i=s+t.length}),o+="';\n",n.variable||(o="with(obj||{}){\n"+o+"}\n"),o="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+o+"return __p;\n";try{var a=new Function(n.variable||"obj","_",o)}catch(e){throw e.source=o,e}if(t)return a(t,C);var s=function(e){return a.call(this,e,C)};return s.source="function("+(n.variable||"obj")+"){\n"+o+"}",s},C.chain=function(e){return C(e).chain()};var B=function(e){return this._chain?C(e).chain():e};C.mixin(C),T(["pop","push","reverse","shift","sort","splice","unshift"],function(e){var t=r[e];C.prototype[e]=function(){var n=this._wrapped;return t.apply(n,arguments),"shift"!=e&&"splice"!=e||0!==n.length||delete n[0],B.call(this,n)}}),T(["concat","join","slice"],function(e){var t=r[e];C.prototype[e]=function(){return B.call(this,t.apply(this._wrapped,arguments))}}),C.extend(C.prototype,{chain:function(){return this._chain=!0,this},value:function(){return this._wrapped}})}.call(this),define("underscore",function(e){return function(){var t;return t||e._}}(this)),define("common/console",["require","lab.config"],function(e){var t,n,r=e("lab.config"),i=function(){};return"undefined"==typeof console&&(console={},window&&(window.console=console)),n=console,void 0===n.log&&(n.log=i),void 0===n.info&&(n.info=i),void 0===n.warn&&(n.warn=i),void 0===n.error&&(n.error=i),void 0===n.time&&(n.time=i),void 0===n.timeEnd&&(n.timeEnd=i),void 0===n.log.apply&&(n.log=Function.prototype.bind.call(console.log,console)),void 0===n.info.apply&&(n.info=Function.prototype.bind.call(console.info,console)),void 0===n.warn.apply&&(n.warn=Function.prototype.bind.call(console.warn,console)),void 0===n.error.apply&&(n.error=Function.prototype.bind.call(console.error,console)),void 0===n.time.apply&&(n.time=Function.prototype.bind.call(console.time,console)),void 0===n.timeEnd.apply&&(n.timeEnd=Function.prototype.bind.call(console.timeEnd,console)),t={log:function(){r.logging&&n.log.apply(n,arguments)},info:function(){r.logging&&n.info.apply(n,arguments)},warn:function(){r.logging&&n.warn.apply(n,arguments)},error:function(){r.logging&&n.error.apply(n,arguments)},time:function(){r.tracing&&n.time.apply(n,arguments)},timeEnd:function(){r.tracing&&n.timeEnd.apply(n,arguments)}}}),define("common/alert",["require","common/console"],function(e){var t=e("common/console"),n="undefined"!=typeof alert?alert:t.error;return function(e){n(e)}}),define("common/validator",["require","arrays"],function(e){function t(e,t){this.prop=e,this.message=t}function n(e){return null!==e&&"object"==typeof e}function r(e,n,r){var i,o;for(i=0,o=r.length;i<o;i++)if(e.hasOwnProperty(r[i]))throw new t(n,"Properties set contains conflicting properties: "+r[i]+" and "+n)}function i(e,n,r,i){if(e.readOnly)throw new t(n,"Properties set tries to overwrite read-only property "+n);if(!i&&e.immutable)throw new t(n,"Properties set tries to overwrite immutable property "+n);return e.validate?e.validate(r):r}var o=e("arrays");return t.prototype=new Error,t.prototype.constructor=t,{validate:function(e,t,n){var o,a,s={};if(arguments.length<2)throw new Error("Incorrect usage. Provide metadata and hash which should be validated.");for(o in t)t.hasOwnProperty(o)&&(a=e[o],"undefined"!=typeof a&&(t[o]=i(a,o,t[o],n),a.conflictsWith&&r(t,o,a.conflictsWith),s[o]=t[o]));return s},validateSingleProperty:i,propertyIsWritable:function(e){return!e.readOnly},propertyChangeInvalidates:function(e){return"undefined"==typeof e.propertyChangeInvalidates||!!e.propertyChangeInvalidates},validateCompleteness:function(e,r,i){var a,s,l,u={},c=i&&i.includeOnlySerializedProperties;if(arguments.length<2)throw new Error("Incorrect usage. Provide metadata and hash which should be validated.");for(a in e)if(e.hasOwnProperty(a)){if(s=e[a],c&&s.serialize===!1)continue;if(l=s.defaultValue,"undefined"==typeof r[a]){if(s.required===!0)throw new t(a,"Properties set is missing required property "+a);o.isArray(l)?u[a]=o.copy(l,[]):n(l)?u[a]=$.extend(!0,{},l):"undefined"!=typeof l&&(u[a]=l)}else!o.isArray(r[a])&&n(r[a])&&n(l)?u[a]=$.extend(!0,{},l,r[a]):o.isArray(r[a])?u[a]=$.extend(!0,[],r[a]):u[a]=r[a]}return this.validate(e,u,!0)},ValidationError:t}}),function(e,t){"object"==typeof exports?module.exports=t():"function"==typeof define&&define.amd&&define("i18next",[],t)}(this,function(){function e(e,t){if(!t||"function"==typeof t)return e;for(var n in t)e[n]=t[n];return e}function t(e,t,n){var r,i=0,o=e.length,a=void 0===o||"[object Array]"!==Object.prototype.toString.apply(e)||"function"==typeof e;if(n)if(a){for(r in e)if(t.apply(e[r],n)===!1)break}else for(;i<o&&t.apply(e[i++],n)!==!1;);else if(a){for(r in e)if(t.call(e[r],r,e[r])===!1)break}else for(;i<o&&t.call(e[i],i,e[i++])!==!1;);return e}function n(e){return"string"==typeof e?e.replace(/[&<>"'\/]/g,function(e){return N[e]}):e}function r(e){var t=function(e){if(window.XMLHttpRequest)return e(null,new XMLHttpRequest);if(window.ActiveXObject)try{return e(null,new ActiveXObject("Msxml2.XMLHTTP"))}catch(t){return e(null,new ActiveXObject("Microsoft.XMLHTTP"))}return e(new Error)},n=function(e){if("string"==typeof e)return e;var t=[];for(var n in e)e.hasOwnProperty(n)&&t.push(encodeURIComponent(n)+"="+encodeURIComponent(e[n]));return t.join("&")},r=function(e){e=e.replace(/\r\n/g,"\n");for(var t="",n=0;n<e.length;n++){var r=e.charCodeAt(n);r<128?t+=String.fromCharCode(r):r>127&&r<2048?(t+=String.fromCharCode(r>>6|192),t+=String.fromCharCode(63&r|128)):(t+=String.fromCharCode(r>>12|224),t+=String.fromCharCode(r>>6&63|128),t+=String.fromCharCode(63&r|128))}return t},i=function(e){var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";e=r(e);var n,i,o,a,s,l,u,c="",d=0;do n=e.charCodeAt(d++),i=e.charCodeAt(d++),o=e.charCodeAt(d++),a=n>>2,s=(3&n)<<4|i>>4,l=(15&i)<<2|o>>6,u=63&o,isNaN(i)?l=u=64:isNaN(o)&&(u=64),c+=t.charAt(a)+t.charAt(s)+t.charAt(l)+t.charAt(u),n=i=o="",a=s=l=u="";while(d<e.length);return c},o=function(){for(var e=arguments[0],t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)n.hasOwnProperty(r)&&(e[r]=n[r])}return e},a=function(e,r,i,s){"function"==typeof i&&(s=i,i={}),i.cache=i.cache||!1,i.data=i.data||{},i.headers=i.headers||{},i.jsonp=i.jsonp||!1,i.async=void 0===i.async||i.async;var l,u=o({accept:"*/*","content-type":"application/x-www-form-urlencoded;charset=UTF-8"},a.headers,i.headers);if(l="application/json"===u["content-type"]?JSON.stringify(i.data):n(i.data),"GET"===e){var c=[];if(l&&(c.push(l),l=null),i.cache||c.push("_="+(new Date).getTime()),i.jsonp&&(c.push("callback="+i.jsonp),c.push("jsonp="+i.jsonp)),c=c.join("&"),c.length>1&&(r+=r.indexOf("?")>-1?"&"+c:"?"+c),i.jsonp){var d=document.getElementsByTagName("head")[0],p=document.createElement("script");return p.type="text/javascript",p.src=r,void d.appendChild(p)}}t(function(t,n){if(t)return s(t);n.open(e,r,i.async);for(var o in u)u.hasOwnProperty(o)&&n.setRequestHeader(o,u[o]);n.onreadystatechange=function(){if(4===n.readyState){var e=n.responseText||"";if(!s)return;s(n.status,{text:function(){return e},json:function(){return JSON.parse(e)}})}},n.send(l)})},s={authBasic:function(e,t){a.headers.Authorization="Basic "+i(e+":"+t)},connect:function(e,t,n){return a("CONNECT",e,t,n)},del:function(e,t,n){return a("DELETE",e,t,n)},get:function(e,t,n){return a("GET",e,t,n)},head:function(e,t,n){return a("HEAD",e,t,n)},headers:function(e){a.headers=e||{}},isAllowed:function(e,t,n){this.options(e,function(e,r){n(r.text().indexOf(t)!==-1)})},options:function(e,t,n){return a("OPTIONS",e,t,n)},patch:function(e,t,n){return a("PATCH",e,t,n)},post:function(e,t,n){return a("POST",e,t,n)},put:function(e,t,n){return a("PUT",e,t,n)},trace:function(e,t,n){return a("TRACE",e,t,n)}},l=e.type?e.type.toLowerCase():"get";s[l](e.url,e,function(t,n){200===t?e.success(n.json(),t,null):e.error(n.text(),t,null)})}function i(e,t){"function"==typeof e&&(t=e,e={}),e=e||{},D.extend(L,e),delete L.fixLng,"string"==typeof L.ns&&(L.ns={namespaces:[L.ns],defaultNs:L.ns}),"string"==typeof L.fallbackNS&&(L.fallbackNS=[L.fallbackNS]),"string"!=typeof L.fallbackLng&&"boolean"!=typeof L.fallbackLng||(L.fallbackLng=[L.fallbackLng]),L.interpolationPrefixEscaped=D.regexEscape(L.interpolationPrefix),L.interpolationSuffixEscaped=D.regexEscape(L.interpolationSuffix),L.lng||(L.lng=D.detectLanguage()),L.lng?L.useCookie&&D.cookie.create(L.cookieName,L.lng,L.cookieExpirationTime,L.cookieDomain):(L.lng=L.fallbackLng[0],L.useCookie&&D.cookie.remove(L.cookieName)),O=D.toLanguages(L.lng),S=O[0],D.log("currentLng set to: "+S);var n=b;e.fixLng&&(n=function(e,t){return t=t||{},t.lng=t.lng||n.lng,b(e,t)},n.lng=S),V.setCurrentLng(S),A&&L.setJqueryExt&&f();var r;if(A&&A.Deferred&&(r=A.Deferred()),L.resStore){if(P=L.resStore,M=!0,t&&t(n),r&&r.resolve(n),r)return r.promise()}else{var i=D.toLanguages(L.lng);"string"==typeof L.preload&&(L.preload=[L.preload]);for(var o=0,a=L.preload.length;o<a;o++)for(var s=D.toLanguages(L.preload[o]),l=0,u=s.length;l<u;l++)i.indexOf(s[l])<0&&i.push(s[l]);if(k.sync.load(i,L,function(e,i){P=i,M=!0,t&&t(n),r&&r.resolve(n)}),r)return r.promise()}}function o(e,t){"string"==typeof e&&(e=[e]);for(var n=0,r=e.length;n<r;n++)L.preload.indexOf(e[n])<0&&L.preload.push(e[n]);return i(t)}function a(e,t,n){"string"!=typeof t?(n=t,t=L.ns.defaultNs):L.ns.namespaces.indexOf(t)<0&&L.ns.namespaces.push(t),P[e]=P[e]||{},P[e][t]=P[e][t]||{},D.extend(P[e][t],n)}function s(e,t){"string"!=typeof t&&(t=L.ns.defaultNs),P[e]=P[e]||{},P[e][t]={}}function l(e){L.ns.defaultNs=e}function u(e,t){c([e],t)}function c(e,t){var n={dynamicLoad:L.dynamicLoad,resGetPath:L.resGetPath,getAsync:L.getAsync,customLoad:L.customLoad,ns:{namespaces:e,defaultNs:""}},r=D.toLanguages(L.lng);"string"==typeof L.preload&&(L.preload=[L.preload]);for(var i=0,o=L.preload.length;i<o;i++)for(var a=D.toLanguages(L.preload[i]),s=0,l=a.length;s<l;s++)r.indexOf(a[s])<0&&r.push(a[s]);for(var u=[],c=0,d=r.length;c<d;c++){var p=!1,f=P[r[c]];if(f)for(var h=0,m=e.length;h<m;h++)f[e[h]]||(p=!0);else p=!0;p&&u.push(r[c])}u.length?k.sync._fetch(u,n,function(n,r){var i=e.length*u.length;D.each(e,function(e,n){L.ns.namespaces.indexOf(n)<0&&L.ns.namespaces.push(n),D.each(u,function(e,o){P[o]=P[o]||{},P[o][n]=r[o][n],i--,0===i&&t&&(L.useLocalStorage&&k.sync._storeLocal(P),t())})})}):t&&t()}function d(e,t,n){return"function"==typeof t?(n=t,t={}):t||(t={}),t.lng=e,i(t,n)}function p(){return S}function f(){function e(e,t,n){if(0!==t.length){var r="text";if(0===t.indexOf("[")){var i=t.split("]");t=i[1],r=i[0].substr(1,i[0].length-1)}t.indexOf(";")===t.length-1&&(t=t.substr(0,t.length-2));var o;if("html"===r)o=L.defaultValueFromContent?A.extend({defaultValue:e.html()},n):n,e.html(A.t(t,o));else if("text"===r)o=L.defaultValueFromContent?A.extend({defaultValue:e.text()},n):n,e.text(A.t(t,o));else if("prepend"===r)o=L.defaultValueFromContent?A.extend({defaultValue:e.html()},n):n,e.prepend(A.t(t,o));else if("append"===r)o=L.defaultValueFromContent?A.extend({defaultValue:e.html()},n):n,e.append(A.t(t,o));else if(0===r.indexOf("data-")){var a=r.substr("data-".length);o=L.defaultValueFromContent?A.extend({defaultValue:e.data(a)},n):n;var s=A.t(t,o);e.data(a,s),e.attr(r,s)}else o=L.defaultValueFromContent?A.extend({defaultValue:e.attr(r)},n):n,e.attr(r,A.t(t,o))}}function t(t,n){var r=t.attr(L.selectorAttr);if(r||"undefined"==typeof r||r===!1||(r=t.text()||t.val()),r){var i=t,o=t.data("i18n-target");if(o&&(i=t.find(o)||t),n||L.useDataAttrOptions!==!0||(n=t.data("i18n-options")),n=n||{},r.indexOf(";")>=0){var a=r.split(";");A.each(a,function(t,r){""!==r&&e(i,r,n)})}else e(i,r,n);L.useDataAttrOptions===!0&&t.data("i18n-options",n)}}A.t=A.t||b,A.fn.i18n=function(e){return this.each(function(){t(A(this),e);var n=A(this).find("["+L.selectorAttr+"]");n.each(function(){t(A(this),e)})})}}function h(e,t,n,r){if(!e)return e;if(r=r||t,e.indexOf(r.interpolationPrefix||L.interpolationPrefix)<0)return e;var i=r.interpolationPrefix?D.regexEscape(r.interpolationPrefix):L.interpolationPrefixEscaped,o=r.interpolationSuffix?D.regexEscape(r.interpolationSuffix):L.interpolationSuffixEscaped,a="HTML"+o;return D.each(t,function(t,s){var l=n?n+L.keyseparator+t:t;"object"==typeof s&&null!==s?e=h(e,s,l,r):r.escapeInterpolation||L.escapeInterpolation?(e=e.replace(new RegExp([i,l,a].join(""),"g"),s),e=e.replace(new RegExp([i,l,o].join(""),"g"),D.escape(s))):e=e.replace(new RegExp([i,l,o].join(""),"g"),s)}),e}function m(e,t){var n=",",r="{",i="}",o=D.extend({},t);for(delete o.postProcess;e.indexOf(L.reusePrefix)!=-1&&(E++,!(E>L.maxRecursion));){var a=e.lastIndexOf(L.reusePrefix),s=e.indexOf(L.reuseSuffix,a)+L.reuseSuffix.length,l=e.substring(a,s),u=l.replace(L.reusePrefix,"").replace(L.reuseSuffix,"");if(u.indexOf(n)!=-1){var c=u.indexOf(n);if(u.indexOf(r,c)!=-1&&u.indexOf(i,c)!=-1){var d=u.indexOf(r,c),p=u.indexOf(i,d)+i.length;try{o=D.extend(o,JSON.parse(u.substring(d,p))),u=u.substring(0,c)}catch(e){}}}var f=w(u,o);e=e.replace(l,f)}return e}function g(e){return e.context&&("string"==typeof e.context||"number"==typeof e.context)}function v(e){return void 0!==e.count&&"string"!=typeof e.count&&1!==e.count}function y(e,t){t=t||{};var n=_(e,t),r=C(e,t);return void 0!==r||r===n}function b(e,t){return t=t||{},M?(E=0,w.apply(null,arguments)):(D.log("i18next not finished initialization. you might have called t function before loading resources finished."),t.defaultValue||"")}function _(e,t){return void 0!==t.defaultValue?t.defaultValue:e}function x(){for(var e=[],t=1;t<arguments.length;t++)e.push(arguments[t]);return{postProcess:"sprintf",sprintf:e}}function w(e,t){if(t&&"object"!=typeof t?"sprintf"===L.shortcutFunction?t=x.apply(null,arguments):"defaultValue"===L.shortcutFunction&&(t={defaultValue:t}):t=t||{},void 0===e||null===e)return"";"string"==typeof e&&(e=[e]);var n=e[0];if(e.length>1)for(var r=0;r<e.length&&(n=e[r],!y(n,t));r++);var i,o=_(n,t),a=C(n,t),s=t.lng?D.toLanguages(t.lng):O,l=t.ns||L.ns.defaultNs;n.indexOf(L.nsseparator)>-1&&(i=n.split(L.nsseparator),l=i[0],n=i[1]),void 0===a&&L.sendMissing&&(t.lng?B.postMissing(s[0],l,n,o,s):B.postMissing(L.lng,l,n,o,s));var u=t.postProcess||L.postProcess;void 0!==a&&u&&j[u]&&(a=j[u](a,n,t));var c=o;if(o.indexOf(L.nsseparator)>-1&&(i=o.split(L.nsseparator),c=i[1]),c===n&&L.parseMissingKey&&(o=L.parseMissingKey(o)),void 0===a&&(o=h(o,t),o=m(o,t),u&&j[u])){var d=_(n,t);a=j[u](d,n,t)}return void 0!==a?a:o}function C(e,t){t=t||{};var n,r,i=_(e,t),o=O;if(!P)return i;if("cimode"===o[0].toLowerCase())return i;if(t.lng&&(o=D.toLanguages(t.lng),!P[o[0]])){var a=L.getAsync;L.getAsync=!1,k.sync.load(o,L,function(e,t){D.extend(P,t),L.getAsync=a})}var s=t.ns||L.ns.defaultNs;if(e.indexOf(L.nsseparator)>-1){var l=e.split(L.nsseparator);s=l[0],e=l[1]}if(g(t)){n=D.extend({},t),delete n.context,n.defaultValue=L.contextNotFound;var u=s+L.nsseparator+e+"_"+t.context;if(r=b(u,n),r!=L.contextNotFound)return h(r,{context:t.context})}if(v(t)){n=D.extend({},t),delete n.count,n.defaultValue=L.pluralNotFound;var c=s+L.nsseparator+e+L.pluralSuffix,d=V.get(o[0],t.count);if(d>=0?c=c+"_"+d:1===d&&(c=s+L.nsseparator+e),r=b(c,n),r!=L.pluralNotFound)return h(r,{count:t.count,interpolationPrefix:t.interpolationPrefix,interpolationSuffix:t.interpolationSuffix})}for(var p,f=e.split(L.keyseparator),y=0,x=o.length;y<x&&void 0===p;y++){for(var T=o[y],S=0,A=P[T]&&P[T][s];f[S];)A=A&&A[f[S]],S++;if(void 0!==A){var E=Object.prototype.toString.apply(A);if("string"==typeof A)A=h(A,t),A=m(A,t);else if("[object Array]"!==E||L.returnObjectTrees||t.returnObjectTrees){if(null===A&&L.fallbackOnNull===!0)A=void 0;else if(null!==A)if(L.returnObjectTrees||t.returnObjectTrees){if("[object Number]"!==E&&"[object Function]"!==E&&"[object RegExp]"!==E){var M="[object Array]"===E?[]:{};D.each(A,function(n){M[n]=w(s+L.nsseparator+e+L.keyseparator+n,t)}),A=M}}else L.objectTreeKeyHandler&&"function"==typeof L.objectTreeKeyHandler?A=L.objectTreeKeyHandler(e,A,T,s,t):(A="key '"+s+":"+e+" ("+T+")' returned an object instead of string.",D.log(A))}else A=A.join("\n"),A=h(A,t),A=m(A,t);"string"==typeof A&&""===A.trim()&&L.fallbackOnEmpty===!0&&(A=void 0),p=A}}if(void 0===p&&!t.isFallbackLookup&&(L.fallbackToDefaultNS===!0||L.fallbackNS&&L.fallbackNS.length>0))if(t.isFallbackLookup=!0,L.fallbackNS.length){for(var N=0,R=L.fallbackNS.length;N<R;N++)if(p=C(L.fallbackNS[N]+L.nsseparator+e,t)){var I=p.indexOf(L.nsseparator)>-1?p.split(L.nsseparator)[1]:p,B=i.indexOf(L.nsseparator)>-1?i.split(L.nsseparator)[1]:i;if(I!==B)break}}else p=C(e,t);return p}function T(){var e,t=[];if("undefined"!=typeof window&&(!function(){for(var e=window.location.search.substring(1),n=e.split("&"),r=0;r<n.length;r++){var i=n[r].indexOf("=");if(i>0){var o=n[r].substring(0,i),a=n[r].substring(i+1);t[o]=a}}}(),t[L.detectLngQS]&&(e=t[L.detectLngQS])),!e&&"undefined"!=typeof document&&L.useCookie){var n=D.cookie.read(L.cookieName);n&&(e=n)}return e||"undefined"==typeof navigator||(e=navigator.language?navigator.language:navigator.userLanguage),e}Array.prototype.indexOf||(Array.prototype.indexOf=function(e){"use strict";if(null==this)throw new TypeError;var t=Object(this),n=t.length>>>0;if(0===n)return-1;var r=0;if(arguments.length>0&&(r=Number(arguments[1]),r!=r?r=0:0!=r&&r!=1/0&&r!=-(1/0)&&(r=(r>0||-1)*Math.floor(Math.abs(r)))),r>=n)return-1;for(var i=r>=0?r:Math.max(n-Math.abs(r),0);i<n;i++)if(i in t&&t[i]===e)return i;return-1}),Array.prototype.lastIndexOf||(Array.prototype.lastIndexOf=function(e){"use strict";if(null==this)throw new TypeError;var t=Object(this),n=t.length>>>0;if(0===n)return-1;var r=n;arguments.length>1&&(r=Number(arguments[1]),r!=r?r=0:0!=r&&r!=1/0&&r!=-(1/0)&&(r=(r>0||-1)*Math.floor(Math.abs(r))));for(var i=r>=0?Math.min(r,n-1):n-Math.abs(r);i>=0;i--)if(i in t&&t[i]===e)return i;return-1}),"function"!=typeof String.prototype.trim&&(String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")});var S,A=void 0,k={},P={},E=0,O=[],M=!1,L={lng:void 0,load:"all",preload:[],lowerCaseLng:!1,returnObjectTrees:!1,fallbackLng:["dev"],fallbackNS:[],detectLngQS:"setLng",ns:"translation",fallbackOnNull:!0,fallbackOnEmpty:!1,fallbackToDefaultNS:!1,nsseparator:":",keyseparator:".",selectorAttr:"data-i18n",debug:!1,resGetPath:"locales/__lng__/__ns__.json",resPostPath:"locales/add/__lng__/__ns__",getAsync:!0,postAsync:!0,resStore:void 0,useLocalStorage:!1,localStorageExpirationTime:6048e5,dynamicLoad:!1,sendMissing:!1,sendMissingTo:"fallback",sendType:"POST",interpolationPrefix:"__",interpolationSuffix:"__",reusePrefix:"$t(",reuseSuffix:")",pluralSuffix:"_plural",pluralNotFound:["plural_not_found",Math.random()].join(""),contextNotFound:["context_not_found",Math.random()].join(""),escapeInterpolation:!1,setJqueryExt:!0,defaultValueFromContent:!0,useDataAttrOptions:!1,cookieExpirationTime:void 0,useCookie:!0,cookieName:"i18next",cookieDomain:void 0,objectTreeKeyHandler:void 0,postProcess:void 0,parseMissingKey:void 0,shortcutFunction:"sprintf"},N={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"},R={create:function(e,t,n,r){var i;if(n){var o=new Date;o.setTime(o.getTime()+60*n*1e3),i="; expires="+o.toGMTString()}else i="";r=r?"domain="+r+";":"",document.cookie=e+"="+t+i+";"+r+"path=/"},read:function(e){for(var t=e+"=",n=document.cookie.split(";"),r=0;r<n.length;r++){for(var i=n[r];" "==i.charAt(0);)i=i.substring(1,i.length);if(0===i.indexOf(t))return i.substring(t.length,i.length)}return null},remove:function(e){this.create(e,"",-1)}},I={create:function(e,t,n,r){},read:function(e){return null},remove:function(e){}},D={extend:A?A.extend:e,each:A?A.each:t,ajax:A?A.ajax:"undefined"!=typeof document?r:function(){},cookie:"undefined"!=typeof document?R:I,detectLanguage:T,escape:n,log:function(e){L.debug&&"undefined"!=typeof console&&console.log(e)},toLanguages:function(e){var t=[];if("string"==typeof e&&e.indexOf("-")>-1){var n=e.split("-");e=L.lowerCaseLng?n[0].toLowerCase()+"-"+n[1].toLowerCase():n[0].toLowerCase()+"-"+n[1].toUpperCase(),"unspecific"!==L.load&&t.push(e),"current"!==L.load&&t.push(n[0])}else t.push(e);for(var r=0;r<L.fallbackLng.length;r++)t.indexOf(L.fallbackLng[r])===-1&&L.fallbackLng[r]&&t.push(L.fallbackLng[r]);return t},regexEscape:function(e){return e.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")}};D.applyReplacement=h;var B={load:function(e,t,n){t.useLocalStorage?B._loadLocal(e,t,function(r,i){for(var o=[],a=0,s=e.length;a<s;a++)i[e[a]]||o.push(e[a]);o.length>0?B._fetch(o,t,function(e,t){D.extend(i,t),B._storeLocal(t),n(null,i)}):n(null,i)}):B._fetch(e,t,function(e,t){n(null,t)})},_loadLocal:function(e,t,n){var r={},i=(new Date).getTime();if(window.localStorage){var o=e.length;D.each(e,function(e,a){var s=window.localStorage.getItem("res_"+a);s&&(s=JSON.parse(s),s.i18nStamp&&s.i18nStamp+t.localStorageExpirationTime>i&&(r[a]=s)),o--,0===o&&n(null,r)})}},_storeLocal:function(e){if(window.localStorage)for(var t in e)e[t].i18nStamp=(new Date).getTime(),window.localStorage.setItem("res_"+t,JSON.stringify(e[t]))},_fetch:function(e,t,n){var r=t.ns,i={};if(t.dynamicLoad){var o=function(e,t){n(null,t)};if("function"==typeof t.customLoad)t.customLoad(e,r.namespaces,t,o);else{var a=h(t.resGetPath,{lng:e.join("+"),ns:r.namespaces.join("+")});D.ajax({url:a,success:function(e,t,n){D.log("loaded: "+a),o(null,e)},error:function(e,t,n){D.log("failed loading: "+a),o("failed loading resource.json error: "+n)},dataType:"json",async:t.getAsync})}}else{var s,l=r.namespaces.length*e.length;D.each(r.namespaces,function(r,o){D.each(e,function(e,r){var a=function(e,t){e&&(s=s||[],s.push(e)),i[r]=i[r]||{},i[r][o]=t,l--,0===l&&n(s,i)};"function"==typeof t.customLoad?t.customLoad(r,o,t,a):B._fetchOne(r,o,t,a)})})}},_fetchOne:function(e,t,n,r){var i=h(n.resGetPath,{lng:e,ns:t});D.ajax({url:i,success:function(e,t,n){D.log("loaded: "+i),r(null,e)},error:function(e,t,n){if(t&&200==t||e&&e.status&&200==e.status)D.log("There is a typo in: "+i);else if(t&&404==t||e&&e.status&&404==e.status)D.log("Does not exist: "+i);else{var o=t?t:e&&e.status?e.status:null;D.log(o+" when loading "+i)}r(n,{})},dataType:"json",async:n.getAsync})},postMissing:function(e,t,n,r,i){var o={};o[n]=r;var a=[];if("fallback"===L.sendMissingTo&&L.fallbackLng[0]!==!1)for(var s=0;s<L.fallbackLng.length;s++)a.push({lng:L.fallbackLng[s],url:h(L.resPostPath,{lng:L.fallbackLng[s],ns:t})});else if("current"===L.sendMissingTo||"fallback"===L.sendMissingTo&&L.fallbackLng[0]===!1)a.push({lng:e,url:h(L.resPostPath,{lng:e,ns:t})});else if("all"===L.sendMissingTo)for(var s=0,l=i.length;s<l;s++)a.push({lng:i[s],url:h(L.resPostPath,{lng:i[s],ns:t})});for(var u=0,c=a.length;u<c;u++){var d=a[u];D.ajax({url:d.url,type:L.sendType,data:o,success:function(e,i,o){D.log("posted missing key '"+n+"' to: "+d.url);for(var a=n.split("."),s=0,l=P[d.lng][t];a[s];)l=s===a.length-1?l[a[s]]=r:l[a[s]]=l[a[s]]||{},s++},error:function(e,t,r){D.log("failed posting missing key '"+n+"' to: "+d.url)},dataType:"json",async:L.postAsync})}}},V={rules:{ach:{name:"Acholi",numbers:[1,2],plurals:function(e){return Number(e>1)}},af:{name:"Afrikaans",numbers:[1,2],plurals:function(e){return Number(1!=e)}},ak:{name:"Akan",numbers:[1,2],plurals:function(e){return Number(e>1)}},am:{name:"Amharic",numbers:[1,2],plurals:function(e){return Number(e>1)}},an:{name:"Aragonese",numbers:[1,2],plurals:function(e){return Number(1!=e)}},ar:{name:"Arabic",numbers:[0,1,2,3,11,100],plurals:function(e){return Number(0===e?0:1==e?1:2==e?2:e%100>=3&&e%100<=10?3:e%100>=11?4:5)}},arn:{name:"Mapudungun",numbers:[1,2],plurals:function(e){return Number(e>1)}},ast:{name:"Asturian",numbers:[1,2],plurals:function(e){return Number(1!=e)}},ay:{name:"Aymará",numbers:[1],plurals:function(e){return 0}},az:{name:"Azerbaijani",numbers:[1,2],plurals:function(e){return Number(1!=e)}},be:{name:"Belarusian",numbers:[1,2,5],plurals:function(e){return Number(e%10==1&&e%100!=11?0:e%10>=2&&e%10<=4&&(e%100<10||e%100>=20)?1:2)}},bg:{name:"Bulgarian",numbers:[1,2],plurals:function(e){return Number(1!=e)}},bn:{name:"Bengali",numbers:[1,2],plurals:function(e){return Number(1!=e)}},bo:{name:"Tibetan",numbers:[1],plurals:function(e){return 0}},br:{name:"Breton",numbers:[1,2],plurals:function(e){return Number(e>1)}},bs:{name:"Bosnian",numbers:[1,2,5],plurals:function(e){return Number(e%10==1&&e%100!=11?0:e%10>=2&&e%10<=4&&(e%100<10||e%100>=20)?1:2)}},ca:{name:"Catalan",numbers:[1,2],plurals:function(e){return Number(1!=e)}},cgg:{name:"Chiga",numbers:[1],plurals:function(e){return 0}},cs:{name:"Czech",numbers:[1,2,5],plurals:function(e){return Number(1==e?0:e>=2&&e<=4?1:2)}},csb:{name:"Kashubian",numbers:[1,2,5],plurals:function(e){return Number(1==e?0:e%10>=2&&e%10<=4&&(e%100<10||e%100>=20)?1:2)}},cy:{name:"Welsh",numbers:[1,2,3,8],plurals:function(e){return Number(1==e?0:2==e?1:8!=e&&11!=e?2:3)}},da:{name:"Danish",numbers:[1,2],plurals:function(e){return Number(1!=e)}},de:{name:"German",numbers:[1,2],plurals:function(e){return Number(1!=e)}},dz:{name:"Dzongkha",numbers:[1],plurals:function(e){return 0}},el:{name:"Greek",numbers:[1,2],plurals:function(e){return Number(1!=e)}},en:{name:"English",numbers:[1,2],plurals:function(e){return Number(1!=e)}},eo:{name:"Esperanto",numbers:[1,2],plurals:function(e){return Number(1!=e)}},es:{name:"Spanish",numbers:[1,2],plurals:function(e){return Number(1!=e)}},es_ar:{name:"Argentinean Spanish",numbers:[1,2],plurals:function(e){return Number(1!=e)}},et:{name:"Estonian",numbers:[1,2],plurals:function(e){return Number(1!=e)}},eu:{name:"Basque",numbers:[1,2],plurals:function(e){return Number(1!=e)}},fa:{name:"Persian",numbers:[1],plurals:function(e){return 0}},fi:{name:"Finnish",numbers:[1,2],plurals:function(e){return Number(1!=e)}},fil:{name:"Filipino",numbers:[1,2],plurals:function(e){return Number(e>1)}},fo:{name:"Faroese",numbers:[1,2],plurals:function(e){return Number(1!=e)}},fr:{name:"French",numbers:[1,2],plurals:function(e){return Number(e>1)}},fur:{name:"Friulian",numbers:[1,2],plurals:function(e){return Number(1!=e)}},fy:{name:"Frisian",numbers:[1,2],plurals:function(e){return Number(1!=e)}},ga:{name:"Irish",numbers:[1,2,3,7,11],plurals:function(e){return Number(1==e?0:2==e?1:e<7?2:e<11?3:4)}},gd:{name:"Scottish Gaelic",numbers:[1,2,3,20],plurals:function(e){return Number(1==e||11==e?0:2==e||12==e?1:e>2&&e<20?2:3)}},gl:{name:"Galician",numbers:[1,2],plurals:function(e){return Number(1!=e)}},gu:{name:"Gujarati",numbers:[1,2],plurals:function(e){return Number(1!=e)}},gun:{name:"Gun",numbers:[1,2],plurals:function(e){return Number(e>1)}},ha:{name:"Hausa",numbers:[1,2],plurals:function(e){return Number(1!=e)}},he:{name:"Hebrew",numbers:[1,2],plurals:function(e){return Number(1!=e)}},hi:{name:"Hindi",numbers:[1,2],plurals:function(e){return Number(1!=e)}},hr:{name:"Croatian",numbers:[1,2,5],plurals:function(e){return Number(e%10==1&&e%100!=11?0:e%10>=2&&e%10<=4&&(e%100<10||e%100>=20)?1:2)}},hu:{name:"Hungarian",numbers:[1,2],plurals:function(e){return Number(1!=e)}},hy:{name:"Armenian",numbers:[1,2],plurals:function(e){return Number(1!=e)}},ia:{name:"Interlingua",numbers:[1,2],plurals:function(e){return Number(1!=e)}},id:{name:"Indonesian",numbers:[1],plurals:function(e){return 0}},is:{name:"Icelandic",numbers:[1,2],plurals:function(e){return Number(e%10!=1||e%100==11)}},it:{name:"Italian",numbers:[1,2],plurals:function(e){return Number(1!=e)}},ja:{name:"Japanese",numbers:[1],plurals:function(e){return 0}},jbo:{name:"Lojban",numbers:[1],plurals:function(e){return 0}},jv:{name:"Javanese",numbers:[0,1],plurals:function(e){return Number(0!==e)}},ka:{name:"Georgian",numbers:[1],plurals:function(e){return 0}},kk:{name:"Kazakh",numbers:[1],plurals:function(e){return 0}},km:{name:"Khmer",numbers:[1],plurals:function(e){return 0}},kn:{name:"Kannada",numbers:[1,2],plurals:function(e){return Number(1!=e)}},ko:{name:"Korean",numbers:[1],plurals:function(e){return 0}},ku:{name:"Kurdish",numbers:[1,2],plurals:function(e){return Number(1!=e)}},kw:{name:"Cornish",numbers:[1,2,3,4],plurals:function(e){return Number(1==e?0:2==e?1:3==e?2:3)}},ky:{name:"Kyrgyz",numbers:[1],plurals:function(e){return 0}},lb:{name:"Letzeburgesch",numbers:[1,2],plurals:function(e){return Number(1!=e)}},ln:{name:"Lingala",numbers:[1,2],plurals:function(e){return Number(e>1)}},lo:{name:"Lao",numbers:[1],plurals:function(e){return 0}},lt:{name:"Lithuanian",numbers:[1,2,10],plurals:function(e){return Number(e%10==1&&e%100!=11?0:e%10>=2&&(e%100<10||e%100>=20)?1:2)}},lv:{name:"Latvian",numbers:[1,2,0],plurals:function(e){return Number(e%10==1&&e%100!=11?0:0!==e?1:2)}},mai:{name:"Maithili",numbers:[1,2],plurals:function(e){return Number(1!=e)}},mfe:{name:"Mauritian Creole",numbers:[1,2],plurals:function(e){return Number(e>1)}},mg:{name:"Malagasy",numbers:[1,2],plurals:function(e){return Number(e>1)}},mi:{name:"Maori",numbers:[1,2],plurals:function(e){return Number(e>1)}},mk:{name:"Macedonian",numbers:[1,2],plurals:function(e){return Number(1==e||e%10==1?0:1)}},ml:{name:"Malayalam",numbers:[1,2],plurals:function(e){return Number(1!=e)}},mn:{name:"Mongolian",numbers:[1,2],plurals:function(e){return Number(1!=e)}},mnk:{name:"Mandinka",numbers:[0,1,2],plurals:function(e){return Number(1==e?1:2)}},mr:{name:"Marathi",numbers:[1,2],plurals:function(e){return Number(1!=e)}},ms:{name:"Malay",numbers:[1],plurals:function(e){return 0}},mt:{name:"Maltese",numbers:[1,2,11,20],plurals:function(e){return Number(1==e?0:0===e||e%100>1&&e%100<11?1:e%100>10&&e%100<20?2:3)}},nah:{name:"Nahuatl",numbers:[1,2],plurals:function(e){return Number(1!=e)}},nap:{name:"Neapolitan",numbers:[1,2],plurals:function(e){return Number(1!=e)}},nb:{name:"Norwegian Bokmal",numbers:[1,2],plurals:function(e){return Number(1!=e)}},ne:{name:"Nepali",numbers:[1,2],plurals:function(e){return Number(1!=e)}},nl:{name:"Dutch",numbers:[1,2],plurals:function(e){return Number(1!=e)}},nn:{name:"Norwegian Nynorsk",numbers:[1,2],plurals:function(e){return Number(1!=e)}},no:{name:"Norwegian",numbers:[1,2],plurals:function(e){return Number(1!=e)}},nso:{name:"Northern Sotho",numbers:[1,2],plurals:function(e){return Number(1!=e)}},oc:{name:"Occitan",numbers:[1,2],plurals:function(e){return Number(e>1)}},or:{name:"Oriya",numbers:[2,1],plurals:function(e){return Number(1!=e)}},pa:{name:"Punjabi",numbers:[1,2],plurals:function(e){return Number(1!=e)}},pap:{name:"Papiamento",numbers:[1,2],plurals:function(e){return Number(1!=e)}},pl:{name:"Polish",numbers:[1,2,5],plurals:function(e){return Number(1==e?0:e%10>=2&&e%10<=4&&(e%100<10||e%100>=20)?1:2)}},pms:{name:"Piemontese",numbers:[1,2],plurals:function(e){return Number(1!=e)}},ps:{name:"Pashto",numbers:[1,2],plurals:function(e){return Number(1!=e)}},pt:{name:"Portuguese",numbers:[1,2],plurals:function(e){return Number(1!=e)}},pt_br:{name:"Brazilian Portuguese",numbers:[1,2],plurals:function(e){return Number(1!=e)}},rm:{name:"Romansh",numbers:[1,2],plurals:function(e){return Number(1!=e)}},ro:{name:"Romanian",numbers:[1,2,20],
plurals:function(e){return Number(1==e?0:0===e||e%100>0&&e%100<20?1:2)}},ru:{name:"Russian",numbers:[1,2,5],plurals:function(e){return Number(e%10==1&&e%100!=11?0:e%10>=2&&e%10<=4&&(e%100<10||e%100>=20)?1:2)}},sah:{name:"Yakut",numbers:[1],plurals:function(e){return 0}},sco:{name:"Scots",numbers:[1,2],plurals:function(e){return Number(1!=e)}},se:{name:"Northern Sami",numbers:[1,2],plurals:function(e){return Number(1!=e)}},si:{name:"Sinhala",numbers:[1,2],plurals:function(e){return Number(1!=e)}},sk:{name:"Slovak",numbers:[1,2,5],plurals:function(e){return Number(1==e?0:e>=2&&e<=4?1:2)}},sl:{name:"Slovenian",numbers:[5,1,2,3],plurals:function(e){return Number(e%100==1?1:e%100==2?2:e%100==3||e%100==4?3:0)}},so:{name:"Somali",numbers:[1,2],plurals:function(e){return Number(1!=e)}},son:{name:"Songhay",numbers:[1,2],plurals:function(e){return Number(1!=e)}},sq:{name:"Albanian",numbers:[1,2],plurals:function(e){return Number(1!=e)}},sr:{name:"Serbian",numbers:[1,2,5],plurals:function(e){return Number(e%10==1&&e%100!=11?0:e%10>=2&&e%10<=4&&(e%100<10||e%100>=20)?1:2)}},su:{name:"Sundanese",numbers:[1],plurals:function(e){return 0}},sv:{name:"Swedish",numbers:[1,2],plurals:function(e){return Number(1!=e)}},sw:{name:"Swahili",numbers:[1,2],plurals:function(e){return Number(1!=e)}},ta:{name:"Tamil",numbers:[1,2],plurals:function(e){return Number(1!=e)}},te:{name:"Telugu",numbers:[1,2],plurals:function(e){return Number(1!=e)}},tg:{name:"Tajik",numbers:[1,2],plurals:function(e){return Number(e>1)}},th:{name:"Thai",numbers:[1],plurals:function(e){return 0}},ti:{name:"Tigrinya",numbers:[1,2],plurals:function(e){return Number(e>1)}},tk:{name:"Turkmen",numbers:[1,2],plurals:function(e){return Number(1!=e)}},tr:{name:"Turkish",numbers:[1,2],plurals:function(e){return Number(e>1)}},tt:{name:"Tatar",numbers:[1],plurals:function(e){return 0}},ug:{name:"Uyghur",numbers:[1],plurals:function(e){return 0}},uk:{name:"Ukrainian",numbers:[1,2,5],plurals:function(e){return Number(e%10==1&&e%100!=11?0:e%10>=2&&e%10<=4&&(e%100<10||e%100>=20)?1:2)}},ur:{name:"Urdu",numbers:[1,2],plurals:function(e){return Number(1!=e)}},uz:{name:"Uzbek",numbers:[1,2],plurals:function(e){return Number(e>1)}},vi:{name:"Vietnamese",numbers:[1],plurals:function(e){return 0}},wa:{name:"Walloon",numbers:[1,2],plurals:function(e){return Number(e>1)}},wo:{name:"Wolof",numbers:[1],plurals:function(e){return 0}},yo:{name:"Yoruba",numbers:[1,2],plurals:function(e){return Number(1!=e)}},zh:{name:"Chinese",numbers:[1],plurals:function(e){return 0}}},addRule:function(e,t){V.rules[e]=t},setCurrentLng:function(e){if(!V.currentRule||V.currentRule.lng!==e){var t=e.split("-");V.currentRule={lng:e,rule:V.rules[t[0]]}}},get:function(e,t){function n(t,n){var r;if(r=V.currentRule&&V.currentRule.lng===e?V.currentRule.rule:V.rules[t]){var i=r.plurals(n),o=r.numbers[i];return 2===r.numbers.length&&1===r.numbers[0]&&(2===o?o=-1:1===o&&(o=1)),o}return 1===n?"1":"-1"}var r=e.split("-");return n(r[0],t)}},j={},F=function(e,t){j[e]=t},z=function(){function e(e){return Object.prototype.toString.call(e).slice(8,-1).toLowerCase()}function t(e,t){for(var n=[];t>0;n[--t]=e);return n.join("")}var n=function(){return n.cache.hasOwnProperty(arguments[0])||(n.cache[arguments[0]]=n.parse(arguments[0])),n.format.call(null,n.cache[arguments[0]],arguments)};return n.format=function(n,r){var i,o,a,s,l,u,c,d=1,p=n.length,f="",h=[];for(o=0;o<p;o++)if(f=e(n[o]),"string"===f)h.push(n[o]);else if("array"===f){if(s=n[o],s[2])for(i=r[d],a=0;a<s[2].length;a++){if(!i.hasOwnProperty(s[2][a]))throw z('[sprintf] property "%s" does not exist',s[2][a]);i=i[s[2][a]]}else i=s[1]?r[s[1]]:r[d++];if(/[^s]/.test(s[8])&&"number"!=e(i))throw z("[sprintf] expecting number but found %s",e(i));switch(s[8]){case"b":i=i.toString(2);break;case"c":i=String.fromCharCode(i);break;case"d":i=parseInt(i,10);break;case"e":i=s[7]?i.toExponential(s[7]):i.toExponential();break;case"f":i=s[7]?parseFloat(i).toFixed(s[7]):parseFloat(i);break;case"o":i=i.toString(8);break;case"s":i=(i=String(i))&&s[7]?i.substring(0,s[7]):i;break;case"u":i=Math.abs(i);break;case"x":i=i.toString(16);break;case"X":i=i.toString(16).toUpperCase()}i=/[def]/.test(s[8])&&s[3]&&i>=0?"+"+i:i,u=s[4]?"0"==s[4]?"0":s[4].charAt(1):" ",c=s[6]-String(i).length,l=s[6]?t(u,c):"",h.push(s[5]?i+l:l+i)}return h.join("")},n.cache={},n.parse=function(e){for(var t=e,n=[],r=[],i=0;t;){if(null!==(n=/^[^\x25]+/.exec(t)))r.push(n[0]);else if(null!==(n=/^\x25{2}/.exec(t)))r.push("%");else{if(null===(n=/^\x25(?:([1-9]\d*)\$|\(([^\)]+)\))?(\+)?(0|'[^$])?(-)?(\d+)?(?:\.(\d+))?([b-fosuxX])/.exec(t)))throw"[sprintf] huh?";if(n[2]){i|=1;var o=[],a=n[2],s=[];if(null===(s=/^([a-z_][a-z_\d]*)/i.exec(a)))throw"[sprintf] huh?";for(o.push(s[1]);""!==(a=a.substring(s[0].length));)if(null!==(s=/^\.([a-z_][a-z_\d]*)/i.exec(a)))o.push(s[1]);else{if(null===(s=/^\[(\d+)\]/.exec(a)))throw"[sprintf] huh?";o.push(s[1])}n[2]=o}else i|=2;if(3===i)throw"[sprintf] mixing positional and named placeholders is not (yet) supported";r.push(n)}t=t.substring(n[0].length)}return r},n}(),G=function(e,t){return t.unshift(e),z.apply(null,t)};return F("sprintf",function(e,t,n){return n.sprintf?"[object Array]"===Object.prototype.toString.apply(n.sprintf)?G(e,n.sprintf):"object"==typeof n.sprintf?z(e,n.sprintf):e:e}),k.init=i,k.setLng=d,k.preload=o,k.addResourceBundle=a,k.removeResourceBundle=s,k.loadNamespace=u,k.loadNamespaces=c,k.setDefaultNamespace=l,k.t=b,k.translate=b,k.exists=y,k.detectLanguage=D.detectLanguage,k.pluralExtensions=V,k.sync=B,k.functions=D,k.lng=p,k.addPostProcessor=F,k.options=L,k}),!function(e){"object"==typeof exports?module.exports=e():"function"==typeof define&&define.amd?define("lab-grapher",e):"undefined"!=typeof window?window.LabGrapher=e():"undefined"!=typeof global?global.LabGrapher=e():"undefined"!=typeof self&&(self.LabGrapher=e())}(function(){return function e(t,n,r){function i(a,s){if(!n[a]){if(!t[a]){var l="function"==typeof require&&require;if(!s&&l)return l(a,!0);if(o)return o(a,!0);throw new Error("Cannot find module '"+a+"'")}var u=n[a]={exports:{}};t[a][0].call(u.exports,function(e){var n=t[a][1][e];return i(n?n:e)},u,u.exports,e,t,n,r)}return n[a].exports}for(var o="function"==typeof require&&require,a=0;a<r.length;a++)i(r[a]);return i}({1:[function(e,t,n){t.exports.numberWidth=function(e,t,n,r,i){var o,a,s,l,u,c;return o=e.append("svg").attr("width",t).attr("height",n).attr("class","graph"),a=o.append("g").append("text").attr("class","axis").attr("x",-r/4+"px").attr("dy",".35em").attr("text-anchor","end").text(i),c=a.node(),c.getBBox?(s=a.node().getBBox(),l=s.width,u=s.height):(l=0,u=0),o.remove(),[l,u]},t.exports.axisProcessDrag=function(e,t,n){var r,i,o=n,a=0,s=n[0],l=n[1],u=l-s;return 0!==t&&(s>=0&&l>s?(a=s,r=e-a,i=.4*r+a,t>i&&(change=r/(t-a),u=l-a,o=[s,s+u*change])):s<0&&l>0?(a=0,r=e-a,i=.4*r+a,(e>=0&&t>i||e<0&&t<i)&&(change=r/(t-a),o=[s*change,l*change])):s<0&&l<0&&(a=l,r=e-a,i=.4*r+a,t<i&&(change=r/(t-a),u=s-a,o=[l+u*change,l]))),o[0]=+o[0].toPrecision(5),o[1]=+o[1].toPrecision(5),o}},{}],2:[function(e,t,n){var r=e("./axis"),i=e("./i18n");t.exports=function(e,t,n){function o(e,n,r){switch(!n&&t||(t=u(n)),t.lang&&(i.lang=t.lang),a(e,r),t.xrange=t.xmax-t.xmin,t.yrange=t.ymax-t.ymin,_n="[object Array]"===Object.prototype.toString.call(t.title)?t.title:[t.title],_n.reverse(),cn=t.sampleInterval,dn=t.dataSampleStart,tn=t.lineWidth,Ke={width:120,height:120},f(),mt=d3.format(t.xFormatter),gt=d3.format(t.yFormatter),ft=function(e){var t=lt.domain(),n=Math.abs(.01*(t[1]-t[0]));return Math.abs(0+e)<n&&(e=0),mt(e)},ht=function(e){var t=ut.domain(),n=Math.abs(.01*(t[1]-t[0]));return Math.abs(0+e)<n&&(e=0),gt(e)},ct=t.xTickCount,dt=t.yTickCount,on=sn=1/0,an=ln=-(1/0),nn=[],t.dataType){case"fake":En=v(),nn=[En];break;case"points":Re(t.dataPoints);break;case"samples":Ie(t.dataSamples,cn,dn)}Pn=[],kn=null,y(En.length)}function a(e,r){e&&(qe=d3.select(e),He=qe.node(),We=$(He),Ye=qe.property("clientWidth"),Xe=qe.property("clientHeight")),r&&(n=r),void 0!==Je&&(Je.remove(),Je=void 0),void 0!==wt&&(wt.remove(),wt=void 0),void 0!==St&&(St.remove(),St=void 0),Pt=t.dataChange?"ns-resize":"crosshair",s(),Tn=NaN,Sn=NaN,An=null}function s(e,t){e||t?(Ye=e,He.style.width=Ye+"px",t?(Xe=t,He.style.height=Xe+"px"):(He.style.height="100%",t=qe.property("clientHeight"),Xe=t,He.style.height=Xe+"px")):(Ye=Math.max(qe.property("clientWidth"),60),Xe=Math.max(qe.property("clientHeight"),60)),p()}function l(){s(),Et=parseFloat(We.css("font-size")),t.fontScaleRelativeToParent||We.css("font-size",.5+wn.value/6+"em"),Et=parseFloat(We.css("font-size")),Ot=Et/2,Mt=Et/4,void 0===Je?(Lt=Et,Nt=Et,Rt=Et,It=Et):(Lt=parseFloat($("svg.graph text.title").css("font-size")),Nt=parseFloat($("svg.graph text.axis").css("font-size")),Rt=parseFloat($("svg.graph text.xlabel").css("font-size")),It=parseFloat($("svg.graph text.ylabel").css("font-size"))),d(),h(),pt=d3.svg.line().x(function(e,t){return lt(En[t][0])}).y(function(e,t){return ut(En[t][1])})}function u(e){if(e)for(var t in Mn)void 0===e[t]&&(e[t]=Mn[t]);else e=Mn;return e.axisShift<1&&(e.axisShift=1),e}function c(){var e=Et;return t.title&&(e=1.8*Lt),"horizontal"===t.buttonsLayout&&(e+=1.3*Et),e}function d(){switch(Dt=[Et,Et],Bt=[2*Et,Et],void 0!==lt&&(lt.ticks(ct).forEach(function(e){var t=r.numberWidth(qe,Ye,Xe,Nt,ft(e));t[0]>Dt[0]&&(Dt=t)}),ut.ticks(dt).forEach(function(e){var t=r.numberWidth(qe,Ye,Xe,Nt,ht(e));t[0]>Bt[0]&&(Bt=t)})),Vt=Dt[0],Ft=Dt[1],Ut=.6*Vt,Wt=1.1*Ft,Gt=Wt+1.3*Ft,qt=Gt-Ft/3,jt=Bt[0],zt=Bt[1],Yt=jt+Ft/4,$t=Yt+zt,Ht=-(Yt+zt/4),t.hideAxisValues&&(qt-=1.3*Ft,Ht=-It/4),wn.value){case 0:Qe={top:Ot,right:Ot,bottom:1.25*Rt,left:1.25*It};break;case 1:Qe={top:c(),right:Ot,bottom:1.25*Rt,left:1.25*It};break;case 2:Qe={top:c(),right:Ut,bottom:t.hideAxisValues?1.25*Rt:1.25*Nt,left:t.hideAxisValues?1.25*It:1.25*jt},ct=Math.max(6,t.xTickCount/2),dt=Math.max(6,t.yTickCount/2);break;case 3:Qe={top:c(),right:Ut,bottom:t.hideAxisValues?1.25*Rt:t.xlabel?Gt:1.25*Nt,left:t.hideAxisValues?1.25*It:t.ylabel?$t:jt};break;default:Qe={top:c(),right:Ut,bottom:t.hideAxisValues?1.25*Rt:t.xlabel?Gt:1.25*Nt,left:t.hideAxisValues?1.25*It:t.ylabel?$t:jt}}wn.value>2?Qe.top+=(_n.length-1)*wn.value/3*wn.value/3*Et:_n=[_n[0]],Ke.width=Math.max(Ye-Qe.left-Qe.right,60),Ke.height=Math.max(Xe-Qe.top-Qe.bottom,60)}function p(){t.responsiveLayout?Ye<=wn.icon?(wn.category="icon",wn.value=0):Ye<=wn.tiny?(wn.category="tiny",wn.value=1):Ye<=wn.small?(wn.category="small",wn.value=2):Ye<=wn.medium?(wn.category="medium",wn.value=3):(wn.category="large",wn.value=4):(wn.category="large",wn.value=4)}function f(){function e(e,t){var n=e.domain,r=e.nice;return e.domain=function(){var r=n.apply(e,arguments);return arguments.length&&t(),r},e.nice=function(){var n=r.apply(e,arguments);return t(),n},e}lt=e(d3.scale[t.xscale](),function(){t.xmin=lt.domain()[0],t.xmax=lt.domain()[1],t.onXDomainChange&&t.onXDomainChange.call(null,t.xmin,t.xmax)}),ut=e(d3.scale[t.yscale](),function(){t.ymin=ut.domain()[0],t.ymax=ut.domain()[1],t.onYDomainChange&&t.onYDomainChange.call(null,t.ymin,t.ymax)}),h()}function h(){m(),g()}function m(){lt.domain([t.xmin,t.xmax]).range([0,Ke.width])}function g(){ut.domain([t.ymin,t.ymax]).range([Ke.height,0])}function v(){var e,n=t.yrange/2,r=n/2;return t.datacount=Ke.width/30,t.xtic=t.xrange/t.datacount,t.ytic=t.yrange/t.datacount,e=d3.range(t.datacount).map(function(e){return[e*t.xtic+t.xmin,t.ymin+r+Math.random()*n]})}function y(e){return"number"==typeof e?un=e:"last"===e&&(un=0,nn.forEach(function(e){e.length>un&&(un=e.length)})),"number"!=typeof un&&(un=En.length-1),un}function b(e,t,n){var r=0,i=[];for(t=t||1,n=n||0,r=0;r<e.length;r++)i.push([r*t+n,e[r]]);return i}function _(e){n=e,e?Tt.text(e):Tt.text("")}function x(){if(vt=qe.append("div"),vt.attr("class","button-layer").style("z-index",3),t.enableLegendButton&&t.legendLabels.length>0&&(bt=vt.append("a"),bt.attr({class:"graph-button legend",title:i.t("tooltips.legend")}).on("click",function(){ce()}),"icons"===t.buttonsStyle?bt.append("i").attr("class","icon-list-ul"):bt.text(i.t("labels.legend"))),t.enableAutoScaleButton){var e=vt.append("a");e.attr({class:"graph-button autoscale",title:i.t("tooltips.autoscale")}).on("click",function(){J(!0),E()}),"icons"===t.buttonsStyle?e.append("i").attr("class","icon-picture"):e.text(i.t("labels.autoscale"))}t.enableSelectionButton&&(_t=vt.append("a"),_t.attr({class:"graph-button selection",title:i.t("tooltips.selection")}).on("click",function(){ee()}),"icons"===t.buttonsStyle?_t.append("i").attr("class","icon-cut"):_t.text(i.t("labels.selection"))),t.enableDrawButton&&(xt=vt.append("a"),xt.attr({class:"graph-button draw",title:i.t("tooltips.draw")}).on("click",function(){le()}),"icons"===t.buttonsStyle?xt.append("i").attr("class","icon-pencil"):xt.text(i.t("labels.draw"))),w()}function w(){"vertical"===t.buttonsLayout?(vt.style({top:Qe.top+.5*Ot+"px",right:Qe.right+.5*Ot+"px"}),vt.classed("horizontal",!1)):"horizontal"===t.buttonsLayout&&(vt.style({top:Qe.top-1.8*Et+"px",width:Qe.left+Ke.width+"px"}),vt.classed("horizontal",!0))}function C(){var e,n="black";yt=qe.append("ul"),yt.attr("class","legend-layer").style("z-index",3);for(var r=0;r<t.legendLabels.length;r++)t.dataColors.length>r&&(n=t.dataColors[r]),e=yt.append("li"),e.append("div").attr("class","legend-colorsquare").style("background-color",n),e.append("label").text(t.legendLabels[r])}function T(){Je=qe.append("svg").attr("width",Ye).attr("height",Xe).attr("class","graph").style("z-index",2),Ze=Je.append("g").attr("transform","translate("+Qe.left+","+Qe.top+")"),et=Ze.append("rect").attr("class","plot").attr("width",Ke.width).attr("height",Ke.height).attr("pointer-events","all").attr("fill","rgba(255,255,255,0)").on("mousemove",D).on("mousedown",V).on("touchstart",V),et.call(P()),wt=qe.append("div").attr("class","background").style({width:Ke.width+"px",height:Ke.height+"px",top:Qe.top+"px",left:Qe.left+"px","z-index":0}),pe(),tt=Ze.append("svg").attr("class","viewbox").attr("top",0).attr("left",0).attr("width",Ke.width).attr("height",Ke.height).attr("viewBox","0 0 "+Ke.width+" "+Ke.height),ot=tt.append("line").attr("stroke",gn).attr("stroke-dasharray","2,2").attr("y1",0).attr("y2",Ke.height).attr("x1",function(){return null===kn?0:kn[0]}).attr("x2",function(){return null===kn?0:kn[0]}).attr("class","ruler hidden"),at=tt.append("line").attr("stroke",gn).attr("stroke-dasharray","2,2").attr("x1",0).attr("x2",Ke.width).attr("y1",function(){return null===kn?0:kn[1]}).attr("y2",function(){return null===kn?0:kn[1]}).attr("class","ruler hidden"),Qt=Je.append("rect").attr("class","axis axis-y"+(t.enableAxisScaling?" axis-draggable":"")).attr("x",Qe.left-Yt).attr("y",Qe.top).attr("rx",zt/6).attr("width",Yt).attr("height",Ke.height).attr("pointer-events","all").on("mousedown",Y).on("touchstart",Y),Jt=Qt.append("title"),Xt=Je.append("rect").attr("class","axis axis-x"+(t.enableAxisScaling?" axis-draggable":"")).attr("x",Qe.left).attr("y",Ke.height+Qe.top).attr("rx",zt/6).attr("width",Ke.width).attr("height",Wt).attr("pointer-events","all").on("mousedown",W).on("touchstart",W),Kt=Xt.append("title"),wn.value<=2&&t.ylabel&&Kt.text(t.xlabel),wn.catefory&&t.ylabel&&Jt.text(t.ylabel),k(),fn=tt.append("g").attr("class","brush"),wn.value>2&&(rt=Ze.append("text").attr("class","axis").attr("class","xlabel").text(t.xlabel).attr("x",Ke.width/2).attr("y",Ke.height).attr("dy",qt+"px").style("text-anchor","middle")),wn.value>2&&(it=Ze.append("g").append("text").attr("class","axis").attr("class","ylabel").text(t.ylabel).style("text-anchor","middle").attr("transform","translate("+Ht+" "+Ke.height/2+") rotate(-90)"),"small"===wn.category&&Qt.append("title").text(t.ylabel)),t.title&&wn.value>0?(Ct=Je.append("rect").attr("class","title-background").attr("x",0).attr("y",0).attr("width",Ke.width+Qe.left).attr("height",Qe.top-.8*Ot),nt=Je.selectAll("text").data(_n,function(e){return e}),nt.enter().append("text").attr("class","title").text(function(e){return e}).attr("x","center"===t.titlePosition?function(){return Qe.left+Ke.width/2-Math.min(Ke.width,A(this))/2}:Cn).attr("y",1.1*Lt).attr("dy",function(e,t){return-t*Lt+"px"}),st=nt.append("title").text("")):t.title&&(st=et.append("title").text(t.title)),d3.select(He).on("mousemove.drag",Q).on("touchmove.drag",Q).on("mouseup.drag",K).on("touchend.drag",K),Tt=Ze.append("text").attr("class","graph-notification").text(n).attr("x",Ke.width/2).attr("y",Ke.height/2).style("text-anchor","middle"),R(),I()}function S(){if(Ze.attr("width",Ye).attr("height",Xe).attr("transform","translate("+Qe.left+","+Qe.top+")"),et.attr("width",Ke.width).attr("height",Ke.height),wt.style({width:Ke.width+"px",height:Ke.height+"px",top:Qe.top+"px",left:Qe.left+"px","z-index":0}),tt.attr("top",0).attr("left",0).attr("width",Ke.width).attr("height",Ke.height).attr("viewBox","0 0 "+Ke.width+" "+Ke.height),Qt.attr("x",Qe.left-Yt).attr("y",Qe.top-zt/2).attr("width",Yt).attr("height",Ke.height+zt),Xt.attr("x",Qe.left).attr("y",Ke.height+Qe.top).attr("width",Ke.width).attr("height",Wt),k(),t.title&&wn.value>0?(Ct.attr("x",0).attr("y",0).attr("width",Ke.width+Qe.left).attr("height",1.8*Lt-.8*Ot),nt.attr("x","center"===t.titlePosition?function(){return Qe.left+Ke.width/2-Math.min(Ke.width,A(this))/2}:Cn).attr("y",1.1*Lt).attr("dy",function(e,t){return-t*Lt+"px"}),st.text("")):t.title&&st.text(t.title),t.xlabel&&wn.value>2?(rt.attr("x",Ke.width/2).attr("y",Ke.height).attr("dy",qt+"px"),Kt.text("")):Kt.text(t.xlabel),t.ylabel&&wn.value>2){var e=Ht;it.attr("transform","translate("+e+" "+Ke.height/2+") rotate(-90)"),Jt.text("")}else Jt.text(t.ylabel);Tt.attr("x",Ke.width/2).attr("y",Ke.height/2),Ze.selectAll("g.x").remove(),Ze.selectAll("g.y").remove(),Nn&&Rn&&se(),R(),I(),fe(),w()}function A(e){return e.getComputedTextLength?e.getComputedTextLength():100}function k(){wn.value<=1?(Xt.style({fill:"rgba(196, 196, 196, 0.2)"}),Qt.style({fill:"rgba(196, 196, 196, 0.2)"})):(Xt.style({fill:null}),Qt.style({fill:null}))}function P(){return t.enableZooming?d3.behavior.zoom().x(lt).y(ut).on("zoom",E):function(){}}function E(){function e(e){switch(e.type){case"line":return{stroke:e.data.hasOwnProperty("stroke")?e.data.stroke:"#f00",x1:e.data.hasOwnProperty("x1")?lt(e.data.x1):0,x2:e.data.hasOwnProperty("x2")?lt(e.data.x2):Ke.width,y1:e.data.hasOwnProperty("y1")?ut(e.data.y1):0,y2:e.data.hasOwnProperty("y2")?ut(e.data.y2):Ke.height};case"bar":return{stroke:e.data.hasOwnProperty("stroke")?e.data.stroke:"#f00",fill:e.data.hasOwnProperty("stroke")?e.data.stroke:"#f00",x:e.data.hasOwnProperty("x1")?lt(e.data.x1):0,y:e.data.hasOwnProperty("y2")?ut(e.data.y2):0,width:e.data.hasOwnProperty("x2")?lt(e.data.x2)-lt(e.data.x1):Ke.width,height:e.data.hasOwnProperty("y1")?ut(e.data.y1)-ut(e.data.y2):Ke.height,"fill-opacity":.5}}return{}}d(),S();var n=Ze.selectAll("g.x").data(lt.ticks(ct),String).attr("transform",vn),r=n.enter().insert("g","a").attr("class","x").attr("transform",vn);r.append("line").attr("stroke",gn).attr("y1",0).attr("y2",Ke.height),wn.value>1&&!t.hideAxisValues&&r.append("text").attr("class","axis").attr("y",Ke.height).attr("dy",Nt+"px").attr("text-anchor","middle").text(ft).on("mouseover",function(){d3.select(this).style("font-weight","bold")}).on("mouseout",function(){d3.select(this).style("font-weight","normal")}),n.exit().remove();var i=Ze.selectAll("g.y").data(ut.ticks(dt),String).attr("transform",yn),o=i.enter().insert("g","a").attr("class","y").attr("transform",yn).attr("background-fill","#FFEEB6");if(o.append("line").attr("stroke",gn).attr("x1",0).attr("x2",Ke.width),wn.value>1){if("log"===t.yscale){var a=o[0].length;o=a>100?o.filter(function(e){return!!e.toString().match(/(\.[0]*|^)[1]/)}):a>50?o.filter(function(e){return!!e.toString().match(/(\.[0]*|^)[12]/)}):o.filter(function(e){return!!e.toString().match(/(\.[0]*|^)[125]/)})}t.hideAxisValues||o.append("text").attr("class","axis").attr("x",-Nt/4+"px").attr("dy",".35em").attr("text-anchor","end").style("cursor","ns-resize").text(ht).on("mouseover",function(){d3.select(this).style("font-weight","bold")}).on("mouseout",function(){d3.select(this).style("font-weight","normal")})}i.exit().remove();var s={line:"line",bar:"rect"},l=Ze.selectAll("g.annotation").data(bn);l.enter().append("g").attr("class","annotation").each(function(e,t){d3.select(this).append(s[e.type])}),l.each(function(t,n){d3.select(this.childNodes[0]).attr(e(t)).call(P())}),l.exit().remove(),et.call(P()),O()}function O(e){y(e),ge(un),R(),d3.event&&d3.event.keyCode&&(d3.event.preventDefault(),d3.event.stopPropagation())}function M(e){y(e),J()?E():O(un)}function L(e){var t=[];return e===kn&&t.push("selected"),0===t.length?null:t.join(" ")}function N(){var e=lt.domain(),t=lt.range();Zt=(t[1]-t[0])/(e[1]-e[0]),Zt=Math.min(Math.max(Zt,4),8),en=Zt/3}function R(){var e,n=null;t.markAllDataPoints&&wn.value>1?(n=[],n=n.concat.apply(n,nn)):t.markNearbyDataPoints&&wn.value>1&&(n=Pn.slice(0),null!==kn&&n.indexOf(kn)===-1&&n.push(kn)),null!==n&&(N(),e=Ze.select("svg").selectAll("circle").data(n),e.enter().append("circle").attr("class",L).attr("cx",function(e){return lt(e[0])}).attr("cy",function(e){return ut(e[1])}).attr("r",Zt).style("stroke-width",en).style("cursor",Pt).on("mousedown.drag",X).on("touchstart.drag",X).append("title").text(function(e){return"( "+ft(e[0])+", "+ht(e[1])+" )"}),e.attr("class",L).attr("cx",function(e){return lt(e[0])}).attr("cy",function(e){return ut(e[1])}).select("title").text(function(e){return"( "+ft(e[0])+", "+ht(e[1])+" )"}),e.exit().remove()),I()}function I(){t.showRulersOnSelection&&null!==kn?(ot.attr("y1",0).attr("y2",Ke.height).attr("x1",function(){return null===kn?0:lt(kn[0])}).attr("x2",function(){return null===kn?0:lt(kn[0])}).attr("class",function(){return"ruler"+(null===kn?" hidden":"")}),at.attr("x1",0).attr("x2",Ke.width).attr("y1",function(){return null===kn?0:ut(kn[1])}).attr("y2",function(){return null===kn?0:ut(kn[1])}).attr("class",function(){return"ruler"+(null===kn?" hidden":"")})):(ot.attr("class","ruler hidden"),at.attr("class","ruler hidden"))}function D(){if(t.markNearbyDataPoints){var e,n,r,i,o,a=d3.mouse(Ze.node()),s=lt.invert(Math.max(0,Math.min(Ke.width,a[0])));for(Pn=[],o=0;o<nn.length;o++)En=nn[o],e=B(s,o),null!==e&&(n=En.indexOf(e),r=n-t.extraCirclesVisibleOnHover,i=n+(t.extraCirclesVisibleOnHover+1),r<0&&(r=0),i>En.length-1&&(i=En.length),Pn=Pn.concat(En.slice(r,i)));O()}}function B(e,t){if("undefined"!=typeof t&&null!==t||(t=0),En=nn[t],0===En.length)return null;for(var n,r,i,o,a=0,s=En.length-1;a<s;)n=Math.floor((a+s)/2),En[n][0]<e?a=n+1:s=n;return r=En[n-1],i=En[n],o=En[n+1],"undefined"!=typeof r&&Math.abs(r[0]-e)<=Math.abs(i[0]-e)?r:"undefined"==typeof o||Math.abs(i[0]-e)<=Math.abs(o[0]-e)?i:o}function V(){var e;Dn?(d3.event.preventDefault(),e=d3.mouse(Ze.node()),z(e),Tn=e[0],Sn=e[0],An=!1):t.enableAxisScaling&&(d3.event.preventDefault(),d3.select("body").style("cursor","move"),d3.event.altKey&&(et.style("cursor","nesw-resize"),d3.event.shiftKey&&t.addData?z():(e=d3.mouse(Ze.node()),Tn=lt.invert(e[0]),Sn=ut.invert(e[1]),An=!1,d3.event.stopPropagation())))}function j(e,t){On.forEach(function(n){n.call(null,{action:e,point:t})})}function F(e){var t=lt.invert(e[0]),n=ut.invert(e[1]),r=lt.domain()[0],i=lt.domain()[1],o=ut.domain()[0],a=ut.domain()[1];return t>=r&&t<=i&&n>=o&&n<=a}function z(e){e||(e=d3.mouse(Ze.node()));var n,r=[],i=rn[t.drawIndex];En=nn[t.drawIndex],r[0]=lt.invert(Math.max(0,Math.min(Ke.width,e[0]))),r[1]=ut.invert(Math.max(0,Math.min(Ke.height,e[1]))),En.push(r),i.push(r),j("added",r),Ne(En),kn=r,n=En.indexOf(r),(un==En.length-2||un>=n)&&un++,En=nn[0],O()}function G(e,t,n){return e<n&&n<=t}function U(e,t,n){return e<=n&&n<t}function q(e,n){var r,i,o,a,s,l=e,u=n,c=!1,d=G;for(e>n&&(l=n,u=e,d=U),a=rn[t.drawIndex],r=0;r<a.length;r++)i=a[r],i&&d(l,u,i[0])&&(o=a[r].slice(),a[r][0]=null,a[r][1]=null,j("removed",o),c=!0);c&&(s=Me(a),Ne(s),nn[t.drawIndex]=s,En=nn[0],O())}function H(){return!1}function W(){if(t.enableAxisScaling){He.focus(),document.onselectstart=H,d3.event.preventDefault();var e=d3.mouse(Ze.node());Tn=lt.invert(e[0])}}function Y(){if(t.enableAxisScaling){He.focus(),d3.event.preventDefault(),document.onselectstart=H;var e=d3.mouse(Ze.node());Sn=ut.invert(e[1])}}function X(e){He.focus(),d3.event.preventDefault(),document.onselectstart=H,kn=An=kn===e?null:e,O()}function Q(){var e,n,i,o,a,s,l,u,c=d3.mouse(Ze.node());document.onselectstart=function(){return!0},d3.event.preventDefault(),An&&(t.dataChange?An[1]=ut.invert(Math.max(0,Math.min(Ke.height,c[1]))):(nn.forEach(function(t){var r=t.indexOf(An);r!==-1&&(e=t,n=r)}),n&&n<e.length-1&&(i=lt.invert(c[0]),o=An[0],a=e[n+1],s=e[n-1],l=o-(o-s[0])/2,u=o+(a[0]-o)/2,i<l?(An=s,kn=An):i>u&&(An=a,kn=An))),O()),!Dn||isNaN(Tn)||isNaN(Sn)?(isNaN(Tn)||(d3.select("body").style("cursor","col-resize"),et.style("cursor","col-resize"),lt.domain(r.axisProcessDrag(Tn,lt.invert(c[0]),lt.domain())),N(),E(),d3.event.stopPropagation()),isNaN(Sn)||(d3.select("body").style("cursor","row-resize"),et.style("cursor","row-resize"),ut.domain(r.axisProcessDrag(Sn,ut.invert(c[1]),ut.domain())),E(),d3.event.stopPropagation())):(F(c)?(q(lt.invert(Math.max(0,Math.min(Ke.width,Tn))),lt.invert(Math.max(0,Math.min(Ke.width,c[0])))),z(c),Tn=c[0],Sn=c[0]):K(),d3.event.stopPropagation())}function K(){d3.select("body").style("cursor","auto"),et.style("cursor","auto"),document.onselectstart=function(){return!0},isNaN(Tn)||(E(),Tn=NaN),isNaN(Sn)||(E(),Sn=NaN),An=null}function J(e){var n,r,i,o=-(1/0);if(nn.forEach(function(e){e.length>o&&(o=e.length)}),o>1){if(t.autoScaleX||e){var a=e?.05:t.autoScalePadding;n=Z("x",on,an,a,e)}if(t.autoScaleY||e){var s=e?.05:t.autoScalePadding;r=Z("y",sn,ln,s,e)}i=n||r}else i=void 0;return e&&t.onAutoscale&&t.onAutoscale.call(null),i}function Z(e,n,r,i,o){if(n===r)return!1;var a,s="x"===e?lt:ut,l=s.domain()[0],u=s.domain()[1],c=!1,d=function(e,t){return e<0?-Math.pow(-e,t):Math.pow(e,t)};switch(t[e+"scale"]){case"linear":a=function(e){return e};break;case"log":n=Math.log(n)/Math.log(10),r=Math.log(r)/Math.log(10),a=function(e){return Math.pow(10,e)};break;case"pow":var p=t[e+"scaleExponent"];n=d(n,p),r=d(r,p),a=function(e){return d(e,1/p)}}var f=(r-n)*i;return(r>u||o)&&(u=r+f,c=!0),(n<l||o)&&(l=n-f,c=!0),c&&s.domain([a(l),a(u)]).nice(),c}function ee(){ue(!1),re()||(ie(!1),re(!0)),ie()?((t.clearSelectionOnLeavingSelectMode||te()===[])&&te(null),ie(!1)):(null==te()&&te([]),ie(!0))}function te(e){return arguments.length?(null===e?Nn=!1:0===e.length?(Nn=!0,Ln.xmin=1/0,Ln.xmax=1/0):(Nn=!0,Ln.xmin=e[0],Ln.xmax=e[1]),se(),pn&&pn(te()),mn):Nn?Ln.xmax===1/0&&Ln.xmin===1/0?[]:[Ln.xmin,Ln.xmax]:null}function ne(){return Nn}function re(e){return arguments.length?(e=!!e,Rn!==e&&(Rn=e,se()),mn):Rn}function ie(e){return arguments.length?(e=!!e,In!==e&&(In=e,_t&&(e?_t.classed("active",!0):_t.classed("active",!1)),se()),mn):In}function oe(e){return arguments.length?(pn=e,mn):pn}function ae(){var e;In&&(e=hn.extent(),te(e[0]!==e[1]?e:[]))}function se(){Nn&&Rn?(hn=hn||d3.svg.brush().x(lt).extent([Ln.xmin||0,Ln.xmax||0]).on("brush",ae),fn.call(hn.extent([Ln.xmin||0,Ln.xmax||0])).style("display","inline").style("pointer-events",In?"all":"none").selectAll("rect").attr("height",Ke.height)):fn.style("display","none")}function le(){Nn&&Rn&&ee(),ue(!Dn)}function ue(e){return arguments.length?(e=!!e,Dn!==e&&(Dn=e,xt&&(e?xt.classed("active",!0):xt.classed("active",!1))),mn):Dn}function ce(){t.legendVisible=!t.legendVisible,de()}function de(){return bt&&(t.legendVisible?bt.classed("active",!0):bt.classed("active",!1)),yt&&(t.legendVisible?(yt.classed("legend-invisible",!1),yt.style({top:Qe.top+Ot+"px",right:Qe.right+Ot+(t.showButtons&&"vertical"===t.buttonsLayout?vt.property("clientWidth"):0)+"px"})):yt.classed("legend-invisible",!0)),mn}function pe(){St=qe.append("canvas"),At=St.node(),fe()}function fe(){St.attr("class","overlay").style({position:"absolute",width:Ke.width+"px",height:Ke.height+"px",top:Qe.top+"px",left:Qe.left+"px","z-index":1}),At=St.node(),At.width=Ke.width,At.height=Ke.height,At.top=Qe.top,At.left=Qe.left,me(),ge(un)}function he(){At.getContext&&(At.width=At.width,kt.lineWidth=tn,kt.fillStyle=xn,kt.fillRect(0,0,At.width,At.height),kt.strokeStyle="rgba(255,65,0, 1.0)",kt.globalAlpha=1)}function me(){At.getContext&&(kt=At.getContext("2d"),kt.globalCompositeOperation="source-over",kt.lineWidth=tn,kt.fillStyle=xn,kt.fillRect(0,0,At.width,At.height),kt.strokeStyle="rgba(255,65,0, 1.0)",kt.globalAlpha=1)}function ge(e){var n,r,i,o,a,s,l,u,c,d,p,f,h=ut(1e-5),m=t.lines,g=t.bars,v=nn.length;if("undefined"!=typeof At.getContext)if(y(e),he(),kt.fillRect(0,0,At.width,At.height),kt.lineWidth=tn,c=lt.domain()[0],d=lt.domain()[1],f=Math.max(0,c),m){for(n=0;n<v;n++)if(En=nn[n],u=En.length,0!==u)if(1!==u){for(l=0,r=0;r<u&&!(null!=En[r][0]&&null!=En[r][1]&&En[r][0]>=c);r++)l++;if(!(l>=u)){for(l>0&&l--,a=lt(En[l][0]),s=ut(En[l][1]),ve(n),kt.beginPath(),kt.moveTo(a,s),o=En[l][0],l++,i=Math.min(e,u);l<i&&!(null!=En[l][0]&&null!=En[l][1]&&(o=En[l][0],a=lt(o),s=ut(En[l][1]),kt.lineTo(a,s),o>=d));l++);if(kt.stroke(),l<u&&o<d){for(ve(n,!0),kt.lineWidth=tn/2;l<u&&!(null!=En[l][0]&&null!=En[l][1]&&(o=En[l][0],a=lt(o),s=ut(En[l][1]),kt.lineTo(a,s),o>=d));l++);kt.stroke(),kt.lineWidth=tn}}}else ye(n),kt.fillRect(lt(En[0][0]),ut(En[0][1]),tn,tn)}else if(g)for(n=0;n<v;n++){for(En=nn[n],u=En.length,ve(n),p=e-1,l=f;l<p;l++)null!=En[l][0]&&null!=En[l][1]&&(a=lt(En[l][0]),s=ut(En[l][1]),0!==s&&(kt.beginPath(),kt.moveTo(a,h),kt.lineTo(a,s),kt.stroke()));if(p=En.length-1,l<p)for(ve(n,!0);l<p;l++)null!=En[l][0]&&null!=En[l][1]&&(a=lt(En[l][0]),s=ut(En[l][1]),kt.beginPath(),kt.moveTo(a,h),kt.lineTo(a,s),kt.stroke())}else for(n=0;n<v;n++){for(En=nn[n],u=En.length,l=0,r=0;r<u&&!(null!=En[r][0]&&null!=En[r][1]&&En[r][0]>=c);r++)l++;if(l>0&&--l,!(l>=u)){for(ye(n),i=Math.min(e,u);l<i&&!(null!=En[l][0]&&null!=En[l][1]&&(o=En[l][0],a=lt(o),s=ut(En[l][1]),kt.fillRect(a,s,tn,tn),o>=d));l++);if(l<u&&o<d)for(ye(n,!0);l<u&&!(null!=En[l][0]&&null!=En[l][1]&&(o=En[l][0],a=lt(o),s=ut(En[l][1]),kt.fillRect(a,s,tn,tn),o>=d));l++);}}}function ve(e,t){kt.strokeStyle=be(e),kt.globalAlpha=t?.5:1}function ye(e,t){kt.fillStyle=be(e),kt.globalAlpha=t?.4:1}function be(e){var n=Math.min(e,t.dataColors.length-1);return n<0?"black":t.dataColors[n]}function _e(e){Pe(e),y("last"),M()}function xe(e,t){Ee(e,t),y("last"),M()}function we(e){Oe(e),y("last"),M()}function Ce(e){var t=En.length,n=t*cn+dn,r=[n,e];En.push(r),y("last"),M()}function Te(e){En.push(e),y("last"),M()}function Se(e,t){return e[0]<t[0]?-1:e[0]>t[0]?1:0}function Ae(e,n){if(t.sortPoints&&!(e.length<2)){if(null==n)return void e.sort(Se);var r=e[n],i=e[n-1],o=e[n+1];(i&&i[0]>r[0]||o&&r[0]>o[0])&&e.sort(Se)}}function ke(e){e[0]<on&&(on=e[0]),e[1]<sn&&(sn=e[1]),e[0]>an&&(an=e[0]),e[1]>ln&&(ln=e[1])}function Pe(e){for(var t,n,r,i=0,o=e.length;i<o;i++)null!=e[i]&&(n=nn[i],r=rn[i],null!=n&&null!=r||(n=nn[i]=[],r=rn[i]=[]),t=e[i],n.push(t),r.push(t),ke(t),Ae(n,n.length-1))}function Ee(e,t){for(var n,r,i,o,a=!1,s=0,l=e.length;s<l;s++)null!=e[s]&&(i=nn[s],o=rn[s],null!=i&&null!=o||(i=nn[s]=[],o=rn[s]=[]),n=o[t],r=e[s],null==n?(i.push(r),o[t]=r,Ae(i,i.length-1),ke(r)):(n[0]=r[0],n[1]=r[1],Ae(i),a=!0));a&&(on=sn=1/0,an=ln=-(1/0),nn.forEach(function(e){e.forEach(ke)}))}function Oe(e){var t,n;if("[object Array]"===Object.prototype.toString.call(e[0])){for(n=0;n<e.length;n++)nn[n]||nn.push([]),En=nn[n],t=En.length*cn+dn,En.push.apply(En,b(e[n],cn,t)),nn[n]=En,En.forEach(ke);En=nn[0]}else{var r;for(n=0;n<e.length;n++)nn[n]||nn.push([]),t=nn[n].length*cn+dn,r=[t,e[n]],nn[n].push(r),ke(r)}}function Me(e){var t=[];return e.forEach(function(e){null!=e&&null!=e[0]&&null!=e[1]&&t.push(e)}),t}function Le(e){var t=[];return e.forEach(function(e,n){null!=e&&null!=e[0]&&null!=e[1]&&(t[n]=e)}),t}function Ne(e){function n(e,t,n){ke(e),r&&t>0&&e[0]<n[t-1][0]&&(r=!1)}var r=t.sortPoints;e.forEach(n),!r&&t.sortPoints&&e.sort(Se)}function Re(e){if(on=sn=1/0,
an=ln=-(1/0),nn=[],rn=[],e&&0!==e.length)if("[object Array]"===Object.prototype.toString.call(e[0]))for(var t=0;t<e.length;t++)nn.push(Me(e[t])),rn.push(Le(e[t])),Ne(nn[t]);else nn=[Me(En)],rn=[Le(En)],Ne(nn[0]);else nn=[[]],rn=[[]];En=nn[0],J(),y("last")}function Ie(e,t,n){if(on=sn=1/0,an=ln=-(1/0),nn=[],"[object Array]"===Object.prototype.toString.call(e[0])){for(var r=0;r<e.length;r++)nn.push(b(e[r],t,n)),nn[nn.length-1].forEach(ke);En=nn[0]}else En=b(e,t,n),nn=[En],En.forEach(ke);cn=t,dn=n}function De(e){Ie(e,cn,dn)}function Be(e,t){t||(t=0);var n,r,i=rn[t];En.slice();i.length&&(n=i[e].slice(),i[e][0]=null,i[e][1]=null,rn[t]=i,r=Me(i),Ne(r),nn[t]=r,un>=En.length&&(un=En.length-1)),En=nn[0]}function Ve(){Je.node().addEventListener("keydown",function(e){if(!kn)return!1;if("keydown"===e.type){switch(e.keyCode){case 8:case 46:if(t.dataChange){var n=En.indexOf(kn);Be(n),kn=En.length?En[n>0?n-1:0]:null,O()}e.preventDefault(),e.stopPropagation()}e.preventDefault()}})}function je(){t.title&&nt&&nt.text(t.title),Ge()}function Fe(){t.xlabel&&rt&&rt.text(t.xlabel),Ge()}function ze(){t.ylabel&&it?it.text(t.ylabel):it.style("display","none"),Ge()}function Ge(){l(),void 0===Je?T():S(),t.showButtons&&(vt||x()),t.legendLabels.length>0&&(yt||C(),de()),E()}function $e(e,t,n){return arguments.length?o(e,t,n):o(),vt&&(vt.remove(),vt=null),Ge(),Ge(),E(),Ve(),mn}function Ue(e,t){return s(e,t),a(),Ge(),E(),mn}var qe,He,We,Ye,Xe,Qe,Ke,Je,Ze,et,tt,nt,rt,it,ot,at,st,lt,ut,ct,dt,pt,ft,ht,mt,gt,vt,yt,bt,_t,xt,wt,Ct,Tt,St,At,kt,Pt,Et,Ot,Mt,Lt,Nt,Rt,It,Dt,Bt,Vt,jt,Ft,zt,Gt,$t,Ut,qt,Ht,Wt,Yt,Xt,Qt,Kt,Jt,Zt,en,tn,nn,rn,on,an,sn,ln,un,cn,dn,pn,fn,hn,mn={},gn=function(e){return e?"#ccc":"#666"},vn=function(e){return"translate("+lt(e)+",0)"},yn=function(e){return"translate(0,"+ut(e)+")"},bn=[],_n=[],xn="rgba(255,255,255, 0.0)",wn={category:"medium",value:3,icon:120,tiny:240,small:480,medium:960,large:1920},Cn="10px",Tn=NaN,Sn=NaN,An=null,kn=null,Pn=[],En=[],On=[],Mn={showButtons:!0,buttonsStyle:"icons",buttonsLayout:"vertical",legendVisible:!1,responsiveLayout:!1,fontScaleRelativeToParent:!0,hideAxisValues:!1,enableAutoScaleButton:!0,enableAxisScaling:!0,enableZooming:!0,enableSelectionButton:!1,clearSelectionOnLeavingSelectMode:!1,enableDrawButton:!1,enableLegendButton:!0,titlePosition:"center",drawIndex:0,dataType:"points",dataPoints:[],dataSamples:[],sampleInterval:1,dataSampleStart:0,sortPoints:!0,title:"graph",xlabel:"x-axis",ylabel:"y-axis",xmax:10,xmin:0,ymax:10,ymin:0,autoScaleX:!0,autoScaleY:!0,autoScalePadding:.3,xTickCount:10,yTickCount:10,xFormatter:".3s",yFormatter:".3s",xscale:"linear",yscale:"linear",xscaleExponent:.5,yscaleExponent:.5,axisShift:10,markAllDataPoints:!1,markNearbyDataPoints:!1,extraCirclesVisibleOnHover:2,showRulersOnSelection:!1,lineWidth:2,dataChange:!1,addData:!1,notification:!1,lines:!0,bars:!1,onAutoscale:null,onXDomainChange:null,onYDomainChange:null,dataColors:["#a00000","#2ca000","#2c00a0"],legendLabels:[]},Ln={xmin:null,xmax:null,ymin:null,ymax:null},Nn=!1,Rn=!1,In=!0,Dn=!1;return mn={update:O,repaint:Ge,reset:$e,redraw:E,resize:Ue,notify:_,selectionDomain:te,selectionVisible:re,selectionListener:oe,selectionEnabled:ie,hasSelection:ne,brushElement:function(){return fn},brushControl:function(){return hn},brushListener:function(){return ae},addPointListener:function(e){On.push(e)},clearPointListeners:function(){On.length=0},scale:s,updateOrRescale:M,xDomain:function(e){return arguments.length?(t.xmin=e[0],t.xmax=e[1],m&&(m(),E()),mn):[t.xmin,t.xmax]},yDomain:function(e){return arguments.length?(t.ymin=e[0],t.ymax=e[1],g&&(g(),E()),mn):[t.ymin,t.ymax]},xmin:function(e){return arguments.length?(t.xmin=e,t.xrange=t.xmax-t.xmin,m&&(m(),E()),mn):t.xmin},xmax:function(e){return arguments.length?(t.xmax=e,t.xrange=t.xmax-t.xmin,m&&(m(),E()),mn):t.xmax},ymin:function(e){return arguments.length?(t.ymin=e,t.yrange=t.ymax-t.ymin,g&&(g(),E()),mn):t.ymin},ymax:function(e){return arguments.length?(t.ymax=e,t.yrange=t.ymax-t.ymin,g&&(g(),E()),mn):t.ymax},xLabel:function(e){return arguments.length?(t.xlabel=e,Fe(),mn):t.xlabel},yLabel:function(e){return arguments.length?(t.ylabel=e,ze(),mn):t.ylabel},title:function(e){return arguments.length?(t.title=e,je(),mn):t.title},width:function(e){return arguments.length?(Ke.width=e,mn):Ke.width},height:function(e){return arguments.length?(Ke.height=e,mn):Ke.height},elem:function(e){return arguments.length?(qe=d3.select(e),o(qe),mn):qe},numberOfPoints:function(){return!!En&&En.length},addAnnotation:function(e){bn.push(e),E()},resetAnnotations:function(){bn.length=0,E()},autoscale:function(){J(!0)},addPoints:_e,replacePoints:xe,addPoint:Te,resetPoints:Re,deletePoint:function(e,t){Be(e,t),O()},addSamples:we,addSample:Ce,resetSamples:De},o(e,t,n),He&&(Ge(),Ge()),mn}},{"./axis":1,"./i18n":3}],3:[function(e,t,n){function r(e,n){for(var r=t.exports.translations,i=n.split("."),o=r[e],a=0,s=i[a];s&&"object"==typeof o;)o=o[s],s=i[++a];return o}var i="en-US";t.exports.translations=e("../locales/translations.json"),t.exports.lang=i,t.exports.fallback=i,t.exports.t=function(e){var n=t.exports.lang;return r(n,e)||r(n.split("-")[0],e)||r(n.split("_")[0],e)||r(t.exports.fallback,e)||e}},{"../locales/translations.json":4}],4:[function(e,t,n){t.exports={"en-US":{labels:{autoscale:"Zoom",draw:"Draw",selection:"Select",legend:"Key"},tooltips:{autoscale:"Show all data (autoscale)",draw:"Draw new data points",selection:"Select data for export",legend:"Show/hide the legend"}},es:{labels:{autoscale:"Zoom",draw:"Graficar",selection:"Elegir",legend:"Leyenda"},tooltips:{autoscale:"Mostrar todos los datos (autoescala)",draw:"Graficar nuevos puntos",selection:"Seleccionar datos para exportar",legend:"Mostrar/Ocultar la leyenda"}},pl:{labels:{autoscale:"Przybliż",draw:"Rysuj",selection:"Zaznacz",legend:"Legenda"},tooltips:{autoscale:"Pokaż cały wykres (autoskalowanie)",draw:"Rysuj nowe punkty",selection:"Zaznacz dane do wyeksportowania",legend:"Pokaż/ukryj legendę"}}}},{}],5:[function(e,t,n){t.exports=e("./lib/graph"),t.exports.i18n=e("./lib/i18n")},{"./lib/graph":2,"./lib/i18n":3}]},{},[5])(5)}),define("text",["module"],function(e){"use strict";var t,n,r=["Msxml2.XMLHTTP","Microsoft.XMLHTTP","Msxml2.XMLHTTP.4.0"],i=/^\s*<\?xml(\s)+version=[\'\"](\d)*.(\d)*[\'\"](\s)*\?>/im,o=/<body[^>]*>\s*([\s\S]+)\s*<\/body>/im,a="undefined"!=typeof location&&location.href,s=a&&location.protocol&&location.protocol.replace(/\:/,""),l=a&&location.hostname,u=a&&(location.port||void 0),c=[],d=e.config&&e.config()||{};return t={version:"2.0.2",strip:function(e){if(e){e=e.replace(i,"");var t=e.match(o);t&&(e=t[1])}else e="";return e},jsEscape:function(e){return e.replace(/(['\\])/g,"\\$1").replace(/[\f]/g,"\\f").replace(/[\b]/g,"\\b").replace(/[\n]/g,"\\n").replace(/[\t]/g,"\\t").replace(/[\r]/g,"\\r").replace(/[\u2028]/g,"\\u2028").replace(/[\u2029]/g,"\\u2029")},createXhr:d.createXhr||function(){var e,t,n;if("undefined"!=typeof XMLHttpRequest)return new XMLHttpRequest;if("undefined"!=typeof ActiveXObject)for(t=0;t<3;t+=1){n=r[t];try{e=new ActiveXObject(n)}catch(e){}if(e){r=[n];break}}return e},parseName:function(e){var t=!1,n=e.indexOf("."),r=e.substring(0,n),i=e.substring(n+1,e.length);return n=i.indexOf("!"),n!==-1&&(t=i.substring(n+1,i.length),t="strip"===t,i=i.substring(0,n)),{moduleName:r,ext:i,strip:t}},xdRegExp:/^((\w+)\:)?\/\/([^\/\\]+)/,useXhr:function(e,n,r,i){var o,a,s,l=t.xdRegExp.exec(e);return!l||(o=l[2],a=l[3],a=a.split(":"),s=a[1],a=a[0],!(o&&o!==n||a&&a.toLowerCase()!==r.toLowerCase()||(s||a)&&s!==i))},finishLoad:function(e,n,r,i){r=n?t.strip(r):r,d.isBuild&&(c[e]=r),i(r)},load:function(e,n,r,i){if(i.isBuild&&!i.inlineText)return void r();d.isBuild=i.isBuild;var o=t.parseName(e),c=o.moduleName+"."+o.ext,p=n.toUrl(c),f=d.useXhr||t.useXhr;!a||f(p,s,l,u)?t.get(p,function(n){t.finishLoad(e,o.strip,n,r)},function(e){r.error&&r.error(e)}):n([c],function(e){t.finishLoad(o.moduleName+"."+o.ext,o.strip,e,r)})},write:function(e,n,r,i){if(c.hasOwnProperty(n)){var o=t.jsEscape(c[n]);r.asModule(e+"!"+n,"define(function () { return '"+o+"';});\n")}},writeFile:function(e,n,r,i,o){var a=t.parseName(n),s=a.moduleName+"."+a.ext,l=r.toUrl(a.moduleName+"."+a.ext)+".js";t.load(s,r,function(n){var r=function(e){return i(l,e)};r.asModule=function(e,t){return i.asModule(e,l,t)},t.write(e,s,r,o)},o)}},"undefined"!=typeof process&&process.versions&&process.versions.node?(n=require.nodeRequire("fs"),t.get=function(e,t){var r=n.readFileSync(e,"utf8");0===r.indexOf("\ufeff")&&(r=r.substring(1)),t(r)}):"undefined"!=typeof Packages&&"undefined"!=typeof java?t.get=function(e,t){var n,r,i="utf-8",o=new java.io.File(e),a=java.lang.System.getProperty("line.separator"),s=new java.io.BufferedReader(new java.io.InputStreamReader(new java.io.FileInputStream(o),i)),l="";try{for(n=new java.lang.StringBuffer,r=s.readLine(),r&&r.length()&&65279===r.charAt(0)&&(r=r.substring(1)),n.append(r);null!==(r=s.readLine());)n.append(a),n.append(r);l=String(n.toString())}finally{s.close()}t(l)}:t.createXhr()&&(t.get=function(e,n,r){var i=t.createXhr();i.open("GET",e,!0),d.onXhr&&d.onXhr(i,e),i.onreadystatechange=function(t){var o,a;4===i.readyState&&(o=i.status,o>399&&o<600?(a=new Error(e+" HTTP status: "+o),a.xhr=i,r(a)):n(i.responseText))},i.send(null)}),t}),define("text!locales/translations.json",[],function(){return'{\n  "en-US": {\n    "translation": {\n      "banner": {\n        "about": "About",\n        "about_tooltip": "Instructions",\n        "share": "Share",\n        "share_tooltip": "Share using e-mail, IM or embed in website",\n        "lang_tooltip": "Select language",\n        "reload_tooltip": "Reload interactive",\n        "help_tooltip": "Show help tips",\n        "credits_tooltip": "Learn more about The Concord Consortium",\n        "fullscreen_tooltip": "Toggle full-screen",\n        "video_play_pause_tooltip": "Start / pause the simulation",\n        "video_reset_tooltip": "Reset the simulation",\n        "video_step_back_tooltip": "Step back",\n        "video_step_forward_tooltip": "Step forward",\n        "text_start": "Start",\n        "text_start_tooltip": "Start the simulation or data collection",\n        "text_stop": "Stop",\n        "text_stop_tooltip": "Stop the simulation or data collection",\n        "text_reset": "Reset",\n        "text_reset_tooltip": "Reset the simulation or data collection",\n        "text_new_run": "New Run",\n        "text_new_run_tooltip": "Set up a new experiment run",\n        "text_analyze_data": "Analyze Data",\n        "text_analyze_data_tooltip": "Send data from the experiment to CODAP"\n      },\n      "dialog": {\n        "close_tooltip": "Close"\n      },\n      "about_dialog": {\n        "title": "About: __interactive_title__"\n      },\n      "share_dialog": {\n        "title": "Share: __interactive_title__",\n        "link": "link",\n        "paste_email_im": "Paste this __link__ in email or IM.",\n        "paste_html": "Paste HTML to embed in website or blog.",\n        "select_size": "Select Size:",\n        "size_larger": "__val__% larger",\n        "size_actual": "actual",\n        "size_smaller": "__val__% smaller"\n      },\n      "credits_dialog": {\n        "title": "Credits: __interactive_title__",\n        "credits_text": "This interactive was created by the __CC_link__ using our __Next_Gen_MW_link__ software, with funding by a grant from __Google_link__.",\n        "shareable_ver": "shareable version",\n        "find_shareable": "Find a __shareable_ver_link__ of this interactive along with dozens of other open-source interactives for science, math and engineering at __concord_org_link__."\n      },\n      "copyright": {\n        "copyright": "Copyright",\n        "all_rights_reserved": "All rights reserved.",\n        "license": "The software is licensed under the __MIT_link__ license.",\n        "attribution": "Please provide attribution to the Concord Consortium and the URL __concord_org_link__."\n      },\n      "md2d": {\n        "heatbath_icon_tooltip": "Heatbath active",\n        "ke_icon_tooltip": "Kinetic energy gradient",\n        "invalid_object_position_alert": "You can\'t drop the object there.",\n        "aminoacid_menu": {\n          "hydrophobic": "Hydrophobic",\n          "hydrophilic": "Hydrophilic",\n          "glycine": "Glycine",\n          "alanine": "Alanine",\n          "valine": "Valine",\n          "leucine": "Leucine",\n          "isoleucine": "Isoleucine",\n          "phenylalanine": "Phenylalanine",\n          "proline": "Proline",\n          "tryptophan": "Tryptophan",\n          "methionine": "Methionine",\n          "cysteine": "Cysteine",\n          "tyrosine": "Tyrosine",\n          "asparagine": "Asparagine",\n          "glutamine": "Glutamine",\n          "serine": "Serine",\n          "threonine": "Threonine",\n          "asparticacid": "Asparticacid",\n          "glutamicacid": "Glutamicacid",\n          "lysine": "Lysine",\n          "arginine": "Arginine",\n          "histidine": "Histidine"\n        },\n        "mutations_menu": {\n          "substitution_mutation": "Substitution mutation",\n          "insertion_mutation": "Insertion mutation",\n          "deletion_mutation": "Deletion mutation",\n          "insert": "Insert"\n        }\n      },\n      "sensor": {\n        "select_sensor": "Select Sensor",\n        "select_sensor_type": "Select type of sensor...",\n        "reading": "Reading:",\n        "zero": "Zero",\n        "zeroing": "Zeroing...",\n        "loading_sensor": "Loading sensor...",\n        "choose_sensor_title": "Select a sensor:",\n        "connect": "Connect",\n        "address_labquest2": "address of LabQuest2",\n        "messages": {\n          "ready": "Ready to collect.",\n          "ready_nocontrol": "Please stop the __controlling_client__ data collector to collect data here.",\n          "ready_nocontrol_noname": "Please stop the other active data collector to collect data here.",\n          "no_sensors": "No sensors found.",\n          "no_devices": "No devices plugged in.",\n          "not_connected": "Not connected.",\n          "connecting": "Connecting...",\n          "connection_in_progress": "Connecting to your sensors. If a message comes up about sensorconnector.concord.org, please accept it.",\n          "connection_failed": "Connection failed. __retry_link__",\n          "connection_failed_retry_link_text": "Try again",\n          "connection_failed_alert": "The Concord Consortium Sensor Connector is not installed or is not running. Please __click_here_link__ for instructions on using the Sensor Connector.",\n          "connection_failed_labquest2_alert": "Could not connect to the LabQuest2. Please make sure the address is correct and that the LabQuest2 can be reached from this computer",\n          "tare_labquest2_alert": "The LabQuest2 needs to be collecting live data in order to zero. Either set up a new run on the LabQuest2, or click the meter icon in the upper left.",\n          "click_here": "click here",\n          "connected": "Connected.",\n          "connected_start_labquest2": "Connected. Press start on your LabQuest2 to begin.",\n          "connected_start_sensorconnector": "Please stop the __controlling_client__ data collector to collect data here.",\n          "connected_start_sensorconnector_noname": "Please stop the other active data collector to collect data here.",\n          "starting_data_collection": "Starting data collection...",\n          "error_starting_data_collection": "Error starting data collection.",\n          "error_starting_data_collection_alert": "Could not start data collection. Make sure that (remote starting) is enabled",\n          "collecting_data": "Collecting data.",\n          "collecting_data_stop_labquest2": "Collecting data. Press stop on your LabQuest2 to end.",\n          "collecting_data_stop_sensorconnector": "Collecting data.",\n          "no_data": "No data is available.",\n          "no_data_alert": "The Sensor Connector does not appear to be reporting data for the plugged-in device",\n          "no_data_labquest2_alert": "The LabQuest does not appear to be reporting data for the plugged-in device",\n          "canceling_data_collection": "Canceling data collection...",\n          "error_canceling_data_collection": "Error canceling data collection.",\n          "error_canceling_data_collection_alert": "Could not cancel data collection. Make sure that (remote starting) is enabled",\n          "stopping_data_collection": "Stopping data collection...",\n          "error_stopping_data_collection": "Error stopping data collection.",\n          "error_stopping_data_collection_alert": "Could not stop data collection. Make sure that (remote starting) is enabled",\n          "data_collection_stopped": "Data collection stopped.",\n          "data_collection_complete": "Data collection complete.",\n          "disconnected": "Disconnected.",\n          "java_applet_error": "It appears that Java applets cannot run in your browser. If you are able to fix this, reload the page to use the sensor",\n          "java_applet_not_loading": "The sensor applet appears not to be loading. If you are able to fix this, reload the page to use the sensor",\n          "unexpected_error": "There was an unexpected error when connecting to the sensor.",\n          "sensor_not_attached": "The __sensor_name__ does not appear to be attached. Try re-attaching it, and then click \\"$t(sensor.messages.try_again)\\".",\n          "sensor_or_device_unplugged": "The __sensor_or_device_name__ was unplugged. Try plugging it back in, and then click \\"$t(sensor.messages.try_again)\\".",\n          "try_again": "Try Again",\n          "cancel": "Cancel"\n        },\n        "measurements": {\n          "sensor_reading": "Sensor Reading",\n          "time": "Time",\n          "distance": "Distance",\n          "acceleration": "Acceleration",\n          "altitude": "Altitude",\n          "angle": "Angle",\n          "CO2": "CO₂",\n          "CO2_concentration": "CO₂ Concentration",\n          "charge": "Charge",\n          "conductivity": "Conductivity",\n          "current": "Current",\n          "dissolved_oxygen": "DO",\n          "flow_rate": "Flow Rate",\n          "fluorescence_405_nm": "Fluorescence 405 nm",\n          "fluorescence_500_nm": "Fluorescence 500 nm",\n          "force": "Force",\n          "intensity": "Intensity",\n          "light_level": "Light Level",\n          "light_intensity": "Light Intensity",\n          "magnetic_field": "Magnetic Field",\n          "position": "Position",\n          "potential": "Potential",\n          "pressure": "Pressure",\n          "signal": "Signal",\n          "sound_level": "Sound Level",\n          "speed": "Speed",\n          "temperature": "Temperature",\n          "transmittance": "Transmittance",\n          "turbidity": "Turbidity",\n          "UV_intensity": "UV Intensity",\n          "velocity": "Velocity",\n          "volume": "Volume",\n          "pH": "pH",\n          "acidity": "Acidity",\n          "O2_concentration": "O₂ Concentration"\n        },\n        "names": {\n          "sensor": "sensor",\n          "no_sensor": "(no sensor)",\n          "light": "Light",\n          "motion": "Motion",\n          "accelerometer": "Accelerometer",\n          "dissolved_oxygen": "Dissolved Oxygen",\n          "pressure": "Pressure",\n          "charge_sensor": "Charge Sensor",\n          "voltage": "Voltage",\n          "pH": "pH",\n          "CO2_gas": "CO₂ Gas",\n          "colorimeter": "Colorimeter",\n          "conductivity": "Conductivity",\n          "current": "Current",\n          "temperature": "Temperature",\n          "force": "Force",\n          "anemometer": "Anemometer",\n          "hand_dynamometer": "Hand Dynamometer",\n          "heart_rate": "Heart Rate",\n          "magnetic_field": "Magnetic Field",\n          "rotary_motion": "Rotary Motion",\n          "linear_position_sensor": "Linear Position Sensor",\n          "sound_level": "Sound Level",\n          "spectrophotometer": "Spectrophotometer",\n          "spirometer": "Spirometer",\n          "turbidity": "Turbidity",\n          "UV_sensor": "UV Sensor",\n          "drop_counter": "Drop Counter",\n          "altitude": "Altitude",\n          "goMotion": "GoMotion",\n          "goTemp": "GoIO Temperature Sensor",\n          "goLinkTemperature": "GoIO Temperature Sensor",\n          "goLinkLight": "GoIO Light Sensor",\n          "goLinkForce": "GoIO Force Sensor",\n          "goLinkPH": "GoIO pH Sensor",\n          "goLinkCO2": "GoIO CO₂ sensor",\n          "goLinkO2": "GoIO O₂ sensor",\n          "labQuestMotion": "LabQuest Motion Sensor",\n          "labQuestTemperature": "LabQuest Temperature Sensor",\n          "labQuestLight": "LabQuest Light Sensor",\n          "labQuestForce": "LabQuest Force Sensor",\n          "labQuestPH": "LabQuest pH Sensor",\n          "labQuestCO2": "LabQuest CO₂ sensor",\n          "labQuestO2": "LabQuest O₂ sensor"\n        }\n      }\n    }\n  },\n  "pl": {\n    "translation": {\n      "banner": {\n        "about": "O symulacji",\n        "about_tooltip": "Instrukcje",\n        "share": "Udostępnij",\n        "share_tooltip": "Udostępnij tę symulację za pomocą e-mail, komunikatora lub umieść na swojej stronie internetowej",\n        "lang_tooltip": "Zmień język",\n        "reload_tooltip": "Załaduj symulację ponownie",\n        "help_tooltip": "Pokaż pomoc",\n        "credits_tooltip": "Dowiedz się więcej o Concord Consortium",\n        "fullscreen_tooltip": "Tryb pełnoekranowy",\n        "video_play_pause_tooltip": "Uruchom lub zatrzymaj symulację",\n        "video_reset_tooltip": "Zresetuj symulację",\n        "video_step_back_tooltip": "Krok wstecz",\n        "video_step_forward_tooltip": "Krok do przodu",\n        "text_start": "Uruchom",\n        "text_start_tooltip": "Uruchom symulację lub pobieranie danych",\n        "text_stop": "Zatrzymaj",\n        "text_stop_tooltip": "Zatrzymaj symulację lub pobieranie danych",\n        "text_reset": "Zresetuj",\n        "text_reset_tooltip": "Zresetuj symulację lub pobieranie danych"\n      },\n      "dialog": {\n        "close_tooltip": "Zamknij"\n      },\n      "about_dialog": {\n        "title": "O symulacji: __interactive_title__"\n      },\n      "share_dialog": {\n        "title": "Udostępnij: __interactive_title__",\n        "link": "odnośnik",\n        "paste_email_im": "Wklej ten __link__ do wiadomości e-mail lub wyślij za pomocą komunikatora.",\n        "paste_html": "Aby zamieścić symulację na swojej stronie lub blogu, wklej kod HTML znajdujący się poniżej.",\n        "select_size": "Wybierz rozmiar:",\n        "size_larger": "__val__% większy",\n        "size_actual": "aktualny",\n        "size_smaller": "__val__% mniejszy"\n      },\n      "credits_dialog": {\n        "title": "__interactive_title__",\n        "credits_text": "Ta symulacja została stworzona przez __CC_link__ przy użyciu __Next_Gen_MW_link__. Prace zostały sfinansowana przez grant otrzymany od __Google_link__.",\n        "shareable_ver": "Wersję tej symulacji, którą możesz udostępnić",\n        "find_shareable": "__shareable_ver_link__, wraz z setkami innych, darmowych symulacji i ćwiczeń znajdziesz na __concord_org_link__."\n      },\n      "copyright": {\n        "copyright": "Copyright",\n        "all_rights_reserved": "Wszystkie prawa zastrzeżone.",\n        "license": "To oprogramowanie jest rozpowszechniane na zasadach wolnej licencji __MIT_link__.",\n        "attribution": "Proszę umieścić odniesienia do Concord Consortium oraz witryny __concord_org_link__."\n      },\n      "md2d": {\n        "heatbath_icon_tooltip": "Stała temperatura",\n        "ke_icon_tooltip": "Skala energii kinetycznej",\n        "invalid_object_position_alert": "Niepoprawna pozycja obiektu.",\n        "aminoacid_menu": {\n          "hydrophobic": "Hydrofobowe",\n          "hydrophilic": "Hydrofilowe",\n          "glycine": "Glicyna",\n          "alanine": "Alanina",\n          "valine": "Walina",\n          "leucine": "Leucyna",\n          "isoleucine": "Izoleucyna",\n          "phenylalanine": "Fenyloalanina",\n          "proline": "Prolina",\n          "tryptophan": "Tryptofan",\n          "methionine": "Metionina",\n          "cysteine": "Cysteina",\n          "tyrosine": "Tyrozyna",\n          "asparagine": "Asparagina",\n          "glutamine": "Glutamina",\n          "serine": "Seryna",\n          "threonine": "Treonina",\n          "asparticacid": "Kwas asparaginowy",\n          "glutamicacid": "Kwas glutaminowy",\n          "lysine": "Lizyna",\n          "arginine": "Arginina",\n          "histidine": "Histydyna"\n        },\n        "mutations_menu": {\n          "substitution_mutation": "Substytucja",\n          "insertion_mutation": "Insercja",\n          "deletion_mutation": "Delecja",\n          "insert": "Wstaw"\n        }\n      },\n      "sensor": {\n        "select_sensor": "Wybierz sensor",\n        "select_sensor_type": "Wybierz rodzaj sensora...",\n        "reading": "Odczyt:",\n        "zero": "Wyzeruj",\n        "zeroing": "Zerowanie...",\n        "loading_sensor": "Ładowanie sensora...",\n        "choose_sensor_title": "Wybierz sensor:",\n        "connect": "Połącz",\n        "address_labquest2": "adres serwera LabQuest2",\n        "messages": {\n          "ready": "Gotowy do odczytu.",\n          "no_sensors": "Nie znaleziono sensorów.",\n          "no_devices": "Żadne urządzenie nie jest podłączone.",\n          "not_connected": "Brak połączenia.",\n          "connecting": "Łączenie...",\n          "connection_failed": "Połączenie nieudane.",\n          "connection_failed_alert": "Concord Consortium Sensor Connector nie jest zainstalowany lub nie działa. Proszę __click_here_link__ żeby otworzyć instrukcję dotyczącą korzystania z Sensor Connector.",\n          "connection_failed_labquest2_alert": "Nie udało się połączyć z LabQuest2. Upewnij się, że adres jest poprawny i LabQuest2 jest osiągalny z tego komputera.",\n          "tare_labquest2_alert": "LabQuest2 musi pobierać rzeczywiste dane aby się wyzerować. Ustaw nowy eksperyment na LabQuest2 lub kliknij ikonę licznika na górze po lewej stronie.",\n          "click_here": "kliknąć tutaj",\n          "connected": "Połączono.",\n          "connected_start_labquest2": "Połączono. Naciśnij start na LabQuest2 aby rozpocząć.",\n          "starting_data_collection": "Rozpoczynanie pobierania danych...",\n          "error_starting_data_collection": "Błąd podczas rozpoczynania pobierania danych.",\n          "error_starting_data_collection_alert": "Nie udało się rozpocząć pobierania danych. Upewnij się, że (remote starting) jest włączony",\n          "collecting_data": "Pobieranie danych.",\n          "collecting_data_stop_labquest2": "Pobieranie danych. Naciśnij stop na LabQuest2 aby zakończyć.",\n          "no_data": "Brak dostępnych danych.",\n          "no_data_alert": "Sensor Connector nie wydaje się raportować żadnych danych dla podłączonego urządzenia",\n          "no_data_labquest2_alert": "LabQuest nie wydaje się raportować żadnych danych dla podłączonego urządzenia",\n          "canceling_data_collection": "Anulowanie pobierania danych...",\n          "error_canceling_data_collection": "Błąd podczas anulowania pobierania danych.",\n          "error_canceling_data_collection_alert": "Nie udało się anulować pobierania danych. Upewnij się, że (remote starting) jest włączony",\n          "stopping_data_collection": "Zatrzymywanie pobierania danych...",\n          "error_stopping_data_collection": "Błąd podczas zatrzymywania pobierania danych.",\n          "error_stopping_data_collection_alert": "Nie udało się zatrzymać pobierania danych. Upewnij się, że (remote starting) jest włączony",\n          "data_collection_stopped": "Pobieranie danych zatrzymane.",\n          "data_collection_complete": "Pobieranie danych zakończone.",\n          "disconnected": "Rozłączono.",\n          "java_applet_error": "Aplety Java prawodpodobnie nie mogą być uruchomione w twojej przeglądarce. Jeżeli jesteś w stanie to naprawić to potem odśwież stronę, żeby użyć sensora.",\n          "java_applet_not_loading": "Sensor Aplet nie ładuje się. Jeżeli jesteś w stanie to naprawić to potem odśwież stronę, żeby użyć sensora.",\n          "unexpected_error": "Wystąpił nieoczekiwany błąd podczas próby połączenia z sensorem.",\n          "sensor_not_attached": "__sensor_name__ wydaje się być niedpołączony. Spróbuj podłączyć go ponownie i potem kliknij \\"$t(sensor.messages.try_again)\\".",\n          "sensor_or_device_unplugged": "__sensor_or_device_name__ został odłączony. Spróbuj podłączyć go ponownie i potem kliknij \\"$t(sensor.messages.try_again)\\".",\n          "try_again": "Spróbuj ponownie",\n          "cancel": "Anuluj"\n        },\n        "measurements": {\n          "sensor_reading": "Odczyt sensora",\n          "time": "Czas",\n          "distance": "Odległość",\n          "acceleration": "Przyspieszenie",\n          "altitude": "Wysokość",\n          "angle": "Kąt",\n          "CO2": "CO₂",\n          "CO2_concentration": "Stężenie CO₂",\n          "charge": "Ładunek",\n          "conductivity": "Przewodność właściwa",\n          "current": "Natężenie prądu",\n          "dissolved_oxygen": "Stężenie tlenu",\n          "flow_rate": "Strumień objętości",\n          "fluorescence_405_nm": "Fluorescencja 405 nm",\n          "fluorescence_500_nm": "Fluorescencja 500 nm",\n          "force": "Siła",\n          "intensity": "Natężenie",\n          "light_level": "Natężenie światła",\n          "light_intensity": "Intensywność światła",\n          "magnetic_field": "Pole magnetyczne",\n          "position": "Pozycja",\n          "potential": "Potencjał",\n          "pressure": "Ciśnienie",\n          "signal": "Sygnał",\n          "sound_level": "Natężenie dźwięku",\n          "speed": "Szybkość",\n          "temperature": "Temperatura",\n          "transmittance": "Transmitacja",\n          "turbidity": "Mętność",\n          "UV_intensity": "Natężenie UV",\n          "velocity": "Prędkość",\n          "volume": "Objętość",\n          "pH": "pH",\n          "acidity": "Kwasowość",\n          "O2_concentration": "Stężenie O₂"\n        },\n        "names": {\n          "sensor": "czujnik",\n          "no_sensor": "(brak czujnika)",\n          "light": "Światło",\n          "motion": "Ruch",\n          "accelerometer": "Akcelerometr",\n          "dissolved_oxygen": "Stężenie tlenu",\n          "pressure": "Ciśnienie",\n          "charge_sensor": "Czujnik ładunku",\n          "voltage": "Napięcie",\n          "pH": "pH",\n          "CO2_gas": "Czujnik CO₂",\n          "colorimeter": "Kolorymetr",\n          "conductivity": "Przewodność właściwa",\n          "current": "Natężenie prądu",\n          "temperature": "Temperatura",\n          "force": "Siła",\n          "anemometer": "Anemometr",\n          "hand_dynamometer": "Dynamometr",\n          "heart_rate": "Pulsometr",\n          "magnetic_field": "Pole magnetyczne",\n          "rotary_motion": "Ruch obrotowy",\n          "linear_position_sensor": "Czujnik położenia",\n          "sound_level": "Natężenie dźwięku",\n          "spectrophotometer": "Spektrofotometr",\n          "spirometer": "Spirometr",\n          "turbidity": "Mętność",\n          "UV_sensor": "Czujnik UV",\n          "drop_counter": "Licznik kropli",\n          "altitude": "Wysokość",\n          "goMotion": "GoMotion",\n          "goTemp": "GoIO czujnik temperatury",\n          "goLinkTemperature": "GoIO czujnik temperatury",\n          "goLinkLight": "GoIO czujnik światła",\n          "goLinkForce": "GoIO czujnik siły",\n          "goLinkPH": "GoIO czujnik pH",\n          "goLinkCO2": "GoIO czujnik CO₂",\n          "goLinkO2": "GoIO czujnik O₂",\n          "labQuestMotion": "LabQuest czujnik ruchu",\n          "labQuestTemperature": "LabQuest czujnik temperatury",\n          "labQuestLight": "LabQuest czujnik światła",\n          "labQuestForce": "LabQuest czujnik siły",\n          "labQuestPH": "LabQuest czujnik pH",\n          "labQuestCO2": "LabQuest czujnik CO₂",\n          "labQuestO2": "LabQuest czujnik O₂"\n        }\n      }\n    }\n  },\n  "nb-NO": {\n    "translation": {\n      "banner": {\n        "about": "Om simuleringen",\n        "about_tooltip": "Bruksanvisning",\n        "share": "Del",\n        "share_tooltip": "Del med e-post, melding eller innbygging",\n        "lang_tooltip": "Velg språk",\n        "reload_tooltip": "Last simuleringen på nytt",\n        "help_tooltip": "Vis hjelpetekster",\n        "credits_tooltip": "Lær mer om Concord Consortium",\n        "fullscreen_tooltip": "Slå fullskjermvisning av/på",\n        "video_play_pause_tooltip": "Start og stopp simuleringen",\n        "video_reset_tooltip": "Tilbakestill simuleringen",\n        "video_step_back_tooltip": "Gå et steg bakover",\n        "video_step_forward_tooltip": "Gå et steg framover",\n        "text_start": "Start",\n        "text_start_tooltip": "Start simuleringen eller datainnsamlingen",\n        "text_stop": "Stopp",\n        "text_stop_tooltip": "Stopp simuleringen eller datainnsamlingen",\n        "text_reset": "Tilbakestill",\n        "text_reset_tooltip": "Tilbakestill simuleringen eller datainnsamlingen"\n      },\n      "dialog": {\n        "close_tooltip": "Lukk"\n      },\n      "about_dialog": {\n        "title": "Om: __interactive_title__"\n      },\n      "share_dialog": {\n        "title": "-Del: __interactive_title__",\n        "link": "lenke",\n        "paste_email_im": "Lim inn denne __link__ i en e-post eller melding.",\n        "paste_html": "Lim inn HTML for innbygging på et nettsted eller en blogg.",\n        "select_size": "Velg størrelse:",\n        "size_larger": "__val__% større",\n        "size_actual": "faktisk",\n        "size_smaller": "__val__% mindre"\n      },\n      "credits_dialog": {\n        "title": "Informasjon om: __interactive_title__",\n        "credits_text": "Denne simuleringen er laget av __CC_link__ med bruk av __Next_Gen_MW_link__ programvare, finanisert av en bevilgning fra __Google_link__.",\n        "shareable_ver": "simuleringen kan deles",\n        "find_shareable": "Du finner en __shareable_ver_link__ av denne simuleringen, sammen med dusinvis andre open-source simuleringer for vitenskap, matematikk og teknologi på __concord_org_link__."\n      },\n      "copyright": {\n        "copyright": "Copyright",\n        "all_rights_reserved": "Alle rettigheter reservert.",\n        "license": "Denne programvaren er lisensiert under __MIT_link__ lisens.",\n        "attribution": "Vær vennlig å referere til Concord Consortium og URLen __concord_org_link__."\n      },\n      "md2d": {\n        "heatbath_icon_tooltip": "Varmebad er på",\n        "ke_icon_tooltip": "Kinetisk energigradient",\n        "invalid_object_position_alert": "You can\'t drop the object there.",\n        "aminoacid_menu": {\n          "hydrophobic": "Hydrofob",\n          "hydrophilic": "Hydrofil",\n          "glycine": "Glysin",\n          "alanine": "Alanin",\n          "valine": "Valin",\n          "leucine": "Leucin",\n          "isoleucine": "Isoleucin",\n          "phenylalanine": "Fenylalanin",\n          "proline": "Prolin",\n          "tryptophan": "Tryptofan",\n          "methionine": "Metionin",\n          "cysteine": "Cystin",\n          "tyrosine": "Tyrosin",\n          "asparagine": "Aspargin",\n          "glutamine": "Glutamin",\n          "serine": "Serin",\n          "threonine": "Threonin",\n          "asparticacid": "Asparginsyre",\n          "glutamicacid": "Glutaminsyre",\n          "lysine": "Lysin",\n          "arginine": "Arginin",\n          "histidine": "Histidin"\n        },\n        "mutations_menu": {\n          "substitution_mutation": "Substitusjonsmutasjon",\n          "insertion_mutation": "Insersjonsmutasjon",\n          "deletion_mutation": "Delesjonsmutasjon",\n          "insert": "Sett inn"\n        }\n      },\n      "sensor": {\n        "select_sensor": "Velg sensor",\n        "select_sensor_type": "Velg sensortype...",\n        "reading": "Avlesning:",\n        "zero": "Null",\n        "zeroing": "Nullstilling...",\n        "loading_sensor": "Laster sensor...",\n        "choose_sensor_title": "Velg en sensor:",\n        "connect": "Koble til",\n        "address_labquest2": "adressen til LabQuest2",\n        "messages": {\n          "ready": "Klar til innsamling.",\n          "no_sensors": "Finner ingen sensorer.",\n          "no_devices": "Ingen enheter er tilkoblet.",\n          "not_connected": "Ikke tilkoblet.",\n          "connecting": "Kobler til...",\n          "connection_failed": "Tilkobling feilet.",\n          "connection_failed_alert": "Concord Consortium Sensor Connector er ikke installert eller kjører ikke. Vennligst __click_here_link__ for instruksjoner om hvordan du bruker Sensor Connector.",\n          "connection_failed_labquest2_alert": "Kunne ikke koble til LabQuest2. Vennligst sjekk at adressen er riktig, og at LabQuest2 kan nås fra denne datamaskinen",\n          "tare_labquest2_alert": "LabQuest2 må samle inn data i sanntid for å kunne nullstilles. Sett enten opp en ny måling, eller klikk målerikonet oppe til venstre.",\n          "click_here": "klikk her",\n          "connected": "Tilkoblet.",\n          "connected_start_labquest2": "Tilkoblet. Trykk start på LabQuest2 for å begynne.",\n          "starting_data_collection": "Starter datainnsamling...",\n          "error_starting_data_collection": "Feil ved start av datainnsamling.",\n          "error_starting_data_collection_alert": "Kunne ikke starte datainnsamling. Forsikre deg om at (fjernstart) er aktivert.",\n          "collecting_data": "Samler inn data.",\n          "collecting_data_stop_labquest2": "Samler inn data. Trykk stopp på LabQuest2 for å avslutte.",\n          "no_data": "Ingen data er tilgengelig.",\n          "no_data_alert": "Sensorkonnektoren ser ikke ut til å levere data fra den tilkoblede enheten",\n          "no_data_labquest2_alert": "LabQuest ser ikke ut til å rapportere data fra den tilkoblede enheten",\n          "canceling_data_collection": "Avbryter datainnsamling...",\n          "error_canceling_data_collection": "Feil ved avbrytelse av datainnsamling.",\n          "error_canceling_data_collection_alert": "Kunne ikke avbryte datainnsamling. Sjekk at (fjernstart) er aktivert",\n          "stopping_data_collection": "Stopper datainnsamling...",\n          "error_stopping_data_collection": "Feil ved stopp av datainnsamling.",\n          "error_stopping_data_collection_alert": "Kunne ikke stoppe datainnsamling. Sjekk at (fjernstart) er aktivert",\n          "data_collection_stopped": "Datainnsamling stoppet.",\n          "data_collection_complete": "Datainnsamling er fullført.",\n          "disconnected": "Koblet fra.",\n          "java_applet_error": "Det ser ut som javaappleter ikke kan kjøre i nettleseren. Hvis du kan rette på dette, last siden på nytt for å bruke sensoren",\n          "java_applet_not_loading": "Sensorappleten ser ikke ut til å virke. Hvis du kan rette på dette, kan du laste siden på nytt for å bruke sensoren",\n          "unexpected_error": "Det oppsto en uventet feil da sensoren ble tilkoblet.",\n          "sensor_not_attached": " __sensor_name__ ser ikke ut til å være tilkoblet. Prøv å koble til på nytt, og klikk på \\"$t(sensor.messages.try_again)\\".",\n          "sensor_or_device_unplugged": " __sensor_or_device_name__ ble frakoblet. Prøv å koble til på nytt, og klikk på \\"$t(sensor.messages.try_again)\\".",\n          "try_again": "Prøv igjen",\n          "cancel": "Avbryt"\n        },\n        "measurements": {\n          "sensor_reading": "Sensoravlesning",\n          "time": "Tid",\n          "distance": "Avstand",\n          "acceleration": "Akselerasjon",\n          "altitude": "Høyde",\n          "angle": "Vinkel",\n          "CO2": "CO₂",\n          "CO2_concentration": "CO₂-konsentrasjon",\n          "charge": "Ladning",\n          "conductivity": "Ledningsevne",\n          "current": "Strøm",\n          "dissolved_oxygen": "OO",\n          "flow_rate": "Gjennomstrømningsmengde",\n          "fluorescence_405_nm": "Fluorescens 405 nm",\n          "fluorescence_500_nm": "Fluorescens 500 nm",\n          "force": "Kraft",\n          "intensity": "Intensitet",\n          "light_level": "Lysnivå",\n          "light_intensity": "Lysintensitet",\n          "magnetic_field": "Magnetfelt",\n          "position": "Posisjon",\n          "potential": "Potensial",\n          "pressure": "Trykk",\n          "signal": "Signal",\n          "sound_level": "Lydnivå",\n          "speed": "Fart",\n          "temperature": "Temperatur",\n          "transmittance": "Transmittans",\n          "turbidity": "Turbiditet",\n          "UV_intensity": "UV-intensitet",\n          "velocity": "Hastighet",\n          "volume": "Volum",\n          "pH": "pH",\n          "acidity": "Surhet",\n          "O2_concentration": "O₂-konsentrasjon"\n        },\n        "names": {\n          "sensor": "sensor",\n          "no_sensor": "(ingen sensor)",\n          "light": "Lys",\n          "motion": "Bevegelse",\n          "accelerometer": "Akselerometer",\n          "dissolved_oxygen": "Oppløst oksygen",\n          "pressure": "Trykk",\n          "charge_sensor": "Ladningssensor",\n          "voltage": "Spenning",\n          "pH": "pH",\n          "CO2_gas": "CO₂-gass",\n          "colorimeter": "Kolorimeter",\n          "conductivity": "Ledningsevne",\n          "current": "Strøm",\n          "temperature": "Temperatur",\n          "force": "Kraft",\n          "anemometer": "Anemometer",\n          "hand_dynamometer": "Hånddynamometer",\n          "heart_rate": "Hjertefrekvens",\n          "magnetic_field": "Magnetfelt",\n          "rotary_motion": "Rotasjon",\n          "linear_position_sensor": "Sensor for lineær posisjon",\n          "sound_level": "Lydnivå",\n          "spectrophotometer": "Spektrofotometer",\n          "spirometer": "Spirometer",\n          "turbidity": "Turbiditet",\n          "UV_sensor": "UV-sensor",\n          "drop_counter": "Dråpeteller",\n          "altitude": "Høyde",\n          "goMotion": "GoMotion",\n          "goTemp": "GoIO temperatursensor",\n          "goLinkTemperature": "GoIO temperatursensor",\n          "goLinkLight": "GoIO lyssensor",\n          "goLinkForce": "GoIO kraftsensor",\n          "goLinkPH": "GoIO pH-sensor",\n          "goLinkCO2": "GoIO CO₂-sensor",\n          "goLinkO2": "GoIO CO₂-sensor",\n          "labQuestMotion": "LabQuest bevegelsessensor",\n          "labQuestTemperature": "LabQuest temperatursensor",\n          "labQuestLight": "LabQuest lyssensor",\n          "labQuestForce": "LabQuest kraftsensor",\n          "labQuestPH": "LabQuest pH-sensor",\n          "labQuestCO2": "LabQuest CO₂-sensor",\n          "labQuestO2": "LabQuest O₂-sensor"\n        }\n      }\n    }\n  },\n  "nn-NO": {\n    "translation": {\n      "banner": {\n        "about": "Om simuleringa",\n        "about_tooltip": "Brukarrettleiing",\n        "share": "Del",\n        "share_tooltip": "Del med e-post, melding eller innbygging",\n        "lang_tooltip": "Vel språk",\n        "reload_tooltip": "Last simuleringa på nytt",\n        "help_tooltip": "Vis hjelpetekstar",\n        "credits_tooltip": "Lær meir om Concord Consortium",\n        "fullscreen_tooltip": "Slå fullskjermvising av/på",\n        "video_play_pause_tooltip": "Start og stopp simuleringa",\n        "video_reset_tooltip": "Tilbakestill simuleringa",\n        "video_step_back_tooltip": "Gå eit steg bakover",\n        "video_step_forward_tooltip": "Gå eit steg framover",\n        "text_start": "Start",\n        "text_start_tooltip": "Start simuleringa eller datainnsamlinga",\n        "text_stop": "Stopp",\n        "text_stop_tooltip": "Stopp simuleringa eller datainnsamlinga",\n        "text_reset": "Tilbakestill",\n        "text_reset_tooltip": "Tilbakestill simuleringa eller datainnsamlinga"\n      },\n      "dialog": {\n        "close_tooltip": "Lukk"\n      },\n      "about_dialog": {\n        "title": "Om: __interactive_title__"\n      },\n      "share_dialog": {\n        "title": "-Del: __interactive_title__",\n        "link": "lenke",\n        "paste_email_im": "Lim inn denne __link__ i ein e-post eller melding.",\n        "paste_html": "Lim inn HTML for innbygging på ein nettstad eller ein blogg.",\n        "select_size": "Vel storleik:",\n        "size_larger": "__val__% større",\n        "size_actual": "faktisk",\n        "size_smaller": "__val__% mindre"\n      },\n      "credits_dialog": {\n        "title": "Informasjon om: __interactive_title__",\n        "credits_text": "Denne simuleringa er laga av __CC_link__ med bruk av __Next_Gen_MW_link__ programvare, finanisert av ei løyving frå __Google_link__.",\n        "shareable_ver": "simuleringa kan delast",\n        "find_shareable": "Du finn ein __shareable_ver_link__ av denne simuleringa, saman med dusinvis andre open-source simuleringar for vitskap, matematikk og teknologi på __concord_org_link__."\n      },\n      "copyright": {\n        "copyright": "Copyright",\n        "all_rights_reserved": "Alle rettar reservert.",\n        "license": "Denne programvara er lisensiert under __MIT_link__ eller lisens.",\n        "attribution": "Vær venleg å referere til Concord Consortium og URLen __concord_org_link__."\n      },\n      "md2d": {\n        "heatbath_icon_tooltip": "Varmebad er på",\n        "ke_icon_tooltip": "Kinetisk energigradient",\n        "invalid_object_position_alert": "You can\'t drop the object there.",\n        "aminoacid_menu": {\n          "hydrophobic": "Hydrofob",\n          "hydrophilic": "Hydrofil",\n          "glycine": "Glysin",\n          "alanine": "Alanin",\n          "valine": "Valin",\n          "leucine": "Leucin",\n          "isoleucine": "Isoleucin",\n          "phenylalanine": "Fenylalanin",\n          "proline": "Prolin",\n          "tryptophan": "Tryptofan",\n          "methionine": "Metionin",\n          "cysteine": "Cystin",\n          "tyrosine": "Tyrosin",\n          "asparagine": "Aspargin",\n          "glutamine": "Glutamin",\n          "serine": "Serin",\n          "threonine": "Threonin",\n          "asparticacid": "Asparginsyre",\n          "glutamicacid": "Glutaminsyre",\n          "lysine": "Lysin",\n          "arginine": "Arginin",\n          "histidine": "Histidin"\n        },\n        "mutations_menu": {\n          "substitution_mutation": "Substitusjonsmutasjon",\n          "insertion_mutation": "Insersjonsmutasjon",\n          "deletion_mutation": "Delesjonsmutasjon",\n          "insert": "Sett inn"\n        }\n      },\n      "sensor": {\n        "select_sensor": "Vel sensor",\n        "select_sensor_type": "Vel sensortype...",\n        "reading": "Avlesing:",\n        "zero": "Null",\n        "zeroing": "Nullstilling...",\n        "loading_sensor": "Lastar sensor...",\n        "choose_sensor_title": "Vel en sensor:",\n        "connect": "Kople til",\n        "address_labquest2": "adressen til LabQuest2",\n        "messages": {\n          "ready": "Klar til innsamling.",\n          "no_sensors": "Finn ingen sensorer.",\n          "no_devices": "Inga eining er kopla til.",\n          "not_connected": "Ikkje tilkopla.",\n          "connecting": "Kopla til...",\n          "connection_failed": "Tilkopling feila.",\n          "connection_failed_alert": "Concord Consortium Sensor Connector er ikke installert eller kjører ikke. Vær venleg __click_here_link__ for, om naudsynt, å laste ned eit installasjonsprogram for sensortilkoplinga.",\n          "connection_failed_labquest2_alert": "Kunne ikkje kople til LabQuest2. Vær venleg, sjekk at adressen er rett, og at LabQuest2 kan nåast frå denne datamaskina",\n          "tare_labquest2_alert": "LabQuest2 må samle inn data i sann tid for å kunne nullstillast. Sett anten opp en ny måling, eller klikk målårikonet oppe til venstre.",\n          "click_here": "klikk her",\n          "connected": "Tilkopla.",\n          "connected_start_labquest2": "Tilkopla. Trykk start på LabQuest2 for å byrje.",\n          "starting_data_collection": "Startar datainnsamling...",\n          "error_starting_data_collection": "Feil ved start av datainnsamling.",\n          "error_starting_data_collection_alert": "Kunne ikkje starte datainnsamling. Forsikre deg om at (fjernstart) er aktivert.",\n          "collecting_data": "Samlar inn data.",\n          "collecting_data_stop_labquest2": "Samlar inn data. Trykk stopp på LabQuest2 for å avslutte.",\n          "no_data": "Ingen data er tilgengelege.",\n          "no_data_alert": "Sensorkonnektoren ser ikkje ut til å levere data frå den tilkopla eininga",\n          "no_data_labquest2_alert": "LabQuest ser ikkje ut til å rapportere data frå den tilkopla eininga",\n          "canceling_data_collection": "Avbryt datainnsamlinga...",\n          "error_canceling_data_collection": "Feil på avbrytinga av datainnsamlinga.",\n          "error_canceling_data_collection_alert": "Kunne ikkje avbryte datainnsamlinga. Sjekk at (fjernstart) er aktivert",\n          "stopping_data_collection": "Stopper datainnsamlinga...",\n          "error_stopping_data_collection": "Feil ved stopp av datainnsamlinga.",\n          "error_stopping_data_collection_alert": "Kunne ikkje stoppe datainnsamlinga. Sjekk at (fjernstart) er aktivert",\n          "data_collection_stopped": "Datainnsamlinga stoppa.",\n          "data_collection_complete": "Datainnsamlinga er fullført.",\n          "disconnected": "Kopla frå.",\n          "java_applet_error": "Det ser ut som javaappleter ikkje kan køyre i nettlesaren. Hvis du kan rette på dette, last inn sida på nytt for å bruke sensoren",\n          "java_applet_not_loading": "Sensorappleten ser ikkje ut til å virke. Hvis du kan rette på dette, kan du laste inn sida på nytt for å bruke sensoren",\n          "unexpected_error": "Det oppsto ein uventa feil då sensoren vart tilkopla.",\n          "sensor_not_attached": " __sensor_name__ ser ikkje ut til å vere tilkopla. Prøv å kople til på nytt, og klikk på \\"$t(sensor.messages.try_again)\\".",\n          "sensor_or_device_unplugged": " __sensor_or_device_name__ ble frakopla. Prøv å kople til på nytt, og klikk på \\"$t(sensor.messages.try_again)\\".",\n          "try_again": "Prøv igjen",\n          "cancel": "Avbryt"\n        },\n        "measurements": {\n          "sensor_reading": "Sensoravlesing",\n          "time": "Tid",\n          "distance": "Avstand",\n          "acceleration": "Akselerasjon",\n          "altitude": "Høgd",\n          "angle": "Vinkel",\n          "CO2": "CO₂",\n          "CO2_concentration": "CO₂-konsentrasjon",\n          "charge": "Ladning",\n          "conductivity": "Leiingsevne",\n          "current": "Strøm",\n          "dissolved_oxygen": "OO",\n          "flow_rate": "Gjennomstrømmingsmengd",\n          "fluorescence_405_nm": "Fluorescens 405 nm",\n          "fluorescence_500_nm": "Fluorescens 500 nm",\n          "force": "Kraft",\n          "intensity": "Intensitet",\n          "light_level": "Lysnivå",\n          "light_intensity": "Lysintensitet",\n          "magnetic_field": "Magnetfelt",\n          "position": "Posisjon",\n          "potential": "Potensial",\n          "pressure": "Trykk",\n          "signal": "Signal",\n          "sound_level": "Lydnivå",\n          "speed": "Fart",\n          "temperature": "Temperatur",\n          "transmittance": "Transmittans",\n          "turbidity": "Turbiditet",\n          "UV_intensity": "UV-intensitet",\n          "velocity": "Hastigheit",\n          "volume": "Volum",\n          "pH": "pH",\n          "acidity": "Surleik",\n          "O2_concentration": "O₂-konsentrasjon"\n        },\n        "names": {\n          "sensor": "sensor",\n          "no_sensor": "(ingen sensor)",\n          "light": "Lys",\n          "motion": "Rørsle",\n          "accelerometer": "Akselerometer",\n          "dissolved_oxygen": "Løyst oksygen",\n          "pressure": "Trykk",\n          "charge_sensor": "Ladingssensor",\n          "voltage": "Spenning",\n          "pH": "pH",\n          "CO2_gas": "CO₂-gass",\n          "colorimeter": "Kolorimeter",\n          "conductivity": "Leiingsevne",\n          "current": "Strøm",\n          "temperature": "Temperatur",\n          "force": "Kraft",\n          "anemometer": "Anemometer",\n          "hand_dynamometer": "Handdynamometer",\n          "heart_rate": "Hjertefrekvens",\n          "magnetic_field": "Magnetfelt",\n          "rotary_motion": "Rotasjon",\n          "linear_position_sensor": "Sensor for lineær posisjon",\n          "sound_level": "Lydnivå",\n          "spectrophotometer": "Spektrofotometer",\n          "spirometer": "Spirometer",\n          "turbidity": "Turbiditet",\n          "UV_sensor": "UV-sensor",\n          "drop_counter": "Dropeteljar",\n          "altitude": "Høgd",\n          "goMotion": "GoMotion",\n          "goTemp": "GoIO temperatursensor",\n          "goLinkTemperature": "GoIO temperatursensor",\n          "goLinkLight": "GoIO lyssensor",\n          "goLinkForce": "GoIO kraftsensor",\n          "goLinkPH": "GoIO pH-sensor",\n          "goLinkCO2": "GoIO CO₂-sensor",\n          "goLinkO2": "GoIO CO₂-sensor",\n          "labQuestMotion": "LabQuest rørslesensor",\n          "labQuestTemperature": "LabQuest temperatursensor",\n          "labQuestLight": "LabQuest lyssensor",\n          "labQuestForce": "LabQuest kraftsensor",\n          "labQuestPH": "LabQuest pH-sensor",\n          "labQuestCO2": "LabQuest CO₂-sensor",\n          "labQuestO2": "LabQuest O₂-sensor"\n        }\n      }\n    }\n  },\n  "pt-BR": {\n    "translation": {\n      "banner": {\n        "about": "Sobre",\n        "about_tooltip": "Instruções",\n        "share": "Compartilhar",\n        "share_tooltip": "Compartilha por e-mail, mensagem ou inclui em site",\n        "lang_tooltip": "Seleciona a língua",\n        "reload_tooltip": "Recarrega o interativo",\n        "help_tooltip": "Mostra dicas",\n        "credits_tooltip": "Saber mais sobre The Concord Consortium",\n        "fullscreen_tooltip": "Alterna para tela cheia",\n        "video_play_pause_tooltip": "Inicia / pausa a simulação",\n        "video_reset_tooltip": "Reinicia a simulação",\n        "video_step_back_tooltip": "Passo atrás",\n        "video_step_forward_tooltip": "Passo adiante",\n        "text_start": "Iniciar",\n        "text_start_tooltip": "Inicia a simulação ou coleta de dados",\n        "text_stop": "Parar",\n        "text_stop_tooltip": "Para a simulação ou coleta de dados",\n        "text_reset": "Reiniciar",\n        "text_reset_tooltip": "Reinicia a simulação ou coleta de dados",\n        "text_new_run": "Nova corrida",\n        "text_new_run_tooltip": "Prepara nova corrida experimental",\n        "text_analyze_data": "Analisar dados",\n        "text_analyze_data_tooltip": "Envia dados experimentais para CODAP"\n      },\n      "dialog": {\n        "close_tooltip": "Fecha"\n      },\n      "about_dialog": {\n        "title": "Sobre: __interactive_title__"\n      },\n      "share_dialog": {\n        "title": "Compartilhar: __interactive_title__",\n        "link": "link",\n        "paste_email_im": "Cole este __link__ no email ou mensagem.",\n        "paste_html": "Cole o HTML para incluir em site ou blog.",\n        "select_size": "Selecione o tamanho:",\n        "size_larger": "__val__% maior",\n        "size_actual": "real",\n        "size_smaller": "__val__% menor"\n      },\n      "credits_dialog": {\n        "title": "Créditos: __interactive_title__",\n        "credits_text": "Este interativo foi criado pelo __CC_link__ usando nosso __Next_Gen_MW_link__ software, com o apoio financeiro do __Google_link__.",\n        "shareable_ver": "versão compartilhável",\n        "find_shareable": "Encontre uma __shareable_ver_link__ deste interativo e mais dezenas de outros interativos de código aberto para ciência, matemática e engenharia em __concord_org_link__."\n      },\n      "copyright": {\n        "copyright": "Copyright",\n        "all_rights_reserved": "Todos direitos reservados.",\n        "license": "O software é licenciado sob a licença __MIT_link__.",\n        "attribution": "Por favor, forneça a atribuição ao Concord Consortium and a URL __concord_org_link__."\n      },\n      "md2d": {\n        "heatbath_icon_tooltip": "Banho de calor ativo",\n        "ke_icon_tooltip": "Gradiente de energia cinética",\n        "invalid_object_position_alert": "You can\'t drop the object there.",\n        "aminoacid_menu": {\n          "hydrophobic": "Hidrofóbico",\n          "hydrophilic": "Hidrofílico",\n          "glycine": "Glicina",\n          "alanine": "Alanina",\n          "valine": "Valina",\n          "leucine": "Leucina",\n          "isoleucine": "Isoleucina",\n          "phenylalanine": "Phenilalanina",\n          "proline": "Prolina",\n          "tryptophan": "Triptofano",\n          "methionine": "Metionina",\n          "cysteine": "Cisteína",\n          "tyrosine": "Tirosina",\n          "asparagine": "Asparagina",\n          "glutamine": "Glutamina",\n          "serine": "Serina",\n          "threonine": "Treonina",\n          "asparticacid": "Ácido aspártico",\n          "glutamicacid": "Ácido glutâmico",\n          "lysine": "Lisina",\n          "arginine": "Arginina",\n          "histidine": "Histidina"\n        },\n        "mutations_menu": {\n          "substitution_mutation": "Mutação de substituição",\n          "insertion_mutation": "Mutação de inserção",\n          "deletion_mutation": "Mutação de deleção",\n          "insert": "Inserir"\n        }\n      },\n      "sensor": {\n        "select_sensor": "Selecione o sensor",\n        "select_sensor_type": "Selecione o tipo de sensor...",\n        "reading": "Leitura:",\n        "zero": "Zero",\n        "zeroing": "Zerando...",\n        "loading_sensor": "Carregando sensor...",\n        "choose_sensor_title": "Selecione o sensor:",\n        "connect": "Conectar",\n        "address_labquest2": "endereço do LabQuest2",\n        "messages": {\n          "ready": "Pronto para coletar.",\n          "ready_nocontrol": "Por favor pare o coletor de dados __controlling_client__ para coletar dados aqui.",\n          "ready_nocontrol_noname": "Por favor pare o outro coletor de dados ativo para coletar dados aqui.",\n          "no_sensors": "Nenhum sensor encontrado.",\n          "no_devices": "Nenhum dispositivo plugado.",\n          "not_connected": "Não contectado.",\n          "connecting": "Conectando...",\n          "connection_failed": "Conexão falhou.",\n          "connection_in_progress": "Conectando-se a seus sensores. Se uma mensagem surge sobre sensorconnector.concord.org, por favor, aceite -o",\n          "connection_failed_alert": "O Conector de Sensores do Concord Consortium não está instalado ou não está funcionando. Por favor __click_here_link__ obter instruções sobre a utilização do Conector de Sensores.",\n          "connection_failed_labquest2_alert": "Não foi possível conectar ao LabQuest2. Por favor verifique se o endereço está certo e se o LabQuest2 pode ser alcançado deste computador",\n          "tare_labquest2_alert": "O LabQuest2 precisa conectar dados ao vivo para zerar. Inicie uma nova corrida no LabQuest2 ou clique no ícone do medidor no alto à esquerda.",\n          "click_here": "clique aqui",\n          "connected": "Conectado.",\n          "connected_start_labquest2": "Conectado. Aperte iniciar no seu LabQuest2 to começar.",\n          "connected_start_sensorconnector": "Por favor pare o coletor de dados __controlling_client__ para coletar dados aqui.",\n          "connected_start_sensorconnector_noname": "Por favor pare o outro coletor de dados ativo para coletar dados aqui.",\n          "starting_data_collection": "Iniciando coleta de dados...",\n          "error_starting_data_collection": "Erro ao iniciar a coleta de dados.",\n          "error_starting_data_collection_alert": "Não foi possível iniciar a coleta de dados. Verifique se (remote starting) está habilitado",\n          "collecting_data": "Coletando dados.",\n          "collecting_data_stop_labquest2": "Coletando dados. Pressione parar no seu LabQuest2 para encerrar.",\n          "collecting_data_stop_sensorconnector": "Coletando dados.",\n          "no_data": "Não há dados disponíveis.",\n          "no_data_alert": "O Conector de Sensores parece não estar reportando dados ao dispositivo plugado",\n          "no_data_labquest2_alert": "The LabQuest parece não estar reportando dados ao dispositivo plugado",\n          "canceling_data_collection": "Cancelando coleta de dados...",\n          "error_canceling_data_collection": "Erro ao cancelar a coleta de dados.",\n          "error_canceling_data_collection_alert": "Não foi possível cancelar a coleta de dados. Verifique se (remote starting) está habilitado",\n          "stopping_data_collection": "Interrompendo a coleta de dados...",\n          "error_stopping_data_collection": "Erro ao interromper a coleta de dados.",\n          "error_stopping_data_collection_alert": "Não foi possível interromper a coleta de dados. Verifique se (remote starting) está habilitado",\n          "data_collection_stopped": "Coleta de dados interrompida.",\n          "data_collection_complete": "Coleta de dados completa.",\n          "disconnected": "Desconectado.",\n          "java_applet_error": "Parece que applets Java não podem rodar no seu navegador. Se você puder consertar isso, recarregue a página para usar o sensor.",\n          "java_applet_not_loading": "O applet do sensor parece não estar carregando. Se você puder consertar isso, recarregue a página para usar o sensor.",\n          "unexpected_error": "Houve um erro inesperado ao conectar com o sensor.",\n          "sensor_not_attached": "O __sensor_name__ parece não estar conectado. Tente reconectá-lo, e então clique \\"$t(sensor.messages.try_again)\\".",\n          "sensor_or_device_unplugged": "O __sensor_or_device_name__ estava deplugado. Tente reconectá-lo, e então clique \\"$t(sensor.messages.try_again)\\".",\n          "try_again": "Tentar de novo",\n          "cancel": "Cancelar"\n        },\n        "measurements": {\n          "sensor_reading": "Leitura do sensor",\n          "time": "Tempo",\n          "distance": "Distância",\n          "acceleration": "Aceleração",\n          "altitude": "Altitude",\n          "angle": "Ângulo",\n          "CO2": "CO₂",\n          "CO2_concentration": "Concentração de CO₂",\n          "charge": "Carga",\n          "conductivity": "Condutividade",\n          "current": "Corrente",\n          "dissolved_oxygen": "OD",\n          "flow_rate": "Taxa de fluxo",\n          "fluorescence_405_nm": "Fluorescência a 405 nm",\n          "fluorescence_500_nm": "Fluorescência a 500 nm",\n          "force": "Força",\n          "intensity": "Intensidade",\n          "light_level": "Nível de luz",\n          "light_intensity": "Intensidade de luz",\n          "magnetic_field": "Campo magnético",\n          "position": "Posição",\n          "potential": "Potencial",\n          "pressure": "Pressão",\n          "signal": "Sinal",\n          "sound_level": "Nível de som",\n          "speed": "Velocidade",\n          "temperature": "Temperatura",\n          "transmittance": "Transmitância",\n          "turbidity": "Turbidez",\n          "UV_intensity": "Intensidade UV",\n          "velocity": "Velocidade",\n          "volume": "Volume",\n          "pH": "pH",\n          "acidity": "Acidez",\n          "O2_concentration": "Concentração de O₂"\n        },\n        "names": {\n          "sensor": "sensor",\n          "no_sensor": "(sem sensor)",\n          "light": "Luz",\n          "motion": "Movimento",\n          "accelerometer": "Acelerômetro",\n          "dissolved_oxygen": "Oxigênio Dissolvido",\n          "pressure": "Pressão",\n          "charge_sensor": "Sensor de Carga",\n          "voltage": "Voltagem",\n          "pH": "pH",\n          "CO2_gas": "Gas CO₂",\n          "colorimeter": "Colorímetro",\n          "conductivity": "Condutividade",\n          "current": "Corrente",\n          "temperature": "Temperatura",\n          "force": "Força",\n          "anemometer": "Anemômetro",\n          "hand_dynamometer": "Dinamômetro de Mão",\n          "heart_rate": "Frequência Cardíaca",\n          "magnetic_field": "Campo Magnético",\n          "rotary_motion": "Movimento de Rotação",\n          "linear_position_sensor": "Sensor de Posição Linear",\n          "sound_level": "Nível de Som",\n          "spectrophotometer": "Espectrofotômetro",\n          "spirometer": "Espirômetro",\n          "turbidity": "Turbidez",\n          "UV_sensor": "Sensor UV",\n          "drop_counter": "Contador de Gotas",\n          "altitude": "Altitude",\n          "goMotion": "GoMotion",\n          "goTemp": "Sensor de Temperatura GoIO",\n          "goLinkTemperature": "Sensor de Temperatura GoIO",\n          "goLinkLight": "Sensor de Luz GoIO",\n          "goLinkForce": "Sensor de Força GoIO",\n          "goLinkPH": "Sensor de pH GoIO",\n          "goLinkCO2": "Sensor de  CO₂ GoIO",\n          "goLinkO2": "Sensor de  O₂ GoIO",\n          "labQuestMotion": "Sensor de Movimento LabQuest",\n          "labQuestTemperature": "Sensor de Temperatura LabQuest",\n          "labQuestLight": "Sensor de Luz LabQuest",\n          "labQuestForce": "Sensor de Força LabQuest",\n          "labQuestPH": "Sensor de pH LabQuest",\n          "labQuestCO2": "Sensor de CO₂ LabQuest",\n          "labQuestO2": "Sensor de O₂ LabQuest"\n        }\n      }\n    }\n  },\n  "cs-CZ": {\n    "translation": {\n      "banner": {\n        "about": "O simulaci",\n        "about_tooltip": "Pokyny",\n        "share": "Sdílet",\n        "share_tooltip": "Sdílet pomocí e-mailu, IM nebo vložení do webové stránky",\n        "lang_tooltip": "Vybrat jazyk",\n        "reload_tooltip": "Opakovat simulaci",\n        "help_tooltip": "Zobrazit nápovědu",\n        "credits_tooltip": "Dozvědět se více o The Concord Consortium",\n        "fullscreen_tooltip": "Režim celé obrazovky",\n        "video_play_pause_tooltip": "Start / pauza simulace",\n        "video_reset_tooltip": "Obnova simulace",\n        "video_step_back_tooltip": "Krok zpět",\n        "video_step_forward_tooltip": "Krok vpřed",\n        "text_start": "Start",\n        "text_start_tooltip": "Start simulace nebo sběru dat",\n        "text_stop": "Stop",\n        "text_stop_tooltip": "Zastavit simulaci nebo sběr dat",\n        "text_reset": "Obnovit",\n        "text_reset_tooltip": "Obnovit simulaci nebo sběr dat",\n        "text_new_run": "Nový pokus",\n        "text_new_run_tooltip": "Nastavení nového pokusu",\n        "text_analyze_data": "Analyzovat data",\n        "text_analyze_data_tooltip": "Poslat data z experimentu do CODAP"\n      },\n      "dialog": {\n        "close_tooltip": "Zavřít"\n      },\n      "about_dialog": {\n        "title": "O simulaci: __interactive_title__"\n      },\n      "share_dialog": {\n        "title": "Sdílet: __interactive_title__",\n        "link": "odkaz",\n        "paste_email_im": "Vložit __link__ do e-mailu nebo IM.",\n        "paste_html": "HTML kód pro vložení do webové stránky nebo blogu",\n        "select_size": "Vybrat velikost:",\n        "size_larger": "__val__% vetší",\n        "size_actual": "současná",\n        "size_smaller": "__val__% menší"\n      },\n      "credits_dialog": {\n        "title": "Credits: __interactive_title__",\n        "credits_text": "Tato simulace byla vytvořena pomocí __CC_link__ využívající našeho __Next_Gen_MW_link__ softwaru. Práce byla financována z grantu __Google_link__.",\n        "shareable_ver": "Verze pro sdílení",\n        "find_shareable": "__shareable_ver_link__ s dalšími simulacemi z přírodních věd, matematiky a strojírenství je možné najít na __concord_org_link__."\n      },\n      "copyright": {\n        "copyright": "Copyright",\n        "all_rights_reserved": "Všechna práva vyhrazena.",\n        "license": "Software je licencován pod __MIT_link__.",\n        "attribution": "Prosím, zajistěte práva Concord Consortium a URL __concord_org_link__."\n      },\n      "md2d": {\n        "heatbath_icon_tooltip": "Vodní lázeň",\n        "ke_icon_tooltip": "Gradient kinetické energie",\n        "invalid_object_position_alert": "You can\'t drop the object there.",\n        "aminoacid_menu": {\n          "hydrophobic": "Hydrofobní",\n          "hydrophilic": "Hydrofilní",\n          "glycine": "Glycin",\n          "alanine": "Alanin",\n          "valine": "Valin",\n          "leucine": "Leucin",\n          "isoleucine": "Isoleucin",\n          "phenylalanine": "Fenylalanin",\n          "proline": "Prolin",\n          "tryptophan": "Tryptofan",\n          "methionine": "Methionin",\n          "cysteine": "Cystein",\n          "tyrosine": "Tyrosin",\n          "asparagine": "Asparagin",\n          "glutamine": "Glutamin",\n          "serine": "Serin",\n          "threonine": "Threonin",\n          "asparticacid": "Kyselina asparagová",\n          "glutamicacid": "Kyselina glutamová",\n          "lysine": "Lysin",\n          "arginine": "Arginin",\n          "histidine": "Histidin"\n        },\n        "mutations_menu": {\n          "substitution_mutation": "Substituční mutace",\n          "insertion_mutation": "Inzerce",\n          "deletion_mutation": "Delece",\n          "insert": "Vložení"\n        }\n      },\n      "sensor": {\n        "select_sensor": "Vybrat čidlo",\n        "select_sensor_type": "Vybrat druh čidla...",\n        "reading": "Hodnota:",\n        "zero": "Vynulovat",\n        "zeroing": "Nulování...",\n        "loading_sensor": "Nahrávání čidla...",\n        "choose_sensor_title": "Vybrat čidlo:",\n        "connect": "Připojeno",\n        "address_labquest2": "adresa LabQuest2",\n        "messages": {\n          "ready": "Připraven ke sběr dat.",\n          "ready_nocontrol": "Prosím, zastavte __controlling_client__ sběr dat, aby bylo možné sbírat data zde.",\n          "ready_nocontrol_noname": "Prosím, zastavte ostatní sběry dat, aby bylo možné sbírat data zde.",\n          "no_sensors": "Čidlo nenalezeno.",\n          "no_devices": "Není připojeno žádné zařízení.",\n          "not_connected": "Nepřipojeno.",\n          "connecting": "Připojování...",\n          "connection_in_progress": "Připojování čidel. Pokud se objeví zpráva o sensorconnector.concord.org, potvrďte ji, prosím.",\n          "connection_failed": "Připojení selhalo. __retry_link__",\n          "connection_failed_retry_link_text": "Zkusit znovu",\n          "connection_failed_alert": "Concord Consortium Sensor Connector není naistalován nebo spuštěn. Prosím, pro další instrukce k používání Sensor Connector __click_here_link__ .",\n          "connection_failed_labquest2_alert": "Nepodařilo se spojit s LabQuest2. Prosím, ověřte zda je adresa správná a jestli je možné se s LabQuest2 spojit z toho počítače.",\n          "tare_labquest2_alert": "Pro vynulování potřebuje LabQuest2 sbírat aktuální data. Buď nastavte nový pokus v LabQuest2, nebo klepněte na ikonu měření v levém horním rohu.",\n          "click_here": "Klepněte zde",\n          "connected": "Připojeno.",\n          "connected_start_labquest2": "Připojeno. Pro zahájení pokusu klepněte na start v LabQuest2.",\n          "connected_start_sensorconnector": "Prosím, zastavte __controlling_client__ sběr dat, aby bylo možné sbírat data zde.",\n          "starting_data_collection": "Začíná sběr dat...",\n          "error_starting_data_collection": "Chyba při zahájení sběru dat.",\n          "error_starting_data_collection_alert": "Nebylo možné zahájit sběr dat. Ujistěte se, že (remote starting) je povolený.",\n          "collecting_data": "Sbírám data.",\n          "collecting_data_stop_labquest2": "Sbírám data. Klikněte na stop v LabQuest2, aby se sběr ukončil.",\n          "collecting_data_stop_sensorconnector": "Sběr dat.",\n          "no_data": "Data nejsou k dispozici.",\n          "no_data_alert": "Sensor Connector nezaznamenává data ze zapojeného zařízení.",\n          "no_data_labquest2_alert": "LabQuest nezaznamenává data ze zapojeného zařízení.",\n          "canceling_data_collection": "Rušení sběru dat...",\n          "error_canceling_data_collection": "Chyba při rušení sběru dat.",\n          "error_canceling_data_collection_alert": "Není možné zrušit sběr dat. Ujistěte se, že (remote starting) je povolený.",\n          "stopping_data_collection": "Zastavování sběru dat...",\n          "error_stopping_data_collection": "Chyba při zastavování sběru dat.",\n          "error_stopping_data_collection_alert": "Není možné zastavit sběr dat. Ujistěte se, že (remote starting) je povolený.",\n          "data_collection_stopped": "Sběr dat zastaven.",\n          "data_collection_complete": "Sběr dat dokončen.",\n          "disconnected": "Odpojeno.",\n          "java_applet_error": "Java aplety nemohou být spuštěny v prohlížeči. Po opravě znovu načtěte stránku, aby bylo možné použít sezor.",\n          "java_applet_not_loading": "čidlo se nenačítá. Po opravě znovu načtěte stránku, aby bylo možné použít sezor.",\n          "unexpected_error": "Nastala neočekáváná chyba při připojování čidla.",\n          "sensor_not_attached": "__sensor_name__ není připojený. Zkuste ho připojit znovu a poté klikněte na \\"$t(sensor.messages.try_again)\\".",\n          "sensor_or_device_unplugged": " __sensor_or_device_name__ byl odpojen. Zkuste ho připojit znovu a poté klepněte na \\"$t(sensor.messages.try_again)\\".",\n          "try_again": "Zkusit znovu",\n          "cancel": "Zrušit"\n        },\n        "measurements": {\n          "sensor_reading": "Hodnota čidla",\n          "time": "Čas",\n          "distance": "Vzdálenost",\n          "acceleration": "Zrychlení",\n          "altitude": "Výška",\n          "angle": "Úhel",\n          "CO2": "CO2",\n          "CO2_concentration": "Koncentrace CO2",\n          "charge": "Náboj",\n          "conductivity": "Vodivost",\n          "current": "Proud",\n          "dissolved_oxygen": "DO - rozpuštěný kyslík",\n          "flow_rate": "Objemový průtok",\n          "fluorescence_405_nm": "Fluorescence 405 nm",\n          "fluorescence_500_nm": "Fluorescence 500 nm",\n          "force": "Síla",\n          "intensity": "Intenzita",\n          "light_level": "Množství světla",\n          "light_intensity": "Intenzita osvětlení",\n          "magnetic_field": "Magnetické pole",\n          "position": "Pozice",\n          "potential": "Potenciál",\n          "pressure": "Tlak",\n          "signal": "Signál",\n          "sound_level": "Hlasitost",\n          "speed": "Rychlost",\n          "temperature": "Teplota",\n          "transmittance": "Transmitance",\n          "turbidity": "Turbidita (zákal)",\n          "UV_intensity": "Intenzita UV záření",\n          "velocity": "Rychlost",\n          "volume": "Objem",\n          "pH": "pH",\n          "acidity": "Kyselost",\n          "O2_concentration": "Koncentrace O2"\n        },\n        "names": {\n          "sensor": "čidlo",\n          "no_sensor": "(žádné čidlo)",\n          "light": "Světlo",\n          "motion": "Pohyb",\n          "accelerometer": "Akcelerometer (čidlo zrychlení)",\n          "dissolved_oxygen": "Rozpuštěný kyslík",\n          "pressure": "Tlak",\n          "charge_sensor": "Elektroskop (čidlo náboje)",\n          "voltage": "Elektrické napětí",\n          "pH": "pH",\n          "CO2_gas": "CO2",\n          "colorimeter": "Kolorimetr",\n          "conductivity": "Vodivost",\n          "current": "Elektrický proud",\n          "temperature": "Teplota",\n          "force": "Síla",\n          "anemometer": "Anemometr",\n          "hand_dynamometer": "Ruční siloměr",\n          "heart_rate": "Srdeční tep",\n          "magnetic_field": "Magnetické pole",\n          "rotary_motion": "Rotační pohyb",\n          "linear_position_sensor": "Lineární poloha",\n          "sound_level": "Hlasitost",\n          "spectrophotometer": "Spektrofotometr",\n          "spirometer": "Spirometr",\n          "turbidity": "Turbidita (zákal)",\n          "UV_sensor": "Čidlo UV záření",\n          "drop_counter": "Čítač kapek",\n          "altitude": "Výška",\n          "goMotion": "GoMotion",\n          "goTemp": "GoIO teplotní čidlo",\n          "goLinkTemperature": "GoIO teplotní čidlo",\n          "goLinkLight": "GoIO světelné čidlo",\n          "goLinkForce": "GoIO čidlo pro měření síly",\n          "goLinkPH": "GoIO čidlo pH",\n          "goLinkCO2": "GoIO čidlo pro měžení CO2",\n          "goLinkO2": "GoIO čidlo pro měření O2",\n          "labQuestMotion": "LabQuest pohybové čidlo",\n          "labQuestTemperature": "LabQuest teplotní čidlo",\n          "labQuestLight": "LabQuest světelné čidlo",\n          "labQuestForce": "LabQuest čidlo pro měření síly",\n          "labQuestPH": "LabQuest čidlo pH",\n          "labQuestCO2": "LabQuest čidlo pro měření CO2",\n          "labQuestO2": "LabQuest čidlo pro měření O2"\n        }\n      }\n    }\n  },\n  "es": {\n    "translation": {\n      "banner": {\n        "about": "Acerca de",\n        "about_tooltip": "Instrucciones",\n        "share": "Compartir",\n        "share_tooltip": "Compartir a través de e-mail, MI o embeber en sitio web",\n        "lang_tooltip": "Elegir idioma",\n        "reload_tooltip": "Recargar el interactivo",\n        "help_tooltip": "Mostrar ayuda",\n        "credits_tooltip": "Saber más sobre The Concord Consortium",\n        "fullscreen_tooltip": "Cambiar a pantalla completa",\n        "video_play_pause_tooltip": "Iniciar / pausar la simulación",\n        "video_reset_tooltip": "Resetear la simulación",\n        "video_step_back_tooltip": "Un paso atrás",\n        "video_step_forward_tooltip": "Un paso adelante",\n        "text_start": "Iniciar",\n        "text_start_tooltip": "Iniciar la simulación o recolección de datos",\n        "text_stop": "Detener",\n        "text_stop_tooltip": "Detener la simulación o recolección de datos",\n        "text_reset": "Resetear",\n        "text_reset_tooltip": "Resetear la simulación o recolección de datos"\n      },\n      "dialog": {\n        "close_tooltip": "Cerrar"\n      },\n      "about_dialog": {\n        "title": "Acerca de: __interactive_title__"\n      },\n      "share_dialog": {\n        "title": "Compartir: __interactive_title__",\n        "link": "enlace",\n        "paste_email_im": "Pegar este __link__ en email o MI",\n        "paste_html": "Pegar HTML para embeber en sitio web o blog.",\n        "select_size": "Elegir tamaño:",\n        "size_larger": "__val__% más grande",\n        "size_actual": "actual",\n        "size_smaller": "__val__% más pequeño"\n      },\n      "credits_dialog": {\n        "title": "Créditos: __interactive_title__",\n        "credits_text": "Este interactivo fue creado por the __CC_link__ usando nuestro software __Next_Gen_MW_link__, con fondos provenientes de un gran de __Google_link__.",\n        "shareable_ver": "versión para compartir",\n        "find_shareable": "Buscar un __shareable_ver_link__ de este interactivo junto a docenas de otros interactivos de código abierto para ciencias, matemática e ingeniería en __concord_org_link__."\n      },\n      "copyright": {\n        "copyright": "Copyright",\n        "all_rights_reserved": "Todos los derechos reservados.",\n        "license": "Este software está licenciado bajo licencia de __MIT_link__.",\n        "attribution": "Por favor dar atribución a The Concord Consortium y la URL __concord_org_link__."\n      }\n    }\n  }\n}\n';
}),define("common/i18n",["require","i18next","lab-grapher","text!locales/translations.json"],function(e){var t=e("i18next"),n=e("lab-grapher"),r=JSON.parse(e("text!locales/translations.json"));return function(e){return t.init({lng:e,resStore:r,fallbackLng:"en-US",useCookie:!1}),n.i18n.lang=e,t}}),define("common/controllers/interactive-metadata",[],function(){return{interactive:{title:{required:!0},publicationStatus:{defaultValue:"public"},labEnvironment:{defaultValue:"production"},i18nMetadata:{defaultValue:""},lang:{defaultValue:"en-US"},theme:{defaultValue:""},showTopBar:{defaultValue:!0},showBottomBar:{defaultValue:!0},credits:{defaultValue:""},padding:{defaultValue:10},subtitle:{defaultValue:""},about:{defaultValue:""},category:{defaultValue:""},subCategory:{defaultValue:""},screenshot:{defaultValue:""},importedFrom:{},aspectRatio:{defaultValue:1.3},fontScale:{defaultValue:1},randomSeed:{required:!1},helpOnLoad:{defaultValue:!1},aboutOnLoad:{defaultValue:!1},models:{required:!0},parameters:{defaultValue:[]},dataSets:{defaultValue:[]},propertiesToRetain:{defaultValue:[]},outputs:{defaultValue:[]},filteredOutputs:{defaultValue:[]},experiment:{required:!1},exports:{required:!1},logging:{required:!1},components:{defaultValue:[]},layout:{defaultValue:{}},template:{defaultValue:"simple"},helpTips:{defaultValue:[]}},model:{type:{required:!0},id:{required:!0},url:{conflictsWith:["model"]},importedFrom:{},model:{conflictsWith:["url"]},onLoad:{},viewOptions:{},modelOptions:{},parameters:{},outputs:{},filteredOutputs:{}},parameter:{name:{required:!0},initialValue:{required:!0},onChange:{},label:{},unitType:{},unitName:{},unitPluralName:{},unitAbbreviation:{}},output:{name:{required:!0},value:{required:!0},label:{},unitType:{},unitName:{},unitPluralName:{},unitAbbreviation:{}},dataSet:{name:{required:!0},properties:{defaultValue:[]},serializableProperties:{defaultValue:"all"},streamDataFromModel:{defaultValue:!0},clearOnModelReset:{defaultValue:!0},initialData:{}},filteredOutput:{name:{required:!0},property:{required:!0},type:{defaultValue:"RunningAverage"},period:{defaultValue:2500},label:{},unitType:{},unitName:{},unitPluralName:{},unitAbbreviation:{}},exports:{selectionComponents:{required:!1,defaultValue:[]},perRun:{required:!1,defaultValue:[]},perTick:{required:!0}},logging:{enabled:{defaultValue:!0},properties:{defaultValue:"boundToComponents"},components:{defaultValue:"all"}},experiment:{timeSeries:{required:!0},parameters:{required:!0,defaultValue:[]},destinations:{required:!0,defaultValue:[]},stateButtons:{required:!0,startRun:{required:!0,defaultValue:"start-run"},stopRun:{required:!0,defaultValue:"stop-run"},saveRun:{required:!0,defaultValue:"save-run"},nextRun:{required:!0,defaultValue:"next-run"},clearAll:{required:!0,defaultValue:"clear-all"}},onReset:{},savedRuns:{defaultValue:[]}},experimentTimeSeries:{time:{defaultValue:"displayTime"},properties:{required:!0,defaultValue:[]}},experimentParameter:{inputs:{required:!0,defaultValue:[]},outputs:{required:!0,defaultValue:[]}},experimentDestination:{type:{required:!0},componentIds:{required:!0,defaultValue:[]},properties:{required:!0,defaultValue:[]}},experimentSavedRun:{timeStamp:{required:!0},timeSeries:{required:!0,defaultValue:[]},parameters:{required:!0,defaultValue:[]}},playback:{id:{required:!0},type:{required:!0},stepping:{defaultValue:!0}},text:{id:{required:!0},type:{required:!0},onClick:{},text:{defaultValue:""},width:{defaultValue:"auto"},height:{defaultValue:"auto"},tooltip:{defaultValue:""},helpIcon:{defaultValue:!1}},image:{id:{required:!0},type:{required:!0},src:{defaultValue:""},urlRelativeTo:{defaultValue:"model"},width:{defaultValue:"auto"},height:{defaultValue:"auto"},onClick:{},tooltip:{defaultValue:""},helpIcon:{defaultValue:!1}},div:{id:{required:!0},type:{required:!0},content:{conflictsWith:["url"]},url:{conflictsWith:["content"]},width:{defaultValue:"auto"},height:{defaultValue:"auto"},onClick:{},classes:{defaultValue:[]},tooltip:{defaultValue:""},helpIcon:{defaultValue:!1}},button:{id:{required:!0},type:{required:!0},action:{required:!0},text:{defaultValue:""},width:{defaultValue:""},height:{defaultValue:""},disabled:{defaultValue:!1},tooltip:{defaultValue:""},helpIcon:{defaultValue:!1}},checkbox:{id:{required:!0},type:{required:!0},text:{defaultValue:""},textOn:{defaultValue:"right"},width:{defaultValue:"auto"},height:{defaultValue:"auto"},property:{conflictsWith:["initialValue","action"]},retainProperty:{defaultValue:!0},action:{conflictsWith:["property"]},initialValue:{conflictsWith:["property"]},disabled:{defaultValue:!1},tooltip:{defaultValue:""},helpIcon:{defaultValue:!1}},slider:{id:{required:!0},type:{required:!0},min:{required:!0},max:{required:!0},steps:{required:!0},title:{defaultValue:""},titlePosition:{defaultValue:"top"},fillColor:{},fillToValue:{},labels:{defaultValue:[]},width:{defaultValue:"auto"},height:{defaultValue:"auto"},displayValue:{},property:{conflictsWith:["initialValue","action"]},retainProperty:{defaultValue:!0},action:{conflictsWith:["property"]},initialValue:{conflictsWith:["property"]},disabled:{defaultValue:!1},tooltip:{defaultValue:""},helpIcon:{defaultValue:!1}},pulldown:{id:{required:!0},type:{required:!0},label:{defaultValue:""},labelOn:{defaultValue:"top"},options:{defaultValue:[]},property:{},retainProperty:{defaultValue:!0},disabled:{defaultValue:!1},tooltip:{defaultValue:""},helpIcon:{defaultValue:!1}},pulldownOption:{text:{defaultValue:""},action:{conflictsWith:["value"]},value:{conflictsWith:["action"]},selected:{conflictsWith:["value"]},disabled:{}},radio:{id:{required:!0},type:{required:!0},style:{defaultValue:"radio"},orientation:{defaultValue:"vertical"},label:{defaultValue:""},labelOn:{defaultValue:"top"},options:{defaultValue:[]},property:{},retainProperty:{defaultValue:!0},disabled:{defaultValue:!1},tooltip:{defaultValue:""},helpIcon:{defaultValue:!1}},radioOption:{text:{defaultValue:""},action:{conflictsWith:["value"]},value:{conflictsWith:["action"]},selected:{conflictsWith:["value"]},disabled:{}},numericOutput:{id:{required:!0},type:{required:!0},property:{required:!0},label:{defaultValue:""},units:{defaultValue:""},orientation:{defaultValue:"horizontal"},width:{defaultValue:"auto"},height:{defaultValue:"auto"},displayValue:{},tooltip:{defaultValue:""},helpIcon:{defaultValue:!1}},thermometer:{id:{required:!0},type:{required:!0},min:{required:!0},max:{required:!0},width:{defaultValue:"2.5em"},height:{defaultValue:"100%"},labelIsReading:{defaultValue:!1},reading:{defaultValue:{units:"K",offset:0,scale:1,digits:0}},labels:{defaultValue:[]}},joystick:{id:{required:!0},type:{required:!0},title:{defaultValue:""},labels:{defaultValue:{n:"N",e:"E",s:"S",w:"W"}},scale:{defaultValue:1},width:{defaultValue:"auto"},height:{defaultValue:"auto"},displayValue:{},property:{conflictsWith:["initialValue","action"]},retainProperty:{defaultValue:!0},action:{conflictsWith:["property"]},initialValue:{conflictsWith:["property"]},disabled:{defaultValue:!1},tooltip:{defaultValue:""},helpIcon:{defaultValue:!1}},colorIndicator:{id:{required:!0},type:{required:!0},title:{defaultValue:""},colorValue:{required:!0},width:{defaultValue:"auto"},height:{defaultValue:"auto"},property:{required:!0},retainProperty:{defaultValue:!0},tooltip:{defaultValue:""},helpIcon:{defaultValue:!1}},spectrometer:{id:{required:!0},type:{required:!0},upperBound:{defaultValue:15},lowerBound:{defaultValue:2},ticks:{defaultValue:10},clearOnModelLoad:{defaultValue:!0},width:{defaultValue:"12em"},height:{defaultValue:"3em"},border:{defaultValue:"none"},tooltip:{defaultValue:""},helpIcon:{defaultValue:!1}},table:{id:{required:!0},type:{required:!0},title:{defaultValue:null},dataSet:{conflictsWith:["tableData","clearOnModelReset","streamDataFromModel"]},tableData:{conflictsWith:["dataSet"]},clearOnModelReset:{conflictsWith:["dataSet"]},streamDataFromModel:{conflictsWith:["dataSet"]},addNewRows:{defaultValue:!0},visibleRows:{defaultValue:4},showBlankRow:{defaultValue:!1},indexColumn:{defaultValue:!0},propertyColumns:{defaultValue:[]},headerData:{defaultValue:[]},width:{defaultValue:"auto"},height:{defaultValue:"100%"},tooltip:{defaultValue:""},helpIcon:{defaultValue:!1}},graph:{id:{required:!0},type:{required:!0},dataSet:{conflictsWith:["dataPoints","clearOnModelReset","streamDataFromModel"]},dataPoints:{conflictsWith:["dataSet"]},clearOnModelReset:{conflictsWith:["dataSet"]},streamDataFromModel:{conflictsWith:["dataSet"]},resetAxesOnReset:{defaultValue:!0},enableAutoScaleButton:{defaultValue:!0},enableAxisScaling:{defaultValue:!0},enableZooming:{defaultValue:!0},autoScaleX:{defaultValue:!0},autoScaleY:{defaultValue:!0},enableSelectionButton:{defaultValue:!1},clearSelectionOnLeavingSelectMode:{defaultValue:!1},enableDrawButton:{defaultValue:!1},drawProperty:{defaultValue:null},markAllDataPoints:{defaultValue:!1},showRulersOnSelection:{defaultValue:!1},fontScaleRelativeToParent:{defaultValue:!0},hideAxisValues:{defaultValue:!1},properties:{defaultValue:[]},xProperty:{defaultValue:"displayTime"},title:{defaultValue:"Graph"},titlePosition:{defaultValue:"center"},buttonsStyle:{defaultValue:"icons"},buttonsLayout:{defaultValue:"vertical"},lineWidth:{defaultValue:2},width:{defaultValue:"100%"},height:{defaultValue:"100%"},xlabel:{defaultValue:"auto"},xmin:{defaultValue:0},xmax:{defaultValue:20},ylabel:{defaultValue:"auto"},ymin:{defaultValue:0},ymax:{defaultValue:10},xTickCount:{defaultValue:10},yTickCount:{defaultValue:10},xscaleExponent:{defaultValue:.5},yscaleExponent:{defaultValue:.5},xFormatter:{defaultValue:".2r"},yFormatter:{defaultValue:".2r"},lines:{defaultValue:!0},bars:{defaultValue:!1},tooltip:{defaultValue:""},dataColors:{defaultValue:["#a00000","#2ca000","#2c00a0"]},legendLabels:{defaultValue:[]},legendVisible:{defaultValue:!1},syncXAxis:{defaultValue:!1},syncYAxis:{defaultValue:!1},helpIcon:{defaultValue:!1}},barGraph:{id:{required:!0},type:{required:!0},property:{required:!0},secondProperty:{conflictsWith:["averagePeriod"]},min:{defaultValue:0},max:{defaultValue:10},title:{defaultValue:""},titleOn:{defaultValue:"right"},labels:{defaultValue:5},units:{defaultValue:!1},gridLines:{defaultValue:10},labelFormat:{defaultValue:"0.1f"},averagePeriod:{conflictsWith:["secondProperty"]},barWidth:{defaultValue:"2em"},height:{defaultValue:"100%"},barColor:{defaultValue:"#e23c34"},fillColor:{defaultValue:"#fff"},tooltip:{defaultValue:""},helpIcon:{defaultValue:!1}},helpTip:{component:{defaultValue:""},text:{defaultValue:""},showcase:{defaultValue:!0}}}}),define("common/resources-url",["require","lab.config"],function(e){var t=e("lab.config");return function(e){return t.rootUrl+"/resources/"+e}}),define("common/controllers/language-select",["require","common/resources-url"],function(e){function t(e,t){var n=t.interactive.i18nMetadata;if(n){var o=$.get(n).done(function(n){"string"==typeof n&&(n=JSON.parse(n)),i(e,n,t.interactive.lang,t)}),a=new $.Deferred;t.on("interactiveRendered.i18nHelper",function(){a.resolve()}),$.when(o,a).done(function(){r(e,t.interactive.lang)})}}function n(e){var t=e.split("-");return o("flags/"+t[t.length-1].toLowerCase()+".png")}function r(e,t){var r=$(e);r.addClass("lang-icon"),r.css("background-image",'url("'+n(t)+'")')}function i(e,t,r,i){var o={};Object.keys(t).forEach(function(e){e!==r&&(o[e]={name:e,className:"lang-"+e})}),0!==Object.keys(o).length&&($(e).on("click",function(){$(e).contextMenu()}),$.contextMenu("destroy",e),$.contextMenu({selector:e,appendTo:".lab-responsive-content",className:"lang-menu",trigger:"none",zIndex:1e3,determinePosition:function(e){e.css("display","block").position({my:"right top",at:"right bottom",of:this,offset:"0 5",collision:"fit"}).css("display","none")},callback:function(e){i.requestInteractiveAt(t[e])},items:o}),Object.keys(o).forEach(function(e){$(".context-menu-item.lang-"+e).css("background-image",'url("'+n(e)+'")')}))}var o=e("common/resources-url");return t}),define("common/listening-pool",[],function(){function e(e){this._nameSpace=e,this.registeredListeners=[],this._nameSpaced=function(e){return e+"."+this._nameSpace}}var t=function(e){return"function"!=typeof e.off};return e.prototype.listen=function(e,t,n){var r=this._nameSpaced(t),i={speaker:e,eventName:r};e.on(r,n),this.registeredListeners.push(i)},e.prototype.remove=function(e){t(e)?e.speaker.on(e.eventName,null):e.speaker.off(e.eventName)},e.prototype.removeAll=function(){for(;this.registeredListeners.length>0;)this.remove(this.registeredListeners.pop())},e}),define("common/dispatch-support",[],function(){function e(e){return[].slice.call(e)}return function(){function t(e){var t,r;for(a=e,o=d3.dispatch.apply(null,a),t=0,r=a.length;t<r;t++)i[a[t]]=n(a[t])}function n(e){return function(){s?l.add(e):o[e].apply(o,arguments)}}function r(e){return function(){o[e].apply(o,arguments)}}var i,o,a,s=!1,l=d3.set();return i={on:r("on"),mixInto:function(e){e.on=i.on,e.suppressEvents=i.suppressEvents},addEventTypes:function(){arguments.length&&t(a.concat(e(arguments)))},startBatch:function(){s=!0},endBatch:function(){s=!1,i.flush()},flush:function(){l.forEach(function(e){o[e]()}),l=d3.set()},suppressEvents:function(e){s=!0,e(),s=!1,l=d3.set()}},t(e(arguments)),i}}),define("common/controllers/data-set",["common/controllers/interactive-metadata","common/validator","common/listening-pool","common/dispatch-support"],function(){function e(a,s,l){this.interactivesController=s,this._model=s.getModel(),this.namespace="dataSet"+ ++o,this.component=n.validateCompleteness(t.dataSet,a),this.name=this.component.name,this.properties=this.component.properties||[],this.streamDataFromModel=this.component.streamDataFromModel,this.clearOnModelReset=this.component.clearOnModelReset,this.initialData=this.component.initialData?$.extend(!0,{},this.component.initialData):null,this._data={},this._modelProperties=[],this._listeningPool=new r(this.namespace),this._dispatch=new i;for(var u in e.Events)this._dispatch.addEventTypes(e.Events[u]);this._dispatch.mixInto(this),this.resetData(),this.interactivesController.addDataSet(this,l)}var t=require("common/controllers/interactive-metadata"),n=require("common/validator"),r=require("common/listening-pool"),i=require("common/dispatch-support"),o=0;return e.Events={SAMPLE_ADDED:"sampleAdded",SAMPLE_CHANGED:"sampleChanged",SAMPLE_REMOVED:"sampleRemoved",DATA_TRUNCATED:"dataTruncated",DATA_RESET:"dataReset",SELECTION_CHANGED:"selectionChanged",LABELS_CHANGED:"labelsChanged"},e.prototype._setupEmptyData=function(){var e=this;this.properties.forEach(function(t){e._data[t]=[]})},e.prototype._inNewModelTerritory=function(){return this._model.stepCounter()<this.maxLength(this._modelProperties)},e.prototype._addListeners=function(){var t=this._listeningPool,n=this.interactivesController.getModel(),r=this,i=function(){r._trigger(e.Events.SELECTION_CHANGED,n.stepCounter())};t.removeAll(),this.streamDataFromModel&&(t.listen(n,"tick",function(){r.appendDataPoint(),i()}),t.listen(n,"play",function(){r._inNewModelTerritory()&&r.removeModelDataAfterStepPointer()}),t.listen(n,"stepBack",i),t.listen(n,"stepForward",i),t.listen(n,"seek",i),t.listen(n,"invalidation",function(){r.removeModelDataAfterStepPointer()})),t.listen(n,"reset",function(){r.clearOnModelReset&&r.resetData(),r.streamDataFromModel&&r.appendDataPoint()}),this.properties.forEach(function(t){r._model.addPropertyDescriptionObserver(t,function(){r._trigger(e.Events.LABELS_CHANGED,r.getLabels())})})},e.prototype._getModelProperty=function(e){return this._model.get(e)},e.prototype._trigger=function(e,t){this._dispatch[e]({data:t})},e.prototype._getPropertyLabel=function(e){if(!this._model.hasProperty(e))return"";var t=this._model.getPropertyDescription(e);return t.getLabel()+" ("+t.getUnitAbbreviation()+")"},e.prototype._resetProperty=function(e,t){var n=[];t&&t[e]?n=t[e]:this.initialData[e]&&(n=this.initialData[e]),this._data[e]=n.slice(0)},e.prototype.getData=function(){return this._data},e.prototype.maxLength=function(e){var t=-(1/0),n=this;return e.forEach(function(e){t<n._data[e].length&&(t=n._data[e].length)}),t},e.prototype.minLength=function(e){var t=1/0,n=this;return e.forEach(function(e){t>n._data[e].length&&(t=n._data[e].length)}),t},e.prototype.dataPointIndex=function(e){for(var t,n,r=Object.keys(e),i=this.minLength(r),o=r.length,a=0;a<i;a++){t=!0;for(var s=0;s<o;s++)if(n=r[s],this._data[n][a]!==e[n]){t=!1;break}if(t)return a}return-1},e.prototype.resetData=function(){this._setupEmptyData(),this.initialData&&$.extend(!0,this._data,this.initialData),this._trigger(e.Events.DATA_RESET,this._data)},e.prototype.clearData=function(){this._setupEmptyData(),this._trigger(e.Events.DATA_RESET,this._data)},e.prototype.resetProperties=function(t){var n;for(n=0;n<t.length;n++)this._resetProperty(t[n]);this._trigger(e.Events.DATA_RESET,this._data)},e.prototype.appendDataPoint=function(t,n){t||(t=this._modelProperties);var r={},i=this;t.forEach(function(e){var t=n&&void 0!==n[e]?n[e]:i._getModelProperty(e);void 0!==t&&(r[e]=t,i._data[e].push(t))}),this._trigger(e.Events.SAMPLE_ADDED,r)},e.prototype.removeDataPoint=function(t,n){var r=this;t.forEach(function(e){r._data[e][n]=null}),this._trigger(e.Events.SAMPLE_REMOVED,{props:t,index:n})},e.prototype.removeModelDataAfterStepPointer=function(){var t=this._model.stepCounter(),n=this;t<0&&(t=0),this._modelProperties.forEach(function(e){n._data[e].length>t&&(n._data[e].length=t)}),this._trigger(e.Events.DATA_TRUNCATED,this._data),n.appendDataPoint()},e.prototype.editDataPoint=function(t,n,r){this._data[n][t]=r;var i=this,o={};this.properties.forEach(function(e){o[e]=i._data[e][t]}),this._trigger(e.Events.SAMPLE_CHANGED,{index:t,property:n,value:r,dataPoint:o})},e.prototype.getPropertyValue=function(e,t){return this._data[t][e]},e.prototype.getLabels=function(){var e={},t=this;return this.properties.forEach(function(n){e[n]=t._getPropertyLabel(n)}),e},e.prototype.modelLoadedCallback=function(){this._model=this.interactivesController.getModel(),this._addListeners(),this._modelProperties=[];var e=this;this.properties.forEach(function(t){e._model.hasProperty(t)&&e._modelProperties.push(t)}),this.clearOnModelReset&&this.resetData(),this.streamDataFromModel&&this.appendDataPoint()},e.prototype.serialize=function(){var e=$.extend(!0,{},this.component);return e.initialData=this.serializeData(),e},e.prototype.serializeData=function(){if("none"===this.component.serializableProperties)return{};var e="all"===this.component.serializableProperties?this.properties:this.component.serializableProperties,t={},n=this;return e.forEach(function(e){t[e]=$.extend(!0,[],n._data[e])}),t},e.prototype.handleExternalEvent=function(t,n){switch(t){case e.Events.SAMPLE_ADDED:this.appendDataPoint(Object.keys(n),n);break;case e.Events.SAMPLE_CHANGED:this.editDataPoint(n.index,n.property,n.newValue);break;case e.Events.SAMPLE_REMOVED:this.removeDataPoint(n.props,n.index);break;case e.Events.DATA_TRUNCATED:break;case e.Events.DATA_RESET:var r=this;Object.keys(n).forEach(function(e){r._resetProperty(e,n)}),this._trigger(e.Events.DATA_RESET,this._data);break;case e.Events.SELECTION_CHANGED:break;case e.Events.LABELS_CHANGED:}},e}),function(){var e,t=this,n=t.Backbone,r=[],i=(r.push,r.slice);r.splice;e="undefined"!=typeof exports?exports:t.Backbone={},e.VERSION="1.1.0";var o=t._;o||"undefined"==typeof require||(o=require("underscore")),e.$=t.jQuery||t.Zepto||t.ender||t.$,e.noConflict=function(){return t.Backbone=n,this},e.emulateHTTP=!1,e.emulateJSON=!1;var a=e.Events={on:function(e,t,n){if(!l(this,"on",e,[t,n])||!t)return this;this._events||(this._events={});var r=this._events[e]||(this._events[e]=[]);return r.push({callback:t,context:n,ctx:n||this}),this},once:function(e,t,n){if(!l(this,"once",e,[t,n])||!t)return this;var r=this,i=o.once(function(){r.off(e,i),t.apply(this,arguments)});return i._callback=t,this.on(e,i,n)},off:function(e,t,n){var r,i,a,s,u,c,d,p;if(!this._events||!l(this,"off",e,[t,n]))return this;if(!e&&!t&&!n)return this._events={},this;for(s=e?[e]:o.keys(this._events),u=0,c=s.length;u<c;u++)if(e=s[u],a=this._events[e]){if(this._events[e]=r=[],t||n)for(d=0,p=a.length;d<p;d++)i=a[d],(t&&t!==i.callback&&t!==i.callback._callback||n&&n!==i.context)&&r.push(i);r.length||delete this._events[e]}return this},trigger:function(e){if(!this._events)return this;var t=i.call(arguments,1);if(!l(this,"trigger",e,t))return this;var n=this._events[e],r=this._events.all;return n&&u(n,t),r&&u(r,arguments),this},stopListening:function(e,t,n){var r=this._listeningTo;if(!r)return this;var i=!t&&!n;n||"object"!=typeof t||(n=this),e&&((r={})[e._listenId]=e);for(var a in r)e=r[a],e.off(t,n,this),(i||o.isEmpty(e._events))&&delete this._listeningTo[a];return this}},s=/\s+/,l=function(e,t,n,r){if(!n)return!0;if("object"==typeof n){for(var i in n)e[t].apply(e,[i,n[i]].concat(r));return!1}if(s.test(n)){for(var o=n.split(s),a=0,l=o.length;a<l;a++)e[t].apply(e,[o[a]].concat(r));return!1}return!0},u=function(e,t){var n,r=-1,i=e.length,o=t[0],a=t[1],s=t[2];switch(t.length){case 0:for(;++r<i;)(n=e[r]).callback.call(n.ctx);return;case 1:for(;++r<i;)(n=e[r]).callback.call(n.ctx,o);return;case 2:for(;++r<i;)(n=e[r]).callback.call(n.ctx,o,a);return;case 3:for(;++r<i;)(n=e[r]).callback.call(n.ctx,o,a,s);return;default:for(;++r<i;)(n=e[r]).callback.apply(n.ctx,t)}},c={listenTo:"on",listenToOnce:"once"};o.each(c,function(e,t){a[t]=function(t,n,r){var i=this._listeningTo||(this._listeningTo={}),a=t._listenId||(t._listenId=o.uniqueId("l"));return i[a]=t,r||"object"!=typeof n||(r=this),t[e](n,r,this),this}}),a.bind=a.on,a.unbind=a.off,o.extend(e,a);var d=e.Model=function(e,t){var n=e||{};t||(t={}),this.cid=o.uniqueId("c"),this.attributes={},t.collection&&(this.collection=t.collection),t.parse&&(n=this.parse(n,t)||{}),n=o.defaults({},n,o.result(this,"defaults")),this.set(n,t),this.changed={},this.initialize.apply(this,arguments)};o.extend(d.prototype,a,{changed:null,validationError:null,idAttribute:"id",initialize:function(){},toJSON:function(e){return o.clone(this.attributes)},sync:function(){return e.sync.apply(this,arguments)},get:function(e){return this.attributes[e]},escape:function(e){return o.escape(this.get(e))},has:function(e){return null!=this.get(e)},set:function(e,t,n){var r,i,a,s,l,u,c,d;if(null==e)return this;if("object"==typeof e?(i=e,n=t):(i={})[e]=t,n||(n={}),!this._validate(i,n))return!1;a=n.unset,l=n.silent,s=[],u=this._changing,this._changing=!0,u||(this._previousAttributes=o.clone(this.attributes),this.changed={}),d=this.attributes,c=this._previousAttributes,this.idAttribute in i&&(this.id=i[this.idAttribute]);for(r in i)t=i[r],o.isEqual(d[r],t)||s.push(r),o.isEqual(c[r],t)?delete this.changed[r]:this.changed[r]=t,a?delete d[r]:d[r]=t;if(!l){s.length&&(this._pending=!0);for(var p=0,f=s.length;p<f;p++)this.trigger("change:"+s[p],this,d[s[p]],n)}if(u)return this;if(!l)for(;this._pending;)this._pending=!1,this.trigger("change",this,n);return this._pending=!1,this._changing=!1,this},unset:function(e,t){return this.set(e,void 0,o.extend({},t,{unset:!0}))},clear:function(e){var t={};for(var n in this.attributes)t[n]=void 0;return this.set(t,o.extend({},e,{unset:!0}))},hasChanged:function(e){return null==e?!o.isEmpty(this.changed):o.has(this.changed,e)},changedAttributes:function(e){if(!e)return!!this.hasChanged()&&o.clone(this.changed);var t,n=!1,r=this._changing?this._previousAttributes:this.attributes;for(var i in e)o.isEqual(r[i],t=e[i])||((n||(n={}))[i]=t);return n},previous:function(e){return null!=e&&this._previousAttributes?this._previousAttributes[e]:null},previousAttributes:function(){return o.clone(this._previousAttributes)},fetch:function(e){e=e?o.clone(e):{},void 0===e.parse&&(e.parse=!0);var t=this,n=e.success;return e.success=function(r){return!!t.set(t.parse(r,e),e)&&(n&&n(t,r,e),void t.trigger("sync",t,r,e))},D(this,e),this.sync("read",this,e)},save:function(e,t,n){var r,i,a,s=this.attributes;if(null==e||"object"==typeof e?(r=e,n=t):(r={})[e]=t,n=o.extend({validate:!0},n),r&&!n.wait){if(!this.set(r,n))return!1}else if(!this._validate(r,n))return!1;r&&n.wait&&(this.attributes=o.extend({},s,r)),void 0===n.parse&&(n.parse=!0);var l=this,u=n.success;return n.success=function(e){l.attributes=s;var t=l.parse(e,n);return n.wait&&(t=o.extend(r||{},t)),!(o.isObject(t)&&!l.set(t,n))&&(u&&u(l,e,n),void l.trigger("sync",l,e,n))},D(this,n),i=this.isNew()?"create":n.patch?"patch":"update","patch"===i&&(n.attrs=r),a=this.sync(i,this,n),r&&n.wait&&(this.attributes=s),a},destroy:function(e){e=e?o.clone(e):{};var t=this,n=e.success,r=function(){t.trigger("destroy",t,t.collection,e)};if(e.success=function(i){(e.wait||t.isNew())&&r(),n&&n(t,i,e),t.isNew()||t.trigger("sync",t,i,e)},this.isNew())return e.success(),!1;D(this,e);var i=this.sync("delete",this,e);return e.wait||r(),i},url:function(){var e=o.result(this,"urlRoot")||o.result(this.collection,"url")||I();return this.isNew()?e:e+("/"===e.charAt(e.length-1)?"":"/")+encodeURIComponent(this.id)},parse:function(e,t){return e},clone:function(){return new this.constructor(this.attributes)},isNew:function(){return null==this.id},isValid:function(e){return this._validate({},o.extend(e||{},{validate:!0}))},_validate:function(e,t){if(!t.validate||!this.validate)return!0;e=o.extend({},this.attributes,e);var n=this.validationError=this.validate(e,t)||null;return!n||(this.trigger("invalid",this,n,o.extend(t,{validationError:n})),!1)}});var p=["keys","values","pairs","invert","pick","omit"];o.each(p,function(e){d.prototype[e]=function(){var t=i.call(arguments);return t.unshift(this.attributes),o[e].apply(o,t)}});var f=e.Collection=function(e,t){t||(t={}),t.model&&(this.model=t.model),void 0!==t.comparator&&(this.comparator=t.comparator),this._reset(),this.initialize.apply(this,arguments),e&&this.reset(e,o.extend({silent:!0},t))},h={add:!0,remove:!0,merge:!0},m={add:!0,remove:!1};o.extend(f.prototype,a,{model:d,initialize:function(){},toJSON:function(e){return this.map(function(t){return t.toJSON(e)})},sync:function(){return e.sync.apply(this,arguments)},add:function(e,t){return this.set(e,o.extend({merge:!1},t,m))},remove:function(e,t){var n=!o.isArray(e);e=n?[e]:o.clone(e),t||(t={});var r,i,a,s;for(r=0,i=e.length;r<i;r++)s=e[r]=this.get(e[r]),s&&(delete this._byId[s.id],delete this._byId[s.cid],a=this.indexOf(s),this.models.splice(a,1),this.length--,t.silent||(t.index=a,s.trigger("remove",s,this,t)),this._removeReference(s));return n?e[0]:e},set:function(e,t){t=o.defaults({},t,h),t.parse&&(e=this.parse(e,t));var n=!o.isArray(e);e=n?e?[e]:[]:o.clone(e);var r,i,a,s,l,u,c,p=t.at,f=this.model,m=this.comparator&&null==p&&t.sort!==!1,g=o.isString(this.comparator)?this.comparator:null,v=[],y=[],b={},_=t.add,x=t.merge,w=t.remove,C=!(m||!_||!w)&&[];for(r=0,i=e.length;r<i;r++){if(l=e[r],a=l instanceof d?s=l:l[f.prototype.idAttribute],u=this.get(a))w&&(b[u.cid]=!0),x&&(l=l===s?s.attributes:l,t.parse&&(l=u.parse(l,t)),u.set(l,t),m&&!c&&u.hasChanged(g)&&(c=!0)),e[r]=u;else if(_){if(s=e[r]=this._prepareModel(l,t),!s)continue;v.push(s),s.on("all",this._onModelEvent,this),this._byId[s.cid]=s,null!=s.id&&(this._byId[s.id]=s)}C&&C.push(u||s)}if(w){for(r=0,i=this.length;r<i;++r)b[(s=this.models[r]).cid]||y.push(s);y.length&&this.remove(y,t)}if(v.length||C&&C.length)if(m&&(c=!0),this.length+=v.length,null!=p)for(r=0,i=v.length;r<i;r++)this.models.splice(p+r,0,v[r]);else{C&&(this.models.length=0);var T=C||v;for(r=0,i=T.length;r<i;r++)this.models.push(T[r])}if(c&&this.sort({silent:!0}),!t.silent){for(r=0,i=v.length;r<i;r++)(s=v[r]).trigger("add",s,this,t);(c||C&&C.length)&&this.trigger("sort",this,t)}return n?e[0]:e},reset:function(e,t){t||(t={});for(var n=0,r=this.models.length;n<r;n++)this._removeReference(this.models[n]);return t.previousModels=this.models,this._reset(),e=this.add(e,o.extend({silent:!0},t)),t.silent||this.trigger("reset",this,t),e},push:function(e,t){return this.add(e,o.extend({at:this.length},t))},pop:function(e){var t=this.at(this.length-1);return this.remove(t,e),t},unshift:function(e,t){return this.add(e,o.extend({at:0},t))},shift:function(e){var t=this.at(0);return this.remove(t,e),t},slice:function(){return i.apply(this.models,arguments)},get:function(e){if(null!=e)return this._byId[e.id]||this._byId[e.cid]||this._byId[e]},at:function(e){return this.models[e]},where:function(e,t){return o.isEmpty(e)?t?void 0:[]:this[t?"find":"filter"](function(t){for(var n in e)if(e[n]!==t.get(n))return!1;return!0})},findWhere:function(e){return this.where(e,!0)},sort:function(e){if(!this.comparator)throw new Error("Cannot sort a set without a comparator");return e||(e={}),o.isString(this.comparator)||1===this.comparator.length?this.models=this.sortBy(this.comparator,this):this.models.sort(o.bind(this.comparator,this)),e.silent||this.trigger("sort",this,e),this},pluck:function(e){return o.invoke(this.models,"get",e)},fetch:function(e){e=e?o.clone(e):{},void 0===e.parse&&(e.parse=!0);var t=e.success,n=this;return e.success=function(r){var i=e.reset?"reset":"set";n[i](r,e),t&&t(n,r,e),n.trigger("sync",n,r,e)},D(this,e),this.sync("read",this,e)},create:function(e,t){if(t=t?o.clone(t):{},!(e=this._prepareModel(e,t)))return!1;t.wait||this.add(e,t);var n=this,r=t.success;return t.success=function(e,t,i){i.wait&&n.add(e,i),r&&r(e,t,i)},e.save(null,t),e},parse:function(e,t){return e},clone:function(){return new this.constructor(this.models)},_reset:function(){this.length=0,this.models=[],this._byId={}},_prepareModel:function(e,t){if(e instanceof d)return e.collection||(e.collection=this),e;t=t?o.clone(t):{},t.collection=this;var n=new this.model(e,t);return n.validationError?(this.trigger("invalid",this,n.validationError,t),!1):n},_removeReference:function(e){this===e.collection&&delete e.collection,e.off("all",this._onModelEvent,this)},_onModelEvent:function(e,t,n,r){("add"!==e&&"remove"!==e||n===this)&&("destroy"===e&&this.remove(t,r),t&&e==="change:"+t.idAttribute&&(delete this._byId[t.previous(t.idAttribute)],null!=t.id&&(this._byId[t.id]=t)),this.trigger.apply(this,arguments))}});var g=["forEach","each","map","collect","reduce","foldl","inject","reduceRight","foldr","find","detect","filter","select","reject","every","all","some","any","include","contains","invoke","max","min","toArray","size","first","head","take","initial","rest","tail","drop","last","without","difference","indexOf","shuffle","lastIndexOf","isEmpty","chain"];o.each(g,function(e){f.prototype[e]=function(){var t=i.call(arguments);return t.unshift(this.models),o[e].apply(o,t)}});var v=["groupBy","countBy","sortBy"];o.each(v,function(e){f.prototype[e]=function(t,n){var r=o.isFunction(t)?t:function(e){return e.get(t)};return o[e](this.models,r,n)}});var y=e.View=function(e){this.cid=o.uniqueId("view"),e||(e={}),o.extend(this,o.pick(e,_)),this._ensureElement(),this.initialize.apply(this,arguments),this.delegateEvents()},b=/^(\S+)\s*(.*)$/,_=["model","collection","el","id","attributes","className","tagName","events"];o.extend(y.prototype,a,{tagName:"div",$:function(e){return this.$el.find(e)},initialize:function(){},render:function(){return this},remove:function(){return this.$el.remove(),this.stopListening(),this},setElement:function(t,n){return this.$el&&this.undelegateEvents(),this.$el=t instanceof e.$?t:e.$(t),this.el=this.$el[0],n!==!1&&this.delegateEvents(),this},delegateEvents:function(e){if(!e&&!(e=o.result(this,"events")))return this;this.undelegateEvents();for(var t in e){var n=e[t];if(o.isFunction(n)||(n=this[e[t]]),n){var r=t.match(b),i=r[1],a=r[2];n=o.bind(n,this),i+=".delegateEvents"+this.cid,""===a?this.$el.on(i,n):this.$el.on(i,a,n)}}return this},undelegateEvents:function(){return this.$el.off(".delegateEvents"+this.cid),this},_ensureElement:function(){if(this.el)this.setElement(o.result(this,"el"),!1);else{var t=o.extend({},o.result(this,"attributes"));this.id&&(t.id=o.result(this,"id")),this.className&&(t.class=o.result(this,"className"));var n=e.$("<"+o.result(this,"tagName")+">").attr(t);this.setElement(n,!1)}}}),e.sync=function(t,n,r){var i=w[t];
o.defaults(r||(r={}),{emulateHTTP:e.emulateHTTP,emulateJSON:e.emulateJSON});var a={type:i,dataType:"json"};if(r.url||(a.url=o.result(n,"url")||I()),null!=r.data||!n||"create"!==t&&"update"!==t&&"patch"!==t||(a.contentType="application/json",a.data=JSON.stringify(r.attrs||n.toJSON(r))),r.emulateJSON&&(a.contentType="application/x-www-form-urlencoded",a.data=a.data?{model:a.data}:{}),r.emulateHTTP&&("PUT"===i||"DELETE"===i||"PATCH"===i)){a.type="POST",r.emulateJSON&&(a.data._method=i);var s=r.beforeSend;r.beforeSend=function(e){if(e.setRequestHeader("X-HTTP-Method-Override",i),s)return s.apply(this,arguments)}}"GET"===a.type||r.emulateJSON||(a.processData=!1),"PATCH"===a.type&&x&&(a.xhr=function(){return new ActiveXObject("Microsoft.XMLHTTP")});var l=r.xhr=e.ajax(o.extend(a,r));return n.trigger("request",n,l,r),l};var x=!("undefined"==typeof window||!window.ActiveXObject||window.XMLHttpRequest&&(new XMLHttpRequest).dispatchEvent),w={create:"POST",update:"PUT",patch:"PATCH",delete:"DELETE",read:"GET"};e.ajax=function(){return e.$.ajax.apply(e.$,arguments)};var C=e.Router=function(e){e||(e={}),e.routes&&(this.routes=e.routes),this._bindRoutes(),this.initialize.apply(this,arguments)},T=/\((.*?)\)/g,S=/(\(\?)?:\w+/g,A=/\*\w+/g,k=/[\-{}\[\]+?.,\\\^$|#\s]/g;o.extend(C.prototype,a,{initialize:function(){},route:function(t,n,r){o.isRegExp(t)||(t=this._routeToRegExp(t)),o.isFunction(n)&&(r=n,n=""),r||(r=this[n]);var i=this;return e.history.route(t,function(o){var a=i._extractParameters(t,o);r&&r.apply(i,a),i.trigger.apply(i,["route:"+n].concat(a)),i.trigger("route",n,a),e.history.trigger("route",i,n,a)}),this},navigate:function(t,n){return e.history.navigate(t,n),this},_bindRoutes:function(){if(this.routes){this.routes=o.result(this,"routes");for(var e,t=o.keys(this.routes);null!=(e=t.pop());)this.route(e,this.routes[e])}},_routeToRegExp:function(e){return e=e.replace(k,"\\$&").replace(T,"(?:$1)?").replace(S,function(e,t){return t?e:"([^/]+)"}).replace(A,"(.*?)"),new RegExp("^"+e+"$")},_extractParameters:function(e,t){var n=e.exec(t).slice(1);return o.map(n,function(e){return e?decodeURIComponent(e):null})}});var P=e.History=function(){this.handlers=[],o.bindAll(this,"checkUrl"),"undefined"!=typeof window&&(this.location=window.location,this.history=window.history)},E=/^[#\/]|\s+$/g,O=/^\/+|\/+$/g,M=/msie [\w.]+/,L=/\/$/,N=/[?#].*$/;P.started=!1,o.extend(P.prototype,a,{interval:50,getHash:function(e){var t=(e||this).location.href.match(/#(.*)$/);return t?t[1]:""},getFragment:function(e,t){if(null==e)if(this._hasPushState||!this._wantsHashChange||t){e=this.location.pathname;var n=this.root.replace(L,"");e.indexOf(n)||(e=e.slice(n.length))}else e=this.getHash();return e.replace(E,"")},start:function(t){if(P.started)throw new Error("Backbone.history has already been started");P.started=!0,this.options=o.extend({root:"/"},this.options,t),this.root=this.options.root,this._wantsHashChange=this.options.hashChange!==!1,this._wantsPushState=!!this.options.pushState,this._hasPushState=!!(this.options.pushState&&this.history&&this.history.pushState);var n=this.getFragment(),r=document.documentMode,i=M.exec(navigator.userAgent.toLowerCase())&&(!r||r<=7);this.root=("/"+this.root+"/").replace(O,"/"),i&&this._wantsHashChange&&(this.iframe=e.$('<iframe src="javascript:0" tabindex="-1" />').hide().appendTo("body")[0].contentWindow,this.navigate(n)),this._hasPushState?e.$(window).on("popstate",this.checkUrl):this._wantsHashChange&&"onhashchange"in window&&!i?e.$(window).on("hashchange",this.checkUrl):this._wantsHashChange&&(this._checkUrlInterval=setInterval(this.checkUrl,this.interval)),this.fragment=n;var a=this.location,s=a.pathname.replace(/[^\/]$/,"$&/")===this.root;if(this._wantsHashChange&&this._wantsPushState){if(!this._hasPushState&&!s)return this.fragment=this.getFragment(null,!0),this.location.replace(this.root+this.location.search+"#"+this.fragment),!0;this._hasPushState&&s&&a.hash&&(this.fragment=this.getHash().replace(E,""),this.history.replaceState({},document.title,this.root+this.fragment+a.search))}if(!this.options.silent)return this.loadUrl()},stop:function(){e.$(window).off("popstate",this.checkUrl).off("hashchange",this.checkUrl),clearInterval(this._checkUrlInterval),P.started=!1},route:function(e,t){this.handlers.unshift({route:e,callback:t})},checkUrl:function(e){var t=this.getFragment();return t===this.fragment&&this.iframe&&(t=this.getFragment(this.getHash(this.iframe))),t!==this.fragment&&(this.iframe&&this.navigate(t),void this.loadUrl())},loadUrl:function(e){return e=this.fragment=this.getFragment(e),o.any(this.handlers,function(t){if(t.route.test(e))return t.callback(e),!0})},navigate:function(e,t){if(!P.started)return!1;t&&t!==!0||(t={trigger:!!t});var n=this.root+(e=this.getFragment(e||""));if(e=e.replace(N,""),this.fragment!==e){if(this.fragment=e,""===e&&"/"!==n&&(n=n.slice(0,-1)),this._hasPushState)this.history[t.replace?"replaceState":"pushState"]({},document.title,n);else{if(!this._wantsHashChange)return this.location.assign(n);this._updateHash(this.location,e,t.replace),this.iframe&&e!==this.getFragment(this.getHash(this.iframe))&&(t.replace||this.iframe.document.open().close(),this._updateHash(this.iframe.location,e,t.replace))}return t.trigger?this.loadUrl(e):void 0}},_updateHash:function(e,t,n){if(n){var r=e.href.replace(/(javascript:|#).*$/,"");e.replace(r+"#"+t)}else e.hash="#"+t}}),e.history=new P;var R=function(e,t){var n,r=this;n=e&&o.has(e,"constructor")?e.constructor:function(){return r.apply(this,arguments)},o.extend(n,r,t);var i=function(){this.constructor=n};return i.prototype=r.prototype,n.prototype=new i,e&&o.extend(n.prototype,e),n.__super__=r.prototype,n};d.extend=f.extend=C.extend=y.extend=P.extend=R;var I=function(){throw new Error('A "url" property or function must be specified')},D=function(e,t){var n=t.error;t.error=function(r){n&&n(e,r,t),e.trigger("error",e,r,t)}}}.call(this),define("backbone",["underscore"],function(e){return function(){var t;return t||e.Backbone}}(this)),define("grapher/bar-graph/bar-graph-model",["require","backbone"],function(e){var t=e("backbone"),n=t.Model.extend({defaults:{value:0,secondValue:null,min:0,max:10,barWidth:"2em",height:"20em",title:"",titleOn:"right",barColor:"#e23c34",fillColor:"white",labels:10,units:"",gridLines:10,labelFormat:"0.1f"}});return n}),define("common/jquery-plugins",[],function(){$.fn.measure=function(e,t,n){var r,i,o;return r=$(this).clone(!1),r.css({visibility:"hidden",position:"absolute"}),r.appendTo(n),i=t?r.find(t):r,o=e.apply(i),r.remove(),o},$.fn.truncate=function(e){var t,n,r=$(this),i=$("<span>");if(i.text(r.text()),i.css({"font-size":r.css("font-size"),"font-weight":r.css("font-weight"),"white-space":"nowrap",visibility:"hidden"}),i.appendTo(r.parent()),t=i.width(),t>e){for(n=i.text()+"...",i.text(n);t>e&&n.length>3;)n=i.text().slice(0,-4)+"...",i.text(n),t=i.width();r.attr("title",r.text()),r.text(n)}i.remove()},$.fn.alterClass=function(e,t){var n=this;if(e.indexOf("*")===-1)return n.removeClass(e),t?n.addClass(t):n;var r=new RegExp("\\s"+e.replace(/\*/g,"[A-Za-z0-9-_]+").split(" ").join("\\s|\\s")+"\\s","g");return n.each(function(e,t){for(var n=" "+t.className+" ";r.test(n);)n=n.replace(r," ");t.className=$.trim(n)}),t?n.addClass(t):n},$.event.special.destroyed={remove:function(e){e.handler&&e.handler()}}}),define("grapher/bar-graph/bar-graph-view",["require","common/jquery-plugins","backbone"],function(e){e("common/jquery-plugins");var t=e("backbone"),n=0,r=function(){return n++},i=function(e){return e.node().getBBox().width},o=16,a=function(e){var t=e/o;return function(e){return e*t}},s=function(e,t){var n,r,i=[],o={};for(n=0,r=t.length;n<r;n++)i[n]=t[n].value,o[i[n]]=t[n].label;e.tickValues(i).tickFormat(function(e){return o[e]})},l=function(e,t){var n=d3.format(e);return function(e){return n(e)+" "+t}},u=t.View.extend({tagName:"div",className:"bar-graph",initialize:function(){this.uid=r(),this.$topArea=$('<div class="top-area">').appendTo(this.$el),this.vis=d3.select(this.el).append("svg"),this.defs=this.vis.append("defs"),this.axisContainer=this.vis.append("g"),this.fill=this.vis.append("rect"),this.bar=this.vis.append("rect"),this.gridContainer=this.vis.append("g"),this.trianglePos=this.vis.append("g"),this.traingle=this.trianglePos.append("polygon"),this.titleContainer=this.vis.append("g"),this.yScale=d3.scale.linear(),this.heightScale=d3.scale.linear(),this.yAxis=d3.svg.axis(),this.scale=null,this.barWidth=null,this.$bottomArea=$('<div class="bottom-area">').appendTo(this.$el),this.model.on("change",this.modelChanged,this)},render:function(){var e=this.model.toJSON(),t=parseFloat(this.$el.css("font-size")),n=this.scale=a(t),r=e.labels>0||e.labels.length>0,o=n(r?8:3),u=n(r?8:3),c=0;this.$el.outerHeight(e.height),this._setupHorizontalTitle(),this.svgHeight=this.$el.height()-this.$topArea.height()-this.$bottomArea.height(),this.vis.attr({width:600,height:this.svgHeight}),this.yScale.domain([e.min,e.max]).range([this.svgHeight-o,u]).clamp(!0),this.heightScale.domain([e.min,e.max]).range([0,this.svgHeight-o-u]).clamp(!0),this.axisContainer.selectAll("*").remove(),r&&(this.yAxis.scale(this.yScale).tickValues(null).tickPadding(0).tickSize(0,0,0).orient("left"),"number"==typeof e.labels?this.yAxis.ticks(e.labels).tickFormat(l(e.labelFormat,e.units)):s(this.yAxis,e.labels),this.axisContainer.call(this.yAxis),c+=i(this.axisContainer),this.axisContainer.attr("transform","translate("+c+")"),c+=n(5)),this.fill.attr({width:e.barWidth,height:this.heightScale(e.max),x:c,y:this.yScale(e.max),rx:"0.5em",ry:"0.5em",fill:this._getFillGradient(e.fillColor)}),this.bar.attr({width:e.barWidth,x:c,rx:"0.5em",ry:"0.5em",fill:this._getBarGradient(e.barColor)}),this.barWidth=i(this.fill),this.traingle.classed("triangle",!0).attr({points:"15,-7 15,7 1,0",transform:"translate("+c+") scale("+n(1)+")"}),this._setupGrid(c),c+=this.barWidth,c=this._setupTitle(c),this.vis.attr("width",c/t+"em"),this.$el.css("min-width",c/t+"em"),this.$el.css("min-width",c/t+.8+"em"),this.update()},update:function(){var e=this.model.get("value"),t=this.model.get("secondValue");this.bar.attr("height",this.heightScale(e)).attr("y",this.yScale(e)),"undefined"!=typeof t&&null!==t?(this.traingle.classed("hidden",!1),this.trianglePos.attr("transform","translate(0,"+this.yScale(t)+")")):this.traingle.classed("hidden",!0)},modelChanged:function(){var e,t,n,r=this.model.changedAttributes(),i=0;for(n in r)if(r.hasOwnProperty(n)&&(i++,i>2))return void this.render();e="undefined"!=typeof r.value,t="undefined"!=typeof r.secondValue,1===i&&(e||t)||2===i&&e&&t?this.update():this.render()},_getBarGradient:function(e){var t="bar-gradient-"+this.uid,n=this.defs.select("#"+t);return e=d3.rgb(e),n.empty()?n=this.defs.append("linearGradient").attr("id",t).attr("x1","0%").attr("y1","0%").attr("x2","0%").attr("y2","100%"):n.selectAll("stop").remove(),n.append("stop").attr("stop-color",e.brighter(2).toString()).attr("offset","0%"),n.append("stop").attr("stop-color",e.toString()).attr("offset","100%"),"url(#"+t+")"},_getFillGradient:function(e){var t="fill-gradient-"+this.uid,n=this.defs.select("#"+t);return n.empty()?n=this.defs.append("linearGradient").attr("id",t).attr("x1","0%").attr("y1","0%").attr("x2","0%").attr("y2","100%"):n.selectAll("stop").remove(),n.append("stop").attr("stop-color",e).attr("offset","0%"),n.append("stop").attr("stop-color",e).attr("stop-opacity",.5).attr("offset","15%"),n.append("stop").attr("stop-color",e).attr("stop-opacity",.4).attr("offset","100%"),"url(#"+t+")"},_setupGrid:function(e){var t=this.yScale.ticks(this.model.get("gridLines")),n=this.yScale,r=this.barWidth;return t.pop(),t.shift(),this.grid=this.gridContainer.selectAll(".grid-line").data(t,String),this.grid.enter().append("path").attr("class","grid-line"),this.grid.exit().remove(),this.grid.attr("d",function(t){return"M "+e+" "+Math.round(n(t))+" h "+r}),e},_setupTitle:function(e){var t,n,r,i,o=this.model.get("title"),a=this;return o&&"right"===this.model.get("titleOn")&&(e+=this.scale(10),t=$.isArray(o),n=t?o.length:1,r=this.titleContainer.selectAll(".title").data(t?o:[o]),r.exit().remove(),i=r.enter().append("g").attr("class","title"),i.append("title"),i.append("text"),r.each(function(e,t){var r=d3.select(this);r.select("title").text(e),r.select("text").text(a._processTitle(e)).attr("dy",-(n-t-1)+"em")}),this.titleContainer.attr("transform","translate("+e+", "+this.svgHeight/2+") rotate(90)"),e+=parseFloat($(r.node()).css("font-size"))*n),e},_setupHorizontalTitle:function(){var e,t=this.model.get("title"),n=this.model.get("titleOn");this.$topArea.empty(),this.$bottomArea.empty(),t&&0!==t.length&&"right"!==n&&(t=$.isArray(t)?t:[t],"top"===n?e=this.$topArea:"bottom"===n&&(e=this.$bottomArea),t.forEach(function(t){e.append('<p class="title">'+t+"</p>")}))},_processTitle:function(e){var t,n=$('<span class="title">'+e+"</span>").appendTo(this.$el);return n.truncate(this.svgHeight),t=n.text(),n.remove(),t}});return u}),define("common/controllers/help-icon-support",[],function(){return function(e,t,n){if(t.helpIcon){var r=$('<i class="icon-question-sign lab-help-icon lab-component-help-icon"></i>');r.on("click",function(){n.isActive()||n.showSingle(t.id)}),r.appendTo(e.getViewContainer())}}}),define("common/controllers/bar-graph-controller",["require","grapher/bar-graph/bar-graph-model","grapher/bar-graph/bar-graph-view","common/controllers/interactive-metadata","common/controllers/help-icon-support","common/validator"],function(e){var t=e("grapher/bar-graph/bar-graph-model"),n=e("grapher/bar-graph/bar-graph-view"),r=e("common/controllers/interactive-metadata"),i=e("common/controllers/help-icon-support"),o=e("common/validator"),a={min:"min",max:"max",title:"title",titleOn:"titleOn",barColor:"barColor",fillColor:"fillColor",labels:"labels",gridLines:"gridLines",labelFormat:"labelFormat",units:"units"},s=function(e){var t,n,r={};for(t in a)a.hasOwnProperty(t)&&(n=a[t],void 0!==e[t]&&(r[n]=e[t]));return r};return function(e,a){function l(){c=a.getModel(),e=o.validateCompleteness(r.barGraph,e),d=new t(s(e)),p=new n({model:d,id:e.id}),p.$el.addClass("component"),f=e.property,h=e.secondProperty,e.tooltip&&p.$el.attr("title",e.tooltip),i(u,e,a.helpSystem)}var u,c,d,p,f,h,m=function(){d.set({value:c.get(f)})},g=function(){d.set({secondValue:c.get(h)})};return u={modelLoadedCallback:function(){var t="";c&&(c.removeObserver(f,m),h&&c.removeObserver(h,g)),c=a.getModel(),c.addPropertiesListener([f],m),"undefined"!=typeof e.averagePeriod&&null!==e.averagePeriod&&(h=f+"-bargraph-"+e.id+"-average",c.defineFilteredOutput(h,{},f,"RunningAverage",e.averagePeriod)),h&&c.addPropertiesListener([h],g),e.units===!0?t=c.getPropertyDescription(f).getUnitAbbreviation():e.units&&(t=e.units),d.set({barWidth:e.barWidth,height:e.height,units:t}),p.render(),m()},getViewContainer:function(){return p.$el},resize:function(){p.render()},serialize:function(){var t=$.extend(!0,{},e);return t}},l(),u}}),define("common/controllers/graph-controller",["require","lab-grapher","common/controllers/interactive-metadata","common/validator","common/listening-pool","common/controllers/data-set","common/controllers/help-icon-support"],function(e){var t=e("lab-grapher"),n=e("common/controllers/interactive-metadata"),r=e("common/validator"),i=e("common/listening-pool"),o=e("common/controllers/data-set"),a=e("common/controllers/help-icon-support"),s={title:"title",titlePosition:"titlePosition",buttonsStyle:"buttonsStyle",buttonsLayout:"buttonsLayout",enableAutoScaleButton:"enableAutoScaleButton",enableAxisScaling:"enableAxisScaling",enableZooming:"enableZooming",autoScaleX:"autoScaleX",autoScaleY:"autoScaleY",enableSelectionButton:"enableSelectionButton",clearSelectionOnLeavingSelectMode:"clearSelectionOnLeavingSelectMode",enableDrawButton:"enableDrawButton",drawIndex:"drawIndex",dataPoints:"dataPoints",markAllDataPoints:"markAllDataPoints",showRulersOnSelection:"showRulersOnSelection",fontScaleRelativeToParent:"fontScaleRelativeToParent",hideAxisValues:"hideAxisValues",xlabel:"xlabel",xmin:"xmin",xmax:"xmax",ylabel:"ylabel",ymin:"ymin",ymax:"ymax",lineWidth:"lineWidth",xTickCount:"xTickCount",yTickCount:"yTickCount",xscaleExponent:"xscaleExponent",yscaleExponent:"yscaleExponent",xFormatter:"xFormatter",yFormatter:"yFormatter",lines:"lines",bars:"bars",dataColors:"dataColors",legendLabels:"legendLabels",legendVisible:"legendVisible"},l=0,u=0,c=0;return function(e,d){function p(){return d.getModel()}function f(e){return null!=e&&"auto"!==e}function h(){if(e.dataSet)j=d.getDataSet(e.dataSet);else{var t=e.properties.slice();z.forEach(function(e){t.indexOf(e)===-1&&t.push(e)}),j=new o({properties:t,name:e.id+"-autoDataSet",streamDataFromModel:e.streamDataFromModel,clearOnModelReset:e.clearOnModelReset},d,!0)}q.listen(j,o.Events.DATA_RESET,C),q.listen(j,o.Events.SAMPLE_ADDED,E),q.listen(j,o.Events.SAMPLE_CHANGED,O),q.listen(j,o.Events.SAMPLE_REMOVED,M),q.listen(j,o.Events.SELECTION_CHANGED,b),q.listen(j,o.Events.DATA_TRUNCATED,T),q.listen(j,o.Events.LABELS_CHANGED,S)}function m(){F=d.getScriptingAPI(),q=new i(X),e=r.validateCompleteness(n.graph,e),G=e.properties.slice(),z=e.xProperty,$.isArray(z)||(z=[z]),h(),D=$("<div>").attr("id",e.id).addClass("graph"),D.addClass("component"),D.css({width:e.width,height:e.height}),e.tooltip&&D.attr("title",e.tooltip),a(V,e,d.helpSystem),U=[],e.drawProperty&&(e.drawIndex=G.indexOf(e.drawProperty),e.drawIndex==-1&&(e.drawProperty=G[0],e.drawIndex=0)),j.resetData()}function g(){var t,n,r={};for(t in s)s.hasOwnProperty(t)&&(n=s[t],r[n]=e[t]);return e.syncXAxis&&v("x",e.syncXAxis,r),e.syncYAxis&&v("y",e.syncYAxis,r),r}function v(e,t,n){var r="on"+e.toUpperCase()+"DomainChange",i="set"+e.toUpperCase()+"Domain";"string"==typeof t&&(t=[t]),n[r]=function(e,n){Y||t.forEach(function(t){var r=d.getComponent(t);r[i](e,n,!0)})}}function y(e){B.updateOrRescale(e)}function b(e){W||y(e.data)}function _(){B?e.resetAxesOnReset&&A():I(),w(j.getData()),N()}function x(){_()}function w(e){if(B){var t=[];G.forEach(function(n,r){for(var i=[],o=e[P(r)],a=e[n],s=0,l=Math.min(o.length,a.length);s<l;s++)i.push([o[s],a[s]]);t.push(i)}),t=t.concat(U),B.resetPoints(t),B.repaint()}}function C(e){W||w(e.data)}function T(e){W||w(e.data)}function S(t){if(!W){var n=!1;if(!f(e.ylabel)){var r=G[c],i=t[r]||t.data[r];B.yLabel(i),n=!0}if(!f(e.xlabel)){var o=z[u],a=t[o]||t.data[o];B.xLabel(a),n=!0}n&&V.syncAxisRangesToPropertyRanges()}}function A(){B.reset("#"+e.id,g())}function k(e){var t=e[0],n=e[1];return null!=t&&""!==t&&!isNaN(Number(t))&&null!=n&&""!==n&&!isNaN(Number(n))}function P(e){return z[e]||z[0]}function E(e){if(B&&!W){var t,n=!0,r=e.data,i=[];G.forEach(function(e,n){t=[r[P(n)],r[e]],i.push(k(t)?t:null)}),n&&B.addPoints(i)}}function O(e){if(B&&!W){var t,n=e.data.dataPoint,r=e.data.index,i=[];G.forEach(function(e,r){t=[n[P(r)],n[e]],i.push(k(t)?t:null)}),B.replacePoints(i,r)}}function M(e){if(B&&!W){var t=e.data.index,n=e.data.props;G.forEach(function(e,r){n.indexOf(e)!==-1&&B.deletePoint(t,r)})}}function L(){var e=p();e.on("reset",x)}function N(){S(j.getLabels())}function R(t){W=!0;var n=e.drawProperty||G[0],r=P(G.indexOf(n)),i={};if(i[r]=t.point[0],i[n]=t.point[1],"added"===t.action)j.appendDataPoint([r,n],i);else if("removed"===t.action){var o=j.dataPointIndex(i);j.removeDataPoint([n],o)}W=!1}function I(){B=new t(D[0],g(),void 0,d.getNextTabIndex()),B.addPointListener(R)}var D,B,V,j,F,z,G,U,q,H=[],W=!1,Y=!1,X="graphController"+ ++l;return V={type:"graph",modelLoadedCallback:function(){L(),F=d.getScriptingAPI(),_(),B.repaint()},getDataSet:function(){return j},appendDataPropertiesToComponent:function(){j.appendDataPoint()},addDataSet:function(e){U.push(e)},clearDataSets:function(){U=[]},setAttributes:function(t){B&&($.extend(e,t),j.resetData(),t.dataPoints&&(H=t.dataPoints),A(),N())},setXDomain:function(e,t,n){B&&(Y=n,B.xDomain([e,t]),Y=!1)},setYDomain:function(e,t,n){B&&(Y=n,B.yDomain([e,t]),Y=!1)},syncAxisRangesToPropertyRanges:function(){var e,t,n=p(),r=n.getPropertyDescription(z[u]),i=G.map(function(e){return n.getPropertyDescription(e)});r&&null!=r.getMin()&&null!=r.getMax()&&B.xDomain([r.getMin(),r.getMax()]),e=1/0,t=-(1/0),i.forEach(function(n){n&&(n.getMin()<e&&(e=n.getMin()),n.getMax()>t&&(t=n.getMax()))}),isFinite(e)&&isFinite(t)&&B.yDomain([e,t])},scrollXAxisToZero:function(){var e=B.xmin(),t=B.xmax();0!==e&&B.xDomain([0,t-e])},getView:function(){return B},getViewContainer:function(){return D},resize:function(){B&&B.resize()},reset:function(){B&&A()},update:function(){B&&B.update()},selectionDomain:function(){return B?B.selectionDomain.apply(B,arguments):null},selectionEnabled:function(){return B?B.selectionEnabled.apply(B,arguments):null},addAnnotation:function(e){B&&B.addAnnotation(e)},resetAnnotations:function(){B&&B.resetAnnotations()},serialize:function(){var t=$.extend(!0,{},e),n=B.xDomain(),r=B.yDomain(),i=e.xmin;return t.ymin=r[0],t.ymax=r[1],t.xmin=i,t.xmax=i+n[1]-n[0],t},enableLogging:function(e){D.off(".logging"),D.on("click.logging",".graph-button.legend",function(){e("GraphKeyBtnClicked")}),D.on("click.logging",".graph-button.autoscale",function(){e("GraphZoomBtnClicked")})}},m(),V}}),!function(e){"object"==typeof exports?module.exports=e():"function"==typeof define&&define.amd?define("iframe-phone",e):"undefined"!=typeof window?window.iframePhone=e():"undefined"!=typeof global?global.iframePhone=e():"undefined"!=typeof self&&(self.iframePhone=e())}(function(){return function e(t,n,r){function i(a,s){if(!n[a]){if(!t[a]){var l="function"==typeof require&&require;if(!s&&l)return l(a,!0);if(o)return o(a,!0);throw new Error("Cannot find module '"+a+"'")}var u=n[a]={exports:{}};t[a][0].call(u.exports,function(e){var n=t[a][1][e];return i(n?n:e)},u,u.exports,e,t,n,r)}return n[a].exports}for(var o="function"==typeof require&&require,a=0;a<r.length;a++)i(r[a]);return i}({1:[function(e,t,n){function r(){function e(e,t){i.supported()?window.parent.postMessage(e,t):window.parent.postMessage(JSON.stringify(e),t)}function t(t,n){var r;r=1===arguments.length&&"object"==typeof t&&"string"==typeof t.type?t:{type:t,content:n},y?e(r,h):b.push(r)}function n(){e({type:"hello",origin:document.location.href.match(/(.*?\/\/.*?)\//)[1]},"*")}function r(e,t){g[e]=t}function s(){g={}}function l(){return Object.keys(g)}function u(e){if(e.source===window.parent){var n=e.data;if("string"==typeof n&&(n=JSON.parse(n)),!y&&"hello"===n.type)for(h=n.origin,y=!0,f();b.length>0;)t(b.shift());e.origin===h&&g[n.type]&&g[n.type](n.content)}}function c(){y=!1,f(),window.removeEventListener("message",messsageListener)}function d(){v||(v=!0,window.parent!==window&&(n(),p(),window.addEventListener("message",u,!1)))}function p(){m&&f(),m=window.setInterval(n,o),window.setTimeout(f,a)}function f(){window.clearInterval(m),m=null}var h,m,g={},v=!1,y=!1,b=[];return{initialize:d,getListenerNames:l,addListener:r,removeAllListeners:s,disconnect:c,post:t}}var i=e("./structured-clone"),o=200,a=1e3,s=null;t.exports=function(){return s||(s=new r),s}},{"./structured-clone":4}],2:[function(e,t,n){"use strict";function r(){for(var e="abcdefghijklmnopqrstuvwxyz0123456789",t=e.length,n=[],r=0;r<10;r++)n.push(e[Math.floor(Math.random()*t)]);return n.join("")}var i=e("./parent-endpoint"),o=e("./iframe-endpoint");t.exports=function(e,t,n,a){function s(e,n){var i=r();c[i]={callback:n,timeout:window.setTimeout(function(){n&&n(void 0,new Error("IframePhone timed out waiting for reply"))},2e3)},u.post(t,{messageType:"call",uuid:i,value:e})}function l(){u.disconnect()}var u,c=Object.create({});return n===window.parent?(u=o(),u.initialize()):u=new i(n,a),u.addListener(t,function(n){var r;"call"===n.messageType?e(n.value,function(e){u.post(t,{messageType:"returnValue",uuid:n.uuid,value:e})}):"returnValue"===n.messageType&&(r=c[n.uuid],r&&(window.clearTimeout(r.timeout),r.callback&&r.callback.call(void 0,n.value),c[n.uuid]=null))}),{call:s,disconnect:l}}},{"./iframe-endpoint":1,"./parent-endpoint":3}],3:[function(e,t,n){var r=e("./structured-clone");t.exports=function(e,t,n){function i(e){return e.src.match(/(.*?\/\/.*?)\//)[1]}function o(e,n){var i;if(i=1===arguments.length&&"object"==typeof e&&"string"==typeof e.type?e:{type:e,content:n},h){var o=l();i.origin=p,r.supported()?o.postMessage(i,t):o.postMessage(JSON.stringify(i),t)}else f.push(i)}function a(e,t){m[e]=t}function s(e){m[e]=null}function l(){if(d){var t=e.contentWindow;if(!t)throw"IFrame element needs to be added to DOM before communication can be started (.contentWindow is not available)";return t}return e}function u(e){var n;e.source===l()&&e.origin===t&&(n=e.data,"string"==typeof n&&(n=JSON.parse(n)),m[n.type]?m[n.type](n.content):console.log("cant handle type: "+n.type))}function c(){h=!1,window.removeEventListener("message",u)}var d,p=window.location.href.match(/(.*?\/\/.*?)\//)[1],f=[],h=!1,m={};try{d=e.constructor===HTMLIFrameElement}catch(e){d=!1}return d&&(t&&t.constructor!==Function||(n=t,t=i(e))),a("hello",function(){for(h=!0,o("hello"),n&&"function"==typeof n&&n();f.length>0;)o(f.shift())}),window.addEventListener("message",u,!1),{post:o,addListener:a,removeListener:s,disconnect:c}}},{"./structured-clone":4}],4:[function(e,t,n){var r=!1;!function(){var e=0;if(window.postMessage)try{window.onmessage=function(t){var n=Object.prototype.toString.call(t.data);e=n.indexOf("Null")!=-1||n.indexOf("DOMWindow")!=-1?1:0,r={structuredClones:e}},window.postMessage(document.createElement("a"),"*")}catch(t){e=t.DATA_CLONE_ERR||"Cannot post cyclic structures."==t.message?1:0,r={structuredClones:e}}}(),n.supported=function(){return r&&r.structuredClones>0}},{}],5:[function(e,t,n){t.exports={ParentEndpoint:e("./lib/parent-endpoint"),getIFrameEndpoint:e("./lib/iframe-endpoint"),structuredClone:e("./lib/structured-clone"),IframePhoneRpcEndpoint:e("./lib/iframe-phone-rpc-endpoint")}},{"./lib/iframe-endpoint":1,"./lib/iframe-phone-rpc-endpoint":2,"./lib/parent-endpoint":3,"./lib/structured-clone":4}]},{},[5])(5)}),define("import-export/dg-exporter",["require","lab.config","iframe-phone"],function(e){function t(e,t){var n;e&&"codap-present"===e.message&&(n=this.isCodapPresent,this.isCodapPresent=!0,n||"function"!=typeof this.codapDidConnect||this.codapDidConnect()),t()}var n=e("lab.config"),r=e("iframe-phone"),i={gameName:"Next Gen MW",parentTableLabels:{singleCase:"run",pluralCase:"runs",singleCaseWithArticle:"a run",setOfCases:"set",setOfCasesWithArticle:"a set"},childTableLabels:{singleCase:"measurement",pluralCase:"measurements",singleCaseWithArticle:"a measurement",setOfCases:"time series",setOfCasesWithArticle:"a time series"},singleTableLabels:{singleCase:"measurement",pluralCase:"measurements",singleCaseWithArticle:"a measurement",setOfCases:"set",setOfCasesWithArticle:"a set"},perRunColumnLabelCount:0,perRunColumnLabelPositions:{},isCodapPresent:!1,init:function(){this.codapPhone||(this.codapPhone=new r.IframePhoneRpcEndpoint(t.bind(this),"codap-game",window.parent))},canCallDGDirect:function(){if(n.codap||n.dataGamesProxyPrefix)try{if(window.parent.DG.doCommand)return!0}catch(e){}return!1},isEmbeddedInCODAP:function(){return this.isCodapPresent||this.canCallDGDirect()},canExportData:function(){return this.isEmbeddedInCODAP()},doCommand:function(e,t,n){var r={action:e,args:t};this.canCallDGDirect()?setTimeout(function(){var e=window.parent.DG.doCommand(r);n&&setTimeout(function(){n(e)},1)},1):this.isCodapPresent&&this.codapPhone.call(r,n)},exportData:function(e,t,n,r){n=n||[];var i,o,a,s,l,u,c,d=[],p=[],f=[];for(c=0;c<t.length;c++)i=e[c],o=t[c],null==this.perRunColumnLabelPositions[i]&&(this.perRunColumnLabelPositions[i]=this.perRunColumnLabelCount++),a=this.perRunColumnLabelPositions[i],0===c?(d[a]={name:i,formula:"caseIndex",type:"nominal"},p[a]=null):(d[a]={name:i},p[a]=o);for(c=0;c<n.length;c++)f.push({name:n[c]});s=n.length>0,s?(l=this.parentTableLabels.pluralCase,u=this.childTableLabels.pluralCase):l=this.singleTableLabels.pluralCase;var h=[{name:l,attrs:d,childAttrName:"runs",labels:s?this.parentTableLabels:this.singleTableLabels,collapseChildren:!0}];s&&h.push({name:u,attrs:f,labels:this.childTableLabels}),this.doCommand("initGame",{name:this.gameName,collections:h}),this.doCommand("openCase",{collection:l,values:p},function(e){s&&this.doCommand("createCases",{collection:u,values:r,parent:e.caseID}),this.doCommand("closeCase",{collection:l,caseID:e.caseID})}.bind(this))},openTable:function(){this.doCommand("createComponent",{type:"DG.TableView",log:!1})},logAction:function(e){this.doCommand("logAction",{formatStr:e})}};return i}),define("common/controllers/basic-dialog",[],function(){function e(e){return e.split("-").map(function(e){return e[0].toUpperCase()+e.slice(1)}).join("")}function t(t,r){var i=t.title||"",o=t.id||"";this.$element=$('<div id="'+o+'" title="'+i+'">'),t=$.extend({closeText:r.t("dialog.close_tooltip")},n,t),this.$element.dialog(t),this._eventNamePrefix=e(t.dialogClass)}var n={autoOpen:!1,dialogClass:"interactive-dialog",width:"80%"};return t.prototype.open=function(){this.$content.css("max-height",.5*$(window).height()+"px"),this.$element.dialog("open")},t.prototype.close=function(){this.$element.dialog("close")},t.prototype.set=function(e,t){this.$element.dialog("option",e,t)},t.prototype.setContent=function(e){this.$content=$("<div>").append(e),this.$element.empty(),this.$element.append('<input type="hidden" autofocus="autofocus" />'),this.$element.append(this.$content)},t.prototype.enableLogging=function(e){var t=null,n=this._eventNamePrefix;this.$element.off(".logging"),this.$element.on("dialogopen.logging",function(){e(n+"Opened"),t=Date.now()}),this.$element.on("dialogclose.logging",function(){e(n+"Closed",{wasOpenFor:(Date.now()-t)/1e3})})},t}),define("common/controllers/export-controller",["require","import-export/dg-exporter","common/controllers/basic-dialog","common/dispatch-support","underscore"],function(e){function t(e,t,n,r){var o=new i({width:"60%",modal:!0,id:"exporter-modal-alert",title:e,buttons:n},r);o.setContent(t),o.open()}function n(e){function i(){var e,t,n=[];for(e=0,t=x.length;e<t;e++)n.push(S.get(x[e]));return n}function a(){C=[i()]}function s(){C.push(i()),O=!0}function l(){C.length=S.stepCounter()+1}function u(t,n){var r;if(n){r={};for(var i=0;i<n.labels.length;i++)r[n.labels[i]]=n.values[i]}e.logAction(t,r)}function c(){return n.canExportData()&&M&&P&&O}function d(n){t("Discard data?","<p>Pressing New Run without pressing Analyze Data will discard the current data. Set up a new run without saving the data first?</p><input type='checkbox' id='dont-ask' name='dont-ask'></input><label for='dont-ask'>Don't show this message again</label>",[{id:"button-cancel",text:"Go back",click:function(){M=!$("#dont-ask").is(":checked"),$(this).remove(),n.cancel()}},{id:"button-reset",text:"Discard the data",click:function(){u("DiscardedData",v()),M=!$("#dont-ask").is(":checked"),$(this).remove(),n.proceed()}}],e.i18n)}function p(){if(!A)return!1;var e=v(),t={values:[],labels:[]},n=!1;return e.values.forEach(function(r,i){var o=A.values[i],a=e.labels[i],s=o!==r;t.labels.push(a+" changed?"),t.values.push(s),n=n||s,t.labels.push(a+" (start of run)"),t.values.push(o),t.labels.push(a+" (sent to CODAP)"),t.values.push(r)}),!!n&&t}function f(){S.on("tick.exportController",s),S.on("reset.exportController",a),S.on("play.exportController",function(){l(),A||(A=v())}),S.on("invalidation.exportController",l)}function h(e,t){return!(e!==S||!c())&&(d(t),!0)}function m(){e.on("modelLoaded.exportController",function(e){g("modelLoaded",e)}),e.on("modelReset.exportController",function(e){g("modelReset",e)}),e.on("willResetModel",h)}function g(t,n){function r(){function t(e){return Object.prototype.hasOwnProperty.call(S.properties,e)}S=e.getModel(),_=(b.perRun||[]).filter(t),null==b.perTick||0===b.perTick.length?(P=!1,x=[]):(P=!0,x=["displayTime"].concat(b.perTick.filter(t))),a(),f(),"new-run"===n&&u("SetUpNewRun"),A=null,O=!1,T.canExportData()&&(E=!0,k.modelCanExportData())}E=!1,
T.canExportData()?r():T.on("canExportData.export-controller",r)}function v(){var e={};e.labels=[],e.values=[];for(var t=0;t<_.length;t++)e.labels[t]=y(_[t]),e.values[t]=S.get(_[t]);return e}function y(e){var t=S.getPropertyDescription(e),n=t&&t.getLabel(),r=t&&t.getUnitAbbreviation(),i="";return i+=n&&n.length>0?n:e,r&&r.length>0&&(i+=" (",i+=r,i+=")"),i}var b,_,x,w,C,T,S,A,k=new o,P=!1,E=!1,O=!1,M=!0,L=!1;return T={canExportData:function(){return n.canExportData()},modelCanExportData:function(){return E},dataAreAvailableForExport:function(){return!P||S.properties.hasPlayed&&S.isStopped()&&O},isUnexportedDataPresent:function(){return O},init:function(e){b=e,w=(b.selectionComponents||[]).slice(),L=!0},selectedData:function(){var t,n,r,i=1/0,o=-(1/0),a=[];if(!L)throw new Error("ExportController: selectData() was called before controller was initialized.");for(t=0;t<w.length;t++)n=e.getComponent(w[t]),n&&n.selectionDomain&&(r=n.selectionDomain(),null!==r&&2===r.length&&(i>r[0]&&(i=r[0]),o<r[1]&&(o=r[1])));return a=i<1/0||o>-(1/0)?C.filter(function(e){return e[0]>i&&e[0]<o}):C},exportData:function(){var e,t,n=[],i=[],o=[];if(!L)throw new Error("ExportController: exportData() was called before controller was initialized.");for(u("ExportedModel",v()),e=p(),e&&u("ParameterChangeBetweenStartAndExport",e),n[0]="Row",i[0]=null,t=0;t<_.length;t++)n[t+1]=y(_[t]),i[t+1]=S.get(_[t]);for(t=0;t<x.length;t++)o[t]=y(x[t]);r.exportData(n,i,o,this.selectedData()),r.openTable(),O=!1}},r.init(),k.mixInto(T),k.addEventTypes("canExportData","modelCanExportData"),r.codapDidConnect=function(){n.canExportData()&&k.canExportData()},m(),T}var r=e("import-export/dg-exporter"),i=e("common/controllers/basic-dialog"),o=e("common/dispatch-support");e("underscore");return n.canExportData=function(){return r.canExportData()},n}),define("common/controllers/log-controller",["require","iframe-phone","import-export/dg-exporter"],function(e){function t(e){var t=e.config;this.enabled=t.enabled,this._properties="boundToComponents"===t.properties?e.boundProperties:t.properties,this._interactivesController=e.interactivesController,this._model=null,this._phone=n.getIFrameEndpoint(),this._phone.initialize(),r.init(),this._interactivesController.on("modelLoaded.logController",this._modelLoadedHandler.bind(this)),this._interactivesController.on("interactiveWillReload.logController",this._interactiveWillReloadHandler.bind(this)),this._setupComponents(e.componentByID,t.components),this._enableLoggingIn(e.additionalComponents)}var n=e("iframe-phone"),r=e("import-export/dg-exporter");return t.prototype.logAction=function(e,t){this.enabled&&(r.isEmbeddedInCODAP()?this._logToCODAP(e,t):this._genericLog(e,t))},t.prototype._genericLog=function(e,t){this._phone.post("log",{action:e,data:t})},t.prototype._logToCODAP=function(e,t){var n=e;t&&(n+=": "+JSON.stringify(t)),r.logAction(n)},t.prototype._setupComponents=function(e,t){if("none"!==t&&t!==[]){"all"===t&&(t=Object.keys(e));var n=[];t.forEach(function(t){n.push(e[t])}),this._enableLoggingIn(n)}},t.prototype._enableLoggingIn=function(e){var t=this.logAction.bind(this);e.forEach(function(e){e&&e.enableLogging&&e.enableLogging(t)})},t.prototype._interactiveWillReloadHandler=function(){this.logAction("ReloadedInteractive",this._getProperties())},t.prototype._modelLoadedHandler=function(e){this._model=this._interactivesController.getModel(),this._model.on("log.logController",function(e,t){this.logAction(e,t)}.bind(this)),this._model.on("play.logController",function(){this.logAction("StartedModel",this._getProperties())}.bind(this)),this._model.on("stop.logController",function(){this.logAction("StoppedModel",this._getProperties())}.bind(this)),this._model.on("willReset.logController",function(){this.logAction("ReloadedModel",this._getProperties())}.bind(this))},t.prototype._getProperties=function(){function e(e){var n=t.getPropertyDescription(e),r=n&&n.getLabel(),i=n&&n.getUnitAbbreviation(),o="";return o+=r&&r.length>0?r:e,i&&i.length>0&&(o+=" ("+i+")"),o}var t=this._model,n={};return this._properties.forEach(function(r){n[e(r)]=t.get(r)}),n},t}),define("common/controllers/scripting-api",["require","common/alert"],function(e){function t(e){return function(){throw new ReferenceError(e+" is not defined")}}function n(){var e,n,r,i,a=Object.getOwnPropertyNames(window);for(n=0,r=a.length;n<r;n++)e=a[n],o.hasOwnProperty(e)||(i=t(e),Object.defineProperty(o,e,{set:i,get:i}))}var r=e("common/alert"),i=0,o={};return function(e,t){function a(e){t.on("reset.common-scripting-api-"+i++,e)}var s={api:function(){function n(e){return"number"==typeof e&&parseFloat(e)===parseInt(e,10)}function o(e){return"object"==typeof e&&e.slice===Array.prototype.slice}function s(e){return e?Math.random()*e:Math.random()}function l(e){return Math.floor(Math.random()*e)}function u(e,t,n){var r=e[t];e[t]=e[n],e[n]=r}function c(e,t){var n,r=[];for(n=0;n<t;n++)r[n]=n;for(n=0;n<e;n++)u(r,n,n+l(t-n));return r.length=e,r}function d(e,t,n){var r;"undefined"!=typeof _gaq&&(r=_gaq,e||(e="Interactive"),r.push(["_trackEvent",e,t,n]))}return{isInteger:n,isArray:o,randomInteger:l,randomFloat:s,swapElementsOfArray:u,choose:c,deg2rad:Math.PI/180,rad2deg:180/Math.PI,trackEvent:d,format:d3.format,get:function(){return t.get.apply(t,arguments)},set:function(){return t.set.apply(t,arguments)},freeze:function(){return t.freeze.apply(t,arguments)},unfreeze:function(){return t.unfreeze.apply(t,arguments)},logAction:function(t,n){e.logAction(t,n)},loadModel:function(n,r){t.stop(),e.loadModel(n,null,r)},getLoadedModelId:function(){return e.getLoadedModelId()},onPropertyChange:function(e,n){t.addPropertiesListener([e],function(){n(t.get(e))})},callAt:function(e,n){function r(){t.properties.time>=e&&(n(),o())}function i(){t.addObserver("time",r)}function o(){t.removeObserver("time",r)}function s(){t.properties.time<e&&i()}a(i),this.onStart(s),i()},callEvery:function(e,n){function r(){for(;t.properties.time-s>=e;)n(),s+=e}function i(){s=0}function o(){for(;s>t.properties.time;)s-=e}var s=0;t.addObserver("time",r),a(i),this.onStart(o)},onClick:function(t,n){e.modelController.modelContainer.setClickHandler("."+t,n)},onDrag:function(t,n){e.modelController.modelContainer.setDragHandler(t,n)},onSelect:function(t){e.modelController.modelContainer.setSelectHandler(t)},setComponentDisabled:function(t,n){e.getComponent(t).setDisabled(n)},clearDataSet:function(t){e.getDataSet(t).clearData()},resetDataSet:function(t){e.getDataSet(t).resetData()},resetDataSetProperties:function(t,n){e.getDataSet(t).resetProperties(n)},appendDataPropertiesToComponent:function(t){var n=e.getComponent(t);void 0!==n&&n.appendDataPropertiesToComponent()},setComponentAttributes:function(t,n){var r=e.getComponent(t);if(!r)throw new Error("Component "+t+" not found.");if("function"!=typeof r.setAttributes)throw new Error("Component "+t+" does not support dynamic attributes change.");r.setAttributes(n)},syncAxisRangesToPropertyRanges:function(t){var n=e.getComponent(t);if(!n)throw new Error("Component "+t+" not found.");if(!n.syncAxisRangesToPropertyRanges)throw new Error("Component "+t+" does not support syncAxisRangesToPropertyRanges.");n.syncAxisRangesToPropertyRanges()},scrollXAxisToZero:function(t){var n=e.getComponent(t);if(!n)throw new Error("Component "+t+" not found.");if(!n.scrollXAxisToZero)throw new Error("Component "+t+" does not support scrollXAxisToZero.");n.scrollXAxisToZero()},resetGraphSelection:function(t){var n=e.getComponent(t);if(!n)throw new Error("Component "+t+" not found.");if(!n.selectionDomain)throw new Error("Component "+t+" does not support selectionDomain.");if(!n.selectionEnabled)throw new Error("Component "+t+" does not support selectionEnabled.");n.selectionDomain(null),n.selectionEnabled(!1)},addAnnotation:function(t,n){var r=e.getComponent(t);if(!r)throw new Error("Component "+t+" not found.");if(!r.addAnnotation)throw new Error("Component "+t+" does not support addAnnotation.");r.addAnnotation(n)},resetAnnotations:function(t){var n=e.getComponent(t);if(!n)throw new Error("Component "+t+" not found.");if(!n.resetAnnotations)throw new Error("Component "+t+" does not support resetAnnotations.");n.resetAnnotations()},start:function(){t.start(),d("Interactive","Start","Starting interactive: "+e.get("title"))},onStart:function(e){t.on("play.custom-script"+i++,e)},stop:function(){t.stop()},onStop:function(e){t.on("stop.custom-script",e)},reloadModel:function(t){e.reloadModel(t)},reloadInteractive:function(){e.reloadInteractive()},stepForward:function(){t.stepForward(),t.isNewStep()||e.updateModelView()},stepBack:function(){t.stepBack(),e.updateModelView()},tick:function(){t.tick()},isStopped:function(){return t.isStopped()},getTime:function(){return t.get("time")},getFPS:function(){return t.getFPS()},getSimulationProgressRate:function(){return t.getSimulationProgressRate()},startPerformanceTuning:function(){t.performanceOptimizer.enable()},repaint:function(){e.repaintModelView()},canExportData:function(){var t=e.exportController;return t&&t.canExportData()||!1},isUnexportedDataPresent:function(){var t=e.exportController;return t&&t.isUnexportedDataPresent()||!1},dataAreAvailableForExport:function(){var t=e.exportController;return t&&t.dataAreAvailableForExport()||!1},exportData:function(){var t=e.exportController;if(!t||!t.canExportData())throw new Error("No exports have been specified.");t.exportData()},getCardinalDirection:function(e,t){var n=["",""];return e>Math.PI/8&&e<7*Math.PI/8?n[0]=t?"S":"N":e>9*Math.PI/8&&e<15*Math.PI/8&&(n[0]=t?"N":"S"),e<3*Math.PI/8||e>13*Math.PI/8?n[1]=t?"W":"E":e>5*Math.PI/8&&e<11*Math.PI/8&&(n[1]=t?"E":"W"),n.join("")},getCompassDirection:function(e,t){e=(e+3*Math.PI/2)%(2*Math.PI);var n=360-180*e/Math.PI;return t?(180+n)%360:n},Math:Math,Infinity:1/0,isFinite:isFinite,NaN:NaN,isNaN:isNaN,undefined:void 0,alert:r,setTimeout:function(e){if(!e||e.constructor!==Function)throw new TypeError("Must pass a Function instance to Lab's setTimeout.");var t=Array.prototype.slice.apply(arguments);return t[0]=e.bind(void 0),window.setTimeout.apply(window,t)},setInterval:function(e){if(!e||e.constructor!==Function)throw new TypeError("Must pass a Function instance to Lab's setInterval.");var t=Array.prototype.slice.apply(arguments);return t[0]=e.bind(void 0),window.setInterval.apply(window,t)},clearTimeout:window.clearTimeout,clearInterval:window.clearInterval,console:null!==window.console?window.console:{log:function(){},error:function(){},warn:function(){},dir:function(){}}}}(),get model(){return t},get intController(){return e},bindModel:function(e){t=e},freeze:function(){Object.freeze(this.api)},extend:function(e){$.extend(this.api,new e(this))},exposeScriptingAPI:function(){window.script=this.api,window.script.run=function(e,t){var n,r=[],i=[];for(n in t)t.hasOwnProperty(n)&&(r.push(n),i.push(t[n]));return s.makeFunctionInScriptContext.apply(null,r.concat(e)).apply(null,i)}},makeFunctionInScriptContext:function(){var e,t,i,a=Array.prototype.slice.call(arguments,0,arguments.length-1),l=arguments[arguments.length-1];"string"!=typeof l&&(l=l.join("      \n")),e="with (shadowedGlobals) {\n  with (scriptingAPI) {\n    return function("+a.join(",")+") {\n      'use strict';\n      "+l+"\n    };\n  }\n}";try{t=new Function("shadowedGlobals","scriptingAPI",e),i=t(o,s.api)}catch(e){return r('Error compiling script: "'+e.toString()+'"\nScript:\n\n'+l),function(){throw new Error("Cannot run a script that could not be compiled")}}return function(){n();try{return i.apply(null,Array.prototype.slice.call(arguments))}catch(e){r('Error running script: "'+e.toString()+'"\nScript:\n\n'+l)}}}};return s}}),define("common/inherit",[],function(){return function(e,t){function n(){}n.prototype=t.prototype,e.prototype=new n,e.superClass=t.prototype,e.prototype.constructor=e}}),define("common/views/view-state",[],function(){return{disableView:function(e){e.hasClass("lab-disabled")||(e.addClass("lab-disabled"),e.append('<div class="lab-disabled-overlay"/>'))},enableView:function(e){e.removeClass("lab-disabled"),e.find(".lab-disabled-overlay").remove()}}}),define("common/controllers/disablable",["common/views/view-state"],function(){var e=require("common/views/view-state"),t=e.enableView,n=e.disableView;return function(e,r){e.setDisabled=function(e){var r=this.getViewContainer();e?(n(r),this.isDisabled=!0):(t(r),this.isDisabled=!1)},e.isDisabled=!1,r&&e.setDisabled(r.disabled)}}),define("common/controllers/interactive-component",["require","common/controllers/interactive-metadata","common/validator","common/controllers/disablable","common/controllers/help-icon-support"],function(e){function t(e,t,i){this._interactivesController=i,this._scriptingAPI=this._interactivesController.getScriptingAPI(),this._model=this._interactivesController.getModel(),this.component=r.validateCompleteness(n[e],t),this.$element=$("<div>").attr("id",t.id).addClass("component"),this.component.width&&this.$element.css("width",this.component.width),this.component.height&&this.$element.css("height",this.component.height),this.component.disabled&&this.setDisabled(this.component.disabled),this._optionallyAddOnClickHandlers(),this.component.classes&&this.component.classes.length&&this.$element.addClass(this.component.classes.join(" ")),this.component.tooltip&&this.$element.attr("title",this.component.tooltip),o(this,this.component,this._interactivesController.helpSystem)}var n=e("common/controllers/interactive-metadata"),r=e("common/validator"),i=e("common/controllers/disablable"),o=e("common/controllers/help-icon-support");return t.prototype._modelLoadedCallback=function(){this._scriptingAPI=this._interactivesController.getScriptingAPI(),this._model=this._interactivesController.getModel(),this._optionallyAddOnClickHandlers()},t.prototype._updateClickHandler=function(e){"function"!=typeof e?this._actionClickFunction=this._scriptingAPI.makeFunctionInScriptContext(e):this._actionClickFunction=e;var t=this;this._onClick(this._nameSpace,function(){t._actionClickFunction()}),this.$element.addClass("clickable")},t.prototype._optionallyAddOnClickHandlers=function(){void 0!==this.component.onClick&&this._updateClickHandler(this.component.onClick),void 0!==this.component.action&&this._updateClickHandler(this.component.action)},t.prototype.setAction=function(e){"function"!=typeof script&&(this.component.action=e),this._updateClickHandler(e)},t.prototype.setOnClick=function(e){void 0!==this.component.onClick&&(this.component.onClick=e,this._updateClickHandler(this.component.onClick))},t.prototype.enableLogging=function(e){var t=this.component;if(void 0!==t.onClick||void 0!==t.action){var n=t.type[0].toUpperCase()+t.type.slice(1)+"Clicked",r={id:t.id};this._onClick(this._nameSpace+"logging",function(){r.label=t.label||t.text||t.title,e(n,r)})}},t.prototype.getViewContainer=function(){return this.$element},t.prototype.serialize=function(){return this.component},t.prototype._onClick=function(e,t){this.$element.off("click."+e),this.$element.on("click."+e,this._clickTargetSelector||null,t)},i(t.prototype),t}),define("common/controllers/button-controller",["common/inherit","common/controllers/interactive-component"],function(){function e(e,t){this._actionClickFunction=function(){},this._nameSpace="button"+ ++r,this._clickTargetSelector="button",n.call(this,"button",e,t),this.$element.addClass("interactive-button"),this.button=$("<button>").html(e.text).appendTo(this.$element),this.setAttributes=function(e){e.text&&"undefined"!=typeof e.text&&(this.component.text=e.text,this.button.html(e.text))}}var t=require("common/inherit"),n=require("common/controllers/interactive-component"),r=0;return t(e,n),e.prototype.modelLoadedCallback=function(){e.superClass._modelLoadedCallback.call(this)},e}),define("common/controllers/checkbox-controller",["common/controllers/interactive-metadata","common/controllers/disablable","common/controllers/help-icon-support","common/validator"],function(){var e=require("common/controllers/interactive-metadata"),t=require("common/controllers/disablable"),n=require("common/controllers/help-icon-support"),r=require("common/validator");return function(i,o){function a(){l(y.get(c))}function s(){var e=y.getPropertyDescription(c);v.setDisabled(e.getFrozen())}function l(e){e?(f.prop("checked",!0),h.addClass("checked")):(f.prop("checked",!1),h.removeClass("checked"))}function u(e){e.preventDefault(),l(f.prop("checked")?!1:!0),f.trigger("change")}var c,d,p,f,h,m,g,v,y,b;return y=o.getModel(),b=o.getScriptingAPI(),i=r.validateCompleteness(e.checkbox,i),c=i.property,d=i.action,p=i.initialValue,m=$("<label>").append("<span>"+i.text+"</span>"),m.attr("for",i.id),f=$('<input type="checkbox">').attr("id",i.id),o&&f.attr("tabindex",o.getNextTabIndex()),h=$('<div class="fakeCheckable">'),f.css("display","none"),g="left"===i.textOn?$("<div>").append(m).append(f).append(h.addClass("right")):$("<div>").append(f).append(h).append(m),g.addClass("interactive-checkbox"),g.addClass("component"),h.on("click",u),m.on("click",u),g.css({width:i.width,height:i.height}),d&&(d=b.makeFunctionInScriptContext("value",d)),f.on("change",function(){var e,t=!1;$(this).is(":checked")&&(t=!0),void 0!==c&&(e={},e[c]=t,y.set(e)),void 0!==d&&d(t)}),i.tooltip&&g.attr("title",i.tooltip),void 0!==p&&l(p),v={modelLoadedCallback:function(){y&&void 0!==c&&(y.removeObserver(c,a),y.removePropertyDescriptionObserver(c,s)),y=o.getModel(),b=o.getScriptingAPI(),void 0!==c&&(y.addPropertiesListener([c],a),y.addPropertyDescriptionObserver(c,s),a())},enableLogging:function(e){f.off("change.logging"),f.on("change.logging",function(){var t={id:i.id,label:i.text,value:$(this).is(":checked")};c&&(t.property=c),e("CheckboxChanged",t)})},getViewContainer:function(){return g},serialize:function(){var e=$.extend(!0,{},i);return void 0===c&&(e.initialValue=!!f.is(":checked")),e}},t(v,i),n(v,i,o.helpSystem),v}}),function(e){function t(){return"Markdown.mk_block( "+uneval(this.toString())+", "+uneval(this.trailing)+", "+uneval(this.lineNumber)+" )"}function n(){var e=require("util");return"Markdown.mk_block( "+e.inspect(this.toString())+", "+e.inspect(this.trailing)+", "+e.inspect(this.lineNumber)+" )"}function r(e){for(var t=0,n=-1;(n=e.indexOf("\n",n+1))!==-1;)t++;return t}function i(e,t){function n(e){this.len_after=e,this.name="close_"+t}var r=e+"_state",i="strong"==e?"em_state":"strong_state";return function(o,a){if(this[r][0]==t)return this[r].shift(),[o.length,new n(o.length-t.length)];var s=this[i].slice(),l=this[r].slice();this[r].unshift(t);var u=this.processInline(o.substr(t.length)),c=u[u.length-1];this[r].shift();if(c instanceof n){u.pop();var d=o.length-c.len_after;return[d,[e].concat(u)]}return this[i]=s,this[r]=l,[t.length,t]}}function o(e){for(var t=e.split(""),n=[""],r=!1;t.length;){var i=t.shift();switch(i){case" ":r?n[n.length-1]+=i:n.push("");break;case"'":case'"':r=!r;break;case"\\":i=t.shift();default:n[n.length-1]+=i}}return n}function s(e){return g(e)&&e.length>1&&"object"==typeof e[1]&&!g(e[1])?e[1]:void 0}function l(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")}function u(e){if("string"==typeof e)return l(e);var t=e.shift(),n={},r=[];for(!e.length||"object"!=typeof e[0]||e[0]instanceof Array||(n=e.shift());e.length;)r.push(u(e.shift()));var i="";for(var o in n)i+=" "+o+'="'+l(n[o])+'"';return"img"==t||"br"==t||"hr"==t?"<"+t+i+"/>":"<"+t+i+">"+r.join("")+"</"+t+">"}function c(e,t,n){var r;n=n||{};var i=e.slice(0);"function"==typeof n.preprocessTreeNode&&(i=n.preprocessTreeNode(i,t));var o=s(i);if(o){i[1]={};for(r in o)i[1][r]=o[r];o=i[1]}if("string"==typeof i)return i;switch(i[0]){case"header":i[0]="h"+i[1].level,delete i[1].level;break;case"bulletlist":i[0]="ul";break;case"numberlist":i[0]="ol";break;case"listitem":i[0]="li";break;case"para":i[0]="p";break;case"markdown":i[0]="html",o&&delete o.references;break;case"code_block":i[0]="pre",r=o?2:1;var a=["code"];a.push.apply(a,i.splice(r,i.length-r)),i[r]=a;break;case"inlinecode":i[0]="code";break;case"img":i[1].src=i[1].href,delete i[1].href;break;case"linebreak":i[0]="br";break;case"link":i[0]="a";break;case"link_ref":i[0]="a";var l=t[o.ref];if(!l)return o.original;delete o.ref,o.href=l.href,l.title&&(o.title=l.title),delete o.original;break;case"img_ref":i[0]="img";var l=t[o.ref];if(!l)return o.original;delete o.ref,o.src=l.href,l.title&&(o.title=l.title),delete o.original}if(r=1,o){for(var u in i[1]){r=2;break}1===r&&i.splice(r,1)}for(;r<i.length;++r)i[r]=c(i[r],t,n);return i}function d(e){for(var t=s(e)?2:1;t<e.length;)"string"==typeof e[t]?t+1<e.length&&"string"==typeof e[t+1]?e[t]+=e.splice(t+1,1)[0]:++t:(d(e[t]),++t)}var f=e.Markdown=function(e){switch(typeof e){case"undefined":this.dialect=f.dialects.Gruber;break;case"object":this.dialect=e;break;default:if(!(e in f.dialects))throw new Error("Unknown Markdown dialect '"+String(e)+"'");this.dialect=f.dialects[e]}this.em_state=[],this.strong_state=[],this.debug_indent=""};e.parse=function(e,t){var n=new f(t);return n.toTree(e)},e.toHTML=function(t,n,r){var i=e.toHTMLTree(t,n,r);return e.renderJsonML(i)},e.toHTMLTree=function(e,t,n){"string"==typeof e&&(e=this.parse(e,t));var r=s(e),i={};r&&r.references&&(i=r.references);var o=c(e,i,n);return d(o),o};var h=f.mk_block=function(e,r,i){1==arguments.length&&(r="\n\n");var o=new String(e);return o.trailing=r,o.inspect=n,o.toSource=t,void 0!=i&&(o.lineNumber=i),o};f.prototype.split_blocks=function(e,t){e=e.replace(/(\r\n|\n|\r)/g,"\n");var n,i=/([\s\S]+?)($|\n#|\n(?:\s*\n|$)+)/g,o=[],a=1;for(null!=(n=/^(\s*\n)/.exec(e))&&(a+=r(n[0]),i.lastIndex=n[0].length);null!==(n=i.exec(e));)"\n#"==n[2]&&(n[2]="\n",i.lastIndex--),o.push(h(n[1],n[2],a)),a+=r(n[0]);return o},f.prototype.processBlock=function(e,t){var n=this.dialect.block,r=n.__order__;if("__call__"in n)return n.__call__.call(this,e,t);for(var i=0;i<r.length;i++){var o=n[r[i]].call(this,e,t);if(o)return(!g(o)||o.length>0&&!g(o[0]))&&this.debug(r[i],"didn't return a proper array"),o}return[]},f.prototype.processInline=function(e){return this.dialect.inline.__call__.call(this,String(e))},f.prototype.toTree=function(e,t){var n=e instanceof Array?e:this.split_blocks(e),r=this.tree;try{for(this.tree=t||this.tree||["markdown"];n.length;){var i=this.processBlock(n.shift(),n);i.length&&this.tree.push.apply(this.tree,i)}return this.tree}finally{t&&(this.tree=r)}},f.prototype.debug=function(){var e=Array.prototype.slice.call(arguments);e.unshift(this.debug_indent),"undefined"!=typeof print&&print.apply(print,e),"undefined"!=typeof console&&"undefined"!=typeof console.log&&console.log.apply(null,e)},f.prototype.loop_re_over_block=function(e,t,n){for(var r,i=t.valueOf();i.length&&null!=(r=e.exec(i));)i=i.substr(r[0].length),n.call(this,r);return i},f.dialects={},f.dialects.Gruber={block:{atxHeader:function(e,t){var n=e.match(/^(#{1,6})\s*(.*?)\s*#*\s*(?:\n|$)/);if(n){var r=["header",{level:n[1].length}];return Array.prototype.push.apply(r,this.processInline(n[2])),n[0].length<e.length&&t.unshift(h(e.substr(n[0].length),e.trailing,e.lineNumber+2)),[r]}},setextHeader:function(e,t){var n=e.match(/^(.*)\n([-=])\2\2+(?:\n|$)/);if(n){var r="="===n[2]?1:2,i=["header",{level:r},n[1]];return n[0].length<e.length&&t.unshift(h(e.substr(n[0].length),e.trailing,e.lineNumber+2)),[i]}},code:function(e,t){var n=[],r=/^(?: {0,3}\t| {4})(.*)\n?/;if(e.match(r)){e:for(;;){var i=this.loop_re_over_block(r,e.valueOf(),function(e){n.push(e[1])});if(i.length){t.unshift(h(i,e.trailing));break e}if(!t.length)break e;if(!t[0].match(r))break e;n.push(e.trailing.replace(/[^\n]/g,"").substring(2)),e=t.shift()}return[["code_block",n.join("\n")]]}},horizRule:function(e,t){var n=e.match(/^(?:([\s\S]*?)\n)?[ \t]*([-_*])(?:[ \t]*\2){2,}[ \t]*(?:\n([\s\S]*))?$/);if(n){var r=[["hr"]];return n[1]&&r.unshift.apply(r,this.processBlock(n[1],[])),n[3]&&t.unshift(h(n[3])),r}},lists:function(){function e(e){return new RegExp("(?:^("+l+"{0,"+e+"} {0,3})("+o+")\\s+)|(^"+l+"{0,"+(e-1)+"}[ ]{0,4})")}function t(e){return e.replace(/ {0,3}\t/g,"    ")}function n(e,t,n,r){if(t)return void e.push(["para"].concat(n));var i=e[e.length-1]instanceof Array&&"para"==e[e.length-1][0]?e[e.length-1]:e;r&&e.length>1&&n.unshift(r);for(var o=0;o<n.length;o++){var a=n[o],s="string"==typeof a;s&&i.length>1&&"string"==typeof i[i.length-1]?i[i.length-1]+=a:i.push(a)}}function r(e,t){for(var n=new RegExp("^("+l+"{"+e+"}.*?\\n?)*$"),r=new RegExp("^"+l+"{"+e+"}","gm"),i=[];t.length>0&&n.exec(t[0]);){var o=t.shift(),a=o.replace(r,"");i.push(h(a,o.trailing,o.lineNumber))}return i}function i(e,t,n){var r=e.list,i=r[r.length-1];if(!(i[1]instanceof Array&&"para"==i[1][0]))if(t+1==n.length)i.push(["para"].concat(i.splice(1,i.length-1)));else{var o=i.pop();i.push(["para"].concat(i.splice(1,i.length-1)),o)}}var o="[*+-]|\\d+\\.",a=/[*+-]/,s=new RegExp("^( {0,3})("+o+")[ \t]+"),l="(?: {0,3}\\t| {4})";return function(o,l){function u(e){var t=a.exec(e[2])?["bulletlist"]:["numberlist"];return f.push({list:t,indent:e[1]}),t}var c=o.match(s);if(c){for(var d,p,f=[],h=u(c),g=!1,v=[f[0].list];;){for(var y=o.split(/(?=\n)/),b="",_=0;_<y.length;_++){var x="",w=y[_].replace(/^\n/,function(e){return x=e,""}),C=e(f.length);if(c=w.match(C),void 0!==c[1]){b.length&&(n(d,g,this.processInline(b),x),g=!1,b=""),c[1]=t(c[1]);var T=Math.floor(c[1].length/4)+1;if(T>f.length)h=u(c),d.push(h),d=h[1]=["listitem"];else{var S=!1;for(p=0;p<f.length;p++)if(f[p].indent==c[1]){h=f[p].list,f.splice(p+1,f.length-(p+1)),S=!0;break}S||(T++,T<=f.length?(f.splice(T,f.length-T),h=f[T-1].list):(h=u(c),d.push(h))),d=["listitem"],h.push(d)}x=""}w.length>c[0].length&&(b+=x+w.substr(c[0].length))}b.length&&(n(d,g,this.processInline(b),x),g=!1,b="");var A=r(f.length,l);A.length>0&&(m(f,i,this),d.push.apply(d,this.toTree(A,[])));var k=l[0]&&l[0].valueOf()||"";if(!k.match(s)&&!k.match(/^ /))break;o=l.shift();var P=this.dialect.block.horizRule(o,l);if(P){v.push.apply(v,P);break}m(f,i,this),g=!0}return v}}}(),blockquote:function(e,t){if(e.match(/^>/m)){var n=[];if(">"!=e[0]){for(var r=e.split(/\n/),i=[],o=e.lineNumber;r.length&&">"!=r[0][0];)i.push(r.shift()),o++;var a=h(i.join("\n"),"\n",e.lineNumber);n.push.apply(n,this.processBlock(a,[])),e=h(r.join("\n"),e.trailing,o)}for(;t.length&&">"==t[0][0];){var l=t.shift();e=h(e+e.trailing+l,l.trailing,e.lineNumber)}var u=e.replace(/^> ?/gm,""),c=(this.tree,this.toTree(u,["blockquote"])),d=s(c);return d&&d.references&&(delete d.references,v(d)&&c.splice(1,1)),n.push(c),n}},referenceDefn:function(e,t){var n=/^\s*\[(.*?)\]:\s*(\S+)(?:\s+(?:(['"])(.*?)\3|\((.*?)\)))?\n?/;if(e.match(n)){s(this.tree)||this.tree.splice(1,0,{});var r=s(this.tree);void 0===r.references&&(r.references={});var i=this.loop_re_over_block(n,e,function(e){e[2]&&"<"==e[2][0]&&">"==e[2][e[2].length-1]&&(e[2]=e[2].substring(1,e[2].length-1));var t=r.references[e[1].toLowerCase()]={href:e[2]};void 0!==e[4]?t.title=e[4]:void 0!==e[5]&&(t.title=e[5])});return i.length&&t.unshift(h(i,e.trailing)),[]}},para:function(e,t){return[["para"].concat(this.processInline(e))]}}},f.dialects.Gruber.inline={__oneElement__:function(e,t,n){var r,i;t=t||this.dialect.inline.__patterns__;var o=new RegExp("([\\s\\S]*?)("+(t.source||t)+")");if(r=o.exec(e),!r)return[e.length,e];if(r[1])return[r[1].length,r[1]];var i;return r[2]in this.dialect.inline&&(i=this.dialect.inline[r[2]].call(this,e.substr(r.index),r,n||[])),i=i||[r[2].length,r[2]]},__call__:function(e,t){function n(e){"string"==typeof e&&"string"==typeof i[i.length-1]?i[i.length-1]+=e:i.push(e)}for(var r,i=[];e.length>0;)r=this.dialect.inline.__oneElement__.call(this,e,t,i),e=e.substr(r.shift()),m(r,n);return i},"]":function(){},"}":function(){},__escape__:/^\\[\\`\*_{}\[\]()#\+.!\-]/,"\\":function(e){return this.dialect.inline.__escape__.exec(e)?[2,e.charAt(1)]:[1,"\\"]},"![":function(e){var t=e.match(/^!\[(.*?)\][ \t]*\([ \t]*([^")]*?)(?:[ \t]+(["'])(.*?)\3)?[ \t]*\)/);if(t){t[2]&&"<"==t[2][0]&&">"==t[2][t[2].length-1]&&(t[2]=t[2].substring(1,t[2].length-1)),t[2]=this.dialect.inline.__call__.call(this,t[2],/\\/)[0];var n={alt:t[1],href:t[2]||""};return void 0!==t[4]&&(n.title=t[4]),[t[0].length,["img",n]]}return t=e.match(/^!\[(.*?)\][ \t]*\[(.*?)\]/),t?[t[0].length,["img_ref",{alt:t[1],ref:t[2].toLowerCase(),original:t[0]}]]:[2,"!["]},"[":function e(t){var n=String(t),r=f.DialectHelpers.inline_until_char.call(this,t.substr(1),"]");if(!r)return[1,"["];var e,i,o=1+r[0],a=r[1];t=t.substr(o);var s=t.match(/^\s*\([ \t]*([^"']*)(?:[ \t]+(["'])(.*?)\2)?[ \t]*\)/);if(s){var l=s[1];if(o+=s[0].length,l&&"<"==l[0]&&">"==l[l.length-1]&&(l=l.substring(1,l.length-1)),!s[3])for(var u=1,c=0;c<l.length;c++)switch(l[c]){case"(":u++;break;case")":0==--u&&(o-=l.length-c,l=l.substring(0,c))}return l=this.dialect.inline.__call__.call(this,l,/\\/)[0],i={href:l||""},void 0!==s[3]&&(i.title=s[3]),e=["link",i].concat(a),[o,e]}return s=t.match(/^\s*\[(.*?)\]/),s?(o+=s[0].length,i={ref:(s[1]||String(a)).toLowerCase(),original:n.substr(0,o)},e=["link_ref",i].concat(a),[o,e]):1==a.length&&"string"==typeof a[0]?(i={ref:a[0].toLowerCase(),original:n.substr(0,o)},e=["link_ref",i,a[0]],[o,e]):[1,"["]},"<":function(e){var t;return null!=(t=e.match(/^<(?:((https?|ftp|mailto):[^>]+)|(.*?@.*?\.[a-zA-Z]+))>/))?t[3]?[t[0].length,["link",{href:"mailto:"+t[3]},t[3]]]:"mailto"==t[2]?[t[0].length,["link",{href:t[1]},t[1].substr("mailto:".length)]]:[t[0].length,["link",{href:t[1]},t[1]]]:[1,"<"]},"`":function(e){var t=e.match(/(`+)(([\s\S]*?)\1)/);return t&&t[2]?[t[1].length+t[2].length,["inlinecode",t[3]]]:[1,"`"]},"  \n":function(e){return[3,["linebreak"]]}},f.dialects.Gruber.inline["**"]=i("strong","**"),f.dialects.Gruber.inline.__=i("strong","__"),f.dialects.Gruber.inline["*"]=i("em","*"),f.dialects.Gruber.inline._=i("em","_"),f.buildBlockOrder=function(e){var t=[];for(var n in e)"__order__"!=n&&"__call__"!=n&&t.push(n);e.__order__=t},f.buildInlinePatterns=function(e){var t=[];for(var n in e)if(!n.match(/^__.*__$/)){var r=n.replace(/([\\.*+?|()\[\]{}])/g,"\\$1").replace(/\n/,"\\n");t.push(1==n.length?r:"(?:"+r+")")}t=t.join("|"),e.__patterns__=t;var i=e.__call__;e.__call__=function(e,n){return void 0!=n?i.call(this,e,n):i.call(this,e,t)}},f.DialectHelpers={},f.DialectHelpers.inline_until_char=function(e,t){for(var n=0,r=[];;){if(e.charAt(n)==t)return n++,[n,r];if(n>=e.length)return null;var i=this.dialect.inline.__oneElement__.call(this,e.substr(n));n+=i[0],r.push.apply(r,i.slice(1))}},f.subclassDialect=function(e){function t(){}function n(){}return t.prototype=e.block,n.prototype=e.inline,{block:new t,inline:new n}},f.buildBlockOrder(f.dialects.Gruber.block),f.buildInlinePatterns(f.dialects.Gruber.inline),f.dialects.Maruku=f.subclassDialect(f.dialects.Gruber),f.dialects.Maruku.processMetaHash=function(e){for(var t=o(e),n={},r=0;r<t.length;++r)if(/^#/.test(t[r]))n.id=t[r].substring(1);else if(/^\./.test(t[r]))n.class?n.class=n.class+t[r].replace(/./," "):n.class=t[r].substring(1);else if(/\=/.test(t[r])){var i=t[r].split(/\=/);n[i[0]]=i[1]}return n},f.dialects.Maruku.block.document_meta=function(e,t){if(!(e.lineNumber>1)&&e.match(/^(?:\w+:.*\n)*\w+:.*$/)){s(this.tree)||this.tree.splice(1,0,{});var n=e.split(/\n/);for(p in n){var r=n[p].match(/(\w+):\s*(.*)$/),i=r[1].toLowerCase(),o=r[2];this.tree[1][i]=o}return[]}},f.dialects.Maruku.block.block_meta=function(e,t){var n=e.match(/(^|\n) {0,3}\{:\s*((?:\\\}|[^\}])*)\s*\}$/);if(n){var r,i=this.dialect.processMetaHash(n[2]);if(""===n[1]){var o=this.tree[this.tree.length-1];if(r=s(o),"string"==typeof o)return;r||(r={},o.splice(1,0,r));for(a in i)r[a]=i[a];return[]}var l=e.replace(/\n.*$/,""),u=this.processBlock(l,[]);r=s(u[0]),r||(r={},u[0].splice(1,0,r));for(a in i)r[a]=i[a];return u}},f.dialects.Maruku.block.definition_list=function(e,t){var n,r,i=/^((?:[^\s:].*\n)+):\s+([\s\S]+)$/,o=["dl"];if(r=e.match(i)){for(var a=[e];t.length&&i.exec(t[0]);)a.push(t.shift());for(var s=0;s<a.length;++s){var r=a[s].match(i),l=r[1].replace(/\n$/,"").split(/\n/),u=r[2].split(/\n:\s+/);
for(n=0;n<l.length;++n)o.push(["dt",l[n]]);for(n=0;n<u.length;++n)o.push(["dd"].concat(this.processInline(u[n].replace(/(\n)\s+/,"$1"))))}return[o]}},f.dialects.Maruku.block.table=function e(t,n){var r,i,o=function(e,t){t=t||"\\s",t.match(/^[\\|\[\]{}?*.+^$]$/)&&(t="\\"+t);for(var n,r=[],i=new RegExp("^((?:\\\\.|[^\\\\"+t+"])*)"+t+"(.*)");n=e.match(i);)r.push(n[1]),e=n[2];return r.push(e),r},a=/^ {0,3}\|(.+)\n {0,3}\|\s*([\-:]+[\-| :]*)\n((?:\s*\|.*(?:\n|$))*)(?=\n|$)/,s=/^ {0,3}(\S(?:\\.|[^\\|])*\|.*)\n {0,3}([\-:]+\s*\|[\-| :]*)\n((?:(?:\\.|[^\\|])*\|.*(?:\n|$))*)(?=\n|$)/;if(i=t.match(a))i[3]=i[3].replace(/^\s*\|/gm,"");else if(!(i=t.match(s)))return;var e=["table",["thead",["tr"]],["tbody"]];i[2]=i[2].replace(/\|\s*$/,"").split("|");var l=[];for(m(i[2],function(e){e.match(/^\s*-+:\s*$/)?l.push({align:"right"}):e.match(/^\s*:-+\s*$/)?l.push({align:"left"}):e.match(/^\s*:-+:\s*$/)?l.push({align:"center"}):l.push({})}),i[1]=o(i[1].replace(/\|\s*$/,""),"|"),r=0;r<i[1].length;r++)e[1][1].push(["th",l[r]||{}].concat(this.processInline(i[1][r].trim())));return m(i[3].replace(/\|\s*$/gm,"").split("\n"),function(t){var n=["tr"];for(t=o(t,"|"),r=0;r<t.length;r++)n.push(["td",l[r]||{}].concat(this.processInline(t[r].trim())));e[2].push(n)},this),[e]},f.dialects.Maruku.inline["{:"]=function(e,t,n){if(!n.length)return[2,"{:"];var r=n[n.length-1];if("string"==typeof r)return[2,"{:"];var i=e.match(/^\{:\s*((?:\\\}|[^\}])*)\s*\}/);if(!i)return[2,"{:"];var o=this.dialect.processMetaHash(i[1]),a=s(r);a||(a={},r.splice(1,0,a));for(var l in o)a[l]=o[l];return[i[0].length,""]},f.dialects.Maruku.inline.__escape__=/^\\[\\`\*_{}\[\]()#\+.!\-|:]/,f.buildBlockOrder(f.dialects.Maruku.block),f.buildInlinePatterns(f.dialects.Maruku.inline);var m,g=Array.isArray||function(e){return"[object Array]"==Object.prototype.toString.call(e)};m=Array.prototype.forEach?function(e,t,n){return e.forEach(t,n)}:function(e,t,n){for(var r=0;r<e.length;r++)t.call(n||e,e[r],r,e)};var v=function(e){for(var t in e)if(hasOwnProperty.call(e,t))return!1;return!0};e.renderJsonML=function(e,t){t=t||{},t.root=t.root||!1;var n=[];if(t.root)n.push(u(e));else for(e.shift(),!e.length||"object"!=typeof e[0]||e[0]instanceof Array||e.shift();e.length;)n.push(u(e.shift()));return n.join("\n\n")}}(function(){return"undefined"==typeof exports?(window.markdown={},window.markdown):exports}()),define("markdown",function(e){return function(){var t;return t||e.markdown}}(this)),define("common/markdown-to-html",["require","markdown"],function(e){var t=e("markdown"),n='class="opens-in-new-window" target="blank"';return function(e){var r,i="";return $.isArray(e)||(e=[e]),e.forEach(function(e){i+=e+"\n"}),r='<div class="markdown-typography">'+t.toHTML(i)+"</div>",r.replace(/<a(.*?)>/g,"<a$1 "+n+">")}}),define("common/controllers/text-controller",["require","common/markdown-to-html","common/inherit","common/controllers/interactive-component"],function(e){function t(e,t){i.call(this,"text",e,t),this.$element.addClass("interactive-text"),this.$element.append(n(this.component.text))}var n=e("common/markdown-to-html"),r=e("common/inherit"),i=e("common/controllers/interactive-component");return r(t,i),t.prototype.modelLoadedCallback=function(){t.superClass._modelLoadedCallback.call(this)},t}),define("common/controllers/image-controller",["require","lab.config","common/inherit","common/controllers/interactive-component"],function(e){function t(e,t){i.call(this,"image",e,t),this._controller=t,this._$img=$("<img>"),this._externalUrl=o.test(this.component.src),this._externalUrl&&this._$img.attr("src",this.component.src),"auto"!==this.component.width&&this._$img.css("width","100%"),"auto"!==this.component.height&&this._$img.css("height","100%"),this._$img.appendTo(this.$element)}var n=e("lab.config"),r=e("common/inherit"),i=e("common/controllers/interactive-component"),o=/^https?:\/\//i;return r(t,i),t.prototype.modelLoadedCallback=function(){var e,t,r;if(!this._externalUrl){switch(e=this.component.src,r=this.component.urlRelativeTo){case"page":t="";break;case"model":default:t=this._controller.modelController.modelUrl||""}t=t.slice(0,t.lastIndexOf("/")+1),e=n.modelsRootUrl+t+e,this._$img.attr("src",e)}},t}),define("common/controllers/radio-controller",["common/controllers/interactive-metadata","common/validator","common/controllers/disablable","common/controllers/help-icon-support"],function(){var e=require("common/controllers/interactive-metadata"),t=require("common/validator"),n=require("common/controllers/disablable"),r=require("common/controllers/help-icon-support");return function(i,o){function a(){if(void 0!==i.property)for(var e=f.get(i.property),t=0,n=p.length;t<n;t++)p[t].value===e?(m[t].attr("checked",!0),g[t].addClass("checked")):(m[t].removeAttr("checked"),g[t].removeClass("checked"))}function s(){var e=f.getPropertyDescription(i.property);c.setDisabled(e.getFrozen())}function l(e){var t,n,r=$(this),i=r.find("input");if(e.preventDefault(),void 0===i.attr("disabled")){for(t=0,n=m.length;t<n;t++)m[t].removeAttr("checked"),g[t].removeClass("checked");i.attr("checked","checked"),r.addClass("checked"),i.trigger("change")}}function u(){var a,s,u,v,y,b,_;for(f=o.getModel(),h=o.getScriptingAPI(),i=t.validateCompleteness(e.radio,i),p=i.options,b=0,_=p.length;b<_;b++)p[b]=t.validateCompleteness(e.radioOption,p[b]);for(d=$("<div>").attr("id",i.id),d.addClass("interactive-radio"),d.addClass("component"),d.addClass(i.orientation),d.addClass(i.style),i.label&&(u=$("<span>").html(i.label),u.addClass("label"),u.addClass("top"===i.labelOn?"on-top":"on-left"),d.append(u)),v=$("<span>").addClass("options").appendTo(d),b=0,_=p.length;b<_;b++)y=p[b],a=$("<input>").attr("type","radio").attr("name",i.id).attr("tabindex",o.getNextTabIndex()).attr("id",i.id+"-"+b),m.push(a),s=$("<span>").addClass("option").append(a),g.push(s),v.append(s),"radio"===i.style&&$('<div class="fakeCheckable">').appendTo(s),$("<label>").attr("for",i.id+"-"+b).html(y.text).appendTo(s),y.disabled&&(a.attr("disabled",y.disabled),s.addClass("lab-disabled")),y.selected&&(a.attr("checked",y.selected),s.addClass("checked")),s.on("touchstart click",l),a.change(function(e){return function(){e.action?h.makeFunctionInScriptContext(e.action)():void 0!==e.value&&f.set(i.property,e.value)}}(y));i.tooltip&&d.attr("title",i.tooltip),n(c,i),r(c,i,o.helpSystem)}var c,d,p,f,h,m=[],g=[];return c={modelLoadedCallback:function(){f&&void 0!==i.property&&(f.removeObserver(i.property,a),f.removePropertyDescriptionObserver(i.property,s)),f=o.getModel(),h=o.getScriptingAPI(),void 0!==i.property&&(f.addPropertiesListener([i.property],a),f.addPropertyDescriptionObserver(i.property,s)),a()},enableLogging:function(e){m.forEach(function(t,n){var r=p[n];t.off(".logging"),t.on("change.logging",function(){var t={id:i.id,selected:r.text};i.label&&(t.label=i.label),i.property&&(t.property=i.property,t.value=r.value),e("RadioChanged",t)})})},getViewContainer:function(){return d},serialize:function(){var e,t;if(void 0===i.property)for(e=0,t=p.length;e<t;e++)m[e].attr("checked")?p[e].selected=!0:delete p[e].selected;return $.extend(!0,{},i)}},u(),c}}),define("common/controllers/slider-controller",["common/controllers/interactive-metadata","common/validator","common/controllers/disablable","common/controllers/help-icon-support"],function(){var e=require("common/controllers/interactive-metadata"),t=require("common/validator"),n=require("common/controllers/disablable"),r=require("common/controllers/help-icon-support");return function(i,o){function a(){k.off(".componentAction"),i.action&&(f=M.makeFunctionInScriptContext("value",i.action),k.on("slide.componentAction",function(e,t){f(t.value),v&&P.text(y(t.value))})),p&&k.on("slide.componentAction",function(e,t){var n={};n[p]=t.value,O&&O.set(n),v&&P.text(y(t.value))}),v&&(y=M.makeFunctionInScriptContext("value",v))}function s(e){if(x){var t=Math.round(100*(e-u)/(c-u)),n="",r="",i=[];null===N&&(E.css("background",""),N=E.css("background-color")),e===w?E.css("background",""):(n+=N+" 0%, ",r+="color-stop(0%,"+N+"), ",w<=e?(i.push(C),i.push(t)):(i.push(t),i.push(C)),n+=N+" "+i[0]+"%, ",r+="color-stop("+i[0]+"%,"+N+"), ",n+=x+" "+i[0]+"%, ",r+="color-stop("+i[0]+"%,"+x+"), ",n+=x+" "+i[1]+"%, ",r+="color-stop("+i[1]+"%,"+x+"), ",n+=N+" "+i[1]+"%, ",r+="color-stop("+i[1]+"%,"+N+"), ",n+=N+" 100%",r+="color-stop(100%,"+N+")",E.css("background","-webkit-gradient(linear, left top, right top, "+r+")"),E.css("background","-webkit-linear-gradient(left, "+n+")"),E.css("background","-moz-linear-gradient(left, "+n+")"),E.css("background","-o-linear-gradient(left, "+n+")"),E.css("background","linear-gradient(to right, "+n+")"))}}function l(){M=o.getScriptingAPI(),O=o.getModel(),i=t.validateCompleteness(e.slider,i),u=i.min,c=i.max,d=i.steps,p=i.property,h=i.initialValue,m=i.title,g=i.labels,v=i.displayValue,x=i.fillColor,w=i.fillToValue,O=o.getModel(),void 0===u&&(u=0),void 0===c&&(c=10),void 0===d&&(d=10),void 0===w&&(w=u),C=Math.round(100*(w-u)/(c-u)),S=$('<div class="title '+i.titlePosition+'">'+m+"</div>"),E=$('<div class="container">'),k=$('<div class="html-slider">').attr("id",i.id),k.appendTo(E),k.slider({min:u,max:c,step:(c-u)/d}),x&&(k.addClass("has-fill"),k.on("slide",function(e,t){s(t.value)})),P=k.find(".ui-slider-handle"),P.attr("tabindex",o.getNextTabIndex()),T=$('<div class="interactive-slider">'),"right"===i.titlePosition||"bottom"===i.titlePosition?T.append(E).append(S):T.append(S).append(E),"left"!==i.titlePosition&&"right"!==i.titlePosition||E.css({display:"inline-block"}),T.addClass("component"),T.css({width:i.width,height:i.height}),"auto"===i.width&&T.css("min-width","12em");var l=null,f=null,N=function(e){return T.measure(function(){return this.width()/parseFloat(this.parent().css("font-size"))},e,o.interactiveContainer)};for(b=0;b<g.length;b++)_=g[b],A=$('<p class="label">'+_.label+"</p>"),E.append(A),"right"===_.value?(A.addClass("side right"),f=N(".label.side.right"),A.css({left:"100%","margin-left":"0.6em"})):"left"===_.value?(A.addClass("side left"),l=N(".label.side.left"),A.css({left:-l+"em","margin-left":"-0.8em"})):A.css("left",(_.value-u)/(c-u)*100+"%");l&&T.css("margin-left",l+"em"),f&&T.css("margin-right",f+"em"),a(),i.tooltip&&T.attr("title",i.tooltip),n(L,i),r(L,i,o.helpSystem),P.on("keydown.slider-handle",function(e){e.stopPropagation()}),L.resize(),void 0!==h&&null!==h&&(k.slider("value",h),s(h),v&&P.text(y(h)))}var u,c,d,p,f,h,m,g,v,y,b,_,x,w,C,T,S,A,k,P,E,O,M,L,N=null,R=function(){var e=o.getModel().get(p);k.slider("value",e),s(e),v&&P.text(y(e))},I=function(){var e=O.getPropertyDescription(p);L.setDisabled(e.getFrozen())};return L={modelLoadedCallback:function(){O&&p&&(O.removeObserver(p,R),O.removePropertyDescriptionObserver(p,I)),M=o.getScriptingAPI(),O=o.getModel(),p&&(O.addPropertiesListener([p],R),O.addPropertyDescriptionObserver(p,I)),a(),p&&R()},getViewContainer:function(){return T},resize:function(){var e,t=parseFloat(P.css("font-size"));"auto"!==i.height&&(e=T.height(),"top"!==i.titlePosition&&"bottom"!==i.titlePosition||(e-=S.outerHeight(!0)),void 0!==A&&(e-=A.outerHeight(!0)),E.css("height",e),k.css("top",.5*e),P.css("height",e+.4*t),P.css("top",-.5*e-.4*t)),"left"!==i.titlePosition&&"right"!==i.titlePosition||E.css({width:T.width()-S.outerWidth(!0)-.5*t})},enableLogging:function(e){var t={id:i.id,label:i.label};p&&(t.property=p);var n;k.off(".logging"),k.on("slidestart.logging",function(e,r){n=Date.now(),t.startVal=t.minVal=t.maxVal=r.value}),k.on("slide.logging",function(e,n){t.minVal=Math.min(t.minVal,n.value),t.maxVal=Math.max(t.maxVal,n.value)}),k.on("slidestop.logging",function(r,i){t.endVal=i.value,t.time=(Date.now()-n)/1e3,e("SliderChanged",t)})},serialize:function(){var e=$.extend(!0,{},i);return p||(e.initialValue=k.slider("value")),e}},l(),L}}),define("common/views/select-box-view",[],function(){return function(e){function t(){var e;return n?void(n=!1):(e=$(this).prop("selectedIndex"),void u(a[e],e))}var n,r,i,o=e.id,a=e.options,s=e.label,l=e.labelOn,u=e.onChange;return{update:function(e){n=!0,r.data("selectBox-selectBoxIt").selectOption(e.toString().trim())},render:function(e){function n(t){var n=parseFloat(e.css("font-size"));return t/n}function u(){return this.width()}var c,d,p,f,h,m,g=[];return r=$("<select>"),a.forEach(function(e){c=$("<option>").html(e.text),g.push(c),e.disabled&&c.prop("disabled",e.disabled),e.selected&&c.prop("selected",e.selected),void 0!==e.value&&c.prop("value",e.value),r.append(c)}),r.change(t),i=$("<div>").attr("id",o),s&&(d=$("<span>").text(s),d.addClass("label"),d.addClass("top"===l?"on-top":"on-left"),i.append(d)),i.append(r),r.selectBoxIt(),this.$element=r,i.find(".selectboxit").css("width","auto"),p=n(i.measure(u,"ul",e)),f=n(i.measure(u,".selectboxit-arrow-container",e)),h=p+"em",m=p+f+.3+"em",i.find(".selectboxit").css("width",m),i.find(".selectboxit-text").css("max-width",h),i.find(".selectboxit-container select").css({width:m,height:"100%"}),i},get $element(){return i},refresh:function(){r.data("selectBox-selectBoxIt").refresh()},destroy:function(){r.data("selectBox-selectBoxIt").destroy(),i.remove()}}}}),define("common/controllers/pulldown-controller",["common/controllers/interactive-metadata","common/validator","common/controllers/disablable","common/controllers/help-icon-support","common/views/select-box-view","common/jquery-plugins"],function(){var e=require("common/controllers/interactive-metadata"),t=require("common/validator"),n=require("common/controllers/disablable"),r=require("common/controllers/help-icon-support"),i=require("common/views/select-box-view");return require("common/jquery-plugins"),function(o,a){function s(){void 0!==o.property&&g.update(p.get(o.property))}function l(){var e=p.getPropertyDescription(o.property);d.setDisabled(e.getFrozen())}function u(e){if(h){var t={id:o.id,selected:e.text};o.label&&(t.label=o.label),o.property&&(t.property=o.property,t.value=e.value),h("PulldownChanged",t)}}function c(){var s,l,c=a.interactiveContainer;for(p=a.getModel(),f=a.getScriptingAPI(),o=t.validateCompleteness(e.pulldown,o),m=o.options,s=0,l=m.length;s<l;s++)m[s]=t.validateCompleteness(e.pulldownOption,m[s]);g=new i({id:o.id,options:m,label:o.label,labelOn:o.labelOn,onChange:function(e){e.action?f.makeFunctionInScriptContext(e.action)():void 0!==e.value&&f.api.set(o.property,e.value),u(e)}}),v=g.render(c),v.addClass("interactive-pulldown").addClass("component"),o.tooltip&&v.attr("title",o.tooltip),n(d,o),r(d,o,a.helpSystem)}var d,p,f,h,m,g,v;return d={modelLoadedCallback:function(){f=a.getScriptingAPI(),void 0!==o.property?(p&&(p.removeObserver(o.property,s),p.removePropertyDescriptionObserver(o.property,l)),p=a.getModel(),p.addObserver(o.property,s),p.addPropertyDescriptionObserver(o.property,l)):p=a.getModel(),s()},enableLogging:function(e){h=e},getViewContainer:function(){return v},serialize:function(){var e,t,n;if(void 0===o.property)for(n=v.find("option"),e=0,t=m.length;e<t;e++)$(n[e]).prop("selected")?m[e].selected=!0:delete m[e].selected;return $.extend(!0,{},o)}},c(),d}}),define("common/controllers/joystick-controller",["common/controllers/interactive-metadata","common/validator","common/controllers/disablable","common/controllers/help-icon-support"],function(){var e=require("common/controllers/interactive-metadata"),t=require("common/validator"),n=require("common/controllers/disablable"),r=require("common/controllers/help-icon-support");return function(i,o){function a(){i.action&&(m=L.makeFunctionInScriptContext("value",i.action),R=function(e){m(e),b&&O.text(_(e))}),h&&(R=function(e){M&&(M.properties[h]=e),b&&O.text(_(e))}),b&&(_=L.makeFunctionInScriptContext("value",b))}function s(){E.draggable({revert:!1,create:function(){l()},drag:function(e,t){var n=u(t.position.left+B.halfWidth,t.position.top+B.halfHeight);n&&(t.position.left=n.x-B.halfWidth,t.position.top=n.y-B.halfHeight);var r=(t.position.left-B.startLeft)/(D.radius-B.halfWidth),i=(B.startTop-t.position.top)/(D.radius-B.halfHeight);d(r,i)},stop:function(){}})}function l(){I||(I=!0,D.width=P[0].offsetWidth,D.height=P[0].offsetHeight,D.top=P[0].offsetTop,D.left=P[0].offsetLeft,D.center=[D.width/2,D.height/2],D.radius=D.width/2,B.startLeft=parseInt(E.css("left")),B.startTop=parseInt(E.css("top")),E.data("startLeft",B.startLeft),E.data("startTop",B.startTop),B.halfWidth=E[0].offsetWidth/2,B.halfHeight=E[0].offsetHeight/2)}function u(e,t){var n=c([e,t],D.center);if(n<=D.radius-B.halfWidth)return null;e-=D.center[0],t-=D.center[1];var r=Math.atan2(t,e);return{x:Math.cos(r)*(D.radius-B.halfWidth)+D.center[0],y:Math.sin(r)*(D.radius-B.halfWidth)+D.center[1]}}function c(e,t){var n=e[0],r=e[1],i=t[0],o=t[1];return Math.sqrt(Math.pow(n-i,2)+Math.pow(r-o,2))}function d(e,t){var n=Math.sqrt(e*e+t*t)*i.scale,r=(Math.atan2(t,e)+2*Math.PI)%(2*Math.PI),o={magnitude:n,direction:r};R&&R(o)}function p(e){var t=(D.radius-B.halfWidth)*e.magnitude/i.scale,n=t*Math.cos(e.direction),r=t*Math.sin(e.direction),o=D.center[0]-B.halfWidth+n,a=D.center[1]-B.halfWidth-r;E.css({top:a,left:o})}function f(){L=o.getScriptingAPI(),M=o.getModel(),i=t.validateCompleteness(e.joystick,i),h=i.property,g=i.initialValue,v=i.title,y=i.labels,b=i.displayValue,M=o.getModel(),void 0===h&&void 0===g&&(g={magnitude:0,direction:0}),w=$('<div class="container">'),C=$('<div class="title">'+v+"</div>"),P=$('<div class="base">').attr("id",i.id),E=$('<div class="handle">'),E.appendTo(P),T=$('<div class="label n">'+y.n+"</div>"),S=$('<div class="label s">'+y.s+"</div>"),k=$('<div class="label w">'+y.w+"</div>"),A=$('<div class="label e">'+y.e+"</div>"),w.append(T).append(k).append(P).append(A).append(S),x=$('<div class="interactive-joystick">').append(C).append(w),x.addClass("component"),O=$('<div class="value"></div>'),x.append(O),i.tooltip&&x.attr("title",i.tooltip),n(N,i),r(N,i,o.helpSystem),x.css({width:i.width,height:i.height}),N.resize(!0),void 0!==g&&null!==g&&(p(g),b&&O.text(_(g)))}var h,m,g,v,y,b,_,x,w,C,T,S,A,k,P,E,O,M,L,N,R,I=!1,D={},B={},V=function(e){var t=o.getModel().get(h);e&&p(t),b&&O.text(_(t))},j=function(){var e=M.getPropertyDescription(h);N.setDisabled(e.getFrozen())};return N={modelLoadedCallback:function(){M&&h&&(M.removeObserver(h,V),M.removePropertyDescriptionObserver(h,j)),L=o.getScriptingAPI(),M=o.getModel(),h&&(M.addPropertiesListener([h],V),M.addPropertyDescriptionObserver(h,j)),a(),s(),h&&V(!0)},getViewContainer:function(){return x},resize:function(e){if(!e){var t=x[0].clientWidth,n=x[0].clientHeight,r=parseFloat(x.css("font-size")),i=n-4.2*r,a=A.outerWidth(!0)+k.outerWidth(!0),s=t-a,u=0;s<2*r&&(u=Math.abs(2*r-s),s=2*r);var c,d=s<i?s:i,f=.3*d,m=d+2.2*r;if(u>0){var g=(a-u-.1*r)/a;c=k.outerWidth(!0)*g+.1*r+d/2}else c=k.outerWidth(!0)+.1*r+d/2;w.css({width:t,height:m}),A.css({left:c+d/2+.1*r}),k.css({left:c-d/2-.1*r-k[0].clientWidth}),T.css({left:c-T.outerWidth(!0)/2}),S.css({left:c-S.outerWidth(!0)/2}),P.css({height:d,width:d,left:c-d/2,top:1.1*r,borderRadius:d}),E.css({height:f,width:f,borderRadius:d,left:d/2-f/2,top:d/2-f/2}),I=!1,l();var v=o.getModel().get(h);p(v)}},serialize:function(){var e=$.extend(!0,{},i);return h||(e.initialValue={magnitude:0,direction:0}),e}},f(),N}}),define("common/controllers/color-indicator-controller",["common/controllers/interactive-metadata","common/validator","common/controllers/help-icon-support"],function(){var e=require("common/controllers/interactive-metadata"),t=require("common/validator"),n=require("common/controllers/help-icon-support");return function(r,i){function o(){h=i.getScriptingAPI(),f=i.getModel(),r=t.validateCompleteness(e.colorIndicator,r),a=r.property,s=r.initialValue,l=r.title,u=h.makeFunctionInScriptContext("value",r.colorValue),f=i.getModel(),d=$('<div class="title">'+l+"</div>"),p=$('<div class="swatch"></div>'),c=$('<div class="interactive-color-indicator">').append(d).append(p),c.addClass("component"),r.tooltip&&c.attr("title",r.tooltip),n(m,r,i.helpSystem),c.css({width:r.width,height:r.height}),m.resize()}var a,s,l,u,c,d,p,f,h,m,g=function(){var e=i.getModel().get(a),t=u(e);p.css("background-color",t)};return m={modelLoadedCallback:function(){f&&a&&f.removeObserver(a,g),h=i.getScriptingAPI(),f=i.getModel(),a&&f.addPropertiesListener([a],g),a&&g()},getViewContainer:function(){return c},resize:function(){},serialize:function(){return $.extend(!0,{},r)}},o(),m}}),define("common/models/engines/clone-restore-wrapper",["require","arrays"],function(e){var t=e("arrays");return function(e,n){n=n||{};var r={clone:function(){var n,r={};for(n in e)e.hasOwnProperty(n)&&(r[n]=t.clone(e[n]));return r}};return n.padArraysWithZeroes?r.restore=function(n){var r,i,o,a;for(r in e)if(e.hasOwnProperty(r))for(i=e[r],t.copy(n[r],i),o=n[r].length,a=i.length;o<a;o++)i[o]=0}:r.restore=function(n){var r;for(r in e)e.hasOwnProperty(r)&&t.copy(n[r],e[r])},r}}),define("models/md2d/models/engine/constants/units",["require","exports","module"],function(e,t,n){var r,i,o,a=1.66054e-27,s=1.602177e-19,l=s,u=1e-15,c=1e-9,d=10,p=1e3,f={TIME:"time",LENGTH:"length",MASS:"mass",ENERGY:"energy",ENTROPY:"entropy",CHARGE:"charge",INVERSE_QUANTITY:"inverse quantity",FARADS_PER_METER:"farads per meter",METERS_PER_FARAD:"meters per farad",FORCE:"force",VELOCITY:"velocity",AREA:"area",PRESSURE:"pressure"};t.unit=r={FEMTOSECOND:{name:"femtosecond",value:1,type:f.TIME},SECOND:{name:"second",value:u,type:f.TIME},NANOMETER:{name:"nanometer",value:1,type:f.LENGTH},ANGSTROM:{name:"Angstrom",value:1*d,type:f.LENGTH},METER:{name:"meter",value:1*c,type:f.LENGTH},DALTON:{name:"Dalton",value:1,type:f.MASS},GRAM:{name:"gram",value:1*a*p,type:f.MASS},KILOGRAM:{name:"kilogram",value:1*a,type:f.MASS},MW_ENERGY_UNIT:{name:"MW Energy Unit (Dalton * nm^2 / fs^2)",value:1,type:f.ENERGY},JOULE:{name:"Joule",value:a*c*c*(1/u)*(1/u),type:f.ENERGY},EV:{name:"electron volt",value:a*c*c*(1/u)*(1/u)*(1/l),type:f.ENERGY},EV_PER_KELVIN:{name:"electron volts per Kelvin",value:1,type:f.ENTROPY},JOULES_PER_KELVIN:{name:"Joules per Kelvin",value:1*l,type:f.ENTROPY},ELEMENTARY_CHARGE:{name:"elementary charge",value:1,type:f.CHARGE},COULOMB:{name:"Coulomb",value:s,type:f.CHARGE},INVERSE_MOLE:{name:"inverse moles",value:1,type:f.INVERSE_QUANTITY},FARADS_PER_METER:{name:"Farads per meter",value:1,type:f.FARADS_PER_METER},METERS_PER_FARAD:{name:"meters per Farad",value:1,type:f.METERS_PER_FARAD},MW_FORCE_UNIT:{name:"MW force units (Dalton * nm / fs^2)",value:1,type:f.FORCE},NEWTON:{name:"Newton",value:1*a*c*(1/u)*(1/u),type:f.FORCE},EV_PER_NM:{name:"electron volts per nanometer",value:1*a*c*c*(1/u)*(1/u)*(1/l),type:f.FORCE},MW_VELOCITY_UNIT:{name:"MW velocity units (nm / fs)",value:1,type:f.VELOCITY},METERS_PER_SECOND:{name:"meters per second",value:1*c*(1/u),type:f.VELOCITY}},t.ratio=i=function(e,t){var n=function(e,t){if(e.type!==t.type)throw new Error("Attempt to convert incompatible type '"+e.name+"'' to '"+t.name+"'")};if(t.per)return n(e,t.per),e.value/t.per.value;if(t.as)return n(e,t.as),t.as.value/e.value;throw new Error("units.ratio() received arguments it couldn't understand.")},t.convert=o=function(e,t){var n=t&&t.from,r=t&&t.to;if(!n)throw new Error('units.convert() did not receive a "from" argument');if(!r)throw new Error('units.convert() did not receive a "to" argument');return e*i(r,{per:n})}}),define("models/md2d/models/engine/constants/index",["require","exports","module","./units"],function(e,t,n){var r,i,o=e("./units"),a=o.unit,s=o.ratio,l=o.convert,u={ELEMENTARY_CHARGE:{value:1,unit:a.ELEMENTARY_CHARGE},ATOMIC_MASS:{value:1,unit:a.DALTON},BOLTZMANN_CONSTANT:{value:1.380658e-23,unit:a.JOULES_PER_KELVIN},AVAGADRO_CONSTANT:{value:s(a.DALTON,{per:a.GRAM}),unit:a.INVERSE_MOLE},PERMITTIVITY_OF_FREE_SPACE:{value:8.854187e-12,unit:a.FARADS_PER_METER}};u.COULOMB_CONSTANT={value:1/(4*Math.PI*u.PERMITTIVITY_OF_FREE_SPACE.value),unit:a.METERS_PER_FARAD},t.unit=a,t.ratio=s,t.convert=l;for(r in u)u.hasOwnProperty(r)&&(i=u[r],t[r]=function(e){return{as:function(t){return o.convert(e.value,{from:e.unit,to:t})}}}(i))}),define("models/md2d/models/engine/utils",["require","arrays"],function(e){var t=e("arrays");return{extendArrays:function(e,n){var r,i;if(Array.isArray(e))for(r=0,i=e.length;r<i;r++)t.isArray(e[r])&&(e[r]=t.extend(e[r],n));else for(r in e)e.hasOwnProperty(r)&&t.isArray(e[r])&&(e[r]=t.extend(e[r],n))}}}),define("common/array-types",["require","arrays"],function(e){var t=e("arrays"),n=function(){if("undefined"==typeof navigator)return!0;var e=/ AppleWebKit\/([0123456789.+]+) \(KHTML, like Gecko\) Version\/([0123456789.]+) (Safari)\/([0123456789.]+)/,t=navigator.userAgent.match(e);return!t||!t[3]}(),r=t.typed&&n;return{floatType:r?"Float64Array":"regular",int32Type:r?"Int32Array":"regular",int16Type:r?"Int16Array":"regular",int8Type:r?"Int8Array":"regular",uint16Type:r?"Uint16Array":"regular",uint8Type:r?"Uint8Array":"regular"}}),define("models/md2d/models/metadata",[],function(){return{mainProperties:{type:{defaultValue:"md2d",immutable:!0},isBeingEdited:{defaultValue:!1,serialize:!1},imagePath:{defaultValue:"",immutable:!0},minX:{serialize:!1},maxX:{serialize:!1},minY:{serialize:!1},maxY:{serialize:!1},width:{defaultValue:10,unitType:"length",immutable:!0},height:{defaultValue:10,unitType:"length",immutable:!0},unitsScheme:{defaultValue:"md2d"},lennardJonesForces:{defaultValue:!0,storeInTickHistory:!0},coulombForces:{defaultValue:!0,storeInTickHistory:!0},temperatureControl:{defaultValue:!1,storeInTickHistory:!0},targetTemperature:{defaultValue:300,unitType:"temperature",storeInTickHistory:!0},modelSampleRate:{defaultValue:"default"},gravitationalField:{defaultValue:!1,unitType:"acceleration",storeInTickHistory:!0},timeStep:{defaultValue:1,unitType:"time",storeInTickHistory:!0},dielectricConstant:{defaultValue:1},realisticDielectricEffect:{defaultValue:!0},solventForceFactor:{defaultValue:1.25},solventForceType:{defaultValue:0},additionalSolventForceMult:{defaultValue:4},additionalSolventForceThreshold:{defaultValue:10,unitType:"length"},polarAAEpsilon:{defaultValue:-2},viscosity:{defaultValue:1,storeInTickHistory:!0},timeStepsPerTick:{defaultValue:50,storeInTickHistory:!0},DNAState:{defaultValue:"dna"},DNA:{defaultValue:"",validate:function(e){if(/[agtc]/.test(e)&&(e=e.toUpperCase()),/[^AGTC]/.test(e))throw new Error("DNA code on sense strand can be defined using only A, G, T or C characters.");return e}},DNAMutations:{defaultValue:!0},useQuantumDynamics:{defaultValue:!1},useChemicalReactions:{defaultValue:!1},useDuration:{defaultValue:"codap",storeInTickHistory:!1,validate:function(e){if(e===!0||e===!1||"codap"===e)return e;throw new Error("Invalid 'useDuration' value: "+e)}},requestedDuration:{defaultValue:null,storeInTickHistory:!1},skipPECheckOnAddAtom:{defaultValue:!1}},viewOptions:{viewPortWidth:{unitType:"length",immutable:!0},viewPortHeight:{unitType:"length",immutable:!0},viewPortZoom:{defaultValue:1},viewPortX:{unitType:"length"},viewPortY:{unitType:"length"},viewPortDrag:{defaultValue:!1},backgroundColor:{defaultValue:"#eeeeee"},showClock:{defaultValue:!0,storeInTickHistory:!0},markColor:{defaultValue:"#f8b500"},atomRadiusScale:{defaultValue:1},keShading:{defaultValue:!1,storeInTickHistory:!0},keShadingMinEnergy:{defaultValue:0,storeInTickHistory:!0},keShadingMaxEnergy:{defaultValue:.2,storeInTickHistory:!0},chargeShading:{defaultValue:!1,storeInTickHistory:!0},aminoAcidColorScheme:{defaultValue:"hydrophobicity"},aminoAcidLabels:{defaultValue:!0},useThreeLetterCode:{defaultValue:!0},showChargeSymbols:{defaultValue:!0},showVDWLines:{defaultValue:!1,storeInTickHistory:!0},VDWLinesCutoff:{defaultValue:"medium"},showVelocityVectors:{defaultValue:!1,storeInTickHistory:!0},showForceVectors:{defaultValue:!1,storeInTickHistory:!0},showElectricField:{defaultValue:!1,storeInTickHistory:!0},electricFieldDensity:{defaultValue:18,storeInTickHistory:!0},electricFieldColor:{defaultValue:"auto"},showAtomTrace:{storeInTickHistory:!0,defaultValue:!1},atomTraceId:{storeInTickHistory:!0,defaultValue:0},images:{defaultValue:[]},imageMapping:{defaultValue:{}},textBoxes:{defaultValue:[]},xlabel:{defaultValue:!1},ylabel:{defaultValue:!1},xunits:{defaultValue:!1},yunits:{defaultValue:!1},controlButtons:{defaultValue:"play"},controlButtonStyle:{defaultValue:"video",propertyChangeInvalidates:!1,serialize:!1},gridLines:{defaultValue:!1},atomNumbers:{defaultValue:!1},enableAtomTooltips:{defaultValue:!1},enableKeyboardHandlers:{defaultValue:!0},atomTraceColor:{defaultValue:"#6913c5"},velocityVectors:{defaultValue:{color:"#000",width:.01,length:2}},forceVectors:{defaultValue:{color:"#169C30",width:.01,length:2}},forceVectorsDirectionOnly:{defaultValue:!1},onAtomDrag:{defaultValue:"translate"}},atom:{x:{required:!0,unitType:"length"},y:{required:!0,unitType:"length"},element:{defaultValue:0},vx:{defaultValue:0,unitType:"velocity"},vy:{defaultValue:0,unitType:"velocity"},ax:{defaultValue:0,unitType:"acceleration",serialize:!1},ay:{defaultValue:0,unitType:"acceleration",serialize:!1},charge:{defaultValue:0,unitType:"charge"},friction:{defaultValue:0,unitType:"dampingCoefficient"},radical:{defaultValue:0},visible:{defaultValue:1},pinned:{defaultValue:0},marked:{defaultValue:0},draggable:{defaultValue:0},draggableWhenStopped:{defaultValue:1},radius:{readOnly:!0,unitType:"length",serialize:!1},px:{readOnly:!0,unitType:"momentum",serialize:!1},py:{readOnly:!0,unitType:"momentum",serialize:!1},speed:{readOnly:!0,unitType:"velocity",serialize:!1},mass:{readOnly:!0,unitType:"mass",serialize:!1},excitation:{},sharedElectrons:{}},element:{mass:{defaultValue:120,unitType:"mass"},sigma:{defaultValue:.3,unitType:"length"},epsilon:{defaultValue:-.1,unitType:"energy"},radius:{unitType:"length",readOnly:!0,serialize:!1},color:{defaultValue:-855310}},pairwiseLJProperties:{element1:{defaultValue:0},element2:{defaultValue:0},sigma:{unitType:"length"},epsilon:{unitType:"energy"}},obstacle:{width:{unitType:"length",required:!0},height:{unitType:"length",required:!0},x:{defaultValue:0,unitType:"length"},y:{defaultValue:0,unitType:"length"},mass:{defaultValue:1/0,unitType:"mass"},vx:{defaultValue:0,unitType:"velocity"},vy:{defaultValue:0,unitType:"velocity"},externalAx:{defaultValue:0,unitType:"acceleration"},externalAy:{defaultValue:0,unitType:"acceleration"},displayExternalAcceleration:{defaultValue:!0},friction:{defaultValue:0,unitType:"inverseTime"},westProbe:{defaultValue:!1},westProbeValue:{unitType:"pressure",readOnly:!0,serialize:!1},northProbe:{defaultValue:!1},northProbeValue:{unitType:"pressure",readOnly:!0,serialize:!1},eastProbe:{defaultValue:!1},eastProbeValue:{unitType:"pressure",readOnly:!0,serialize:!1},southProbe:{defaultValue:!1},southProbeValue:{unitType:"pressure",readOnly:!0,serialize:!1},color:{defaultValue:"rgb(128,128,128)"},visible:{defaultValue:!0}},shape:{type:{defaultValue:"rectangle",required:!0},width:{unitType:"length",required:!0},height:{unitType:"length",required:!0},x:{defaultValue:0,unitType:"length"},y:{defaultValue:0,unitType:"length"},fence:{defaultValue:0},color:{defaultValue:"transparent"},lineColor:{defaultValue:"black"},lineDashes:{defaultValue:"none"},lineWeight:{defaultValue:1},layer:{defaultValue:1},layerPosition:{defaultValue:1},visible:{defaultValue:1}},line:{x1:{defaultValue:0,required:!0,unitType:"length"},y1:{defaultValue:0,required:!0,unitType:"length"},x2:{defaultValue:0,required:!0,unitType:"length"},y2:{defaultValue:0,required:!0,unitType:"length"},beginStyle:{defaultValue:"none"},endStyle:{defaultValue:"none"},fence:{defaultValue:0},lineColor:{defaultValue:"black"},lineDashes:{defaultValue:"none"},lineWeight:{defaultValue:1},layer:{defaultValue:1},layerPosition:{defaultValue:1},visible:{defaultValue:1}},radialBond:{atom1:{defaultValue:0},atom2:{defaultValue:0},length:{unitType:"length",required:!0},strength:{unitType:"stiffness",required:!0},type:{defaultValue:101}},angularBond:{atom1:{defaultValue:0},atom2:{defaultValue:0},atom3:{defaultValue:0},strength:{unitType:"rotationalStiffness",required:!0},angle:{unitType:"angle",required:!0}},restraint:{atomIndex:{
required:!0},k:{defaultValue:2e3,unitType:"stiffness"},x0:{defaultValue:0,unitType:"length"},y0:{defaultValue:0,unitType:"length"}},electricField:{intensity:{defaultValue:.004},orientation:{defaultValue:"E"},shapeIdx:{defaultValue:null}},textBox:{text:{defaultValue:""},x:{defaultValue:0,unitType:"length"},y:{defaultValue:0,unitType:"length"},anchor:{defaultValue:"lower-left"},layer:{defaultValue:1},width:{},height:{},frame:{},color:{},calloutPoint:{},backgroundColor:{defaultValue:"white"},strokeWidthEms:{defaultValue:.03},strokeOpacity:{defaultValue:1},strokeColor:{defaultValue:"#000000"},rotate:{defaultValue:0},fontSize:{defaultValue:.12},hostType:{},hostIndex:{},textAlign:{}},chemicalReactions:{updateInterval:{defaultValue:10},createAngularBonds:{defaultValue:!0},noLoops:{defaultValue:!1},valenceElectrons:{defaultValue:[1,1,7,7]},bondEnergy:{defaultValue:{default:6,"0-0":4,"1-1":4,"2-2":4,"3-3":4}},activationEnergy:{defaultValue:{default:.2}},bondProbability:{defaultValue:{default:[.8,.15,.05]},validate:function(e){return Object.keys(e).forEach(function(t){var n=e[t];if(Math.abs(n[0]+n[1]+n[2]-1)>.001)throw new Error("Bond type probability values should sum to one.")}),e}}},image:{imageUri:{required:!0},imageX:{defaultValue:0,required:!0},imageY:{defaultValue:0,required:!0},imageHostType:{defaultValue:""},imageHostIndex:{defaultValue:0},imageLayer:{defaultValue:1},imageLayerPosition:{defaultValue:1},visible:{defaultValue:!0},rotation:{defaultValue:0},scale:{defaultValue:1},opacity:{defaultValue:1}},quantumDynamics:{elementEnergyLevels:{defaultValue:[]},photons:{defaultValue:{}},radiationlessEmissionProbability:{defaultValue:1},lightSource:{defaultValue:{on:!1,monochromatic:!0,frequency:1,radiationPeriod:1e3,numberOfBeams:10,angleOfIncidence:0}}},photon:{x:{serialize:!0},y:{serialize:!0},vx:{defaultValue:0,serialize:!0},vy:{defaultValue:0,serialize:!0},angularFrequency:{serialize:!0}}}}),define("models/md2d/models/engine/plugins/quantum-dynamics",["require","common/models/engines/clone-restore-wrapper","common/dispatch-support","../constants/index","../utils","arrays","common/array-types","models/md2d/models/metadata","common/validator"],function(e){function t(e,t){var i,_,x,w,C,T,S,A,k,P,E,O,M,L=u.validateCompleteness(l.quantumDynamics,t),N=new r("photonAbsorbed"),R=L.elementEnergyLevels,I=L.radiationlessEmissionProbability,D=0,B=L.lightSource,V=e.getDimensions(),j=[],F=0,z=function(){return g+(v-g)*Math.random()},G=function(){var e=x.x.length;x.excitation=a.create(e,0,s.int8Type)},$=function(e){var t=0;e.x&&(t=10*Math.ceil(e.x.length/10)),C={id:a.create(t,0,s.uint16Type),x:a.create(t,0,s.floatType),y:a.create(t,0,s.floatType),vx:a.create(t,0,s.floatType),vy:a.create(t,0,s.floatType),angularFrequency:a.create(t,0,s.floatType)}},U=[],q=0,H=function(e){if(e&&e.x){["x","y","vx","vy","angularFrequency"].forEach(function(t){a.copy(e[t],C[t])});for(var t=0;t<C.x.length;t++)(C.vx[t]||C.vy[t])&&(q++,C.id[t]=F++)}},W=function(){var t,n,r,i,o,a,s,l,u,c,d=e.getNumberOfAtoms();for(t=0,n=C.x.length;t<n;t++)if(C.vx[t]||C.vy[t])for(r=C.x[t],i=C.y[t],o=0;o<d&&(l=x.x[o]-r,u=x.y[o]-i,a=x.radius[o],s=a*a,!(l*l+u*u<s&&(c=Y(t,o),c===y)));o++);},Y=function(e,t){if(Math.random()<D)return b;var n=X(e,t);if(n!==!1&&n>0){ae(e);var r=n/c;return N.photonAbsorbed(r),y}},X=function(e,t){if(R){var n,r,i=R[x.element[t]],o=x.excitation[t],a=i[o],s=C.angularFrequency[e]*c;for(n=o+1,r=i.length;n<r;n++)if(Math.abs(i[n]-a-s)<d)return x.excitation[t]=n,j[t]=_,i[n]-a;return!1}},Q=function(t){var n,r,i,o,a,s,l,u,c,d,p,f,h,m,g,v,y,b=e.getNumberOfAtoms(),_=t.getList(),C=[];if(R){for(n=0;n<b;n++)for(c=x.x[n],d=x.y[n],i=t.getStartIdxFor(n),o=t.getEndIdxFor(n);i<o;i++)r=_[i],a=x.element[n],s=x.element[r],l=R[a],u=R[s],(l.length||u.length)&&(p=c-x.x[r],f=d-x.y[r],h=p*p+f*f,m=.55*(w.sigma[a]+w.sigma[s]),g=m*m,h>=g||(C[n]=r,U[n]!==r&&(v=K(n,r),v||(y=ne(n,r)),(v||y)&&(U[n]=r,U[r]=n))));for(n=0,o=U.length;n<o;n++)r=U[n],isNaN(r)||C[n]!==r&&C[r]!==n&&(delete U[n],delete U[r])}},K=function(e,t){var n,r;return T=e,S=t,r=Math.random()<.5?T:S,n=J(r),n||(n=J(T+S-r)),n},J=function(e){var t,n,r,i,o,a,s,l,u,c=R[x.element[e]];if(c){for(Z(),r=ee(),t=x.excitation[e],n=c[t],l=t+1,u=c.length;l<u&&(i=c[l]-n,!(r<i));l++)o=l;return!!o&&(o-=t,a=Math.ceil(Math.random()*o)+t,x.excitation[e]=a,j[e]=_,s=c[a]-n,te(s),!0)}},Z=function(){var e=x.x[S]-x.x[T],t=x.y[S]-x.y[T],n=1/Math.sqrt(e*e+t*t);O=e*n,M=t*n,A=x.vx[T]*O+x.vy[T]*M,P=x.vy[T]*O-x.vx[T]*M,k=x.vx[S]*O+x.vy[S]*M,E=x.vy[S]*O-x.vx[S]*M},ee=function(){var e=k-A,t=x.mass[T],n=x.mass[S];return.5*e*e*t*n/(t+n)},te=function(e){var t=x.mass[T],n=x.mass[S],r=t*A*A+n*k*k-e,i=t*A+n*k,o=(i-Math.sqrt(n/t*(r*(t+n)-i*i)))/(t+n),a=(i+Math.sqrt(t/n*(r*(t+n)-i*i)))/(t+n);x.vx[T]=o*O-P*M,x.vy[T]=o*M+P*O,x.vx[S]=a*O-E*M,x.vy[S]=a*M+E*O},ne=function(e,t){var n,r=x.excitation[e],i=x.excitation[t];if(T=e,S=t,!r&&!i)return!1;if(r)if(i){if(n=Math.random()<.5?T:S,!re(n)&&(n=T+S-n,!re(n)))return!1}else{if(!re(T))return!1;n=T}else{if(!re(S))return!1;n=S}return ie(n),!0},re=function(e){if(_>j[e]+h)return!0},ie=function(e){var t=R[x.element[e]],n=x.excitation[e],r=Math.floor(Math.random()*n),i=t[r]-t[n];x.excitation[e]=r,Math.random()<I?(Z(),te(i)):le(e,-i)},oe=function(){var e,t=C.x.length;if(q+1>t)return o.extendArrays(C,t+10),t;for(e=0;e<t;e++)if(!C.vx[e]&&!C.vy[e])return e},ae=function(e){q--,C.x[e]=C.y[e]=C.vx[e]=C.vy[e]=C.angularFrequency[e]=0},se=function(e,t,n,r){var i=Math.cos(n),o=Math.sin(n),a=p*i,s=p*o,l=r/c,u=oe();q++,C.id[u]=F++,C.x[u]=e,C.y[u]=t,C.vx[u]=a,C.vy[u]=s,C.angularFrequency[u]=l},le=function(e,t){var n=Math.random()*f-Math.PI,r=Math.cos(n),i=Math.sin(n),o=w.sigma[x.element[e]],a=x.x[e]+.51*o*r,s=x.y[e]+.51*o*i;se(a,s,n,t)},ue=function(e){var t,n,r,i;for(t=0,n=C.x.length;t<n;t++)(C.vx[t]||C.vy[t])&&(r=C.x[t]+=C.vx[t]*e,i=C.y[t]+=C.vy[t]*e,(r<V[0]||r>V[2]||i<V[1]||i>V[3])&&ae(t))},ce=function(t){if(R)for(var n=0,r=e.getNumberOfAtoms();n<r;n++)de(n,t)},de=function(e,t){if(0!==x.excitation[e]&&!(Math.random()>t*m)){var n,r,i,o=Math.random(),a=Math.random(),s=x.excitation[e],l=1/s;for(i=0;i<s;i++)if(i*l<=o&&o<(i+1)*l&&I<a)return n=R[x.element[e]],r=n[s]-n[i],x.excitation[e]=i,void le(e,r)}},pe=function(e){return e%=f,e<0||e>f?Math.abs(f-Math.abs(e)):e},fe=function(){var e,t,n,r,i,o,a,s,l,u=V[0],d=V[1],p=V[2]-u,f=V[3]-d,h=pe(B.angleOfIncidence),m=B.numberOfBeams,g=function(){return(B.monochromatic?B.frequency:z())*c};if(0==h)for(e=f/(m+1),l=1;l<=m;l++)se(u,d+e*l,h,g());else if(h.toFixed(4)==(Math.PI/2).toFixed(4))for(e=p/(m+1),l=1;l<=m;l++)se(u+e*l,d,h,g());else if(h.toFixed(4)==Math.PI.toFixed(4))for(e=f/(m+1),l=1;l<=m;l++)se(u+p,d+e*l,h,g());else if(h.toFixed(4)==(3*Math.PI/2).toFixed(4))for(e=p/(m+1),l=1;l<=m;l++)se(u+e*l,d+f,h,g());else if(t=Math.abs(Math.sin(h)),n=Math.abs(Math.cos(h)),r=t*f<n*p?f/n:p/t,e=r/m,i=e/t,o=e/n,a=Math.floor(p/i),s=Math.floor(f/o),h>=0&&h<.5*Math.PI){for(l=1;l<=a;l++)se(u+i*l,d,h,g());for(l=0;l<=s;l++)se(u,d+f-o*l,h,g())}else if(h>=3*Math.PI/2){for(l=1;l<=a;l++)se(u+i*l,d+f,h,g());for(l=0;l<=s;l++)se(u,d+o*l,h,g())}else if(h<Math.PI&&h>=.5*Math.PI){for(l=0;l<=a;l++)se(u+p-i*l,d,h,g());for(l=1;l<=s;l++)se(u+p,d+f-o*l,h,g())}else if(h>=Math.PI&&h<3*Math.PI/2){for(l=0;l<=a;l++)se(u+p-i*l,d+f,h,g());for(l=1;l<=s;l++)se(u+p,d+o*l,h,g())}};return i={initialize:function(e){x=e.atoms,w=e.elements,G(),$(L.photons),H(L.photons)},performActionWithinIntegrationLoop:function(e,t,n){_=n,ue(t),W(),Q(e),ce(t),B.on&&n%B.radiationPeriod<t&&fe()},turnOnLightSource:function(){B.on=!0},turnOffLightSource:function(){B.on=!1},setLightSourceAngle:function(e){B.angleOfIncidence=e},setLightSourceFrequency:function(e){B.frequency=e},setLightSourcePeriod:function(e){B.radiationPeriod=e},setLightSourceNumber:function(e){B.numberOfBeams=e},getPhotons:function(){return C},getNumPhotons:function(){return q},getViewPhotons:function(){function e(e,t){var n=e.vx[t],r=e.vy[t],i=-180*Math.atan2(r,n)/Math.PI;return{id:e.id[t],x:e.x[t],y:e.y[t],vx:n,vy:r,angle:i,angularFrequency:e.angularFrequency[t]}}var t=[],n=[];return function(){var r,i,o,a=this.getPhotons(),s=0;for(t.length=this.getNumPhotons(),n.length=a.x.length,r=0,i=a.x.length;r<i;r++)a.vx[r]||a.vy[r]?(o=n[r],o&&o.id===a.id[r]?(o.x=a.x[r],o.y=a.y[r]):(o=e(a,r),n[r]=o),t[s++]=o):n[r]=null;return t}}(),getElementEnergyLevels:function(){return R},getRadiationlessEmissionProbability:function(){return I},getLightSource:function(){if(B)return B},getState:function(){return[new n(C,{padArraysWithZeroes:!0}),{clone:function(){return{numPhotons:q}},restore:function(e){q=e.numPhotons}}]}},N.mixInto(i),i}var n=e("common/models/engines/clone-restore-wrapper"),r=e("common/dispatch-support"),i=e("../constants/index"),o=e("../utils"),a=e("arrays"),s=e("common/array-types"),l=e("models/md2d/models/metadata"),u=e("common/validator"),c=i.convert(.2,{from:i.unit.EV,to:i.unit.MW_ENERGY_UNIT}),d=i.convert(.05,{from:i.unit.EV,to:i.unit.MW_ENERGY_UNIT}),p=.002,f=2*Math.PI,h=200,m=1/h,g=2.5,v=14.5,y=1,b=2;return t.INFRARED=g,t.ULTRAVIOLET=v,t}),define("common/controllers/spectrometer-controller",["common/inherit","common/controllers/interactive-component","models/md2d/models/engine/plugins/quantum-dynamics"],function(){function e(e,t){n.call(this,"spectrometer",e,t),this.$element.addClass("interactive-spectrometer").css("border",this.component.border),this.lowerBound=this.component.lowerBound,this.upperBound=this.component.upperBound,this._existingPhotonMarks={},this.renderBackground(),this.renderTickMarks(),this.$photonMarksContainer=$("<div>").appendTo(this.$element)}var t=require("common/inherit"),n=require("common/controllers/interactive-component"),r=require("models/md2d/models/engine/plugins/quantum-dynamics"),i=r.INFRARED,o=r.ULTRAVIOLET,a=2,s="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASkAAAABCAYAAACCEVhtAAAAmUlEQVQ4T8WUwQ6DIBBEn1Wr+P/fCnjCbGuTLe4GbphMnH0ZhkiIUymlMOo5T0jpXzk/mWQ097zusnpihBXYgP1+i38rL/NPHteZVl72mYBXp3qzjdwJpErZYJLR3PO6y+qJnzskhxEqyQHUTGbNPa/XWT0HDPjQhe81EmnfM3vrWnzeYAmVdoNJRvPbrwFmI+/yY9RP4bnvBfEAd/7c+ytNAAAAAElFTkSuQmCC";return t(e,n),e.prototype.modelLoadedCallback=function(){e.superClass._modelLoadedCallback.call(this),this._model.onPhotonAbsorbed(this.onPhotonAbsorbed.bind(this)),this.component.clearOnModelLoad&&this.$photonMarksContainer.empty()},e.prototype.renderBackground=function(){var e=(i-this.lowerBound)/(this.upperBound-this.lowerBound)*100,t=(o-i)/(this.upperBound-this.lowerBound)*100;$("<img>").addClass("spectrometer-bg").attr("src",s).css("left",e+"%").css("width",t+"%").appendTo(this.$element)},e.prototype.renderTickMarks=function(){if(this.component.ticks&&!(this.component.ticks<2))for(var e=$("<div>").appendTo(this.$element),t=100/this.component.ticks,n=1;n<this.component.ticks;n++)$('<div class="tick-mark">').css("left",n*t+"%").appendTo(e)},e.prototype.onPhotonAbsorbed=function(e){if(!(e>this.upperBound||e<this.lowerBound)){var t=(e-this.lowerBound)/(this.upperBound-this.lowerBound)*100;this.photonMarkExists(t)||this.addPhotonMark(t)}},e.prototype.photonMarkExists=function(e){return!!this._existingPhotonMarks[e.toFixed(a)]},e.prototype.addPhotonMark=function(e){$('<div class="photon-mark">').css("left",e+"%").appendTo(this.$photonMarksContainer),this._existingPhotonMarks[e.toFixed(a)]=!0},e}),define("common/layout/detect-font-change",[],function(){function e(e){var t=document.createElement("canvas"),n=t.getContext("2d"),i=1.5*r;return t.width=i,t.height=i,n.font=e,n.fillText("A",0,i),t.toDataURL()}function t(e){window.clearInterval(a[e].pollingInterval),delete a[e]}function n(n,r,i){return a[n].bitmap=e(n),function(){return e(n)!==a[n].bitmap?(a[n].changeCallbacks.forEach(function(e){e()}),o[n]=!0,void t(n)):void(Date.now()-r>i&&t(n))}}var r=15,i={weight:"normal",timeout:3e3,interval:250,onchange:null},o={},a={};return function e(t){var s={};Object.keys(t).concat(Object.keys(i)).forEach(function(e){s[e]=null!=t[e]?t[e]:i[e]});var l=s.font.split(",");if(l.length>1){var u=!1;return l.forEach(function(t){s.font=t.trim(),e(s)&&(u=!0)}),u}var c=s.weight+" "+r+"px "+s.font;return!o[c]&&(a[c]||(a[c]={bitmap:null,pollingInterval:null,changeCallbacks:[]}),s.onchange&&a[c].changeCallbacks.push(s.onchange),a[c].pollingInterval||(a[c].pollingInterval=window.setInterval(n(c,Date.now(),s.timeout),s.interval)),!0)}}),define("common/views/numeric-output-view",["common/layout/detect-font-change"],function(){var e=require("common/layout/detect-font-change"),t=2;return function(n){function r(e){var n;m=e,g=l.height(),p.width(m),p.height(g),v=t*m,y=t*g,p.attr("width",v),p.attr("height",y),n=t*parseInt(l.css("font-size"),10),h.font=[l.css("font-style"),l.css("font-variant"),l.css("font-weight"),n+"px/"+l.css("line-height"),l.css("font-family")].join(" "),h.fillStyle=l.css("color"),h.textAlign="right",h.textBaseline="middle",f=y/2}function i(){var e=s.position();p.css({left:e.left+parseInt(l.css("padding-left"),10)+l.width()-m,top:e.top+parseInt(s.css("padding-top"),10)})}var o,a,s,l,u,c,d,p,f,h,m,g,v,y,b,_=n.id,x=n.label,w=n.unit,C=0;return b={update:function(e){e=null==e?"":""+e,c=e;var n=!1;C=Math.round(h.measureText(e).width/t),m<C&&(r(2*C),n=!0),Math.abs(l.width()-C)>5&&C>d&&(l.width(C),n=!0),n&&i(),h.clearRect(0,0,v,y),h.fillText(e,v,f)},updateLabel:function(e){a.html(e)},updateUnits:function(e){u.html(e)},hideUnits:function(){u.css("opacity",0)},showUnits:function(){u.css("opacity",1)},render:function(){return p=$("<canvas>").css("position","absolute"),h=p[0].getContext("2d"),o=$('<div class="numeric-output">'),a=$('<span class="label"></span>'),s=$('<span class="output"></span>'),l=$('<span class="value"> - </span>').css("opacity",0),u=$('<span class="units"></span>'),x&&a.html(x),w&&u.html(w),o.attr("id",_).append(a).append(s.append(p).append(l).append(u)),o},resize:function(){d=parseInt(l.css("min-width"),10)-parseInt(l.css("padding-left"),10)-parseInt(l.css("padding-right"),10),r(2*C),b.update(c),i(),e({font:h.font,onchange:function(){b.resize()}})}}}}),define("common/controllers/numeric-output-controller",["common/controllers/interactive-metadata","common/validator","common/controllers/help-icon-support","common/views/numeric-output-view"],function(){var e=require("common/controllers/interactive-metadata"),t=require("common/validator"),n=require("common/controllers/help-icon-support"),r=require("common/views/numeric-output-view");return function(i,o){function a(){var e=m.properties[s];c&&(e=c(e)),d.update(e)}var s,l,u,c,d,p,f,h,m,g;return m=o.getModel(),g=o.getScriptingAPI(),i=t.validateCompleteness(e.numericOutput,i),s=i.property,u=i.units,l=i.label,c=i.displayValue,d=new r({id:i.id,units:u,label:l}),p=d.render(),p.addClass("component"),p.addClass(i.orientation),p.css({width:i.width,height:i.height}),c&&(c=g.makeFunctionInScriptContext("value",c)),i.tooltip&&p.attr("title",i.tooltip),h={modelLoadedCallback:function(){m&&m.removeObserver(s,a),m=o.getModel(),g=o.getScriptingAPI(),s&&(f=m.getPropertyDescription(s),f&&(l||d.updateLabel(f.getLabel()),u||d.updateUnits(f.getUnitAbbreviation())),a(),m.addObserver(s,a))},getViewContainer:function(){return p},resize:function(){d.resize(),a()},serialize:function(){return $.extend(!0,{},i)}},n(h,i,o.helpSystem),h}}),define("common/views/table-view",[],function(){return function(e,t){function n(){var e,t;for(P.find("th").remove("th"),e=0;e<R.length;e++)t=$("<th>"),t.text(R[e].name),t.click(o),P.append(t)}function r(e,t,n){"undefined"!=typeof t&&null!==t?"string"==typeof t?e.text(t):"number"==typeof t&&e.text(I[n](t)):e.html("&nbsp;")}function i(){E.find("td").html(function(){var e=$(this),t=e.data("datum"),n=e.data("index");r(e,t,n)})}function o(e){var t,n=$(this),r="asc",i="desc";m(),t=r,n.hasClass(r)?(n.removeClass(r),n.addClass(i),t=i):n.hasClass(i)?(n.removeClass(i),n.addClass(r),t=r):(n.addClass(i),t=i),n.siblings().removeClass("sorted"),O=E.find("tr"),O.tsort("td:eq("+n.index()+")",{sortFunction:function(e,n){var i=Math.abs(parseFloat(e.s)),o=Math.abs(parseFloat(n.s));return t===r?i===o?0:i>o?1:-1:i===o?0:i<o?1:-1}}),n.addClass("sorted"),g(),e.preventDefault()}function a(){C=k.find("tr:first th").map(function(){return $(this).outerWidth()}),E.find("tr:first td").each(function(e){$(this).outerWidth(C[e])})}function s(e){return $(E.find("tr")).filter(function(){return $(this).data("index")===e})}function l(e){return e.data("index")}function u(e){var t=G.indexOf(e);if(t!==-1)return G.splice(t,1),s(e).removeClass("selected")}function c(e){var t;if(G.indexOf(e)===-1)return G.push(e),t=s(e),t.addClass("selected"),t}function d(){var e,t,n=[];for(e=0;e<G.length;e++)t=G[e],n.push([t,s(t).index()]);return n.sort(function(e,t){return e[1]-t[1]})}function p(){var e,t,n,r;for(t=d(),n=t[0],r=t[t.length-1],O=E.find("tr"),e=n[1];e<=r[1];e++)c($(O[e]).data("index"))}function f(){var e;for(e=0;e<G.length;e++)s(G[e]).removeClass("selected");G=[]}function h(e,t){var n,i,o,s;for(o=$('<tr class="data">'),$(o).data("index",t),n=0;n<R.length;n++)s=$("<td>"),$(s).data("index",n),i=e[n],s.data("datum",i),r(s,i,n),o.append(s);E.append(o),E.find("tr").length<2&&a()}function m(){E.find(".blank").remove()}function g(){if(m(),D){var e,t,n,r=E.find("tr").length;for(t=$('<tr class="data blank">'),$(t).data("index",r),e=0;e<R.length;e++)n=$("<td>"),$(n).data("index",e),n.html("&nbsp;"),t.append(n);E.append(t),E.find("tr").length<2&&a()}}function v(){E.scrollTop(99999999)}function y(e,t){var n;if(0===E.find("tr").length)return void w.appendDataRow(e,t);var i,o,a=$(E.find("tr")).filter(function(){return $(this).data("index")===t}),s=$(a).find("td"),l=s.length;for(o=0;o<e.length;o++)o<l&&(i=$(s[o]),n=e[o],i.data("datum",n),r(i,n,o))}function b(){M=E.position(),L=E.height()}function _(){var e=E.find("input");e.each(function(){var e=$(this).parent(),n=e.parent().data("index"),r=e.data("index"),i=$(this).val();!isNaN(parseFloat(i))&&isFinite(i)&&(i=parseFloat(i)),t.addDataToCell(n,r,i),e.empty().html(i)}),a(),b()}function x(e,n){var r,i,o,l=$(s(e).find("td")[n]),u=E.find("input");l&&R[n].editable&&!l.find("input").length&&(u.length&&_(),r=t.getDataInCell(e,n),i=$('<input class="editor-text">').val(r),l.empty().append(i),a(),i.bind("keydown",function(t){var r=t.keyCode?t.keyCode:t.which;if(13===r)_();else if(9===r)for(_(),o=n;++o<R.length;)if(R[o].editable){x(e,o);break}t.stopPropagation()}),i.on("blur",_),setTimeout(function(){i.focus()},0))}var w,C,T,S,A,k,P,E,O,M,L,N=e.id,R=e.columns,I=e.formatters,D=(e.visibleRows,e.showBlankRow),B=e.title,V=e.width,j=e.height,F=e.tooltip,z=e.klasses||[],G=[];return w={render:function(){var e,t;for(T=$("<div>"),A=$("<table>"),E=$("<tbody>"),P=$('<tr class="header">'),k=$("<thead>").append(P),A.append(k).append(E),n(),S=$("<div>").addClass("table-wrapper").append(A),T.attr("id",N),B&&(t=$("<div>").addClass("title").text(B),T.append(t)),T.append(S),e=0;e<z.length;e++)T.addClass(z[e]);return F&&T.attr("title",F),V&&T.css("width",V),j&&T.css("height",j),E.delegate("tr","click",function(e){var t=l($(e.currentTarget));e.shiftKey||e.metaKey||f(),c(t),e.shiftKey&&p()}),E.delegate("td","click",function(e){var t=$(e.currentTarget),n=t.parent().data("index"),r=t.data("index");x(n,r)}),b(),T},resize:function(){var e;A.height(S.height()),e=A.height()-k.outerHeight(!0),E.height(e-6),a(),b()},clear:function(){E.find(".data").remove()},appendDataRow:function(e,t){h(e,t),g(),v()},appendDataRows:function(e,t){var n=t;e.forEach(function(e){h(e,n++)}),g(),v()},removeDataRows:function(e){var t=E.find("tr").filter(function(){var t=$(this).data("index");return t>=e});t.remove(),g()},replaceDataRow:y,removeSelection:u,addSelection:c,clearSelection:f,updateTable:function(e){R=e.columns||R,I=e.formatters||I,n(),i(),a(),b()}}}}),define("common/controllers/table-controller",["require","common/controllers/interactive-metadata","common/validator","common/views/table-view","common/listening-pool","common/controllers/data-set","common/controllers/help-icon-support"],function(e){var t=e("common/controllers/interactive-metadata"),n=e("common/validator"),r=e("common/views/table-view"),i=e("common/listening-pool"),o=e("common/controllers/data-set"),a=e("common/controllers/help-icon-support"),s=0;return function(e,l){function u(){S=l.getModel(),e=n.validateCompleteness(t.table,e),R=e.propertyColumns.slice();for(var o=0;o<R.length;o++)R[o].name&&(R[o]=R[o].name);k=new i(I),c(),d(),O=0,N=$.extend(!0,[],e.headerData),P=new r({id:e.id,title:e.title,columns:M,formatters:L,visibleRows:e.visibleRows,showBlankRow:e.showBlankRow,width:e.width,height:e.height,tooltip:e.tooltip,klasses:["interactive-table","component"]},T),E=P.render(),a(T,e,l.helpSystem),A.resetData()}function c(){A=e.dataSet?l.getDataSet(e.dataSet):new o({name:e.id+"-autoDataSet",properties:R.slice(),xProperty:e.xProperty,initialData:e.tableData,streamDataFromModel:e.streamDataFromModel,clearOnModelReset:e.clearOnModelReset},l,!0),k.listen(A,o.Events.SAMPLE_ADDED,b),k.listen(A,o.Events.SAMPLE_CHANGED,_),k.listen(A,o.Events.DATA_RESET,x),k.listen(A,o.Events.DATA_TRUNCATED,w),k.listen(A,o.Events.SELECTION_CHANGED,h)}function d(){var t,n,r,i,o,a,s,l;for(M=[],L=[],e.indexColumn&&(M.push({name:"#",editable:!1}),L.push(d3.format("f"))),t=0;t<e.propertyColumns.length;t++)o=null,s=!1,l=".3r",r="string"==typeof e.propertyColumns[t]?{name:e.propertyColumns[t]}:e.propertyColumns[t],"undefined"!=typeof S&&(n=r.name,S.properties.hasOwnProperty(n)&&(i=S.getPropertyDescription(n),i&&(o=i.getLabel(),a=i.getUnitAbbreviation(),a&&(o+=" ("+a+")")))),o||(o=r.name,r.units&&(o+=" ("+r.units+")"),s=!r.hasOwnProperty("editable")||r.editable,l=r.hasOwnProperty("format")?r.format:l),M.push({name:o,editable:s}),L.push(d3.format(l))}function p(){d(),P.updateTable({columns:M,formatters:L})}function f(){A.appendDataPoint()}function h(t){var n=t.data;if(e.addNewRows)P.clearSelection(),P.addSelection(n);else{var r=A.getData();P.replaceDataRow(g(r,n),0)}}function m(t,n){var r=[];return e.indexColumn&&(null==n&&(n=O),r.push(n)),R.forEach(function(e){r.push(t[e])}),r}function g(t,n){var r=[];return e.indexColumn&&r.push(n),R.forEach(function(e){r.push(t[e][n])}),r}function v(t){for(var n=e.indexColumn?1:0,r=t.length;n<r;n++)if(null!=t[n])return!1;return!0}function y(t){var n=m(t);v(n)||(e.addNewRows?(P.appendDataRow(n,O),O++):(P.replaceDataRow(n,0),O++))}function b(e){y(e.data)}function _(t){var n=t.data.index,r=m(t.data.dataPoint,n);e.addNewRows?P.replaceDataRow(r,n):P.replaceDataRow(r,0)}function x(t){var n,r=t.data,i=A.maxLength(R);if(e.addNewRows){var o=[];for(O=0;O<i;O++)o.push(g(r,O));P.clear(),P.appendDataRows(o,0)}else n=g(r,i-1),P.replaceDataRow(n,0),O=i}function w(t){var n=A.maxLength(R);O=n,e.addNewRows?P.removeDataRows(n):P.replaceDataRow(g(t.data,n-1),0)}function C(){}var T,S,A,k,P,E,O,M,L,N,R,I="tableController"+ ++s;return T={modelLoadedCallback:function(){S=l.getModel(),C(),p()},resize:function(){P&&P.resize()},getData:function(e){var t=A.getData(),n={};return e.forEach(function(e){n[e]=t[e]}),n},appendDataPropertiesToComponent:f,addDataToCell:function(t,n,r){e.indexColumn&&n--;var i=R[n];if(t===O){if(""===r)return;var o={};return o[i]=r,void A.appendDataPoint(R,o)}A.editDataPoint(t,i,r)},getDataInCell:function(t,n){e.indexColumn&&n--;var r=R[n];return A.getPropertyValue(t,r)},getViewContainer:function(){return E},getView:function(){return P},serialize:function(){var t=$.extend(!0,{},e);return t.headerData=M,e.dataSet||(t.tableData=A.serializeData()),t}},u(),T}}),define("common/benchmark/browser-detect",[],function(){function e(){var e=navigator.userAgent.match(/\(([^)]+)\).*/);if(!e)return"na";var n=e[1],r=n.split("; ");if("Macintosh"===r[0])return r[1];if(r[0].match(/^Windows/)){var i=navigator.userAgent.match(/\(.*?(Windows NT.+?)[;)]/),o="";return n.match(/WOW64/)?o="64/32":n.match(/Win64; IA64/)?o="64":n.match(/Win64; x64/)&&(o="64"),t[i[1]]+"/"+o}return r[0].match(/^X11/)?r.join("/"):"na"}var t={"Windows NT 6.2":"Windows 8","Windows NT 6.1":"Windows 7","Windows NT 6.0":"Windows Vista","Windows NT 5.2":"Windows Server 2003; Windows XP x64 Edition","Windows NT 5.1":"Windows XP","Windows NT 5.01":"Windows 2000, Service Pack 1 (SP1)","Windows NT 5.0":"Windows 2000","Windows NT 4.0":"Microsoft Windows NT 4.0"};return{isMobile:function(e){return/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|ipad|android|playbook|silk|iris|kindle|lge |maemo|midp|mmp|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows (ce|phone)|xda|xiino/i.test(e)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(e.substr(0,4))}(navigator.userAgent||navigator.vendor||window.opera),what_browser:function(){var n,r=/ (Chrome)\/(.*?) /,i=/ (Firefox)\/([0123456789ab.]+)/,o=/ AppleWebKit\/([0123456789.+]+) \(KHTML, like Gecko\) Version\/([0123456789.]+) (Safari)\/([0123456789.]+)/,a=/ (MSIE) ([0123456789.]+);/,s=/^(Opera)\/.+? Version\/([0123456789.]+)$/,l=/.+?\((iPhone); CPU.+?OS .+?Version\/([0123456789._]+)/,u=/.+?\((iPad); CPU.+?OS .+?Version\/([0123456789._]+)/,c=/.+?\((iPod); CPU (iPhone.+?) like.+?Version\/([0123456789ab._]+)/,d=/.+?(Android) ([0123456789.]+).*?; (.+?)\).+? Chrome\/([0123456789.]+)/,p=/.+?(Android.+?\)).+? Firefox\/([0123456789.]+)/,f=/.+?(Android) ([0123456789ab.]+).*?; (.+?)\)/;if(n=navigator.userAgent.match(d),n&&n[1])return{browser:"Chrome for Android",version:n[4],oscpu:n[1]+"/"+n[2]+"/"+n[3]};if(n=navigator.userAgent.match(r),n&&n[1])return{browser:n[1],version:n[2],oscpu:e()};if(n=navigator.userAgent.match(i),n&&n[1]){var h=navigator.buildID,m="";return h&&h.length>=8&&(m="("+h.slice(0,4)+"-"+h.slice(4,6)+"-"+h.slice(6,8)+")"),{browser:n[1],version:n[2]+" "+m,oscpu:e()}}if(n=navigator.userAgent.match(p),n&&n[1])return{browser:"Firefox",version:n[2],oscpu:n[1]};if(n=navigator.userAgent.match(f),n&&n[1])return{browser:"Android",version:n[2],oscpu:n[1]+"/"+n[2]+"/"+n[3]};if(n=navigator.userAgent.match(o),n&&n[3])return{browser:n[3],version:n[2]+"/"+n[1],oscpu:e()};if(n=navigator.userAgent.match(a),n&&n[1]){var g=navigator.userAgent.match(/\(.*?(Windows.+?); (.+?)[;)].*/);return{browser:n[1],version:n[2],oscpu:t[g[1]]+"/"+navigator.cpuClass+"/"+navigator.platform}}return n=navigator.userAgent.match(s),n&&n[1]?{browser:n[1],version:n[2],oscpu:e()}:(n=navigator.userAgent.match(l),n&&n[1]?{browser:"Mobile Safari",version:n[2],oscpu:n[1]+"/iOS/"+n[2]}:(n=navigator.userAgent.match(u),n&&n[1]?{browser:"Mobile Safari",version:n[2],oscpu:n[1]+"/iOS/"+n[2]}:(n=navigator.userAgent.match(c),n&&n[1]?{browser:"Mobile Safari",version:n[3],oscpu:n[1]+"/iOS/"+n[2]}:{browser:"",version:navigator.appVersion,oscpu:""})))}}}),define("common/benchmark/benchmark",["require","./browser-detect"],function(e){function t(e,t,n){function r(t){var n=e.getElementsByTagName("tr")[0],r=n.appendChild(document.createElement("th"));r.innerHTML=t,m[t]=h++}function o(t){t=t||0;var n,r=e.appendChild(document.createElement("tr"));for(n=0;n<t;n++)r.appendChild(document.createElement("td"));return r}function a(e,t,n){var r;n=n||l,r=n.getElementsByTagName("td")[m[e]],"string"==typeof t&&"<"===t.slice(0,1)?r.innerHTML=t:r.textContent=t}function s(){function e(e){return Math.floor(e)===e}var n,r,o,a,s,l,u,c,d=g.length,p=i.getElementsByTagName("td"),f=d3.format("5.1f"),h=d3.format("f");for(n=0;n<t.length;n++)if(o=t[n],l=m[o.name],o.numeric===!1)a=g[2],s=a.getElementsByTagName("td")[l],p[l].innerHTML=s.innerHTML;else{for(u=0,r=2;r<d;r++)a=g[r],s=a.getElementsByTagName("td")[l],u+=+s.textContent;c=u/(d-2),c=o.formatter?o.formatter(c):e(c)?h(u/(d-2)):f(u/(d-2)),p[l].textContent=c}}var l,u,c,d,p,f=0,h=0,m={},g=e.getElementsByTagName("tr");if(e.style.display="",0===g.length){for(o(),r("browser"),r("version"),r("cpu/os"),r("date"),r("commit"),r("branch"),f=0;f<t.length;f++)r(t[f].name);i=o(h),i.className="average"}else for(c=g[0],d=c.getElementsByTagName("th"),f=0,p=d.length;f<p;f++)m[d[f].innerHTML]=h++;for(l=o(h),l.className="sample",f=0;f<6;f++)u=n[f],a(u[0],u[1]),a(u[0],u[1],i);for(f=6;f<n.length;f++)u=n[f],a(u[0],u[1]);s()}function n(e,t,n,r){function i(e){function n(n){e.formatter?l.push([e.name,e.formatter(n)]):l.push([e.name,n]),s.length>0?i(s.shift()):(r&&r(),t&&t(l))}e.run(n)}var o,s=e.slice(),l=[],u=a(),c=d3.time.format("%Y-%m-%d %H:%M");return l.push(["browser",u.browser]),l.push(["version",u.version]),l.push(["cpu/os",u.oscpu]),l.push(["date",c(new Date)]),o="<a href='"+Lab.version.repo.commit.url+"' class='opens-in-new-window' target='_blank'>"+Lab.version.repo.commit.short_sha+"</a>",Lab.version.repo.dirty&&(o+=" <i>dirty</i>"),l.push(["commit",o]),l.push(["branch",Lab.version.repo.branch]),n&&n(),i(s.shift()),l}function r(e,r,i,o,a){var s;return n(e,function(n){t(r,e,n),i(n)},o,a),s}var i,o=e("./browser-detect"),a=o.what_browser,s=o.isMobile,l=o.what_browser();return{get browser(){return l},what_browser:function(){return l=a()},get isMobile(){return s},run:function(e,t,n,i,o){r(e,t,n,i,o)},bench:function(e,t,r,i){return n(e,t,r,i)},renderToTable:function(e,n,r){t(e,n,r)}}}),define("common/url-helper",["require","lab.version","lab.config"],function(e){var t=e("lab.version"),n=e("lab.config"),r=function(e,t,n){return e.length>0?e+"&"+t+"="+n:"?"+t+"="+n};return{getVersionedUrl:function(){if(n.versionedHome&&t.repo.last_tag)return n.versionedHome(t.repo.last_tag);var e=window.location.host,i=window.location.pathname,o=window.location.search,a=window.location.protocol;return o=r(o,"show_data_warning","true"),a+"//"+e+i+o}}}),define("common/controllers/parent-message-api",["require","common/benchmark/benchmark","common/url-helper","iframe-phone"],function(e){var t=e("common/benchmark/benchmark"),n=e("common/url-helper"),r=e("iframe-phone");return function(e){function i(e){s.post("propertyValue",{name:e,value:a.get(e)})}function o(t){s.post("dataset",{name:t,value:e.getDataSet(t).serialize()})}var a,s=r.getIFrameEndpoint();s.addListener("setFocus",function(){var t=e.modelController.modelContainer;t&&t.setFocus&&t.setFocus()}),s.addListener("getLearnerUrl",function(){s.post("setLearnerUrl",n.getVersionedUrl())}),s.addListener("loadInteractive",function(t){e&&e.loadInteractive&&e.loadInteractive(t)}),s.addListener("loadModel",function(t){e&&e.loadModel&&e.loadModel(t.modelId,t.modelObject)}),s.addListener("getModelState",function(){e&&e.modelController&&s.post("modelState",e.modelController.state())}),s.addListener("getInteractiveState",function(){e&&e.modelController&&s.post("interactiveState",e.serialize());
}),s.addListener("runBenchmarks",function(){var n,r;e&&e.modelController&&(n=e.modelController,r=e.benchmarks.concat(n.benchmarks),t.bench(r,function(e){console.log(e),s.post("returnBenchmarks",{results:e,benchmarks:r})}))}),s.addListener("listenForDispatchEvent",function(e){var t=e.eventName,n=e.properties,r={},i=0,o=null;a.on(t,function(){if(n)for(i=0;i<n.length;i++)o=n[i],r[o]=a.get(o);s.post(t,r)})});var l=!0;return s.addListener("listenForDatasetEvent",function(t){var n=t.eventName,r=t.datasetName,i=e.getDataSet(r);i&&(console.log("registering listener on "+r+": "+n),i.on(n,function(e){l&&s.post(r+"-"+n,e)}))}),s.addListener("sendDatasetEvent",function(t){var n=t.eventName,r=t.datasetName,i=t.data,o=e.getDataSet(r);o&&(l=!1,o.handleExternalEvent(n,i),l=!0)}),s.addListener("removeListenerForDispatchEvent",function(e){a.on(e,null)}),s.addListener("getDataset",function(e){o(e)}),s.addListener("get",function(e){i(e)}),s.addListener("observe",function(e){a.addPropertiesListener(e,function(){i(e)}),i(e)}),s.addListener("set",function(e){a.set(e.name,e.value)}),s.addListener("tick",function(e){a.tick(Number(e))}),s.addListener("play",function(){a.start()}),s.addListener("stop",function(){a.stop()}),s.addListener("reloadModel",function(){e.reloadModel()}),s.addListener("reloadInteractive",function(){e.reloadInteractive()}),s.initialize(),e.on("modelLoaded.parentMessageAPI",function(){s.post("modelLoaded")}),{bindModel:function(e){a=e}}}}),function(e,t){if("object"==typeof exports&&exports)t(exports);else{var n={};t(n),"function"==typeof define&&define.amd?define("mustache",n):e.Mustache=n}}(this,function(e){function t(e,t){return _.call(e,t)}function n(e){return!t(g,e)}function r(e){return"function"==typeof e}function i(e){return e.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")}function o(e){return String(e).replace(/[&<>"'\/]/g,function(e){return C[e]})}function a(e){this.string=e,this.tail=e,this.pos=0}function s(e,t){this.view=null==e?{}:e,this.parent=t,this._cache={".":this.view}}function l(){this.clearCache()}function u(t,n,i,o){function a(e){return n.render(e,i)}for(var s,l,c,d="",p=0,f=t.length;p<f;++p)switch(s=t[p],l=s[1],s[0]){case"#":if(c=i.lookup(l),"object"==typeof c||"string"==typeof c)if(w(c))for(var h=0,m=c.length;h<m;++h)d+=u(s[4],n,i.push(c[h]),o);else c&&(d+=u(s[4],n,i.push(c),o));else if(r(c)){var g=null==o?null:o.slice(s[3],s[5]);c=c.call(i.view,g,a),null!=c&&(d+=c)}else c&&(d+=u(s[4],n,i,o));break;case"^":c=i.lookup(l),(!c||w(c)&&0===c.length)&&(d+=u(s[4],n,i,o));break;case">":c=n.getPartial(l),r(c)&&(d+=c(i));break;case"&":c=i.lookup(l),null!=c&&(d+=c);break;case"name":c=i.lookup(l),null!=c&&(d+=e.escape(c));break;case"text":d+=l}return d}function c(e){for(var t,n=[],r=n,i=[],o=0,a=e.length;o<a;++o)switch(t=e[o],t[0]){case"#":case"^":i.push(t),r.push(t),r=t[4]=[];break;case"/":var s=i.pop();s[5]=t[2],r=i.length>0?i[i.length-1][4]:n;break;default:r.push(t)}return n}function d(e){for(var t,n,r=[],i=0,o=e.length;i<o;++i)t=e[i],t&&("text"===t[0]&&n&&"text"===n[0]?(n[1]+=t[1],n[3]=t[3]):(n=t,r.push(t)));return r}function p(e){return[new RegExp(i(e[0])+"\\s*"),new RegExp("\\s*"+i(e[1]))]}function f(t,r){function o(){if(A&&!k)for(;S.length;)delete T[S.pop()];else S=[];A=!1,k=!1}if(t=t||"",r=r||e.tags,"string"==typeof r&&(r=r.split(m)),2!==r.length)throw new Error("Invalid tags: "+r.join(", "));for(var s,l,u,f,g,_,x=p(r),w=new a(t),C=[],T=[],S=[],A=!1,k=!1;!w.eos();){if(s=w.pos,u=w.scanUntil(x[0]))for(var P=0,E=u.length;P<E;++P)f=u.charAt(P),n(f)?S.push(T.length):k=!0,T.push(["text",f,s,s+1]),s+=1,"\n"==f&&o();if(!w.scan(x[0]))break;if(A=!0,l=w.scan(b)||"name",w.scan(h),"="===l?(u=w.scanUntil(v),w.scan(v),w.scanUntil(x[1])):"{"===l?(u=w.scanUntil(new RegExp("\\s*"+i("}"+r[1]))),w.scan(y),w.scanUntil(x[1]),l="&"):u=w.scanUntil(x[1]),!w.scan(x[1]))throw new Error("Unclosed tag at "+w.pos);if(g=[l,u,s,w.pos],T.push(g),"#"===l||"^"===l)C.push(g);else if("/"===l){if(_=C.pop(),!_)throw new Error('Unopened section "'+u+'" at '+s);if(_[1]!==u)throw new Error('Unclosed section "'+_[1]+'" at '+s)}else if("name"===l||"{"===l||"&"===l)k=!0;else if("="===l){if(r=u.split(m),2!==r.length)throw new Error("Invalid tags at "+s+": "+r.join(", "));x=p(r)}}if(_=C.pop())throw new Error('Unclosed section "'+_[1]+'" at '+w.pos);return c(d(T))}var h=/\s*/,m=/\s+/,g=/\S/,v=/\s*=/,y=/\s*\}/,b=/#|\^|\/|>|\{|&|=|!/,_=RegExp.prototype.test,x=Object.prototype.toString,w=Array.isArray||function(e){return"[object Array]"===x.call(e)},C={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"};a.prototype.eos=function(){return""===this.tail},a.prototype.scan=function(e){var t=this.tail.match(e);if(t&&0===t.index){var n=t[0];return this.tail=this.tail.substring(n.length),this.pos+=n.length,n}return""},a.prototype.scanUntil=function(e){var t,n=this.tail.search(e);switch(n){case-1:t=this.tail,this.tail="";break;case 0:t="";break;default:t=this.tail.substring(0,n),this.tail=this.tail.substring(n)}return this.pos+=t.length,t},s.make=function(e){return e instanceof s?e:new s(e)},s.prototype.push=function(e){return new s(e,this)},s.prototype.lookup=function(e){var t;if(e in this._cache)t=this._cache[e];else{for(var n=this;n;){if(e.indexOf(".")>0){t=n.view;for(var i=e.split("."),o=0;null!=t&&o<i.length;)t=t[i[o++]]}else t=n.view[e];if(null!=t)break;n=n.parent}this._cache[e]=t}return r(t)&&(t=t.call(this.view)),t},l.prototype.clearCache=function(){this._cache={},this._partialCache={}},l.prototype.compile=function(t,n){var r=this._cache[t];if(!r){var i=e.parse(t,n);r=this._cache[t]=this.compileTokens(i,t)}return r},l.prototype.compilePartial=function(e,t,n){var r=this.compile(t,n);return this._partialCache[e]=r,r},l.prototype.getPartial=function(e){return e in this._partialCache||!this._loadPartial||this.compilePartial(e,this._loadPartial(e)),this._partialCache[e]},l.prototype.compileTokens=function(e,t){var n=this;return function(i,o){if(o)if(r(o))n._loadPartial=o;else for(var a in o)n.compilePartial(a,o[a]);return u(e,n,s.make(i),t)}},l.prototype.render=function(e,t,n){return this.compile(e)(t,n)},e.name="mustache.js",e.version="0.7.3",e.tags=["{{","}}"],e.Scanner=a,e.Context=s,e.Writer=l,e.parse=f,e.escape=o;var T=new l;e.clearCache=function(){return T.clearCache()},e.compile=function(e,t){return T.compile(e,t)},e.compilePartial=function(e,t,n){return T.compilePartial(e,t,n)},e.compileTokens=function(e,t){return T.compileTokens(e,t)},e.render=function(e,t,n){return T.render(e,t,n)},e.to_html=function(t,n,i,o){var a=e.render(t,n,i);return r(o)?void o(a):a}}),define("text!common/controllers/thermometer.tpl",[],function(){return'<div class="interactive-thermometer component" id="{{id}}">\n  <div class="thermometer-main-container">\n    <div class="thermometer">\n      <div class="thermometer-fill"></div>\n    </div>\n    <p class="label">{{labelText}}</p>\n  </div>\n  <div class="labels-container">\n    {{#labels}}\n      <span class="value-label" style="bottom: {{position}}">{{label}}</span>\n    {{/labels}}\n  </div>\n</div>'}),define("common/controllers/thermometer-controller",["require","mustache","text!common/controllers/thermometer.tpl","common/controllers/interactive-metadata","common/validator","common/jquery-plugins"],function(e){var t=e("mustache"),n=e("text!common/controllers/thermometer.tpl"),r=e("common/controllers/interactive-metadata"),i=e("common/validator");return e("common/jquery-plugins"),function(e,o){function a(){var a,y,_,x,w,C,T,S,A,k,P,E;for(b=o.getModel(),e=i.validateCompleteness(r.thermometer,e),a=e.reading,s=a.units,y=a.offset,_=a.scale,l=a.digits,k=e.min,A=e.max,u=function(e){return _*e+y},c=function(e){return(e-k)/(A-k)*100+"%"},d=e.labelIsReading,w=d?"":"Thermometer",x={id:e.id,labelText:d?"":"Thermometer"},C=e.labels,S=-(1/0),x.labels=[],P=0,E=C.length;P<E;P++)x.labels.push({label:C[P].label,position:c(u(C[P].value))}),C[P].label.length>S&&(S=C[P].label.length,T=P);f=$(t.render(n,x)),h=f.find(".thermometer"),m=f.find(".thermometer-fill"),g=f.find(".label"),v=f.find(".labels-container"),S=f.measure(function(){return this.width()/parseFloat(this.css("font-size"))+"em"},".value-label:eq("+T+")",o.interactiveContainer),v.css("width",S),f.css("height",e.height),p=!1,/%$/.test(e.width)?(f.css("width",e.width),p=!0):h.css("width",e.width)}var s,l,u,c,d,p,f,h,m,g,v,y,b,_=function(e){e=u(e),g.text(e.toFixed(l)+" "+s)},x=function(){var e=b.get("targetTemperature");m.css("height",c(u(e))),d&&_(e)};return y={modelLoadedCallback:function(){b&&b.removeObserver("targetTemperature",x),b=o.getModel(),b.addPropertiesListener("targetTemperature",x),x()},getViewContainer:function(){return f},resize:function(){var e=f.height()-g.height();h.height(e),v.height(e),p&&h.width(f.width()-v.width())},serialize:function(){return e}},a(),y}}),define("common/controllers/playback-controller",["require","common/inherit","common/layout/detect-font-change","common/controllers/interactive-component","common/views/select-box-view","underscore"],function(e){function t(e){e.attr("disabled",!0).addClass("lab-disabled").css("cursor","default")}function n(e){e.attr("disabled",!1).removeClass("lab-disabled").css("cursor","pointer")}function r(e,r){e?n(r):t(r)}function i(e,t){r(!e,t)}function o(e,t){l.call(this,"playback",e,t),this.$element.addClass("interactive-playback"),this._modelStopped=!0,this._modelPlayable=!0,this._modelHasPlayed=!1,this._dataAreAvailableForExport=!1,this._timeDesc=null,this._model=null,this._scriptingAPI=null,this._interactivesController=t,this._fontSpec="bold 2em "+t.fontFamily,s({font:t.fontFamily,onchange:this._updateClockVisibility.bind(this)})}var a=e("common/inherit"),s=e("common/layout/detect-font-change"),l=e("common/controllers/interactive-component"),u=e("common/views/select-box-view"),c=e("underscore");a(o,l);var d={video:{createControls:function(){var e=this._scriptingAPI,t=this._interactivesController.i18n;this.$element.empty(),this.$element.removeClass("text").addClass("video"),this._$reset=$('<button class="reset"><i class="icon-step-backward"></i></button>').appendTo(this.$element),this._$playPause=$('<button class="play-pause"><i class="icon-play"></i><i class="icon-pause"></i></button>').appendTo(this.$element),this._$timeDisplay=$('<span class="time-display">').appendTo(this._$playPause),this._$timeCanvas=$("<canvas>").appendTo(this._$timeDisplay),this._timeCtx=this._$timeCanvas[0].getContext("2d"),this._$stepBackward=$('<button class="step"><i class="icon-backward"></i></button>').insertBefore(this._$playPause),this._$stepForward=$('<button class="step"><i class="icon-forward"></i></button>').insertAfter(this._$playPause),this._$reset.after('<div class="spacer reset">'),this._$stepBackward.after('<div class="spacer step">'),this._$stepForward.before('<div class="spacer step">'),this._$reset.on("click",e.reloadModel),this._$playPause.on("click",function(){this._modelStopped?this._modelPlayable&&e.start():e.stop()}.bind(this)),this._$stepBackward.on("click",e.stepBack),this._$stepForward.on("click",e.stepForward),this._$playPause.attr("title",t.t("banner.video_play_pause_tooltip")),this._$reset.attr("title",t.t("banner.video_reset_tooltip")),this._$stepBackward.attr("title",t.t("banner.video_step_back_tooltip")),this._$stepForward.attr("title",t.t("banner.video_step_forward_tooltip"))},updateButtonStates:function(e,t){var n=!e;this._$playPause.toggleClass("playing",n),i(e&&!t,this._$playPause)},updateControlButtonChoices:function(e){var t;e?"play"===e?(this.$element.find(".play-pause").removeClass("hidden"),this.$element.find(".spacer, .step, .reset").addClass("hidden")):"reset"===e?(this.$element.find(".reset").removeClass("hidden"),this.$element.find(".spacer, .play-pause, .step").addClass("hidden")):"play_reset"===e?(this.$element.find(".spacer, .play-pause, .reset").removeClass("hidden"),this.$element.find(".step").addClass("hidden")):"play_reset_step"===e&&this.$element.find(".spacer, .step, .reset, .play-pause").removeClass("hidden"):this.$element.find(".step, .reset, .play-pause").addClass("hidden"),t=this.$element.find("button"),t.removeClass("first"),t.removeClass("last"),t=t.not(".hidden"),t.first().addClass("first"),t.last().addClass("last")},setClockVisibility:function(e){e?(this._$playPause.addClass("with-clock"),this._timeDesc=this._model.getPropertyDescription("displayTime"),this._timeChanged()):this._$playPause.removeClass("with-clock")},setClockValue:function(e){this._timeCtx.clearRect(0,0,this._canvWidth,this._canvHeigth),this._timeCtx.fillText(this._timeDesc.format(e),this._canvWidth,.85*this._canvHeigth)}},text:{createControls:function(){var e=this._scriptingAPI,t=this._interactivesController.i18n;this.$element.empty(),this.$element.removeClass("video").addClass("text"),this._$start=$('<button class="start">').text(t.t("banner.text_start")).appendTo(this.$element),this._$stop=$('<button class="stop">').text(t.t("banner.text_stop")).appendTo(this.$element),this._$reset=$('<button class="reset">').text(t.t("banner.text_reset")).appendTo(this.$element),this._$reset.on("click",e.reloadModel),this._$start.on("click",e.start),this._$stop.on("click",e.stop),this._$start.attr("title",t.t("banner.text_start_tooltip")),this._$stop.attr("title",t.t("banner.text_stop_tooltip")),this._$reset.attr("title",t.t("banner.text_reset_tooltip"))},updateButtonStates:function(e,t){i(e,this._$stop),r(t,this._$start)},updateControlButtonChoices:function(e){if(e)if("play"===e)this.$element.find(".start, .stop").removeClass("hidden"),this.$element.find(".reset").addClass("hidden");else if("reset"===e)this.$element.find(".reset").removeClass("hidden"),this.$element.find(".start, .stop").addClass("hidden");else{if("play_reset"!==e)throw new Error('controlButtons option "'+e+'" is not understood or is not compatible with controlButtonStyle "text"');this.$element.find(".start, .stop, .reset").removeClass("hidden")}else this.$element.find(".reset, .start, .stop").addClass("hidden")},setClockVisibility:function(){},setClockValue:function(){}},codap:{createControls:function(){var e=this._scriptingAPI,n=this._interactivesController.i18n;this.$element.removeClass("video").addClass("text wide"),this.$element.empty(),this._$start=$('<button class="start">').text(n.t("banner.text_start")).attr("title",n.t("banner.text_start_tooltip")).appendTo(this.$element),this._$stop=$('<button class="stop">').text(n.t("banner.text_stop")).attr("title",n.t("banner.text_start_tooltip")).appendTo(this.$element),this._$analyzeData=$('<button class="analyze-data">').text(n.t("banner.text_analyze_data")).attr("title",n.t("banner.text_analyze_data_tooltip")).appendTo(this.$element),this._$newRun=$('<button class="new-run">').text(n.t("banner.text_new_run")).attr("title",n.t("banner.text_new_run_tooltip")).appendTo(this.$element),this._$start.on("click",e.start),this._$stop.on("click",e.stop),this._$analyzeData.on("click",function(){e.exportData(),this._dataAreAvailableForExport=e.dataAreAvailableForExport(),this._dataAreAvailableForExport||t($(this))}),this._$newRun.on("click",function(){e.reloadModel({cause:"new-run"})})},updateButtonStates:function(e,t,n,o){i(n,this._$start),i(e,this._$stop),r(n&&e,this._$newRun),r(o,this._$analyzeData)},updateControlButtonChoices:function(e){e&&e.indexOf("play")>=0?(this._$start.show(),this._$stop.show(),e.indexOf("reset")>=0?this._$newRun.show():this._$newRun.hide()):(this._$start.hide(),this._$stop.hide(),this._$newRun.hide())},setClockVisibility:function(){},setClockValue:function(){}}};return o.prototype._createControls=function(){this._controlButtonMethods.createControls.apply(this,arguments),this._updateButtonStates(),this._fitButtons()},o.prototype._updateButtonStates=function(){this._controlButtonMethods.updateButtonStates.call(this,this._modelStopped,this._modelPlayable,this._modelHasPlayed,this._dataAreAvailableForExport)},o.prototype._updateControlButtonChoices=function(){this._controlButtonMethods.updateControlButtonChoices.apply(this,arguments),this._fitButtons()},o.prototype._setClockVisibility=function(){this._controlButtonMethods.setClockVisibility.apply(this,arguments)},o.prototype._setClockValue=function(){this._controlButtonMethods.setClockValue.apply(this,arguments)},o.prototype._updateCachedSimulationState=function(){var e=this._model.isStopped(),t=this._model.properties.isPlayable!==!1,n=this._model.properties.hasPlayed,r=this._scriptingAPI.dataAreAvailableForExport();return(e!==this._modelStopped||t!==this._modelPlayable||n!==this._modelHasPlayed||r!==this._dataAreAvailableForExport)&&(this._modelStopped=e,this._modelPlayable=t,this._modelHasPlayed=n,this._dataAreAvailableForExport=r,!0)},o.prototype._simulationStateChanged=function(){this._updateCachedSimulationState()&&this._updateButtonStates()},o.prototype._timeChanged=function(){this._model.properties.showClock&&this._setClockValue(this._model.properties.displayTime)},o.prototype._useDurationChanged=function(){this._useDuration!==this._model.properties.actualUseDuration&&(this._useDuration=this._model.properties.actualUseDuration,this._updateDurationControl())},o.prototype._updateDurationControl=function(){var e=this._model,t=this._useDuration,n=e.properties.durationOptions,r=e.properties.actualDuration,i=[];this.durationControl&&(this.durationControl.destroy(),this.durationControl=null),t&&n.length>0&&(n.forEach(function(t){r<t&&(0===i.length||r>i[i.length-1].value)&&i.push({value:r,text:e.formatTime(r),selected:!0}),i.push({value:t,text:e.formatTime(t),selected:t===r})}),this.durationControl=new u({id:"duration-control",options:i,onChange:function(e){this._model.properties.requestedDuration=e.value}.bind(this)}),this.durationControl.render(this.$element.parent()),this.durationControl.$element.addClass("duration-control interactive-pulldown component component-spacing"),this.$element.parent().append(this.durationControl.$element)),this._fitButtons()},o.prototype._controlButtonChoicesChanged=function(){this._updateControlButtonChoices(this._model.properties.controlButtons)},o.prototype._controlButtonStyleChanged=function(){var e=this._model.properties.controlButtonStyle||"video";if(this.controlButtonStyle!==e){if(this.controlButtonStyle=e,this.$element.empty(),!d[e])throw new Error('Unknown controlButtonStyle "'+e+'"');this._controlButtonMethods=d[e],this._updateCachedSimulationState(),this._createControls(),this._controlButtonChoicesChanged()}},o.prototype._updateClockVisibility=function(){this._setClockVisibility(this._model.properties.showClock)},o.prototype._fitButtons=function(){var e,t,n,r=this.$element.parent().width(),i=10,o=this.durationControl&&this.durationControl.$element;this.$element.css("left","");var a=this.$element.measure(function(){return o&&this.prepend(o.clone()),this.removeClass("scrunched-buttons"),this.width()},null,$("#bottom-bar"));if(this.$element.parent().css("fontSize",""),a<r?this.$element.removeClass("scrunched-buttons"):(e=r/a,t=parseFloat(this.$element.parent().css("font-size"))*e,n=t<i?i+"px":e+"em",this.$element.parent().css("fontSize",n),this.$element.removeClass("scrunched-buttons"),this.$element.width()-10>=r&&this.$element.addClass("scrunched-buttons")),o){var s=this.$element.find("button:visible").first();if(s.length>0){var l=s.offset().left-parseFloat(s.css("padding-left"))-parseFloat(s.css("margin-left")),u=o.offset().left+o.outerWidth(!0);l<u&&this.$element.css("left",u-l+"px")}}},o.prototype._fitButtonsOnResize=function(){this._debouncedFitButtons||(this._debouncedFitButtons=c.debounce(this._fitButtons.bind(this),200)),this.$element.parent().css("fontSize",this.$element.parent().css("fontSize")),this._debouncedFitButtons()},o.prototype.modelLoadedCallback=function(){this._model=this._interactivesController.getModel(),this._scriptingAPI=this._interactivesController.getScriptingAPI().api;var e=this._simulationStateChanged.bind(this);this._model.on("play."+this.component.id,e),this._model.on("stop."+this.component.id,e),this._model.addObserver("isPlayable",e),this._model.addObserver("showClock",this._updateClockVisibility.bind(this)),this._model.addObserver("displayTime",this._timeChanged.bind(this)),this._model.addObserver("actualUseDuration",this._useDurationChanged.bind(this)),this._model.addObserver("controlButtons",this._controlButtonChoicesChanged.bind(this)),this._model.addObserver("controlButtonStyle",this._controlButtonStyleChanged.bind(this)),this._useDuration=null,this._useDurationChanged(),this._controlButtonStyleChanged(),this._controlButtonChoicesChanged(),this._simulationStateChanged(),this._updateClockVisibility()},o.prototype.resize=function(){this._fitButtonsOnResize(),this._$timeCanvas&&(this._canvWidth=2*this._$timeCanvas.width(),this._canvHeigth=2*this._$timeCanvas.height(),this._$timeCanvas.attr("width",this._canvWidth),this._$timeCanvas.attr("height",this._canvHeigth),this._timeCtx.font=this._fontSpec,this._timeCtx.fillStyle="#939598",this._timeCtx.textAlign="right",this._updateClockVisibility())},o}),define("common/controllers/div-controller",["require","common/inherit","common/controllers/interactive-component","common/alert"],function(e){function t(e,t,n){r.call(this,"div",e,t,n);var o=e.content,a=this;e.url?("auto"!==e.width&&"auto"!==e.height||i("This interactive has a remote div component.\nThe width and/or height is not set.\nPlease set both the width and height."),$.ajax(e.url,{dataType:"html",complete:function(e){a.$element.append(e.responseText)}})):(o&&o.join&&(o=o.join("\n")),this.$element.append(o))}var n=e("common/inherit"),r=e("common/controllers/interactive-component"),i=e("common/alert");return n(t,r),t}),define("common/controllers/help-system",["require","common/markdown-to-html","common/dispatch-support"],function(e){var t=e("common/markdown-to-html"),n=e("common/dispatch-support"),r=["center bottom","left center","center top","right center"],i=["center top-5","right+5 center","center bottom+5","left-5 center"],o="lab-is-bounding-box";return function(e,a){function s(){var n,s,u,c=e[m];c&&(d.focus(),d.html(t(c.text)),c.component?(n=l(c.component),s=n.outerHeight()+10,u=parseFloat(d.css("font-size")),d.position({of:n,collision:"flipfit flipfit",within:a,my:"left-"+4*u+" top+"+u,at:"right bottom",using:function(e,t){var n,r,i=t.element.left,o=t.element.width,a=t.target.left,s=t.target.width;$(this).css(e),n=$("<div>").addClass("lab-help-arrow").addClass(t.vertical).appendTo(this),a>i&&(r=a-i+s/2,r=Math.max(.1*o,Math.min(.9*o,r)),n.css("left",r))}}),g.forEach(function(e,t){1!==t&&3!==t||e.css("height",s),e.position({of:n,collision:"none none",my:r[t],at:i[t]})}),n.data(o)&&n.remove()):(d.position({of:a,collision:"flipfit flipfit",within:a,my:"center center",at:"center center"}),g.forEach(function(e,t){e.position({of:a,collision:"none none",my:t?"left top":"center center",at:t?"right bottom":"center center"})})))}function l(e){var t;return"model"===e?t=$("#model-container"):"string"==typeof e?t=$("#"+e).closest(".component"):(t=$(e.map(function(e){return"#"+e}).join(", ")).closest(".component"),t=u(t)),t}function u(e){var t,n,r,i,s,l=[],u=[],c=[],d=[];return e.each(function(){$el=$(this),pos=$el.offset(),contPos=a.offset(),l.push(pos.left-contPos.left),u.push(pos.left-contPos.left+$el.width()),c.push(pos.top-contPos.top),d.push(pos.top-contPos.top+$el.height())}),t=Math.min.apply(null,l),n=Math.max.apply(null,u),r=Math.min.apply(null,c),i=Math.max.apply(null,d),s=$("<div>").data(o,!0).css({position:"absolute",left:t,top:r,width:n-t,height:i-r}).appendTo(a)}var c,d,p,f=new n("start","stop"),h=!1,m=-1,g=[];return c={start:function(e,t){if(h)return void c.stop();for(var n=0;n<4;n++)g.push($('<div class="lab-help-overlay lab-help-next"></div>').appendTo(a));d=$('<div class="lab-help-tip lab-help-next" tabindex="-1"></div>').appendTo(a),t?(p=$('<div class="lab-help-instructions"><span class="lab-help-next">Click overlay to hide help tip</span></div>').appendTo(a),a.on("click.lab-help-next",".lab-help-next",c.stop)):(p=$('<div class="lab-help-instructions"><span class="lab-help-prev btn"><</span><span class="lab-help-next">Click overlay to see next help tip</span><span class="lab-help-next btn">></span></div>').appendTo(a),a.on("click.lab-help-next",".lab-help-next",c.next),a.on("click.lab-help-prev",".lab-help-prev",c.prev),d.on("keydown.lab-help",function(e){switch(e.keycode||e.which){case 37:c.prev();break;case 39:c.next()}e.preventDefault(),e.stopPropagation()})),h=!0,m=null!=e?e:0,t?s():(m--,c.next()),f.start()},showSingle:function(t){for(var n=0;n<e.length;n++){var r=e[n].component;if("string"==typeof r&&r===t||r.indexOf(t)!==-1)return void c.start(n,!0)}},stop:function(){d.remove(),p.remove(),g.forEach(function(e){e.remove()}),g.length=0,a.off("click.lab-help-next",".lab-help-next"),a.off("click.lab-help-prev",".lab-help-prev"),h=!1,f.stop()},next:function(){for(m++;m<e.length&&!e[m].showcase;)m++;return m>=e.length?void c.stop():void s()},prev:function(){for(m--;!m>=0&&e[m].showcase;)m--;return m<0?void c.stop():void s()},isActive:function(){return h},hasShowcase:function(){return e.filter(function(e){return e.showcase}).length>0},enableLogging:function(e){var t=null;f.on(".logging",null),f.on("start.logging",function(){e("HelpTipsOpened"),t=Date.now()}),f.on("stop.logging",function(){e("HelpTipsClosed",{wasOpenFor:(Date.now()-t)/1e3})})}},f.mixInto(c),c}}),define("common/views/tooltip",["require","common/benchmark/benchmark"],function(e){function t(e){function t(t){var n=e.css("font-size"),r=.35*+parseFloat(n),i=$(t).closest("[title], [aria-describedby]");o.css("font-size",n),o.is(":visible")||o.show(),o.position({of:i,collision:"flipfit flipfit",within:e,my:"center top+"+r,at:"center bottom",using:function(e,t){$(this).css(e),$("<div>").addClass("ui-tooltip-arrow").addClass(t.vertical).addClass(t.horizontal).appendTo(this)}})}function n(){o&&o.hide(),clearInterval(a),clearInterval(s),l=!1,o=null}if(i){var o=null,a=null,s=null,l=!1;e.tooltip({show:!1,hide:!1,open:function(e,i){var u=3*Math.min(500,Date.now()-r);null!==o&&n(),o=i.tooltip,t(e.originalEvent.target),o.hide(),a=setTimeout(function(){o.fadeIn(),l=!0},u),s=setTimeout(function(){o.fadeOut()},u+5e3)},close:function(e,t){o&&t.tooltip[0]===o[0]&&(l&&(r=Date.now()),n())}})}}var n=e("common/benchmark/benchmark"),r=0,i=function(){if(n.isMobile)return!1;var e=n.browser.browser,t=parseInt(n.browser.version,10);return!("Safari"===e&&t<7)}();return t}),define("common/cookies",[],function(){return{getItem:function(e){return unescape(document.cookie.replace(new RegExp("(?:(?:^|.*;)\\s*"+escape(e).replace(/[\-\.\+\*]/g,"\\$&")+"\\s*\\=\\s*([^;]*).*$)|^.*$"),"$1"))||null},setItem:function(e,t,n,r,i,o){if(!e||/^(?:expires|max\-age|path|domain|secure)$/i.test(e))return!1;var a="";if(n)switch(n.constructor){case Number:a=n===1/0?"; expires=Fri, 31 Dec 9999 23:59:59 GMT":"; max-age="+n;break;case String:a="; expires="+n;break;case Date:a="; expires="+n.toGMTString()}return document.cookie=escape(e)+"="+escape(t)+a+(i?"; domain="+i:"")+(r?"; path="+r:"")+(o?"; secure":""),!0},removeItem:function(e,t){return!(!e||!this.hasItem(e))&&(document.cookie=escape(e)+"=; expires=Thu, 01 Jan 1970 00:00:00 GMT"+(t?"; path="+t:""),!0)},hasItem:function(e){return new RegExp("(?:^|;\\s*)"+escape(e).replace(/[\-\.\+\*]/g,"\\$&")+"\\s*\\=").test(document.cookie)},keys:function(){for(var e=document.cookie.replace(/((?:^|\s*;)[^\=]+)(?=;|$)|^\s*|\s*(?:\=[^;]*)?(?:\1|$)/g,"").split(/\s*(?:\=[^;]*)?;\s*/),t=0;t<e.length;t++)e[t]=unescape(e[t]);return e}}}),function(){"use strict";var e="undefined"!=typeof module&&module.exports,t="undefined"!=typeof Element&&"ALLOW_KEYBOARD_INPUT"in Element,n=function(){for(var e,t,n=[["requestFullscreen","exitFullscreen","fullscreenElement","fullscreenEnabled","fullscreenchange","fullscreenerror"],["webkitRequestFullscreen","webkitExitFullscreen","webkitFullscreenElement","webkitFullscreenEnabled","webkitfullscreenchange","webkitfullscreenerror"],["webkitRequestFullScreen","webkitCancelFullScreen","webkitCurrentFullScreenElement","webkitCancelFullScreen","webkitfullscreenchange","webkitfullscreenerror"],["mozRequestFullScreen","mozCancelFullScreen","mozFullScreenElement","mozFullScreenEnabled","mozfullscreenchange","mozfullscreenerror"],["msRequestFullscreen","msExitFullscreen","msFullscreenElement","msFullscreenEnabled","MSFullscreenChange","MSFullscreenError"]],r=0,i=n.length,o={};r<i;r++)if(e=n[r],e&&e[1]in document){for(r=0,t=e.length;r<t;r++)o[n[0][r]]=e[r];return o}return!1}(),r={request:function(e){var r=n.requestFullscreen;e=e||document.documentElement,/5\.1[\.\d]* Safari/.test(navigator.userAgent)?e[r]():e[r](t&&Element.ALLOW_KEYBOARD_INPUT)},exit:function(){document[n.exitFullscreen]()},toggle:function(e){this.isFullscreen?this.exit():this.request(e)},raw:n};return n?(Object.defineProperties(r,{isFullscreen:{get:function(){return Boolean(document[n.fullscreenElement])}},element:{enumerable:!0,get:function(){return document[n.fullscreenElement]}},enabled:{enumerable:!0,get:function(){return Boolean(document[n.fullscreenEnabled])}}}),void(e?module.exports=r:window.screenfull=r)):void(e?module.exports=!1:window.screenfull=!1)}(),define("screenfull",function(e){return function(){var t;return t||e.screenfull}}(this)),define("common/controllers/setup-banner",["lab.config","common/controllers/text-controller","common/controllers/image-controller","common/controllers/div-controller","common/controllers/playback-controller","screenfull"],function(){var e=require("lab.config"),t=require("common/controllers/text-controller"),n=require("common/controllers/image-controller"),r=require("common/controllers/div-controller"),i=require("common/controllers/playback-controller"),o=require("screenfull"),a=1.5,s=.65*a,l=a/10;return function(u,c,d,p,f){function h(e,o){var a;"text"===e.type?a=t:"image"===e.type?a=n:"div"===e.type?a=r:"playback"===e.type&&(a=i),y[e.id]=new a(e,u),b.push(o),_[o.id]=[e.id]}function m(){for(var e=0;e<c.components.length;e++)if("playback"===c.components[e].type)return!0;return!1}function g(){b.push({id:"top-bar",top:"0",left:"0",height:a+"em","padding-top":l+"em","padding-bottom":l+"em",width:"container.width",aboveOthers:!0}),c.i18nMetadata&&h({type:"div",id:"lang-icon",width:"1.8em",height:"1.35em",tooltip:x.t("banner.lang_tooltip")},{id:"banner-lang",top:"0",height:a+"em",right:"container.right","padding-top":l+"em","padding-bottom":l+"em","padding-left":"0.75em","padding-right":"0.25em",aboveOthers:!0}),h({type:"text",id:"about-link",text:x.t("banner.about"),onClick:function(){p.open()},tooltip:x.t("banner.about_tooltip")},{id:"banner-right",fontScale:s,top:"0",height:a+"em","padding-top":l+"em","padding-bottom":l+"em",right:c.i18nMetadata?"banner-lang.left":"interactive.right","padding-left":"1em","padding-right":"0.75em",align:"right",aboveOthers:!0}),e.sharing&&h({type:"text",id:"share-link",text:u.i18n.t("banner.share"),onClick:function(){f.open()},tooltip:x.t("banner.share_tooltip")},{id:"banner-middle",fontScale:s,top:"0",height:a+"em","padding-top":l+"em","padding-bottom":l+"em",right:"banner-right.left","padding-right":"1em",align:"right",aboveOthers:!0}),h({type:"div",id:"interactive-reload-icon",content:'<i class="icon-repeat"></i>',onClick:function(){u.reloadInteractive()},tooltip:x.t("banner.reload_tooltip")},{id:"banner-reload",fontScale:s,top:"0",height:a+"em","padding-top":l+"em","padding-bottom":l+"em",left:"0.7em","padding-right":"1em",align:"left",aboveOthers:!0}),u.helpSystem&&u.helpSystem.hasShowcase()&&(h({type:"div",id:"main-help-icon",content:'<i class="icon-question-sign lab-help-icon"></i>',onClick:function(){u.helpSystem.isActive()?u.helpSystem.stop():u.helpSystem.start()},tooltip:x.t("banner.help_tooltip")},{id:"banner-help",fontScale:s,top:"0",height:a+"em","padding-top":l+"em","padding-bottom":l+"em",left:"banner-reload.right","padding-right":"1em",align:"left",aboveOthers:!0}),u.helpSystem.on("start.icon",function(){var e=$("#main-help-icon .lab-help-icon");e.addClass("icon-remove-sign active"),e.removeClass("icon-question-sign");
}),u.helpSystem.on("stop.icon",function(){var e=$("#main-help-icon .lab-help-icon");e.addClass("icon-question-sign"),e.removeClass("icon-remove-sign active")}))}function v(){b.push({id:"bottom-bar",bottom:"container.height",left:"0",width:"container.width",height:"2.5em",belowOthers:!0}),h({type:"div",id:"credits-link",height:"2.5em",width:"8.1em",classes:["credits"],tooltip:x.t("banner.credits_tooltip"),onClick:function(){d.open()}},{id:"banner-bottom-left",bottom:"container.height",left:"0","padding-left":"0.3em",align:"left",belowOthers:!0}),o.enabled&&h({type:"div",id:"fullsize-link",height:"2.5em",width:"2.5em",classes:["fullscreen"],tooltip:x.t("banner.fullscreen_tooltip"),onClick:function(){o.isFullscreen?o.exit():(o.request(document.body),u.logAction("FullScreenStarted"))}},{id:"banner-bottom-right",bottom:"container.height",right:"container.width",align:"left","padding-left":"1em",belowOthers:!0}),m()||h({type:"playback",id:"playback"},{id:"interactive-playback-container",bottom:"container.height",height:"banner-bottom-left.height",left:"banner-bottom-left.right",right:b.map(function(e){return e.id}).indexOf("banner-bottom-right")>=0?"banner-bottom-right.left":"container.right",belowOthers:!0})}var y={},b=[],_={},x=u.i18n;return c.showTopBar&&g(),c.showBottomBar&&v(),{components:y,template:b,layout:_}}}),define("common/controllers/about-dialog",["require","common/markdown-to-html","common/inherit","common/controllers/basic-dialog"],function(e){function t(e,t,n){i.call(this,{dialogClass:"about-dialog",appendTo:e},t),this._i18n=t,n&&this.update(n)}var n=e("common/markdown-to-html"),r=e("common/inherit"),i=e("common/controllers/basic-dialog");return r(t,i),t.prototype.update=function(e){var t=$("<div>");this.set("title",this._i18n.t("about_dialog.title",{interactive_title:e.title})),e.subtitle&&t.append(n("**"+e.subtitle+"**")),t.append(n(e.about)),this.setContent(t)},t}),define("common/controllers/copyright",[],function(){return function(e){var t='<a class="opens-in-new-window" href="http://concord.org" target="_blank">The Concord Consortium</a>',n='<a class="opens-in-new-window" href="http://opensource.org/licenses/MIT" target="_blank">MIT</a>',r='<a class="opens-in-new-window" href="http://concord.org/" target="_blank">http://concord.org</a>';return'<div class="copyright-section"><strong>'+e.t("copyright.copyright")+" © "+(new Date).getFullYear()+"</strong> "+t+". "+e.t("copyright.all_rights_reserved")+" "+e.t("copyright.license",{MIT_link:n})+" "+e.t("copyright.attribution",{concord_org_link:r})+"</div>"}}),define("text!common/controllers/share-dialog.tpl",[],function(){return"<div>\n  <h2>\n    {{{paste_email_im}}}\n  </h2>\n  <textarea>{{embeddableSharingUrl}}</textarea>\n  <h2>{{paste_html}}</h2>\n  <p>{{select_size}}\n    <select id='iframe-size'>\n      <option value='smaller'>{{size_smaller}}</option>\n      <option selected value='actual'>{{size_actual}}</option>\n      <option value='larger'>{{size_larger}}</option>\n    </select>\n  </p>\n  <textarea id='share-iframe-content'></textarea>\n  {{{copyright}}}\n</div>\n"}),define("common/controllers/share-dialog",["require","lab.config","mustache","common/inherit","common/controllers/basic-dialog","common/controllers/copyright","text!common/controllers/share-dialog.tpl"],function(e){function t(e,t,i,u){var c=l.hash,d=l.href.match(/(.*?\/\/.*?)\//)[1],p=l.pathname;o.call(this,{dialogClass:"share-dialog",appendTo:e},i),this._view={paste_html:i.t("share_dialog.paste_html"),select_size:i.t("share_dialog.select_size"),size_larger:i.t("share_dialog.size_larger",{val:50}),size_actual:i.t("share_dialog.size_actual"),size_smaller:i.t("share_dialog.size_smaller",{val:30}),copyright:a(i)},this._i18n=i,n.homeForSharing?this._view.embeddableSharingUrl=n.homeForSharing+n.homeEmbeddablePath+c:this._view.embeddableSharingUrl=d+p+c;var f="<a class='opens-in-new-window' href='"+this._view.embeddableSharingUrl+"' target='_blank'>"+i.t("share_dialog.link")+"</a>";this._view.paste_email_im=i.t("share_dialog.paste_email_im",{link:f}),this.setContent(r.render(s,this._view)),this._$interactiveContainer=$(t),this._$iframeSize=this.$element.find("#iframe-size"),this._$iframeContent=this.$element.find("#share-iframe-content"),this._$iframeSize.on("change",$.proxy(this.updateIframeSize,this)),this.updateIframeSize(),u&&this.update(u)}var n=e("lab.config"),r=e("mustache"),i=e("common/inherit"),o=e("common/controllers/basic-dialog"),a=e("common/controllers/copyright"),s=e("text!common/controllers/share-dialog.tpl"),l=document.location,u=r.compile('<iframe width="{{width}}px" height="{{height}}px" frameborder="no" scrolling="no" allowfullscreen="true" webkitallowfullscreen="true" mozallowfullscreen="true" src="{{{embeddableSharingUrl}}}"></iframe>');return i(t,o),t.prototype.updateIframeSize=function(){var e=this._$interactiveContainer.innerWidth(),t=this._$interactiveContainer.innerHeight(),n=this._$iframeSize.val();switch(n){case"smaller":this._view.width=Math.floor(.7*e),this._view.height=Math.floor(.7*t);break;case"larger":this._view.width=Math.floor(1.5*e),this._view.height=Math.floor(1.5*t);break;default:this._view.width=e,this._view.height=t}this._$iframeContent.val(u(this._view))},t.prototype.update=function(e){this.set("title",this._i18n.t("share_dialog.title",{interactive_title:e.title}))},t}),define("text!common/controllers/credits-dialog.tpl",[],function(){return"<div>\n  <p>\n    {{{credits_text}}}\n  </p>\n  {{#showShareable}}\n  <p>\n    {{{find_shareable}}}\n  </p>\n  {{/showShareable}}\n  {{{copyright}}}\n</div>\n"}),define("common/controllers/credits-dialog",["require","lab.config","mustache","common/markdown-to-html","common/inherit","common/controllers/basic-dialog","common/controllers/copyright","text!common/controllers/credits-dialog.tpl"],function(e){function t(e,t,n){a.call(this,{dialogClass:"credits-dialog",appendTo:e},t),this._i18n=t,n&&this.update(n)}var n=e("lab.config"),r=e("mustache"),i=e("common/markdown-to-html"),o=e("common/inherit"),a=e("common/controllers/basic-dialog"),s=e("common/controllers/copyright"),l=e("text!common/controllers/credits-dialog.tpl"),u="http://concord.org",c="http://mw.concord.org/nextgen/";return o(t,a),t.prototype.update=function(e){var t,o,a=document.location.hash,d=document.location.href.match(/(.*?\/\/.*?)\//)[1],p=document.location.pathname,f=this._i18n,h=u,m=c;this.set("title",this._i18n.t("credits_dialog.title",{interactive_title:e.title})),t=n.homeForSharing?n.homeForSharing+n.homeEmbeddablePath+a:d+p+a,n.utmCampaign&&(o="utm_source="+encodeURIComponent(e.title.replace(/ /gi,"+"))+"&utm_medium=embedded_interactive&utm_campaign="+n.utmCampaign,h+="?"+o,m+="?"+o,t+="?"+encodeURI("utm_source=embed_link&utm_medium=embedded_interactive&utm_campaign="+n.utmCampaign));var g={credits_text:e.credits?i(e.credits):f.t("credits_dialog.credits_text",{CC_link:"<a class='opens-in-new-window' href='"+h+"' target='_blank'>Concord Consortium</a>",Next_Gen_MW_link:"<a class='opens-in-new-window' href='"+m+" ' target='_blank'>Next-Generation Molecular Workbench</a>",Google_link:"<a class='opens-in-new-window' href='http://www.google.org/' target='_blank'>Google.org</a>"}),find_shareable:f.t("credits_dialog.find_shareable",{shareable_ver_link:'<a href="'+t+'" class="opens-in-new-window" target="_blank">'+f.t("credits_dialog.shareable_ver")+"</a>",concord_org_link:'<a href="'+h+'" class="opens-in-new-window" target="_blank">concord.org</a>'}),copyright:s(f)};n.sharing||(g.showShareable=!0),this.setContent(r.render(l,g))},t}),define("common/layout/semantic-layout-config",[],function(){return{iterationsLimit:35,minModelWidth:150,minFontSize:.65,canonicalFontSize:.9,canonicalWidth:565,containerColors:["rgba(0,0,255,0.1)","rgba(255,0,0,0.1)","rgba(0,255,0,0.1)","rgba(255,255,0,0.1)","rgba(0,255,255,0.1)","rgba(255,255,128,0.1)","rgba(128,255,0,0.1)","rgba(255,128,0,0.1)"]}}),define("common/layout/semantic-layout",["require","common/layout/semantic-layout-config","arrays","common/console","common/alert"],function(require){var layoutConfig=require("common/layout/semantic-layout-config"),arrays=require("arrays"),console=require("common/console"),alert=require("common/alert");return function SemanticLayout(){function reset(){modelWidth=layoutConfig.minModelWidth,modelTop=0,modelLeft=0,paddingBottom=0}function getDimensionOfContainer(e,t){var n=e.position();switch(t){case"top":return n.top;case"bottom":return n.top+e.outerHeight();case"left":return n.left;case"right":return n.left+e.outerWidth();case"height":return e.outerHeight();case"width":return e.outerWidth()}}function setFontSize(){var e,t,n=layoutConfig.canonicalWidth,r=n/aspectRatio;e=Math.min($mainContainer.width()/n,$mainContainer.height()/r),scaledPadding=e*padding,paddingTop=scaledPadding,paddingLeft=scaledPadding,paddingBottom=scaledPadding,t=layoutConfig.canonicalFontSize*fontScale*e,t<layoutConfig.minFontSize&&(t=layoutConfig.minFontSize),$mainContainer.css("font-size",t+"em"),fontSizeChanged=!0}function createContainers(){var e,t,n,r,i;for($containerByID={},$innerContainerByID={},containerSpecByID={},r=0,i=containerSpecList.length;r<i;r++){e=containerSpecList[r],t=e.id,containerSpecByID[t]=e,$containerByID[t]=$("<div id='"+t+"'>").appendTo($containersParent),$containerByID[t].css({display:"inline-block",position:"absolute"}),$innerContainerByID[t]=$('<div class="inner-container">'),$innerContainerByID[t].appendTo($containerByID[t]),void 0===e.width&&$containerByID[t].css("white-space","nowrap");for(n in e)e.hasOwnProperty(n)&&(/^margin/.test(n)?$containerByID[t].css(n.replace("margin","padding"),e[n]):/^padding/.test(n)?$innerContainerByID[t].css(n,e[n]):"align"===n?$containerByID[t].css("text-align",e[n]):"min-width"===n?$containerByID[t].css("min-width",e[n]):"fontScale"===n?$containerByID[t].css("font-size",e[n]+"em"):"border"===n?$innerContainerByID[t].css("border",e[n]):"background"===n&&$innerContainerByID[t].css("background",e[n]))}}function placeComponentsInContainers(){var e,t,n,r,i,o,a,s,l,u,c,d,p,f,h,m;l=$.extend({},componentByID);for(t in containersContent)if(containersContent.hasOwnProperty(t))if($containerByID[t])if(n=containersContent[t],arrays.isArray(n))for(arrays.isArray(n[0])||(n=[n]),p=0,f=n.length;p<f;p++)for(r=n[p],i=$('<div class="interactive-row"/>'),i.css("width","100%"),1===f&&i.css("height","100%"),$innerContainerByID[t].append(i),h=0,m=r.length;h<m;h++)e=r[h],void 0!==l[e]?(i.append(l[e].getViewContainer()),delete l[e]):alert("Incorrect layout definition. Component with ID '"+e+"'' is not defined.");else u="Incorrect layout definition for '"+t+"' container. It should specify an array of components or an array of arrays of components (multiple rows).",alert(u);else u="Incorrect layout definition - '"+t+"' container does not exist.",alert(u);if(s=containerSpecByID.bottom||containerSpecList[containerSpecList.length-1]){o=$innerContainerByID[s.id].children(),i=o.last(),i.length||(i=$('<div class="interactive-row"/>'),$innerContainerByID[s.id].append(i));for(e in l)l.hasOwnProperty(e)&&i.append(l[e].getViewContainer())}for(c=0,d=containerSpecList.length;c<d;c++)a=$innerContainerByID[containerSpecList[c].id].children().children(),a.length>1&&a.addClass("component-spacing")}function positionContainers(){var e,t,n,r,i,o,a,s,l,u;for($modelContainer.css({width:modelWidth,height:modelController.getHeightForWidth(modelWidth,fontSizeChanged),left:modelLeft,top:modelTop}),fontSizeChanged=!1,s=0,l=containerSpecList.length;s<l;s++)e=containerSpecList[s],t=$containerByID[e.id],e.left||e.right||(e.left="0"),e.top||e.bottom||(e.top="0"),e.left&&(n=parseDimension(e.left),t.css("left",n)),e.top&&(r=parseDimension(e.top),t.css("top",r)),e.height&&t.css("height",parseDimension(e.height)),e.width&&t.css("width",parseDimension(e.width)),e.right&&(i=parseDimension(e.right),e.left?t.css("width",i-n):(n=i-t.outerWidth(),t.css("left",n))),e.bottom&&(o=parseDimension(e.bottom),e.top?t.css("height",o-r):(r=o-t.outerHeight(),t.css("top",r))),e.aboveOthers&&(o=getDimensionOfContainer(t,"bottom")+scaledPadding,o>paddingTop&&(paddingTop=o)),e.belowOthers&&(a=getDimensionOfContainer(t,"height")+scaledPadding,a>paddingBottom&&(paddingBottom=a));for(u in $containerByID)$containerByID.hasOwnProperty(u)&&(containerSpecByID[u]&&containerSpecByID[u].aboveOthers||containerSpecByID[u]&&containerSpecByID[u].belowOthers||(t=$containerByID[u],r=getDimensionOfContainer(t,"top"),t.css("top",r+paddingTop),n=getDimensionOfContainer(t,"left"),t.css("left",n+paddingLeft)))}function resizeModelContainer(){var e,t,n,r,i,o,a,s=-(1/0),l=-(1/0),u=1/0,c=1/0;for(e in $containerByID)$containerByID.hasOwnProperty(e)&&(containerSpecByID[e]&&containerSpecByID[e].aboveOthers||containerSpecByID[e]&&containerSpecByID[e].belowOthers||(t=$containerByID[e],n=getDimensionOfContainer(t,"right"),n>s&&(s=n),r=getDimensionOfContainer(t,"bottom"),r>l&&(l=r),o=getDimensionOfContainer(t,"left"),o<u&&(u=o),i=getDimensionOfContainer(t,"top"),i<c&&(c=i)));return s<=availableWidth+2&&l<=availableHeight-paddingBottom+2&&(Math.abs(availableWidth-s)<2||Math.abs(availableHeight-paddingBottom-l)<2)&&Math.abs(u-paddingLeft)<2&&Math.abs(c-paddingTop)<2||(a=Math.min(availableWidth/s,(availableHeight-paddingBottom)/l),isNaN(a)||(modelWidth*=a),modelWidth<layoutConfig.minModelWidth&&(modelWidth=layoutConfig.minModelWidth),modelLeft-=u-paddingLeft,modelTop-=c-paddingTop,!1)}function parseDimension(dim){var vars,i,ii,value;if("number"==typeof dim||/^[0-9]+\.?[0-9]*(em)?$/.test(dim))return dim;for(vars=dim.match(/[a-zA-Z][a-zA-Z0-9\-]+\.[a-zA-Z]+/g),i=0,ii=vars.length;i<ii;i++)value=getDimension(vars[i]),dim=dim.replace(vars[i],value);return/^[^a-zA-Z]*$/.test(dim)?eval(dim):0}function getDimension(e){switch(e){case"container.left":case"container.top":return 0;case"container.width":case"container.right":return availableWidth;case"container.height":case"container.bottom":return availableHeight;case"interactive.left":return paddingLeft;case"interactive.top":return paddingTop;case"interactive.width":case"interactive.right":return availableWidth-paddingLeft;case"interactive.height":case"interactive.bottom":return availableHeight-paddingTop-paddingBottom;default:return e=e.split("."),getDimensionOfContainer($containerByID[e[0]],e[1])}}var layout,$mainContainer,$containersParent,containerSpecList,containersContent,componentByID,modelController,aspectRatio,fontScale,padding,scaledPadding,containerSpecByID,$containerByID,$innerContainerByID,$modelContainer,availableWidth,availableHeight,fontSizeChanged=!1,modelWidth,modelTop,modelLeft,paddingTop,paddingLeft,paddingBottom;return layout={initialize:function(e){$mainContainer=e.$mainContainer,$containersParent=e.$containersParent,containerSpecList=e.containers,containersContent=e.layout,componentByID=e.components,aspectRatio=e.aspectRatio,fontScale=e.fontScale,padding=e.padding,createContainers(),placeComponentsInContainers(),modelController=null,$mainContainer.addClass("lab-responsive-content")},setupModel:function(e){if(modelController=e,$containerByID.model){if($containerByID.model===modelController.getViewContainer())return;$containerByID.model.remove()}$modelContainer=modelController.getViewContainer(),$modelContainer.css({display:"inline-block",position:"absolute","z-index":"0"}),$modelContainer.appendTo($containersParent),$containerByID.model=$modelContainer},isReady:function(){return!!modelController},layoutInteractive:function(){var e,t=layoutConfig.iterationsLimit;for(console.time("[layout] update"),reset(),availableWidth=$mainContainer.width(),availableHeight=$mainContainer.height(),modelWidth=availableWidth,setFontSize(),positionContainers();--t>0&&!resizeModelContainer();)positionContainers();modelController.resize();for(e in componentByID)componentByID.hasOwnProperty(e)&&void 0!==componentByID[e].resize&&componentByID[e].resize();return console.timeEnd("[layout] update"),layoutConfig.iterationsLimit-t}}}}),define("common/layout/templates",[],function(){return{"model-only":[],simple:[{id:"top",bottom:"model.top",width:"interactive.width"},{id:"right",top:"model.top",left:"model.right",height:"model.height","padding-left":"1em","padding-right":"0.5em"},{id:"bottom",top:"model.bottom",width:"interactive.width","padding-top":"0.5em"}],"narrow-right":[{id:"top",bottom:"model.top",width:"interactive.width"},{id:"right",top:"model.top",left:"model.right",height:"model.height","padding-left":"1em","padding-right":"0.5em",width:"model.width / 4","min-width":"6em"},{id:"bottom",top:"model.bottom",width:"interactive.width","padding-top":"0.5em"}],"wide-right":[{id:"top",bottom:"model.top",width:"interactive.width"},{id:"right",top:"model.top",left:"model.right",height:"model.height","padding-left":"1em","padding-right":"0.5em",width:"model.width","min-width":"6em"},{id:"bottom",top:"model.bottom",width:"interactive.width","padding-top":"0.5em"}],"left-right-bottom":[{id:"left",top:"model.top",height:"model.height",right:"model.left","padding-right":"0.5em"},{id:"right",top:"model.top",height:"model.height",left:"model.right","padding-left":"1em","padding-right":"0.5em"},{id:"bottom",top:"model.bottom",left:"model.left",width:"model.width"}]}}),define("common/performance",[],function(){var e,t,n=!1;return e="undefined"!=typeof performance&&"undefined"!=typeof performance.now?$.proxy(performance.now,performance):$.proxy(Date.now,Date),{now:e,collectData:function(e){n=e,n&&(t={})},enterScope:function(r){if(n){var i=t[r];void 0===i&&(i=t[r]={lastTime:0,timeSum:0,count:0}),i.lastTime=e()}},leaveScope:function(r){if(n){var i=t[r];void 0!==i&&(i.timeSum+=e()-i.lastTime,i.count+=1)}},getAvgTime:function(e){var n=t[e];return void 0!==n?n.timeSum/n.count:0},getAvgFreq:function(e){var n=t[e];return void 0!==n?1e3*n.count/n.timeSum:0}}}),define("common/controllers/model-controller",["require","lab.config","common/performance"],function(e){function t(e,i,o,a,s,l,u){function c(){Math.seedrandom(o.randomSeed+g.get("time"))}function d(){n.enterScope("js-rendering"),m.modelContainer.update(),n.leaveScope("js-rendering")}function p(){g=new a(i,{waitForSetup:!0,i18n:o.i18n}),g.on("tickStart.modelController",c),g.on("tick.modelController",d),g.on("reset.modelController",f)}function f(){b=b||t.RESET_CAUSE.RESET,y.repaint(),_.modelReset(b)}function h(n,r,a){g&&g.willReset&&g.willReset(),e=n||e,i=r||i,p(),y?y.bindModel(g,e):y=new s(g,m.modelUrl,o.i18n),a||_.modelLoaded(t.LOAD_CAUSE.RELOAD)}var m,g,v,y,b,_=d3.dispatch("modelLoaded","modelReset","modelSetupComplete");return m={get type(){return a.type},get benchmarks(){return v},get modelUrl(){return e},get model(){return g},get modelContainer(){return y},on:function(e,t){_.on(e,t)},getViewContainer:function(){return m.modelContainer.$el},getHeightForWidth:function(e,t){return m.modelContainer.getHeightForWidth(e,t)},initializeView:function(){m.modelContainer.setup(),m.modelContainer.repaint()},resize:function(){m.modelContainer.resize()},repaint:function(){m.modelContainer.repaint()},updateView:function(){m.modelContainer.update()},reload:h,reset:function(e){g.stop(),b=e,g.reset(),b=void 0},state:function(){return g.serialize()},ScriptingAPI:l,enableKeyboardHandlers:function(){return g.get("enableKeyboardHandlers")}},null!=i&&p(),r.getModel=function(){return g},v="function"==typeof u?new u(m):[],m}var n=(e("lab.config"),e("common/performance")),r=function(){return this}();return t.LOAD_CAUSE={RELOAD:"reload",INITIAL_LOAD:"initialLoad"},t.RESET_CAUSE={RESET:"reset"},t}),define("common/serialize",["require","arrays"],function(e){var t=e("arrays"),n=function(e){var r,i;if(t.isArray(e))for(r=0,i=e.length;r<i;r++)e[r]!==1/0&&e[r]!==-(1/0)||(e[r]=e[r].toString());else for(r in e)e.hasOwnProperty(r)&&(e[r]!==1/0&&e[r]!==-(1/0)||(e[r]=e[r].toString()),("object"==typeof e[r]||t.isArray(e[r]))&&n(e[r]))};return function(e,r,i){var o,a,s={};for(o in e)e.hasOwnProperty(o)&&void 0!==r[o]&&e[o].serialize!==!1&&(a=r[o],t.isArray(a)?s[o]=t.copy(a,[],i):"object"==typeof a&&null!==a?s[o]=$.extend(!0,{},a):s[o]=a);return n(s),s}}),define("common/property-support",[],function(){function e(e,t,n){if(typeof n!==e)throw new TypeError(t+" must be a "+e+".")}function t(e){var t=[];return e.forEach(function(e){t.push(e)}),t}var n={get:{defaultValue:void 0,type:"function"},set:{defaultValue:void 0,type:"function"},validate:{defaultValue:void 0,type:"function"},beforeSetCallback:{defaultValue:void 0,type:"function"},afterSetCallback:{defaultValue:void 0,type:"function"},afterGetTransform:{defaultValue:void 0,type:"function"},beforeSetTransform:{defaultValue:void 0,type:"function"},writable:{defaultValue:!0,type:"boolean"},includeInHistoryState:{defaultValue:!1,type:"boolean"},invokeSetterAfterBulkRestore:{defaultValue:!0,type:"boolean"},type:{defaultValue:void 0,type:"propertyType"},description:{defaultValue:void 0}};return function(r){function i(){return P.filter(function(e){return _[e].observers.length>0})}function o(e){if(b.indexOf(e)<0)throw new TypeError(e+" is not a recognized property type.")}function a(t){var r={};return Object.keys(n).forEach(function(i){var a=n[i];if(void 0!==t[i])switch(r[i]=t[i],a.type){case"boolean":r[i]=!!r[i];break;case"function":e("function",i,t[i]);break;case"string":e("string",i,t[i]);break;case"propertyType":o(t[i])}else r[i]=a.defaultValue}),r}function s(e){var t=[];e.forEach(function(e){t.indexOf(e)<0&&(e(),t.push(e))})}function l(e){var t=[];C=!0,e(),C=!1,k.forEach(function(e){_[e].observers.forEach(function(e){t.push(e)})}),k=[],s(t)}function u(e){C?k.push(e):s(_[e].observers)}function c(e){s(_[e].propertyDescriptionObservers)}function d(e){var t=_[e];return t.descriptor.get?w?(t.hasCachedValue||(t.hasCachedValue=!0,t.cachedValue=t.descriptor.get()),t.cachedValue):t.descriptor.get():t.cachedValue}function p(e,t){var n=_[e];if(!n.descriptor.writable)throw new Error("Attempt to set read-only property "+e);n.descriptor.get&&!w?n.hasCachedValue=!1:(n.hasCachedValue=!0,n.cachedValue=t)}function f(e,t){var n=_[e];n.descriptor.description=t,c(e)}function h(e){x.all=void 0,e&&(x.byType[e]=void 0)}function m(e,t){var n=_[t];Object.defineProperty(e,t,{enumerable:!0,configurable:!1,get:function(){var e=d(t);return n.descriptor.afterGetTransform&&(e=n.descriptor.afterGetTransform(e)),e},set:function(e){n.descriptor.beforeSetCallback&&n.descriptor.beforeSetCallback(),n.descriptor.beforeSetTransform&&(e=n.descriptor.beforeSetTransform(e)),n.descriptor.validate&&(e=n.descriptor.validate(e)),p(t,e),n.descriptor.set&&n.descriptor.set(e),n.descriptor.afterSetCallback&&n.descriptor.afterSetCallback(),u(t)}})}function g(e){var t=e?x.byType[e]:x.all;return t||(t={},Object.keys(_).forEach(function(n){e&&e!==_[n].descriptor.type||m(t,n)}),Object.seal&&Object.seal(t),e?x.byType[e]=t:x.all=t),t}var v,y,b=r&&r.types&&t(r.types)||[],_={},x={all:void 0,byType:{}},w=!0,C=!1,T=d3.dispatch("beforeInvalidatingChange","afterInvalidatingChange","afterInvalidatingChangeSequence"),S=0,A=!1,k=[],P=[],E=[];return y={mixInto:function(e){Object.defineProperty(e,"properties",{configurable:!1,enumerable:!0,get:g}),e.propertiesOfType=function(e){return g(e)},e.set=function(t,n){var r;"string"==typeof t?e.properties[t]=n:(r=t,l(function(){Object.keys(r).forEach(function(t){e.properties[t]=r[t]})}))},e.get=function(t){return e.properties[t]},e.freeze=function(t){var n=e.getPropertyDescription(t);n.setFrozen(!0),f(t,n)},e.unfreeze=function(t){var n=e.getPropertyDescription(t);n.setFrozen(!1),f(t,n)},e.addObserver=function(e,t){if(_[e]){var n=_[e].observers;n.indexOf(t)<0&&n.push(t)}},e.removeObserver=function(e,t){var n=_[e].observers,r=n.indexOf(t);r>=0&&n.splice(r,1)},e.addPropertyDescriptionObserver=function(e,t){if(_[e]){var n=_[e].propertyDescriptionObservers;n.indexOf(t)<0&&n.push(t)}},e.removePropertyDescriptionObserver=function(e,t){var n=_[e].propertyDescriptionObservers,r=n.indexOf(t);r>=0&&n.splice(r,1)},e.hasProperty=function(e){return null!=_[e]},e.isPropertyWritable=function(e){return!!_[e]&&_[e].descriptor.writable},e.getPropertyDescription=function(e){return _[e]&&_[e].descriptor?_[e].descriptor.description:null},e.getPropertyType=function(e){return _[e]&&_[e].descriptor?_[e].descriptor.type:null},e.getPropertyValidateFunc=function(e){return _[e]&&_[e].descriptor?_[e].descriptor.validate:null},e.makeInvalidatingChange=function(e){y.invalidatingChangePreHook(),e&&e(),y.invalidatingChangePostHook()},e.addPropertiesListener=function(t,n){"string"==typeof t?e.addObserver(t,n):t.forEach(function(t){e.addObserver(t,n)})}},defineProperty:function(e,t){t=a(t||{}),_[e]={descriptor:t,observers:[],propertyDescriptionObservers:[],hasCachedValue:!1,cachedValue:void 0,previousValue:void 0},t.get&&P.push(e),t.includeInHistoryState&&E.push(e),h(t.type)},setPropertyDescription:function(e,t){f(e,t)},deleteComputedPropertyCachedValues:function(){P.forEach(function(e){_[e].hasCachedValue=!1,_[e].cachedValue=void 0})},storeComputedProperties:function(){i().forEach(function(e){_[e].previousValue=d(e)})},notifyChangedComputedProperties:function(){l(function(){i().forEach(function(e){d(e)!==_[e].previousValue&&u(e),_[e].previousValue=void 0})})},notifyAllComputedProperties:function(){l(function(){i().forEach(function(e){u(e)})})},get properties(){return g()},propertiesOfType:function(e){return g(e)},get enableCaching(){return w},set enableCaching(e){w=!!e},get historyStateRawValues(){var e={};return E.forEach(function(t){e[t]=d(t)}),e},get rawValues(){var e={};return Object.keys(_).forEach(function(t){e[t]=d(t)}),e},setRawValues:function(e){l(function(){Object.keys(e).forEach(function(t){var n=_[t];n&&(d(t)!==e[t]&&u(t),p(t,e[t]),n.descriptor.invokeSetterAfterBulkRestore&&n.descriptor.set&&n.descriptor.set(d(t)))})})},invalidatingChangePreHook:function(){A&&v||(v=!0,0===S&&(y.storeComputedProperties(),y.deleteComputedPropertyCachedValues(),y.enableCaching=!1),S++,T.beforeInvalidatingChange())},invalidatingChangePostHook:function(){A||(S--,T.afterInvalidatingChange(),0===S&&(y.enableCaching=!0,y.notifyChangedComputedProperties(),T.afterInvalidatingChangeSequence()))},startBatch:function(){v=!1,A=!0},endBatch:function(){A=!1,v&&y.invalidatingChangePostHook()},on:function(e,t){T.on(e,t)}}}}),define("common/property-description",["require","underscore"],function(e){function t(e){return""===e}function n(e,t){var n;if(this._descriptionHash=t,this._label=t.label||"",this._unitName="",this._unitPluralName="",this._unitAbbreviation="",t.unitType){if(!(n=e.units[t.unitType]))throw new Error("PropertyDescription: couldn't find unitType "+t.unitType+" in the supplied units definition.");this._unitType=t.unitType,this._unitName=n.name,this._unitPluralName=n.pluralName,this._unitAbbreviation=n.symbol}t.unitName&&(this._unitName=t.unitName),t.unitPluralName&&(this._unitPluralName=t.unitPluralName),t.unitAbbreviation&&(this._unitAbbreviation=t.unitAbbreviation),this._min=t.min,this._max=t.max,this._frozen=t.frozen,this.setFormat(t.format)}var r=e("underscore");return n.prototype.getHash=function(){return r.extend(r.reject({unitName:this.getUnitName(),unitPluralName:this.getUnitPluralName(),unitAbbreviation:this.getUnitAbbreviation()},t),this._descriptionHash)},n.prototype.getLabel=function(){return this._label},n.prototype.getUnitType=function(){return this._unitType},n.prototype.getUnitName=function(){return this._unitName},n.prototype.getUnitPluralName=function(){return this._unitPluralName},n.prototype.getUnitAbbreviation=function(){return this._unitAbbreviation},n.prototype.getMin=function(){return this._min},n.prototype.getMax=function(){return this._max},n.prototype.getFrozen=function(){return this._frozen},n.prototype.setFrozen=function(e){this._frozen=e},n.prototype.setFormat=function(e){e?this._formatter=d3.format(e):this._formatter=function(e){return e}},n.prototype.format=function(e,t){t=t||{};var n,r,i,o=!0;return t.format?t.format===this._lastFormat?n=this._lastFormatter:(n=d3.format(t.format),this._lastFormat=t.format,this._lastFormatter=n):n=this._formatter,r=n(e),t&&null!=t.abbreviated&&(o=t.abbreviated),o?r+" "+this._unitAbbreviation:(i=1!==parseFloat(r),r+" "+(i?this._unitPluralName:this._unitName))},n}),define("common/parameter-support",["require","common/property-description"],function(e){var t=e("common/property-description");return function(e){var n=e.propertySupport,r=e.unitsDefinition||{};return{mixInto:function(e){e.defineParameter=function(i,o,a){var s={type:"parameter",includeInHistoryState:!0,invokeSetterAfterBulkRestore:!1,description:new t(r,o),beforeSetCallback:n.invalidatingChangePreHook,afterSetCallback:n.invalidatingChangePostHook};a&&(s.set=function(t){a.call(e,t)}),n.defineProperty(i,s)}}}}}),define("cs",{load:function(e){throw new Error("Dynamic load not allowed: "+e)}}),function(){define("cs!common/filters/running-average-filter",["require"],function(e){var t;return t=function(){function e(e){this.periodLength=e,this._value=[],this._time=[],this._idx=-1,this._maxBufferLength=this.periodLength}return e.prototype.addSample=function(e,t){var n;if(this._time[this._idx]===e)return void(this._value[this._idx]=t);if(this._time[this._idx]>e)throw new Error("RunningAverageFilter: cannot add sample with @_time less than previous sample.");for(this._idx++,this._value.push(t),this._time.push(e),n=[];this._value.length>this._maxBufferLength;)this._time.shift(),this._value.shift(),n.push(this._idx--);return n},e.prototype.calculate=function(){var e,t,n,r,i,o;for(t=Math.max(this._time[this._idx]-this.periodLength,0),o=0,i=0,e=this._idx;e>0&&this._time[e-1]>=t;)r=this._time[e]-this._time[e-1],i+=r,o+=r*(this._value[e-1]+this._value[e])/2,e--;return e>0&&this._time[e]>t&&this._time[e-1]<t&&(r=this._time[e]-t,i+=r,n=this._value[e-1]+(this._value[e]-this._value[e-1])*(t-this._time[e-1])/(this._time[e]-this._time[e-1]),o+=r*(this._value[e]+n)/2),i?o/i:this._value[0]||0},e.prototype.getCurrentBufferLength=function(){return this._value.length},e.prototype.setMaxBufferLength=function(e){return this._maxBufferLength=e},e.prototype.getCurrentTime=function(){return this._time[this._idx]},e.prototype.getCurrentStep=function(){return this._idx},e.prototype.setCurrentStep=function(e){if(e<-1||e>=this._value.length)throw new Error("RunningAverageFilter: cannot seek, location outside available range.");return this._idx=e},e.prototype.invalidate=function(e){return this._value.length=e+1,this._time.length=e+1,this._idx=e},e.prototype.reset=function(){return this._values.length=0,this._time=0,this._idx=0},e}()})}.call(this),function(){define("cs!common/filters/simple-period-filter",["require"],function(e){var t;return t=function(){function e(){this._values=[],this._time=[],this._idx=-1,this._zero_crossing_buffer=[],this._period_buffer=[],this._maxBufferLength=8192}return e.prototype.addSample=function(e,t){var n,r;if(this._time[this._idx]===e)return void(this._values[this._idx]=t);if(this._time[this._idx]>e)return void console.log("Error: RunningAverageFilter: cannot add sample with @_time less than previous sample.");for(this._idx++,this._values.push(t),this._time.push(e),this._values.length>1&&(n=this._values[this._values.length-2]);this._values.length>this._maxBufferLength;)this._time.shift(),this._values.shift(),this._idx--;if(n<0&&t>0||n>0&&t<0)for(this._zero_crossing_buffer.push(e),this._zero_crossing_buffer.length>1&&(r=this._zero_crossing_buffer[this._zero_crossing_buffer.length-2],this._period_buffer.push(e-r));this._zero_crossing_buffer.length>128;)this._zero_crossing_buffer.shift(),this._period_buffer.shift()},e.prototype.calculate=function(){var e,t;return this._period_buffer.length<1?0:1===this._period_buffer.length?2*this._period_buffer[0]:(t=this._period_buffer.reduce(function(e,t){return e+t}),e=t/this._period_buffer.length,2*e)},e.prototype.getCurrentBufferLength=function(){return this._values.length},e.prototype.setMaxBufferLength=function(e){return this._maxBufferLength=e},e.prototype.getCurrentTime=function(){return this._time[this._idx]},e.prototype.getCurrentStep=function(){
return this._idx},e.prototype.setCurrentStep=function(e){if(e<-1||e>=this._values.length)throw new Error("SimplePeriodFilter: cannot seek, location outside available range.");return this._idx=e},e.prototype.invalidate=function(e){return e?(this._values.length=e+1,this._time.length=e+1,this._idx=e):this.reset()},e.prototype.reset=function(){this._values.length=0,this._time.length=0,this._idx=0,this._zero_crossing_buffer.length=0,this._period_buffer.length=0},e}()})}.call(this),define("common/output-support",["require","common/property-description","cs!common/filters/running-average-filter","cs!common/filters/simple-period-filter"],function(e){var t=e("common/property-description"),n=e("cs!common/filters/running-average-filter"),r=e("cs!common/filters/simple-period-filter");return function(e){function i(){u.forEach(function(e){e.addSample()})}function o(){u.forEach(function(e){e.reset()})}var a=e.propertySupport,s=e.unitsDefinition||{},l=e.tickHistory||null,u=[];return a.on("afterInvalidatingChange.output-support",i),{mixInto:function(e){e.defineOutput=function(e,n,r){a.defineProperty(e,{type:"output",writable:!1,get:r,includeInHistoryState:!1,description:new t(s,n)})},e.defineFilteredOutput=function(t,i,o,a,s){var c,d;if("RunningAverage"===a)c=new n(s);else{if("SimplePeriod"!==a)throw new Error("FilteredOutput: unknown filter type "+a+".");c=new r}if(d=e.properties[o],void 0===d||isNaN(Number(d)))throw new Error("FilteredOutput: property is not a valid numeric value or it is undefined.");c.addSample(e.properties.time,d),l?l.registerExternalObject({push:function(){c.addSample(e.properties.time,e.properties[o])},extract:function(e){c.setCurrentStep(e)},invalidate:function(e){c.invalidate(e)},setHistoryLength:function(e){c.setMaxBufferLength(e)},reset:function(){c.reset()}}):u.push({addSample:function(){c.addSample(e.properties.time,e.properties[o])}}),i.property=o,i.type=a,i.period=s,e.defineOutput(t,i,function(){return c.calculate()})},e.updateAllOutputProperties=function(){a.deleteComputedPropertyCachedValues(),a.notifyAllComputedProperties(),i()},e.resetAllOutputProperties=function(){o()}}}}}),define("common/playback-support",["require","common/console","common/performance","common/property-description"],function(e){var t=e("common/console"),n=e("common/performance"),r=e("common/property-description");return function(e){function i(e){var t,n=a&&a.properties.modelSampleRate||"default";"default"===n?d3.timer(e):t=window.setInterval(function(){e()&&window.clearInterval(t)},1e3/n)}var o=e&&e.dispatch||null,a=e&&e.propertySupport||null,s=e&&e.unitsDefinition||null,l=e.computeActualUseDuration,u=e.computeActualDuration,c=function(){if(o){if(o.on&&o.addEventTypes)return o.addEventTypes("play","stop","tickStart","tickEnd"),!0;throw new Error("[PlaybackSupport] Provided Dispatch object doesn't implement required interface!")}return!1}(),d=!0,p=!1,f=!1,h=!1;return{mixInto:function(e){var m;a&&e.defineOutput&&(e.defineOutput("durationOptions",{},function(){var e=[30,60,120,300,600,1800,3600],t=a.properties.timePerTick;return null!=t?e.map(function(e){return e*t}):[]}),e.defineOutput("actualUseDuration",{},l),e.defineOutput("actualDuration",{label:"Experiment duration",unitType:"time",format:"f"},u)),!e.formatTime&&s&&(m=new r(s,{unitType:"time",format:".1f"}),e.formatTime=function(e){return m.format(e)}),"function"!=typeof e.tick&&(e.tick=function(){t.warn("[PlaybackSupport] .tick() method should be overwritten by target!")}),e.start=function(){return p=!1,f=!1,d?(d=!1,i(function(t){return c&&o.tickStart(),n.leaveScope("gap"),p?(d=!0,c&&o.stop(),!0):f?(setTimeout(e.start,0),d=!0,!0):a&&a.properties.time>=a.properties.actualDuration?(e.stop(),!1):(n.enterScope("tick"),e.tick(t),n.leaveScope("tick"),n.enterScope("gap"),!1)}),c&&o.play(),n.enterScope("gap"),e):e},e.restart=function(){return f=!0,e},e.stop=function(){return p=!0,e},e.isStopped=function(){return d||p},e.on("play.playback-support",function(){h=!0}),e.on("reset.playback-support",function(){h=!1}),Object.defineProperty(e,"hasPlayed",{enumerable:!0,get:function(){return h}})}}}}),define("common/define-builtin-properties",["require","common/validator","common/property-description"],function(e){var t=e("common/validator"),n=e("common/property-description");return function(e){function r(e,r,l){var u,c,d,p;if("mainProperty"===r)u=o.mainProperties;else{if("viewOption"!==r)throw new Error(r+" is not a supported built-in property type");u=o.viewOptions}d=t.propertyChangeInvalidates(u[e]),c={type:r,writable:t.propertyIsWritable(u[e]),set:l,includeInHistoryState:!!u[e].storeInTickHistory,validate:function(n){return t.validateSingleProperty(u[e],e,n,!1)},beforeSetCallback:d?i.invalidatingChangePreHook:void 0,afterSetCallback:d?i.invalidatingChangePostHook:void 0},p=u[e].unitType,c.description=new n(a,{unitType:p,label:u[e].label||e}),p&&s&&(c.beforeSetTransform=function(e){return s.translateToModelUnits(e,p)},c.afterGetTransform=function(e){return s.translateFromModelUnits(e,p)}),i.defineProperty(e,c)}var i=e.propertySupport,o=e.metadata,a=e.unitsDefinition||{},s=e.unitsTranslation||null,l=e.setters||{},u=e.initialProperties||null;!function(){var e,n;Object.keys(o.mainProperties).forEach(function(e){r(e,"mainProperty",l[e])}),Object.keys(o.viewOptions).forEach(function(e){r(e,"viewOption",l[e])}),u&&(e=t.validateCompleteness(o.mainProperties,u),i.setRawValues(e),n=t.validateCompleteness(o.viewOptions,u.viewOptions||{}),i.setRawValues(n))}()}}),define("common/lab-modeler-mixin",["require","common/property-support","common/parameter-support","common/output-support","common/dispatch-support","common/playback-support","common/define-builtin-properties","common/controllers/export-controller"],function(e){var t=e("common/property-support"),n=e("common/parameter-support"),r=e("common/output-support"),i=e("common/dispatch-support"),o=e("common/playback-support"),a=e("common/define-builtin-properties"),s=e("common/controllers/export-controller");return function(e){function l(){var e,t=b.properties.actualUseDuration,n=b.properties.requestedDuration;return t?null!=n?n:(e=b.properties.durationOptions,e.length>0?e[Math.floor(e.length/2)]:1/0):1/0}function u(){var e=b.properties.useDuration;return e===!0||"codap"===e&&s.canExportData()}var c,d,p=e.metadata,f=e.setters,h=e.unitsDefinition,m=e.unitsTranslation,g=e.initialProperties,v=e.tickHistory,y=void 0===e.usePlaybackSupport||!!e.usePlaybackSupport,b=new t({types:["output","parameter","mainProperty","viewOption"]}),_=new n({propertySupport:b,unitsDefinition:h}),x=new r({propertySupport:b,unitsDefinition:h,tickHistory:v}),w=new i;y&&(d=new o({dispatch:w,propertySupport:b,unitsDefinition:h,computeActualDuration:l,computeActualUseDuration:u}));var C=!1;return w.addEventTypes("reset","stepForward","stepBack","seek","invalidation","willReset","ready","log"),c={mixInto:function(e){b.mixInto(e),_.mixInto(e),x.mixInto(e),w.mixInto(e),d&&d.mixInto(e),e.willReset=function(){w.willReset()},e.ready=function(){if(C)throw new Error("ready() called on an already-ready model.");c.tickHistory&&(c.tickHistory.saveInitialState(),c.tickHistory.push()),b.invalidatingChangePreHook(),C=!0,b.invalidatingChangePostHook(),w.ready()},Object.defineProperty(e,"isReady",{enumerable:!0,get:function(){return C}}),p&&a({propertySupport:b,metadata:p,unitsDefinition:h,unitsTranslation:m,setters:f,initialProperties:g})},get propertySupport(){return b},get parameterSupport(){return _},get outputSupport(){return x},get dispatchSupport(){return w},get playbackSupport(){return d},get computeActualDuration(){return l},get computeActualUseDuration(){return u}}}}),define("common/models/tick-history",[],function(){return function(e,t,n){function r(){return{input:{},state:[],parameters:{}}}function i(){var e;for(d=[],p={length:0,maxSize:n,index:-1,counter:-1,startCounter:0},e=0;e<m.length;e++)m[e].reset&&m[e].reset()}function o(t){var n,r,i,o,a;if(g)t.input=e.getProperties();else{for(n=0;n<e.input.length;n++)r=e.input[n],t.input[r]=e.getRawPropertyValue(r);o=e.parameters;for(a in o)o.hasOwnProperty(a)&&o[a].isDefined&&(t.parameters[a]=e.getRawPropertyValue(a))}for(i=e.state,n=0;n<i.length;n++)t.state[n]=i[n].clone()}function a(){var e,t=r();for(o(t),d[p.index+1]=t,d.length>p.maxSize?(d.splice(0,1),p.startCounter++):p.index++,p.counter=p.index+p.startCounter,e=0;e<m.length;e++)m[e].push();s(),p.length=d.length}function s(){var e;for(d.length=p.index+1,p.length=d.length,e=0;e<m.length;e++)m[e].invalidate(p.index)}function l(t){var n,r;for(e.restoreProperties(t.input),g||e.restoreParameters(t.parameters),r=t.state,n=0;n<r.length;n++)e.state[n].restore(r[n]);for(n=0;n<m.length;n++)m[n].extract(p.index)}function u(e){if(e<0)throw new Error("TickHistory: extract index ["+e+"] less than 0");if(e>=d.length)throw new Error("TickHistory: extract index ["+e+"] greater than list.length: "+d.length);return e}var c,d,p,f={},h=1e3,m=[],g=!!e.getProperties;return f.isEmpty=function(){return 0===p.index},f.push=function(){a()},f.returnTick=function(e){var t;return t="number"==typeof e?e:p.index,u(t),d[t]},f.extract=function(e){var t;t="number"==typeof e?e:p.index,u(t),l(d[t])},f.saveInitialState=function(){c=r(),o(c)},f.restoreInitialState=function(){i(),l(c),a()},f.reset=i,f.decrementExtract=function(){p.counter>p.startCounter&&(p.index--,p.counter--,l(d[p.index]))},f.incrementExtract=function(){p.index++,p.counter++,l(d[p.index])},f.seekExtract=function(e){e<p.startCounter&&(e=p.startCounter),e>=p.startCounter+p.length&&(e=p.startCounter+p.length-1),p.counter=e,p.index=e-p.startCounter,l(d[p.index])},f.invalidateFollowingState=s,f.get=function(e){return p[e]},f.set=function(e,t){return p[e]=t},f.registerExternalObject=function(e){e.setHistoryLength(p.maxSize),m.push(e)},null==n&&(n=h),i(),f}}),define("models/md2d/models/aminoacids-props",[],function(){return[{fullName:"Alanine",abbreviation:"Ala",symbol:"A",molWeight:89.09,charge:0,hydrophobicityRB:2.15,pK:0,surface:115,volume:88.6,solubility:16.65,hydrophobicity:1,property:"Total aliphatic; hydrophobic"},{fullName:"Arginine",abbreviation:"Arg",symbol:"R",molWeight:174.2,charge:1,hydrophobicityRB:2.23,pK:12,surface:225,volume:173.4,solubility:15,hydrophobicity:-2,property:"Acidic side chains; strongly polar; cationic"},{fullName:"Asparagine",abbreviation:"Asn",symbol:"N",molWeight:132.12,charge:0,hydrophobicityRB:1.05,pK:0,surface:160,volume:114.1,solubility:3.53,hydrophobicity:-1,property:"Strongly polar"},{fullName:"Asparticacid",abbreviation:"Asp",symbol:"D",molWeight:133.1,charge:-1,hydrophobicityRB:1.13,pK:4.4,surface:150,volume:111.1,solubility:.778,hydrophobicity:-2,property:"Acidic side chains; strongly polar; anionic"},{fullName:"Cysteine",abbreviation:"Cys",symbol:"C",molWeight:121.15,charge:0,hydrophobicityRB:1.2,pK:8.5,surface:135,volume:108.5,solubility:1e3,hydrophobicity:1,property:"Polar side chains; semipolar"},{fullName:"Glutamine",abbreviation:"Gln",symbol:"Q",molWeight:146.15,charge:0,hydrophobicityRB:1.65,pK:0,surface:180,volume:143.8,solubility:2.5,hydrophobicity:-1,property:"Strongly polar"},{fullName:"Glutamicacid",abbreviation:"Glu",symbol:"E",molWeight:147.13,charge:-1,hydrophobicityRB:1.73,pK:4.4,surface:190,volume:138.4,solubility:.864,hydrophobicity:-2,property:"Acidic side chains; strongly polar; anionic"},{fullName:"Glycine",abbreviation:"Gly",symbol:"G",molWeight:75.07,charge:0,hydrophobicityRB:1.18,pK:0,surface:75,volume:60.1,solubility:24.99,hydrophobicity:1,property:"Semipolar"},{fullName:"Histidine",abbreviation:"His",symbol:"H",molWeight:155.16,charge:1,hydrophobicityRB:2.45,pK:6.5,surface:195,volume:153.2,solubility:4.19,hydrophobicity:-2,property:"Basic side chains; strongly polar; cationic"},{fullName:"Isoleucine",abbreviation:"Ile",symbol:"I",molWeight:131.17,charge:0,hydrophobicityRB:3.88,pK:0,surface:175,volume:166.7,solubility:4.117,hydrophobicity:1,property:"Branched chain aliphatic; hydrophobic"},{fullName:"Leucine",abbreviation:"Leu",symbol:"L",molWeight:131.17,charge:0,hydrophobicityRB:4.1,pK:10,surface:170,volume:166.7,solubility:2.426,hydrophobicity:1,property:"Branched chain aliphatic; hydrophobic"},{fullName:"Lysine",abbreviation:"Lys",symbol:"K",molWeight:146.19,charge:1,hydrophobicityRB:3.05,pK:0,surface:200,volume:168.6,solubility:1e3,hydrophobicity:-2,property:"Acidic side chains; strongly polar; cationic"},{fullName:"Methionine",abbreviation:"Met",symbol:"M",molWeight:149.21,charge:0,hydrophobicityRB:3.43,pK:0,surface:185,volume:162.9,solubility:3.81,hydrophobicity:1,property:"Totally alyphatic"},{fullName:"Phenylalanine",abbreviation:"Phe",symbol:"F",molWeight:165.19,charge:0,hydrophobicityRB:3.46,pK:0,surface:210,volume:189.9,solubility:2.965,hydrophobicity:2,property:"Totally aromatic"},{fullName:"Proline",abbreviation:"Pro",symbol:"P",molWeight:115.13,charge:0,hydrophobicityRB:3.1,pK:0,surface:145,volume:112.7,solubility:162.3,hydrophobicity:1,property:"Totally alyphatic"},{fullName:"Serine",abbreviation:"Ser",symbol:"S",molWeight:105.09,charge:0,hydrophobicityRB:1.4,pK:0,surface:115,volume:89,solubility:5.023,hydrophobicity:-1,property:"Semipolar"},{fullName:"Threonine",abbreviation:"Thr",symbol:"T",molWeight:119.12,charge:0,hydrophobicityRB:2.25,pK:0,surface:140,volume:116.1,solubility:1e3,hydrophobicity:-1,property:"Semipolar"},{fullName:"Tryptophan",abbreviation:"Trp",symbol:"W",molWeight:204.23,charge:0,hydrophobicityRB:4.11,pK:0,surface:255,volume:227.8,solubility:1.136,hydrophobicity:2,property:"Totally aromatic"},{fullName:"Tyrosine",abbreviation:"Tyr",symbol:"Y",molWeight:181.19,charge:0,hydrophobicityRB:2.81,pK:10,surface:230,volume:193.6,solubility:.045,hydrophobicity:1,property:"Hydrophobic; total aromatic"},{fullName:"Valine",abbreviation:"Val",symbol:"V",molWeight:117.15,charge:0,hydrophobicityRB:3.38,pK:0,surface:155,volume:140,solubility:8.85,hydrophobicity:1,property:"Branched chain aliphatic; hydrophobic"}]}),function(){define("cs!models/md2d/models/aminoacids-helper",["require","models/md2d/models/aminoacids-props"],function(e){var t,n,r;return r=e("models/md2d/models/aminoacids-props"),t=5,n={UUU:"Phe",UUC:"Phe",UUA:"Leu",UUG:"Leu",CUU:"Leu",CUC:"Leu",CUA:"Leu",CUG:"Leu",AUU:"Ile",AUC:"Ile",AUA:"Ile",AUG:"Met",GUU:"Val",GUC:"Val",GUA:"Val",GUG:"Val",UCU:"Ser",UCC:"Ser",UCA:"Ser",UCG:"Ser",AGU:"Ser",AGC:"Ser",CCU:"Pro",CCC:"Pro",CCA:"Pro",CCG:"Pro",ACU:"Thr",ACC:"Thr",ACA:"Thr",ACG:"Thr",GCU:"Ala",GCC:"Ala",GCA:"Ala",GCG:"Ala",UAU:"Tyr",UAC:"Tyr",CAU:"His",CAC:"His",CAA:"Gln",CAG:"Gln",AAU:"Asn",AAC:"Asn",AAA:"Lys",AAG:"Lys",GAU:"Asp",GAC:"Asp",GAA:"Glu",GAG:"Glu",UGU:"Cys",UGC:"Cys",UGG:"Trp",CGU:"Arg",CGC:"Arg",CGA:"Arg",CGG:"Arg",AGA:"Arg",AGG:"Arg",GGU:"Gly",GGC:"Gly",GGA:"Gly",GGG:"Gly",UAA:"STOP",UAG:"STOP",UGA:"STOP"},{firstElementID:t,lastElementID:t+r.length-1,cysteineElement:9,abbrToElement:function(e){var t,n,i,o;for(n=i=0,o=r.length;i<o;n=++i)if(t=r[n],t.abbreviation===e)return n+this.firstElementID},getAminoAcidByElement:function(e){return r[e-this.firstElementID]},isAminoAcid:function(e){return e>=this.firstElementID&&e<=this.lastElementID},getPolarAminoAcids:function(){var e,t,n,r,i;for(r=["Asn","Gln","Ser","Thr"],i=[],t=0,n=r.length;t<n;t++)e=r[t],i.push(this.abbrToElement(e));return i},codonToAbbr:function(e){return 3!==e.length?"STOP":n[e]}}})}.call(this),define("models/md2d/models/engine/math/distributions",["require","exports","module"],function(e,t,n){t.normal=function(){var e=null;return function(t,n){null==t&&(t=0),null==n&&(n=1);var r,i,o,a,s;return e?(i=e,e=null,i):(a=Math.random(),s=Math.random(),o=2*Math.PI*a,r=Math.sqrt(-2*Math.log(s)),e=t+n*(r*Math.sin(o)),t+n*(r*Math.cos(o)))}}()}),define("models/md2d/models/engine/math/utils",["require","exports","module"],function(e,t,n){t.getWindowedAverager=function(e){null==e&&(e=1e3);var t=0,n=[],r=0;return function(i){return r-=n[t]||0,r+=i,n[t]=i,++t===e&&(t=0),n.length===e?r/e:NaN}},t.getAngleBetweenVec=function(e,t,n,r,i,o){var a=e-i,s=n-i,l=t-o,u=r-o,c=a*a+l*l,d=s*s+u*u,p=Math.sqrt(c),f=Math.sqrt(d),h=(a*s+l*u)/(p*f);return h>1?h=1:h<-1&&(h=-1),Math.acos(h)}}),define("models/md2d/models/engine/math/minimizer",["require","exports","module","common/console"],function(e,t,n){var r=e("common/console");t.minimize=function(e,t,n){n=n||{},null==n.precision&&(n.precision=.01);var i,o,a,s,l,u,c,d,p,f,h=n.precision,m=n.bounds,g=n.maxiter||1e3,v=n.stopval||-(1/0),y=n.maxstep||.01,b=n.eps||.01,_=t.length;for(u=y*y,i=[],p=0;p<_;p++)i[p]=t[p];o=e.apply(null,i),a=o[0],l=o[1],d=0;do{if(a<=v)break;if(d>g)return r.log("maxiter reached"),{error:"maxiter reached",f:a,iter:g,x:i};for(c=0,p=0;p<_;p++)c+=l[p]*l[p];if(b*b*c>u)for(f=Math.sqrt(u/c)/b,p=0;p<_;p++)l[p]=f*l[p];for(p=0;p<_;p++)i[p]-=b*l[p],m&&i[p]<m[p][0]&&(i[p]=m[p][0]),m&&i[p]>m[p][1]&&(i[p]=m[p][1]);s=a,o=e.apply(null,i),a=o[0],l=o[1],d++}while(Math.abs(a-s)>h);return[a,i]}}),define("models/md2d/models/engine/math/index",["require","exports","module","./distributions","./utils","./utils","./minimizer"],function(e,t,n){t.normal=e("./distributions").normal,t.getWindowedAverager=e("./utils").getWindowedAverager,t.getAngleBetweenVec=e("./utils").getAngleBetweenVec,t.minimize=e("./minimizer").minimize}),define("models/md2d/models/engine/potentials/coulomb",["require","exports","module","../constants/index"],function(e,t,n){var r=e("../constants/index"),i=r.unit,o=.346,a=r.COULOMB_CONSTANT.as(r.unit.METERS_PER_FARAD),s=r.ratio(i.NANOMETER,{per:i.METER}),l=Math.pow(r.ratio(i.COULOMB,{per:i.ELEMENTARY_CHARGE}),2),u=r.ratio(i.EV,{per:i.JOULE}),c=r.ratio(i.MW_FORCE_UNIT,{per:i.NEWTON}),d=o*a*l*s*u,p=o*a*l*s*s*c,f=(t.potential=function(e,t,n,r,i){return i&&r>1&&e<1.2&&(r=1+(r-1)/(1+Math.exp(-12*e+7))),d*(t*n/e)/r},t.forceFromSquaredDistance=function(e,t,n,r,i){var o=Math.sqrt(e);return i&&r>1&&o<1.2&&(r=1+(r-1)/(1+Math.exp(-12*o+7))),-p*(t*n/e)/r});t.forceOverDistanceFromSquaredDistance=function(e,t,n,r,i){return f(e,t,n,r,i)/Math.sqrt(e)},t.force=function(e,t,n,r,i){return f(e*e,t,n,r,i)}}),define("models/md2d/models/engine/potentials/lennard-jones",["require","exports","module","../constants/index"],function(e,t,n){var r=e("../constants/index"),i=r.unit,o=r.ratio(i.NANOMETER,{per:i.METER}),a=r.ratio(i.MW_FORCE_UNIT,{per:i.NEWTON});t.pairwiseEpsilon=function(e,t){return.5*(e+t)},t.pairwiseSigma=function(e,t){return Math.sqrt(e*t)},t.rmin=function(e){return Math.pow(2,1/6)*e},t.radius=function(e){return.5*e},t.newLJCalculator=function(e,n){var s,l,u,c,d,p,f,h,m=!1,g=function(e,h){s=e,l=h,u=t.rmin(l),null!=s&&null!=l&&(c=4*s*Math.pow(l,12),d=4*s*Math.pow(l,6),p=12*r.convert(c,{from:i.EV,to:i.JOULE})*o*a,f=6*r.convert(d,{from:i.EV,to:i.JOULE})*o*a),m&&"function"==typeof n&&n(v(),this)},v=function(){return{epsilon:s,sigma:l,rmin:u}},y=function(e){if(null==e||parseFloat(e)!==e)throw new Error("lennardJones: epsilon value "+e+" is invalid")},b=function(e){if(null==e||parseFloat(e)!==e||e<=0)throw new Error("lennardJones: sigma value "+e+" is invalid")};return y(e.epsilon),b(e.sigma),g(e.epsilon,e.sigma),m=!0,h={getCoefficients:v,setEpsilon:function(e){y(e),g(e,l)},setSigma:function(e){b(e),g(s,e)},potentialFromSquaredDistance:function(e){return e?c*Math.pow(e,-6)-d*Math.pow(e,-3):-(1/0)},potential:function(e){return h.potentialFromSquaredDistance(e*e)},forceOverDistanceFromSquaredDistance:function(e){var t=1/e,n=t*t*t,r=n*t,i=r*n;return p*i-f*r},force:function(e){return e*h.forceOverDistanceFromSquaredDistance(e*e)}}}}),define("models/md2d/models/engine/potentials/index",["require","exports","module","./coulomb","./lennard-jones"],function(e,t,n){t.coulomb=e("./coulomb"),t.lennardJones=e("./lennard-jones")}),function(){var e={}.hasOwnProperty;define("cs!models/md2d/models/engine/pairwise-lj-properties",["require","models/md2d/models/metadata","common/validator"],function(t){var n,r,i;return r=t("models/md2d/models/metadata"),i=t("common/validator"),n=function(){function t(e){this._engine=e,this._data={}}return t.prototype.registerChangeHooks=function(e,t){return this._changePreHook=e,this._changePostHook=t},t.prototype.set=function(t,n,o){var a;o=i.validate(r.pairwiseLJProperties,o),this._changePreHook(),null==this._data[t]&&(this._data[t]={}),null==this._data[n]&&(this._data[n]={}),null==this._data[t][n]&&(this._data[t][n]=this._data[n][t]={});for(a in o)e.call(o,a)&&(this._data[t][n][a]=o[a]);return this._engine.setPairwiseLJProperties(t,n),this._changePostHook()},t.prototype.remove=function(e,t){return this._changePreHook(),delete this._data[e][t],delete this._data[t][e],this._engine.setPairwiseLJProperties(e,t),this._changePostHook()},t.prototype.get=function(e,t){return this._data[e]&&this._data[e][t]?this._data[e][t]:void 0},t.prototype.deserialize=function(e){var t,n,o,a,s;for(a=0,s=e.length;a<s;a++)o=e[a],o=i.validateCompleteness(r.pairwiseLJProperties,o),t=o.element1,n=o.element2,delete o.element1,delete o.element2,this.set(t,n,o)},t.prototype.serialize=function(){var t,n,r,i,o,a;o=[],a=this._data;for(n in a)if(e.call(a,n)){t=a[n];for(r in t)e.call(t,r)&&n<r&&(i=this.get(n,r),i.element1=Number(n),i.element2=Number(r),o.push(i))}return o},t.prototype.clone=function(){return $.extend(!0,{},this._data)},t.prototype.restore=function(t){var n,r,i,o;this._data=t,o=this._data;for(r in o)if(e.call(o,r)){n=o[r];for(i in n)e.call(n,i)&&r<i&&this._engine.setPairwiseLJProperties(r,i)}},t}()})}.call(this),define("models/md2d/models/engine/cell-list",[],function(){return function(e,t,n){var r,i,o,a,s,l=function(){var r;for(i=Math.ceil(e/n),o=Math.ceil(t/n),a=i*o,s=new Array(a),r=0;r<a;r++)s[r]=[]};return l(),r={reinitialize:function(r,i,o){var a=!1;void 0!==r&&r!==e&&(e=r,a=!0),void 0!==i&&i!==t&&(t=i,a=!0),void 0!==o&&o!==n&&(n=o,a=!0),a&&l()},addToCell:function(e,t,r){var o=Math.floor(r/n)*i+Math.floor(t/n);s[o].push(e)},getCell:function(e){return s[e]},getRowsNum:function(){return o},getColsNum:function(){return i},getNeighboringCells:function(e,t){var n=e*i+t,r=[];return t+1<i&&e+1<o&&r.push(s[n+i+1]),t+1<i&&r.push(s[n+1]),t+1<i&&e-1>=0&&r.push(s[n-i+1]),e-1>=0&&r.push(s[n-i]),r},clear:function(){var e;for(e=0;e<a;e++)s[e].length=0}}}}),define("models/md2d/models/engine/neighbor-list",["require","arrays","common/array-types"],function(e){var t=e("arrays"),n=e("common/array-types");return function(e,r){var i,o,a,s,l,u,c,d,p,f,h=function(){o=e+10,a=0,s=o*(o-1)/2,f=!0,l=t.create(s,0,n.int16Type),u=t.create(o,-1,n.int16Type),c=t.create(o,-1,n.int16Type),d=t.create(o,1/0,n.floatType),p=t.create(o,1/0,n.floatType)};return h(),i={reinitialize:function(t,n){e=t,r=n,f=!0,e>o&&h()},clear:function(){var t;for(a=0,t=0;t<e;t++)u[t]=c[t]=-1},getList:function(){return l},markNeighbors:function(e,t){u[e]<0&&(u[e]=a),l[a]=t,a++,c[e]=a},getStartIdxFor:function(e){return u[e]},getEndIdxFor:function(e){return c[e]},saveAtomPosition:function(e,t,n){d[e]=t,p[e]=n},invalidate:function(){f=!0},shouldUpdate:function(t,n){var i,o=-(1/0),a=-(1/0);if(f)return f=!1,!0;for(i=0;i<e;i++)Math.abs(t[i]-d[i])>o&&(o=Math.abs(t[i]-d[i])),Math.abs(n[i]-p[i])>a&&(a=Math.abs(n[i]-p[i]));return Math.sqrt(o*o+a*a)>r}}}}),define("common/models/plugin-controller",[],function(){return function(){var e=[];return{registerPlugin:function(t){e.push(t)},callPluginFunction:function(t,n,r){var i,o,a,s;for(i=0,o=e.length;i<o;i++)a=e[i][t],a&&(s=a.apply(e[i],n)),r&&r(s,i,e[i])}}}}),define("models/md2d/models/engine/md2d",["require","exports","module","arrays","common/array-types","common/console","./constants/index","cs!models/md2d/models/aminoacids-helper","./math/index","./potentials/index","./potentials/index","cs!./pairwise-lj-properties","common/models/engines/clone-restore-wrapper","./cell-list","./neighbor-list","common/models/plugin-controller","./utils"],function(e,t){var n=e("arrays"),r=e("common/array-types"),i=e("common/console"),o=e("./constants/index"),a=o.unit,s=e("cs!models/md2d/models/aminoacids-helper"),l=e("./math/index"),u=e("./potentials/index").coulomb,c=e("./potentials/index").lennardJones,d=e("cs!./pairwise-lj-properties"),p=e("common/models/engines/clone-restore-wrapper"),f=e("./cell-list"),h=e("./neighbor-list"),m=e("common/models/plugin-controller"),g=e("./utils"),v=o.BOLTZMANN_CONSTANT.as(a.JOULES_PER_KELVIN),y=function(e,t,n,r){return e*r-t*n},b=function(e,t){return e*e+t*t},_=function(e,t){if(0===t)return 0;var n=e/t,r=o.convert(n,{from:a.MW_ENERGY_UNIT,to:a.JOULE});return r/v},x=function(e,t){var n=e*v,r=o.convert(n,{from:a.JOULE,to:a.MW_ENERGY_UNIT}),i=r*t;return i},w=function(e){var t=parseFloat(e);if(isNaN(t))throw new Error("md2d: requested temperature "+e+" could not be understood.");if(t<0)throw new Error("md2d: requested temperature "+t+" was less than zero");if(t===1/0)throw new Error("md2d: requested temperature was Infinity!")};t.createEngine=function(){var e,t,v,C,T,S,A,k,P,E,O,M,L,N,R,I,D,B,V,j,F,z,G,$,U,q,H,W,Y,X,Q,K,J,Z,ee,te,ne,re,ie,oe,ae,se,le,ue,ce,de,pe,fe,he,me,ge,ve,ye,be,_e,xe,we,Ce,Te,Se,Ae,ke,Pe,Ee,Oe,Me,Le,Ne,Re,Ie,De,Be,Ve,je,Fe,ze,Ge,$e,Ue,qe,He,We,Ye,Xe,Qe,Ke,Je,Ze,et,tt,nt,rt,it,ot,at,st,lt,ut,ct,dt,pt,ft,ht,mt,gt,vt,yt,bt,_t,xt,wt,Ct,Tt,St,At,kt,Pt,Et,Ot,Mt,Lt,Nt,Rt,It,Dt,Bt=!1,Vt=new m,jt=!1,Ft=1,zt=!0,Gt=0,$t=!1,Ut=1,qt=25,Ht=3,Wt=!0,Yt=!1,Xt=1.67,Qt=!1,Kt=[10,10],Jt=0,Zt=0,en=10,tn=10,nn=0,rn=0,on=0,an=[],sn=0,ln=!1,un=0,cn=0,dn=0,pn=0,fn=0,hn=0,mn=0,gn=4,vn=[],yn=4.1,bn=[],_n=[],xn=[],wn=function(){On(0),Mn(0),Rn(0),Ln(0),Nn(0),In(0),Dn(0),Bn(0),Vn(0),jn(0),Fn(0),Q=new d(e)},Cn=function(){throw new Error("md2d: Don't change the epsilon or sigma parameters of the LJ calculator being used by MD2D. Use the setElementProperties method instead.")},Tn=function(e,t){var n,r,i=q[e],o=q[t],a=H[e],s=H[t],l=Q.get(e,t);n=l&&void 0!==l.epsilon?l.epsilon:c.pairwiseEpsilon(i,o),r=l&&void 0!==l.sigma?l.sigma:c.pairwiseSigma(a,s),vn[e][t]=vn[t][e]=gn*r*(gn*r),bn[e][t]=bn[t][e]=yn*r*(yn*r),_n[e][t]=_n[t][e]=c.newLJCalculator({epsilon:n,sigma:r},Cn)},Sn=function(){var e,t,n,r,i=0;for(n=0;n<on;n++)for(r=0;r<=n;r++)an[n]&&an[r]&&(e=Q.get(n,r),t=e&&void 0!==e.sigma?e.sigma:c.pairwiseSigma(H[n],H[r]),yn*t>i&&(i=yn*t));return i||Math.max(Kt[0],Kt[1])},An=function(){var e,t,n,r,i=1/0;for(n=0;n<on;n++)for(r=0;r<=n;r++)an[n]&&an[r]&&(e=Q.get(n,r),t=e&&void 0!==e.sigma?e.sigma:c.pairwiseSigma(H[n],H[r]),(yn-gn)*t<i&&(i=(yn-gn)*t));return i},kn=function(){void 0===Tt?Tt=new f(Kt[0],Kt[1],Sn()):Tt.reinitialize(Kt[0],Kt[1],Sn())},Pn=function(){void 0===St?St=new h(rn,An()):St.reinitialize(rn,An())},En={atoms:function(){S=$.radius,A=$.px,k=$.py,P=$.x,E=$.y,O=$.vx,M=$.vy,L=$.speed,N=$.ax,R=$.ay,I=$.charge,B=$.friction,V=$.radical,D=$.element,j=$.pinned,F=$.mass,z=$.hydrophobicity,G=$.visited},radialBonds:function(){K=ne.atom1,J=ne.atom2,Z=ne.length,ee=ne.strength,te=ne.type},restraints:function(){re=se.atomIndex,ie=se.k,oe=se.x0,ae=se.y0},angularBonds:function(){le=fe.atom1,ue=fe.atom2,ce=fe.atom3,de=fe.angle,pe=fe.strength},elements:function(){U=X.mass,q=X.epsilon,H=X.sigma,W=X.radius,Y=X.color},obstacles:function(){he=De.x,me=De.y,ge=De.width,ve=De.height,Ce=De.mass,ye=De.vx,be=De.vy,_e=De.externalAx,xe=De.externalAy,we=De.friction,Te=De.westProbe,Se=De.northProbe,Ae=De.eastProbe,ke=De.southProbe,Le=De.westProbeValue,Ne=De.northProbeValue,Re=De.eastProbeValue,Ie=De.southProbeValue,Oe=De.xPrev,Me=De.yPrev,Pe=De.color,Ee=De.visible},shapes:function(){Be=Qe.type,Ve=Qe.x,je=Qe.y,Fe=Qe.width,ze=Qe.height,Ge=Qe.fence,$e=Qe.color,Ue=Qe.lineColor,qe=Qe.lineDashes,He=Qe.lineWeight,We=Qe.layer,Ye=Qe.layerPosition,Xe=Qe.visible},lines:function(){Ke=ct.x1,Je=ct.y1,Ze=ct.x2,et=ct.y2,tt=ct.beginStyle,nt=ct.endStyle,rt=ct.fence,it=ct.lineColor,ot=ct.lineDashes,at=ct.lineWeight,st=ct.layer,lt=ct.layerPosition,ut=ct.visible},electricFields:function(){dt=ht.intensity,pt=ht.orientation,ft=ht.shapeIdx},springForces:function(){bt=Ct[0],_t=Ct[1],xt=Ct[2],wt=Ct[3]},vdwPairs:function(){vt=mt.atom1,yt=mt.atom2}},On=function(t){X=e.elements={},X.mass=n.create(t,0,r.floatType),X.epsilon=n.create(t,0,r.floatType),X.sigma=n.create(t,0,r.floatType),X.radius=n.create(t,0,r.floatType),X.color=n.create(t,0,r.int32Type),En.elements()},Mn=function(e){$={},$.radius=n.create(e,0,r.floatType),$.px=n.create(e,0,r.floatType),$.py=n.create(e,0,r.floatType),$.x=n.create(e,0,r.floatType),$.y=n.create(e,0,r.floatType),$.vx=n.create(e,0,r.floatType),$.vy=n.create(e,0,r.floatType),$.speed=n.create(e,0,r.floatType),$.ax=n.create(e,0,r.floatType),$.ay=n.create(e,0,r.floatType),$.charge=n.create(e,0,r.floatType),$.friction=n.create(e,0,r.floatType),$.radical=n.create(e,0,r.uint8Type),$.element=n.create(e,0,r.uint8Type),$.pinned=n.create(e,0,r.uint8Type),$.mass=n.create(e,0,r.floatType),$.hydrophobicity=n.create(e,0,r.int8Type),$.visited=n.create(e,0,r.uint8Type),$.marked=n.create(e,0,r.uint8Type),$.visible=n.create(e,0,r.uint8Type),$.draggable=n.create(e,0,r.uint8Type),$.draggableWhenStopped=n.create(e,1,r.uint8Type),En.atoms()},Ln=function(t){ne=e.radialBonds={},ne.atom1=n.create(t,0,r.uint16Type),ne.atom2=n.create(t,0,r.uint16Type),ne.length=n.create(t,0,r.floatType),ne.strength=n.create(t,0,r.floatType),ne.type=n.create(t,0,r.uint8Type),En.radialBonds()},Nn=function(t){se=e.restraints={},se.atomIndex=n.create(t,0,r.uint16Type),se.k=n.create(t,0,r.floatType),se.x0=n.create(t,0,r.floatType),se.y0=n.create(t,0,r.floatType),En.restraints()},Rn=function(t){fe=e.angularBonds={},fe.atom1=n.create(t,0,r.uint16Type),fe.atom2=n.create(t,0,r.uint16Type),fe.atom3=n.create(t,0,r.uint16Type),fe.angle=n.create(t,0,r.floatType),fe.strength=n.create(t,0,r.floatType),En.angularBonds()},In=function(t){mt=e.vdwPairs={},mt.count=0,mt.atom1=n.create(t,0,r.uint16Type),mt.atom2=n.create(t,0,r.uint16Type)},Dn=function(t){Ct=e.springForces=[],Ct[0]=n.create(t,0,r.uint16Type),Ct[1]=n.create(t,0,r.floatType),Ct[2]=n.create(t,0,r.floatType),Ct[3]=n.create(t,0,r.floatType),En.springForces()},Bn=function(t){De=e.obstacles={},De.x=n.create(t,0,r.floatType),De.y=n.create(t,0,r.floatType),De.width=n.create(t,0,r.floatType),De.height=n.create(t,0,r.floatType),De.mass=n.create(t,0,r.floatType),De.vx=n.create(t,0,r.floatType),De.vy=n.create(t,0,r.floatType),De.externalAx=n.create(t,0,r.floatType),De.externalAy=n.create(t,0,r.floatType),De.friction=n.create(t,0,r.floatType),De.westProbe=n.create(t,0,r.uint8Type),De.northProbe=n.create(t,0,r.uint8Type),De.eastProbe=n.create(t,0,r.uint8Type),De.southProbe=n.create(t,0,r.uint8Type),De.westProbeValue=n.create(t,0,r.floatType),De.northProbeValue=n.create(t,0,r.floatType),De.eastProbeValue=n.create(t,0,r.floatType),De.southProbeValue=n.create(t,0,r.floatType),De.xPrev=n.create(t,0,r.floatType),De.yPrev=n.create(t,0,r.floatType),De.color=[],De.visible=n.create(t,0,r.uint8Type),De.displayExternalAcceleration=n.create(t,0,r.uint8Type),En.obstacles()},Vn=function(t){Qe=e.shapes={},Qe.type=[],Qe.x=n.create(t,0,r.floatType),Qe.y=n.create(t,0,r.floatType),Qe.width=n.create(t,0,r.floatType),Qe.height=n.create(t,0,r.floatType),Qe.color=[],Qe.lineColor=[],Qe.lineDashes=[],Qe.lineWeight=n.create(t,0,r.floatType),Qe.layer=n.create(t,0,r.uint8Type),Qe.layerPosition=n.create(t,0,r.uint8Type),Qe.visible=n.create(t,0,r.uint8Type),Qe.fence=n.create(t,0,r.uint8Type),En.shapes()},jn=function(t){ct=e.lines={},ct.x1=n.create(t,0,r.floatType),ct.y1=n.create(t,0,r.floatType),ct.x2=n.create(t,0,r.floatType),ct.y2=n.create(t,0,r.floatType),ct.beginStyle=[],ct.endStyle=[],ct.lineColor=[],ct.lineDashes=[],ct.lineWeight=n.create(t,0,r.floatType),ct.layer=n.create(t,0,r.uint8Type),ct.layerPosition=n.create(t,0,r.uint8Type),ct.visible=n.create(t,0,r.uint8Type),ct.fence=n.create(t,0,r.uint8Type),En.lines()},Fn=function(t){ht=e.electricFields={},ht.intensity=n.create(t,0,r.floatType),ht.orientation=[],ht.shapeIdx=[],En.electricFields()},zn=function(){var e,t=0;for(e=0;e<rn;e++)t+=F[e]*(O[e]*O[e]+M[e]*M[e]);for(e=0;e<dn;e++)Ce[e]!==1/0&&(t+=Ce[e]*(ye[e]*ye[e]+be[e]*be[e]));return _(t/2,rn)},Gn=function(e){var t,n,r=0;for(t=0;t<e.length;t++)n=e[t],r+=F[n]*(O[n]*O[n]+M[n]*M[n]);return _(r/2,e.length)},$n=function(e,t,n){O[e]+=t,M[e]+=n,
A[e]=O[e]*F[e],k[e]=M[e]*F[e]},Un=function(e,t){O[e]-=t*(E[e]-Pt),M[e]+=t*(P[e]-kt),A[e]=O[e]*F[e],k[e]=M[e]*F[e]},qn=function(){for(var e=0;e<rn;e++)$n(e,-Mt,-Lt),Un(e,-It)},Hn=function(){var t,n=0,r=0,i=0,o=0,a=e.getTotalMass();for(t=0;t<rn;t++)n+=P[t],r+=E[t],i+=A[t],o+=k[t];kt=n/rn,Pt=r/rn,Et=i,Ot=o,Mt=i/a,Lt=o/a},Wn=function(){var e,t,n=0,r=0;for(t=0;t<rn;t++)e=F[t],n+=e*y(P[t]-kt,E[t]-Pt,O[t]-Mt,M[t]-Lt),r+=e*b(P[t]-kt,E[t]-Pt);Nt=n,Rt=r,It=Nt/Rt},Yn=function(){Hn(),Wn()},Xn=function(e){var t=0,n=0,r=Kt[0],i=Kt[1],o=r-ge[e],a=i-ve[e];if(he[e]<t){for(;he[e]<t-r;)he[e]+=r;he[e]=t+(t-he[e]),ye[e]*=-1}else if(he[e]>o){for(;he[e]>o+r;)he[e]-=r;he[e]=o-(he[e]-o),ye[e]*=-1}if(me[e]<n){for(;me[e]<n-i;)me[e]+=i;me[e]=n+(n-me[e]),be[e]*=-1}else if(me[e]>a){for(;me[e]>a+r;)me[e]-=r;me[e]=a-(me[e]-a),be[e]*=-1}},Qn=function(e){var t=S[e],n=t,r=t,i=Kt[0],o=Kt[1],a=i-t,s=o-t;if(P[e]<n){for(;P[e]<n-i;)P[e]+=i;P[e]=n+(n-P[e]),O[e]*=-1,A[e]*=-1}else if(P[e]>a){for(;P[e]>a+i;)P[e]-=i;P[e]=a-(P[e]-a),O[e]*=-1,A[e]*=-1}if(E[e]<r){for(;E[e]<r-o;)E[e]+=o;E[e]=r+(r-E[e]),M[e]*=-1,k[e]*=-1}else if(E[e]>s){for(;E[e]>s+o;)E[e]-=o;E[e]=s-(E[e]-s),M[e]*=-1,k[e]*=-1}},Kn=function(e,t,n,r){if(!(dn<1)){var i,o,a,s,l,u,c,d,p,f,h,m,g,v,y,b,_,x,w,C;for(i=S[e],o=P[e],a=E[e],s=0;s<dn;s++)l=he[s]-i,u=he[s]+ge[s]+i,c=me[s]+ve[s]+i,d=me[s]-i,p=Oe[s]-i,f=Oe[s]+ge[s]+i,h=Me[s]+ve[s]+i,m=Me[s]-i,C=0,o>l&&o<u&&a>d&&a<c&&(t<=p?(P[e]=l-(o-l),C=1):t>=f?(P[e]=u+(u-o),C=2):n<=m?(E[e]=d-(a-d),C=-1):n>=h&&(E[e]=c+(c-a),C=-2)),x=Ce[s],0!==C&&(x!==1/0?(_=F[e],w=x+_,C>0?(g=O[e],y=ye[s],O[e]=(g*(_-x)+2*x*y)/w,ye[s]=(y*(x-_)+2*A[e])/w):(v=M[e],b=be[s],M[e]=(v*(_-x)+2*x*b)/w,be[s]=(b*(x-_)+2*k[e])/w)):C>0?O[e]*=-1:M[e]*=-1,r&&(Te[s]&&1===C?Le[s]+=F[e]*((g?g:-O[e])-O[e]):Ae[s]&&2===C?Re[s]+=F[e]*(O[e]-(g?g:-O[e])):ke[s]&&C===-1?Ie[s]+=F[e]*((v?v:-M[e])-M[e]):Se[s]&&C===-2&&(Ne[s]+=F[e]*(M[e]-(v?v:-M[e])))))}},Jn=function(e,t,n){if(!(pn<1)){var r,i,o,a,s,l,u,c,d,p,f,h,m,g,v,y,_,x,w,C,T,A,k,L,N,R,I,D,B,V,j,F,z,G,$,U;for(r=S[e],i=P[e],o=E[e],a=0;a<pn;a++)Ge[a]&&("rectangle"===Be[a]?(d=Ve[a]-r,p=Ve[a]+Fe[a]+r,f=je[a]+ze[a]+r,h=je[a]-r,s=Ve[a]+r,l=Ve[a]+Fe[a]-r,u=je[a]+ze[a]-r,c=je[a]+r,i>d&&i<p&&o>h&&o<f&&(t<=d?(P[e]=d-(i-d),O[e]*=-1):t>=p?(P[e]=p+(p-i),O[e]*=-1):n<=h?(E[e]=h-(o-h),M[e]*=-1):n>=f&&(E[e]=f+(f-o),M[e]*=-1)),t>s&&t<l&&n>c&&n<u&&(i<=s?(P[e]=s+(s-i),O[e]*=-1):i>=l&&(P[e]=l-(i-l),O[e]*=-1),o<=c?(E[e]=c+(c-o),M[e]*=-1):o>=u&&(E[e]=u-(o-u),M[e]*=-1))):"ellipse"===Be[a]&&(T=Fe[a]/2,A=ze[a]/2,m=Ve[a]+T,g=je[a]+A,v=(i-m)/(T+r),y=(o-g)/(A+r),v*=v,y*=y,_=(t-m)/(T+r),x=(n-g)/(A+r),_*=_,x*=x,w=(T+r)/(T-r),C=(A+r)/(A-r),w*=w,C*=C,(v+y<=1&&_+x>1||v*w+y*C>=1&&_*w+x*C<1)&&(Fe[a]>ze[a]?(k=Math.sqrt(T*T-A*A),L=Ve[a]+T+k,I=Ve[a]+T-k,N=D=je[a]+A):(k=Math.sqrt(A*A-T*T),L=I=Ve[a]+T,N=je[a]+A+k,D=je[a]+A-k),F=(i+t)/2,z=(o+n)/2,R=Math.sqrt(b(L-F,N-z)),B=Math.sqrt(b(I-F,I-F)),G=F-(L*B+I*R)/(R+B),$=z-(N*B+D*R)/(R+B),U=Math.sqrt(b(G,$)),G/=U,$/=U,P[e]=F-t-2*((F-t)*G+(z-n)*$)*G+F,E[e]=z-n-2*((F-t)*G+(z-n)*$)*$+z,V=O[e],j=M[e],O[e]=V-2*(V*G+j*$)*G,M[e]=j-2*(V*G+j*$)*$)))}},Zn=function(e,t,n){if(!(fn<1)){var r,i,o,a,s,l,u,c,d,p,f,h,m,g,v,_;for(r=S[e],v=P[e],_=E[e],g=0;g<fn;g++)rt[g]&&(s=y(t-Ke[g],n-Je[g],v-Ke[g],_-Je[g]),l=y(t-Ze[g],n-et[g],v-Ze[g],_-et[g]),s*l<0&&(i=Math.sqrt(b(Ke[g]-Ze[g],Je[g]-et[g])),o=y(Ze[g]-t,et[g]-n,Ke[g]-t,Je[g]-n),a=y(Ze[g]-v,et[g]-_,Ke[g]-v,Je[g]-_),(o<0&&a>-r*i||o>0&&a<r*i)&&o*s>0&&(u=(v+t)/2,c=(_+n)/2,d=et[g]-Je[g],p=-(Ze[g]-Ke[g]),f=Math.sqrt(b(d,p)),d/=f,p/=f,P[e]=u-t-2*((u-t)*d+(c-n)*p)*d+u,E[e]=c-n-2*((u-t)*d+(c-n)*p)*p+c,h=O[e],m=M[e],O[e]=h-2*(h*d+m*p)*d,M[e]=m-2*(h*d+m*p)*p)))}},er=function(e,t){var n,r,i,o=D[e],a=D[t],s=P[t]-P[e],l=E[t]-E[e],u=b(s,l);At&&u<bn[o][a]&&St.markNeighbors(e,t),Mr&&Mr[e]&&Mr[e][t]||u<vn[o][a]&&(n=_n[o][a].forceOverDistanceFromSquaredDistance(u),r=n*s,i=n*l,N[e]+=r,R[e]+=i,N[t]-=r,R[t]-=i)},tr=function(){Wt&&(At?(i.time("cell lists"),nr(),i.timeEnd("cell lists")):(i.time("neighbor list"),rr(),i.timeEnd("neighbor list")))},nr=function(){var e,t,n,r,i,o,a,s,l,u,c,d,p,f,h=Tt.getRowsNum(),m=Tt.getColsNum();for(e=0;e<h;e++)for(n=e*m,t=0;t<m;t++)for(r=n+t,i=Tt.getCell(r),f=Tt.getNeighboringCells(e,t),a=0,u=i.length;a<u;a++){for(l=i[a],s=0;s<a;s++)er(l,i[s]);for(d=0,p=f.length;d<p;d++)for(o=f[d],s=0,c=o.length;s<c;s++)er(l,o[s])}},rr=function(){var e,t,n,r,i=St.getList();for(e=0;e<rn;e++)for(n=St.getStartIdxFor(e),r=St.getEndIdxFor(e);n<r;n++)t=i[n],er(e,t)},ir=function(){if(jt&&0!==Or.length){var e,t,n,r,i,o,a,s,l,c,d,p,f;for(e=0,n=Or.length;e<n;e++)for(d=Or[e],c=I[d],f=Mr&&Mr[d],t=0;t<e;t++)p=Or[t],f&&f[p]||(r=P[p]-P[d],i=E[p]-E[d],o=r*r+i*i,a=u.forceOverDistanceFromSquaredDistance(o,c,I[p],Ft,zt),s=a*r,l=a*i,N[d]+=s,R[d]+=l,N[p]-=s,R[p]-=l)}},or=function(){if(v){var e,t;for(e=0;e<rn;e++)t=v*B[e],N[e]+=-O[e]*t,R[e]+=-M[e]*t}},ar=function(){if(!(sn<1)){var e,t,n,r,i,s,l,u,c,d,p,f;for(e=0;e<sn;e++)t=K[e],n=J[e],r=P[n]-P[t],i=E[n]-E[t],s=r*r+i*i,l=Math.sqrt(s),u=ee[e],c=Z[e],d=o.convert(u*(l-c),{from:a.EV_PER_NM,to:a.MW_FORCE_UNIT})/l,p=d*r,f=d*i,N[t]+=p,R[t]+=f,N[n]-=p,R[n]-=f}},sr=function(){if(!(cn<1)){var e,t,n,r,i,s,l,u,c,d,p,f,h,m,g,v,y,b,_,x,w,C,T;for(e=0;e<cn;e++)t=le[e],n=ue[e],r=ce[e],m=de[e],h=pe[e],i=P[t]-P[r],l=P[n]-P[r],s=E[t]-E[r],u=E[n]-E[r],c=i*i+s*s,d=l*l+u*u,p=Math.sqrt(c),f=Math.sqrt(d),v=(i*l+s*u)/(p*f),v>1?v=1:v<-1&&(v=-1),y=Math.sqrt(1-v*v),g=Math.acos(v),y<1e-4&&(y=1e-4),C=o.convert(h*(g-m)/(y*p),{from:a.EV_PER_NM,to:a.MW_FORCE_UNIT})/f,T=i*l+s*u,b=C*(l-T*i/c),_=C*(u-T*s/c),x=C*(i-T*l/d),w=C*(s-T*u/d),N[t]+=b,R[t]+=_,N[n]+=x,R[n]+=w,N[r]-=b+x,R[r]-=_+w}},lr=function(){if(!(un<1)){var e,t,n,r,i,s,l,u,c,d;for(e=0;e<un;e++)d=re[e],t=oe[e]-P[d],n=ae[e]-E[d],0===t&&0===n||(i=t*t+n*n,r=Math.sqrt(i),s=ie[e],l=o.convert(s*r,{from:a.EV_PER_NM,to:a.MW_FORCE_UNIT})/r,u=l*t,c=l*n,N[d]+=u,R[d]+=c)}},ur=function(){if(!(mn<1)){var e,t,n,r,i,s,l,u,c,d;for(e=0;e<mn;e++)d=bt[e],t=_t[e]-P[d],n=xt[e]-E[d],0===t&&0===n||(i=t*t+n*n,r=Math.sqrt(i),s=wt[e],l=o.convert(s*r,{from:a.EV_PER_NM,to:a.MW_FORCE_UNIT})/r,u=l*t,c=l*n,N[d]+=u,R[d]+=c)}},cr=function(e){var t,n,r,i,o=0,a=0,s=0;for(r=0,i=e.length;r<i;r++)t=e[r],n=F[t],o+=P[t]*n,a+=E[t]*n,s+=n;return o/=s,a/=s,{x:o,y:a}},dr=function(){if(!(0===Gt||0===Ut||rn<2)){var t,n,r,i,o,a,s,l,u,c,d,p,f;for(d=0;d<rn;d++)G[d]=0;for(i=6e-5*Gt*Ut,d=0;d<rn;d++)if(1!==G[d])for(t=e.getMoleculeAtoms(d),t.push(d),r=cr(t),p=0,f=t.length;p<f;p++)n=t[p],G[n]=1,0!==z[n]&&(o=P[n]-r.x,a=E[n]-r.y,s=Math.sqrt(o*o+a*a),s>0&&(c=z[n]*i,c>0&&s<Ht&&(c*=(1-qt)*s/Ht+qt),l=c*o/s,u=c*a/s,N[n]-=l,R[n]-=u))}},pr=function(){if(Qt){var e;for(e=0;e<rn;e++)R[e]-=Qt}},fr=function(e,t,n){var r=Ve[e],i=je[e];return r<=t&&t<=r+Fe[e]&&i<=n&&n<=i+ze[e]},hr=function(e){var t=pt[e];return("N"===t||"E"===t?1:-1)*dt[e]},mr=function(){if(ht){var e,t,n,r,i,o;for(t=0;t<hn;t++)for(n=pt[t],r="N"===n||"S"===n,o=hr(t)/Ft,i=ft[t],e=0;e<rn;e++)(null==i||fr(i,P[e],E[e]))&&(r?R[e]+=o*I[e]/F[e]:N[e]+=o*I[e]/F[e])}},gr=function(){if($t){var e,t;for(e=0;e<rn;e++)t=Math.min(1,2.2-E[e]),t>0&&(R[e]+=1e-4*t,N[e]-=3e-6)}},vr=function(){var e,t,r=s.cysteineElement;for(xn.length=0,t=0;t<rn;t++)D[t]===r&&xn.push(t);for(t=0;t<sn;t++)D[K[t]]===r&&D[J[t]]===r&&(e=xn.indexOf(K[t]),e!==-1&&n.remove(xn,e),e=xn.indexOf(J[t]),e!==-1&&n.remove(xn,e))},yr=function(){var e,t;if(0!==rn){for(e=0;e<rn;e++)N[e]=R[e]=0;if(At=St.shouldUpdate(P,E))for(Tt.clear(),St.clear(),e=0;e<rn;e++)Tt.addToCell(e,P[e],E[e]),St.saveAtomPosition(e,P[e],E[e]);for(i.time("short-range forces"),tr(),i.timeEnd("short-range forces"),i.time("long-range forces"),ir(),i.timeEnd("long-range forces"),ar(),sr(),lr(),ur(),or(),dr(),e=0;e<rn;e++)t=1/F[e],N[e]*=t,R[e]*=t;pr(),mr(),gr()}},br=function(){var e,t;for(e=0;e<rn;e++)t=F[e],O[e]+=.5*N[e]*C,A[e]=t*O[e],M[e]+=.5*R[e]*C,k[e]=t*M[e]},_r=function(){var e,t,n,r=100*Kt[0],i=100*Kt[1];for(n=0;n<rn;n++){if(e=P[n],t=E[n],P[n]+=O[n]*C,E[n]+=M[n]*C,isNaN(P[n])||isNaN(E[n])||Math.abs(P[n])>r||Math.abs(E[n])>i)throw new Error("Model has diverged!");Qn(n),Kn(n,e,t,!0),Jn(n,e,t),Zn(n,e,t)}},xr=function(){var e;for(e=0;e<rn;e++)j[e]&&(O[e]=M[e]=N[e]=R[e]=0)},wr=function(){var e;for(e=0;e<rn;e++)L[e]=Math.sqrt(O[e]*O[e]+M[e]*M[e])},Cr=function(){var e,t,n,r,i,o,a,s;for(s=0;s<dn;s++)Ce[s]!==1/0&&(n=ye[s],r=be[s],o=_e[s],a=xe[s],(n||r||o||a||Qt)&&(i=v*we[s],e=o-i*n,t=a-i*r-Qt,Oe[s]=he[s],Me[s]=me[s],he[s]+=n*C+.5*e*T,me[s]+=r*C+.5*t*T,ye[s]+=e*C,be[s]+=t*C,Xn(s)))},Tr=function(){var t,n,r,i,o,a,s,l;for(a=0;a<rn;a++)G[a]=0;for(a=0;a<rn;a++)if(1!==G[a]&&(t=e.getMoleculeAtoms(a),0!==t.length)){for(t.push(a),r=i=o=0,s=0,l=t.length;s<l;s++)n=t[s],G[n]=1,j[n]||(r+=O[n]*F[n],i+=M[n]*F[n],o+=F[n]);for(o=1/o,s=0,l=t.length;s<l;s++)n=t[s],j[n]||(O[n]-=r*o,M[n]-=i*o,A[n]=O[n]*F[n],k[n]=M[n]*F[n])}},Sr=function(e,n){var r,i;if(null==e&&(e=t),Dt=zn(),0===Dt){for(i=0;i<rn;i++)j[i]===!1&&(O[i]=.02*Math.random()-.01,M[i]=.02*Math.random()-.01);if(Dt=zn(),0===Dt)return}if(n||Yt&&Dt>0){for(r=Math.sqrt(e/Dt),i=0;i<rn;i++)O[i]*=r,M[i]*=r,A[i]*=r,k[i]*=r;for(i=0;i<dn;i++)ye[i]*=r,be[i]*=r;Dt=e}},Ar=function(){var t,r,i,o,a,s,l,u;for(s=0,u=xn.length;s<u;s++)for(t=xn[s],l=s+1;l<u;l++)r=xn[l],i=P[t]-P[r],o=E[t]-E[r],a=i*i+o*o,a<.07&&(e.addRadialBond({atom1:t,atom2:r,length:Math.sqrt(a),strength:1e4,type:109}),n.remove(xn,s),n.remove(xn,l),u=xn.length,t=xn[s],l=s+1)},kr=function(){var e;for(e=0;e<dn;e++)Se[e]&&(Ne[e]=0),ke[e]&&(Ie[e]=0),Ae[e]&&(Re[e]=0),Te[e]&&(Le[e]=0)},Pr=function(e){var t,n;for(t=13888.89/e,n=0;n<dn;n++)Se[n]&&(Ne[n]*=t/ge[n]),ke[n]&&(Ie[n]*=t/ge[n]),Ae[n]&&(Re[n]*=t/ve[n]),Te[n]&&(Le[n]*=t/ve[n])},Er=function(t,n,r){var i;for(i=0;i<cn;)le[i]===t&&ce[i]===n||le[i]===n&&ce[i]===t||ue[i]===t&&ce[i]===n||ue[i]===n&&ce[i]===t?e.removeAngularBond(i,r):i++},Or=[];Or.reset=function(){var e,t=0;for(e=0;e<rn;e++)$.charge[e]&&(this[t++]=e);this.length=t};var Mr=[];Mr.reset=function(){var e,t,n;for(this.length=0,e=0;e<sn;e++)t=K[e],n=J[e],this[t]=this[t]||[],this[t][n]=!0,this[n]=this[n]||[],this[n][t]=!0};var Lr=[];return Lr.reset=function(){var e,t,n;for(this.length=0,e=0;e<sn;e++)t=K[e],n=J[e],this[t]=this[t]||[],this[t].push(n),this[n]=this[n]||[],this[n].push(t)},Lr.unset=function(e,t){if(this[e]){var n=this[t].indexOf(e),r=this[e].indexOf(t);n!==-1&&(this[e].splice(r,1),this[t].splice(n,1))}},Lr.set=function(e,t){null==this[e]&&(this[e]=[]),null==this[t]&&(this[t]=[]),this[e].push(t),this[t].push(e)},e={addPlugin:function(e){e.initialize&&e.initialize({atoms:$,elements:X,radialBonds:ne,angularBonds:fe}),Vt.registerPlugin(e)},useCoulombInteraction:function(e){jt=!!e},useLennardJonesInteraction:function(e){Wt=!!e},useThermostat:function(e){Yt=!!e},setVDWLinesRatio:function(e){"number"==typeof e&&0!==e&&(Xt=e)},setGravitationalField:function(e){Qt="number"==typeof e&&0!==e&&e},setTemperatureOfAtoms:function(t,n){var r,i,o,a,s,l,u,c,d,p=t.length;for(s=1e-4*(Gn(t)||n),l=x(s,1),r=0;r<p;r++)i=t[r],j[i]||0!==O[i]||0!==M[i]||(o=Math.random()-.5,a=Math.random()-.5,c=Math.sqrt(2*l/F[i]/(o*o+a*a)),O[i]=o*c,M[i]=a*c);for(Dt=zn(),d=Gn(t),u=Math.sqrt(n/d),r=0;r<p;r++)i=t[r],e.setAtomProperties(i,{vx:O[i]*u,vy:M[i]*u})},getTemperatureOfAtoms:function(e){return Gn(e)},setTargetTemperature:function(e){w(e),t=e},setDielectricConstant:function(e){Ft=e},setRealisticDielectricEffect:function(e){zt=e},setSolventForceType:function(e){Gt=e},setDNAState:function(e){$t=0===e.indexOf("translation:")},setSolventForceFactor:function(e){Ut=e},setAdditionalSolventForceMult:function(e){qt=e},setAdditionalSolventForceThreshold:function(e){Ht=e},setTime:function(e){nn=e},setDimensions:function(e){if(Bt)throw new Error("The molecular model's size has already been set, and cannot be reset.");Jt=e[0],Zt=e[1],en=e[2],tn=e[3],Kt=[en-Jt,tn-Zt],Bt=!0},getDimensions:function(){return[Jt,Zt,en,tn]},getLJCalculator:function(){return _n},setAtomProperties:function(t,n){var r,i,o,a=s.cysteineElement;if(void 0!==n.element){if(n.element<0||n.element>=on)throw new Error("md2d: Unknown element "+n.element+", an atom can't be created.");if(D[t]===a&&n.element!==a)for(o=0;o<sn;o++)if((K[o]===t||J[o]===t)&&109===te[o]){e.removeRadialBond(o);break}an[n.element]=!0,n.mass=U[n.element],n.radius=W[n.element],s.isAminoAcid(n.element)&&(i=s.getAminoAcidByElement(n.element),n.charge=i.charge,n.hydrophobicity=i.hydrophobicity)}!I[t]&&n.charge?Or.push(t):I[t]&&0===n.charge&&Or.splice(Or.indexOf(t),1);for(r in n)n.hasOwnProperty(r)&&($[r][t]=n[r]);A[t]=O[t]*F[t],k[t]=M[t]*F[t],L[t]=Math.sqrt(O[t]*O[t]+M[t]*M[t])},setRadialBondProperties:function(e,t,n){var r,i,o;i=K[e],o=J[e],Mr[i]&&Mr[i][o]&&(Mr[i][o]=!1),Mr[o]&&Mr[o][i]&&(Mr[o][i]=!1),Lr.unset(i,o),(void 0!==t.atom1&&t.atom1!==i||void 0!==t.atom2&&t.atom2!==o)&&Er(i,o,n);for(r in t)t.hasOwnProperty(r)&&(ne[r][e]=t[r]);i=K[e],o=J[e],Mr[i]||(Mr[i]=[]),Mr[i][o]=!0,Mr[o]||(Mr[o]=[]),Mr[o][i]=!0,Lr.set(i,o)},setAngularBondProperties:function(e,t){var n;for(n in t)t.hasOwnProperty(n)&&(fe[n][e]=t[n])},setRestraintProperties:function(e,t){var n;for(n in t)t.hasOwnProperty(n)&&(se[n][e]=t[n])},setElementProperties:function(e,t){var n,r;if(null!=t.mass&&t.mass!==U[e])for(U[e]=t.mass,n=0;n<rn;n++)D[n]===e&&(F[n]=t.mass);if(null!=t.sigma&&(H[e]=t.sigma,r=c.radius(t.sigma),W[e]!==r))for(W[e]=r,n=0;n<rn;n++)D[n]===e&&(S[n]=r);for(null!=t.epsilon&&(q[e]=t.epsilon),null!=t.color&&(Y[e]=t.color),n=0;n<on;n++)Tn(e,n);kn(),Pn()},setPairwiseLJProperties:function(e,t){Tn(e,t),kn(),Pn()},setObstacleProperties:function(t,n){var r;if(!e.canPlaceObstacle(n.x,n.y,n.width,n.height,t))throw new Error("Obstacle can't be placed at "+n.x+", "+n.y);void 0!==n.x&&(n.xPrev=n.x),void 0!==n.y&&(n.yPrev=n.y),"string"==typeof n.mass&&(n.mass=parseFloat(n.mass));for(r in n)n.hasOwnProperty(r)&&(De[r][t]=n[r])},setShapeProperties:function(e,t){var n;for(n in t)t.hasOwnProperty(n)&&(Qe[n][e]=t[n])},setLineProperties:function(e,t){var n;for(n in t)t.hasOwnProperty(n)&&(ct[n][e]=t[n])},setElectricFieldProperties:function(e,t){var n;for(n in t)t.hasOwnProperty(n)&&(ht[n][e]=t[n])},addAtom:function(t){rn+1>$.x.length&&(g.extendArrays($,Math.round(1.5*rn+10)),En.atoms()),t.ax=t.ay=0,I[rn]=0,e.setAtomProperties(rn,t),rn++,kn(),Pn()},removeAtom:function(t){var r,i,o,a,s,l;if(t>=rn)throw new Error("Atom "+t+" doesn't exist, so it can't be removed.");for(r=0;r<sn;)K[r]===t||J[r]===t?e.removeRadialBond(r):r++;for(r=Or.indexOf(t),r!==-1&&n.remove(Or,r),r=t;r<rn;r++)for(o in $)$.hasOwnProperty(o)&&(r===rn-1?$[o][r]=0:$[o][r]=$[o][r+1]);for(rn--,l=[Or,K,J,le,ue,ce],a=0;a<l.length;a++)for(s=l[a],r=0,i=s.length;r<i;r++)s[r]>t&&s[r]--;Mr.reset(),Lr.reset(),kn(),Pn(),St.invalidate(),yr()},addElement:function(e){var t;for(on>=q.length&&(g.extendArrays(X,on+10),En.elements()),U[on]=e.mass,q[on]=e.epsilon,H[on]=e.sigma,W[on]=c.radius(e.sigma),Y[on]=e.color,_n[on]=[],vn[on]=[],bn[on]=[],t=0;t<=on;t++)Tn(on,t);on++},addRadialBond:function(t){sn+1>K.length&&(g.extendArrays(ne,sn+10),En.radialBonds()),sn++,e.setRadialBondProperties(sn-1,t),ln=!0},removeRadialBond:function(e,t){var n,r;if(e>=sn)throw new Error("Radial bond "+e+" doesn't exist, so it can't be removed.");for(Er(K[e],J[e],t),Lr.unset(K[e],J[e]),n=e;n<sn;n++)for(r in ne)ne.hasOwnProperty(r)&&(n===sn-1?ne[r][n]=0:ne[r][n]=ne[r][n+1]);sn--,Mr.reset(),ln=!0},addRestraint:function(t){un+1>se.atomIndex.length&&(g.extendArrays(se,un+10),En.restraints()),un++,e.setRestraintProperties(un-1,t)},addAngularBond:function(t){cn+1>fe.atom1.length&&(g.extendArrays(fe,cn+10),En.angularBonds()),cn++,e.setAngularBondProperties(cn-1,t)},removeAngularBond:function(t,n){var r,i,o,a,s,u;if(t>=cn)throw new Error("Angular bond "+t+" doesn't exist, so it can't be removed.");for(n&&(o=le[t],a=ue[t],s=ce[t],u=de[t]-l.getAngleBetweenVec(P[o],E[o],P[a],E[a],P[s],E[s]),e.addKEToAtoms(.5*pe[t]*u*u,o,a,s)),r=t;r<cn;r++)for(i in fe)fe.hasOwnProperty(i)&&(r===cn-1?fe[i][r]=0:fe[i][r]=fe[i][r+1]);cn--},addSpringForce:function(e,t,n,r){return mn+1>Ct[0].length&&(g.extendArrays(Ct,mn+1),En.springForces()),bt[mn]=e,_t[mn]=t,xt[mn]=n,wt[mn]=r,mn++},updateSpringForce:function(e,t,n){_t[e]=t,xt[e]=n},removeSpringForce:function(e){var t,n;if(e>=mn)throw new Error("Spring force "+e+" doesn't exist, so it can't be removed.");for(mn--,t=e;t<mn;t++)for(n=0;n<4;n++)Ct[n][t]=Ct[n][t+1]},springForceAtomIndex:function(e){return bt[e]},addObstacle:function(t){if(!e.canPlaceObstacle(t.x,t.y,t.width,t.height))throw new Error("Obstacle can't be placed at "+t.x+", "+t.y+".");dn+1>De.x.length&&(g.extendArrays(De,dn+1),En.obstacles()),dn++,e.setObstacleProperties(dn-1,t)},removeObstacle:function(e){var t,n;if(e>=dn)throw new Error("Obstacle "+e+" doesn't exist, so it can't be removed.");for(dn--,t=e;t<dn;t++)for(n in De)De.hasOwnProperty(n)&&(De[n][t]=De[n][t+1]);g.extendArrays(De,dn),En.obstacles()},addShape:function(t){pn+1>Qe.x.length&&(g.extendArrays(Qe,pn+1),En.shapes()),pn++,e.setShapeProperties(pn-1,t)},removeShape:function(t){var n,r;if(t>=pn)throw new Error("Shape "+t+" doesn't exist, so it can't be removed.");for(n=0;n<hn;)ft[n]===t?e.removeElectricField(n):n++;for(pn--,n=t;n<pn;n++)for(r in Qe)Qe.hasOwnProperty(r)&&(Qe[r][n]=Qe[r][n+1]);for(n=0;n<hn;n++)ft[n]>t&&ft[n]--;g.extendArrays(Qe,pn),En.shapes()},addLine:function(t){fn+1>ct.x1.length&&(g.extendArrays(ct,fn+1),En.lines()),fn++,e.setLineProperties(fn-1,t)},removeLine:function(e){var t,n;if(e>=fn)throw new Error("Line "+e+" doesn't exist, so it can't be removed.");for(t=e;t<fn;t++)for(n in ct)ct.hasOwnProperty(n)&&(ct[n][t]=ct[n][t+1]);fn--,g.extendArrays(ct,fn),En.lines()},addElectricField:function(t){hn+1>ht.intensity.length&&(g.extendArrays(ht,hn+1),En.electricFields()),hn++,e.setElectricFieldProperties(hn-1,t)},removeElectricField:function(e){var t,n;if(e>=hn)throw new Error("Electric field "+e+" doesn't exist, so it can't be removed.");for(hn--,t=e;t<hn;t++)for(n in ht)ht.hasOwnProperty(n)&&(ht[n][t]=ht[n][t+1]);g.extendArrays(ht,hn),En.electricFields()},atomInBounds:function(e,t,n){var r,i=S[n];if(e<i||e>Kt[0]-i||t<i||t>Kt[1]-i)return!1;for(r=0;r<dn;r++)if(e>he[r]-i&&e<he[r]+ge[r]+i&&t>me[r]-i&&t<me[r]+ve[r]+i)return!1;return!0},canPlaceAtom:function(t,n,r,i,o){var a,s,l,u,c,d,p,f;if(!e.atomInBounds(n,r,i))return!1;for(f=0;f<dn;f++)if(u=he[f],c=me[f],d=u+ge[f],p=c+ve[f],n>u&&n<d&&r>c&&r<p)return!1;return!!o||("number"==typeof i&&(a=P[i],s=E[i],P[i]=E[i]=1/0),l=e.newPotentialCalculator(t,0,!1)(n,r),"number"==typeof i&&(P[i]=a,E[i]=s),l<=0)},canPlaceObstacle:function(e,t,n,r,i){var o,a,s,l,u,c,d=e+n,p=t+r;if(e<0||d>Kt[0]||t<0||p>Kt[0])return!1;for(c=0;c<rn;c++)if(u=S[c],P[c]>e-u&&P[c]<d+u&&E[c]>t-u&&E[c]<p+u)return!1;for(c=0;c<dn;c++)if((void 0===i||i!==c)&&(o=he[c],a=me[c],s=o+ge[c],l=a+ve[c],d>o&&e<s&&p>a&&t<l))return!1;return!0},setupAtomsRandomly:function(t){var n,r,i,o,a,s,u,c,d=t.temperature||100,p=Math.floor(Math.sqrt(rn)),f=Math.ceil(rn/p);for(w(d),a=Kt[0]/(1+f),o=Kt[1]/(1+p),n=-1,r=1;r<=p;r++)for(i=1;i<=f&&(n++,n!==rn);i++)s=l.normal(1,.25),u=2*Math.random()*Math.PI,c={element:Math.floor(Math.random()*t.userElements),x:i*a,y:r*o,vx:s*Math.cos(u),vy:s*Math.sin(u),charge:2*(n%2)-1},e.setAtomProperties(n,c);Yn(),qn(),Sr(d,!0)},getVdwPairsArray:function(){var e,t,n,r,i,o,a,s,l,u,c,d,p,f,h,m=Xt*Xt;for(gt=0,e=0;e<rn;e++)for(d=D[e],s=H[d],l=H[d],o=P[e],a=E[e],t=e+1;t<rn;t++)0!==sn&&Mr[e]&&Mr[e][t]||(p=D[t],u=H[p],c=H[p],I[e]*I[t]<=0&&(n=P[t]-o,r=E[t]-a,i=n*n+r*r,f=.5*(s+u),f*=f,h=l*c,i<f*m&&h>0&&(gt+1>mt.atom1.length&&(g.extendArrays(mt,2*(gt+1)),En.vdwPairs()),vt[gt]=e,yt[gt]=t,gt++)));return mt.count=gt,mt},integrate:function(e,t){var n,r,i=nn;for(void 0===e&&(e=100),void 0===t&&(t=1),C=t,T=C*C,ln=!1,vr(),0===nn&&yr(),n=Math.floor(e/C),kr(),xr(),r=1;r<=n;r++)nn=i+r*C,br(),_r(),yr(),xr(),br(),wr(),Cr(),0===Gt||$t||Tr(),Vt.callPluginFunction("performActionWithinIntegrationLoop",[St,C,nn]),Sr();Pr(e),Ar()},updateParticlesAccelerations:yr,minimizeEnergy:function(){var e,t,n,r,i,o,a=.001,s=1e-4,l=3e3;for(yr(),xr(),e=0,i=0;i<rn;i++)e<Math.abs(N[i])&&(e=Math.abs(N[i])),e<Math.abs(R[i])&&(e=Math.abs(R[i]));for(o=0;e>s&&o<l;){for(o++,t=a/e,i=0;i<rn;i++)n=P[i],r=E[i],P[i]+=N[i]*t,E[i]+=R[i]*t,Qn(i),Kn(i,n,r,!1),Jn(i,n,r),Zn(i,n,r);for(yr(),xr(),e=0,i=0;i<rn;i++)e<Math.abs(N[i])&&(e=Math.abs(N[i])),e<Math.abs(R[i])&&(e=Math.abs(R[i]))}},getRadialBondsForAtom:function(e){var t,n,r,i=[];for(t=0;t<sn;t++)n=K[t],r=J[t],e!==n&&e!==r||i.push(t);return i},getAngularBondsForAtom:function(e){var t,n,r,i,o=[];for(t=0;t<cn;t++)n=le[t],r=ue[t],i=ce[t],e!==n&&e!==r&&e!==i||o.push(t);return o},getTotalMass:function(){var e,t=0;for(e=0;e<rn;e++)t+=F[e];return t},getRadiusOfElement:function(e){return W[e]},getNumberOfAtoms:function(){return rn},getNumberOfElements:function(){return on},getNumberOfObstacles:function(){return dn},getNumberOfShapes:function(){return pn},getNumberOfLines:function(){return fn},getNumberOfRadialBonds:function(){return sn},getNumberOfAngularBonds:function(){return cn},getNumberOfRestraints:function(){return un},getNumberOfSpringForces:function(){return mn},getNumberOfElectricFields:function(){return hn},computeOutputState:function(e){var t,n,r,i,s,l,c,d,p,f,h,m,g,v,y,b,x,w,C,T,S,A,k,L,N,R,B;for(B=0,R=0,t=0;t<rn;t++){for(Qt&&(N=F[t]*Qt*E[t],B+=o.convert(N,{from:a.MW_ENERGY_UNIT,to:a.EV})),r=0;r<hn;r++)if(x=ft[r],null==x||fr(x,P[t],E[t])){switch(L=I[t]*hr(r),pt[r]){case"N":case"S":L*=(null!=x?je[x]:Zt)-E[t];break;case"W":case"E":L*=(null!=x?Ve[x]:Jt)-P[t]}B+=o.convert(L,{from:a.MW_ENERGY_UNIT,to:a.EV})}for(R+=.5*F[t]*(O[t]*O[t]+M[t]*M[t]),n=t+1;n<rn;n++)p=P[n]-P[t],f=E[n]-E[t],w=p*p+f*f,Wt&&(B-=_n[D[t]][D[n]].potentialFromSquaredDistance(w)),jt&&Or.length>0&&(B+=u.potential(Math.sqrt(w),I[t],I[n],Ft,zt))}for(t=0;t<sn;t++)i=K[t],s=J[t],c=D[i],d=D[s],p=P[s]-P[i],f=E[s]-E[i],w=p*p+f*f,S=ee[t],A=Math.sqrt(w)-Z[t],B+=.5*S*A*A,Wt&&(B+=_n[c][d].potentialFromSquaredDistance(w)),jt&&I[i]&&I[s]&&(B-=u.potential(Math.sqrt(w),I[i],I[s],Ft,zt));for(t=0;t<cn;t++)i=le[t],s=ue[t],l=ce[t],h=P[i]-P[l],g=P[s]-P[l],m=E[i]-E[l],v=E[s]-E[l],C=Math.sqrt(h*h+m*m),T=Math.sqrt(g*g+v*v),y=(h*g+m*v)/(C*T),y>1?y=1:y<-1&&(y=-1),b=Math.acos(y),k=b-de[t],B+=.5*pe[t]*k*k;for(t=0;t<un;t++)i=re[t],c=D[i],p=oe[t]-P[i],f=ae[t]-E[i],w=p*p+f*f,S=ie[t],A=Math.sqrt(w),B+=.5*S*A*A;for(t=0;t<dn;t++)Ce[t]!==1/0&&(Qt&&(N=Ce[t]*Qt*me[t],B+=o.convert(N,{from:a.MW_ENERGY_UNIT,to:a.EV})),R+=.5*Ce[t]*(ye[t]*ye[t]+be[t]*be[t]));Dt=_(R,rn),e.time=nn,e.PE=B,e.KE=o.convert(R,{from:a.MW_ENERGY_UNIT,to:a.EV}),e.temperature=Dt,e.pCM=[Et,Ot],e.CM=[kt,Pt],e.vCM=[Mt,Lt],e.omega_CM=It,e.atoms=$,e.radialBonds=ne,Vt.callPluginFunction("processOutputState",[e])},newPotentialCalculator:function(e,t,n){return function(r,i){var s,l,c,d,p,f,h,m,g,v=0,y=0,b=0,_=_n[e];for(c=0;c<rn;c++)d=r-P[c],p=i-E[c],f=d*d+p*p,m=0,Wt&&(g=_[D[c]],v+=-g.potentialFromSquaredDistance(f,e,D[c]),n&&(m+=g.forceOverDistanceFromSquaredDistance(f))),jt&&Or.length>0&&t&&(h=Math.sqrt(f),v+=-u.potential(h,t,I[c],Ft,zt),n&&(m+=u.forceOverDistanceFromSquaredDistance(f,t,I[c],Ft,zt))),m&&(y+=m*d,b+=m*p);return n?(s=o.convert(y,{from:a.MW_FORCE_UNIT,to:a.EV_PER_NM}),l=o.convert(b,{from:a.MW_FORCE_UNIT,to:a.EV_PER_NM}),[v,[s,l]]):v}},addKEToAtoms:function(t){var n,r,i,o,a,s=Array.prototype.slice.call(arguments,1),l=0;if(0===s.length)for(i=0;i<rn;i++)s.push(i);for(i=0,o=s.length;i<o;i++)l+=e.getAtomKineticEnergy(s[i]);if(n=l+t,n<=0)return!1;for(0===l&&(a=s[0],O[a]=2*Math.random()-1e-5,M[a]=2*Math.random()-1e-5,l=e.getAtomKineticEnergy(a)),r=Math.sqrt(n/l),i=0,o=s.length;i<o;i++)a=s[i],O[a]*=r,M[a]*=r,A[a]*=r,k[a]*=r;return!0},addKEToAtomPairAndConserveMomentum:function(e,t,n){var r=P[n]-P[t],i=E[n]-E[t],s=-Math.atan2(i,r),l=Math.cos(s),u=Math.sin(s),c=l*O[t]-u*M[t],d=l*O[n]-u*M[n],p=u*O[t]+l*M[t],f=u*O[n]+l*M[n],h=F[t],m=F[n],g=.5*h*(c*c+p*p)+.5*m*(d*d+f*f),v=g+o.convert(e,{from:a.EV,to:a.MW_ENERGY_UNIT});if(v<0)return!1;var y=h+h*h/m,b=2*h*(c-d),_=2*(g-v),x=b*b-4*y*_;if(x<0)return!1;x=Math.sqrt(x);var w=(-b+x)/(2*y),C=(-b-x)/(2*y),T=Math.abs(w)<Math.abs(C)?w:C;return c+=T,d+=-h/m*T,u*=-1,O[t]=c*l-p*u,A[t]=h*O[t],M[t]=c*u+p*l,k[t]=h*M[t],O[n]=d*l-f*u,A[n]=m*O[n],M[n]=d*u+f*l,k[n]=m*M[n],!0},findMinimumPELocation:function(t,n,r,i){var o=e.newPotentialCalculator(t,i,!0),a=W[t],s=l.minimize(o,[n,r],{bounds:[[a,Kt[0]-a],[a,Kt[1]-a]]});return!s.error&&s[1]},findMinimumPESquaredLocation:function(t,n,r,i){var o=e.newPotentialCalculator(t,i,!0),a=function(e,t){var n,r,i;return n=o(e,t),r=n[0],i=n[1],i[0]*=2*r,i[1]*=2*r,[r*r,i]},s=W[t],u=l.minimize(a,[n,r],{bounds:[[s,Kt[0]-s],[s,Kt[1]-s]],stopval:1e-4,precision:1e-6});return!u.error&&u[1]},getMoleculeAtoms:function(t){var n,r,i,o,a=[],s=[],l={};for(s.push(t),l[t]=!0;s.length>0;)for(n=e.getBondedAtoms(s.pop()),i=0,o=n.length;i<o;i++)r=n[i],l[r]||(l[r]=!0,s.push(r),a.push(r));return a},getBondedAtoms:function(e){return Lr[e]||[]},getCoulombForceAt:function(e,t,n){if(n=n||{},!jt||0===Or.length)return n.fx=n.fy=0,n;var r,i,s,l,c,d,p,f,h,m,g=0,v=0;for(r=0,i=Or.length;r<i;r++)f=Or[r],p=I[f],s=P[f]-e,l=E[f]-t,c=s*s+l*l,d=u.forceOverDistanceFromSquaredDistance(c,1,p,Ft,zt),g+=d*s,v+=d*l;for(r=0;r<hn;r++)h=ft[r],(null==h||fr(h,e,t))&&(m=pt[r],"N"===m||"S"===m?v+=hr(r):g+=hr(r));return n.fx=o.convert(g,{from:a.MW_FORCE_UNIT,to:a.EV_PER_NM}),n.fy=o.convert(v,{from:a.MW_FORCE_UNIT,to:a.EV_PER_NM}),n},getAtomKineticEnergy:function(e){var t=.5*F[e]*(O[e]*O[e]+M[e]*M[e]);return o.convert(t,{from:a.MW_ENERGY_UNIT,to:a.EV})},getAtomNeighbors:function(e){var t,n,r=[],i=St.getList();for(t=St.getStartIdxFor(e),n=St.getEndIdxFor(e);t<n;t++)r.push(i[t]);return r},getNeighborList:function(){return St},setViscosity:function(e){v=e},get ljCalculator(){return _n},get radialBondsChanged(){return ln},atomsBonded:function(e,t){return!!(Mr&&Mr[e]&&Mr[e][t])},getState:function(){var e=[new p(X),new p($),new p(De),new p(Qe),new p(ct),new p(ne),new p(fe),new p(se),new p(Ct),Q,{clone:function(){return{time:nn,N:rn,N_elements:on,N_obstacles:dn,N_shapes:pn,N_lines:fn,N_radialBonds:sn,N_angularBonds:cn,N_restraints:un,N_springForces:mn}},restore:function(e){nn=e.time,rn=e.N,on=e.N_elements,pn=e.N_shapes,fn=e.N_lines,sn=e.N_radialBonds,cn=e.N_angularBonds,un=e.N_restraints,mn=e.N_springForces,St.invalidate(),Mr.reset(),Lr.reset(),Or.reset()}}];return Vt.callPluginFunction("getState",[],function(t){e=e.concat(t)}),e},callPluginAccessor:function(e,t){var n;return t=t||[],Vt.callPluginFunction(e,t,function(e){n=e}),n}},wn(),e.pairwiseLJProperties=Q,e}}),define("models/md2d/models/unit-definitions/md2d",[],function(){return{name:"md2d",translated:!1,units:{length:{name:"nanometer",pluralName:"nanometers",symbol:"nm"},mass:{name:"atomic mass unit",pluralName:"atomic mass units",symbol:"amu"},time:{name:"femtosecond",pluralName:"femtoseconds",symbol:"fs",displayValue:{unitsPerBaseUnit:.001,pluralName:"picoseconds",name:"picosecond",symbol:"ps"}},inverseTime:{name:"1/femtosecond",pluralName:"1/femtoseconds",symbol:"1/fs"},velocity:{name:"nanometer per femtosecond",pluralName:"nanometers per second",symbol:"nm/s"},acceleration:{name:"nanometer per femtosecond squared",pluralName:"nanometers per femtosecond squared",symbol:"nm/fs²"},momentum:{name:"amu nanometer per femtosecond",pluralName:"amu nanometers per femtosecond",symbol:"amu⋅nm/fs"},force:{name:"amu nanometer per femtosecond squared",pluralName:"amu nanometers per femtosecond squared",symbol:"amu⋅nm/fs²"},energy:{name:"electron volt",pluralName:"electron volts",symbol:"eV"},dampingCoefficient:{name:"amu per femtosecond",pluralName:"amu per femtoseconds",symbol:"amu/fs"},stiffness:{name:"electron volt per nanometer squared",pluralName:"electron volts per nanometer squared",symbol:"eV/nm²"},rotationalStiffness:{name:"electron volt per radian",pluralName:"electron volts per radian",symbol:"eV/rad"},charge:{name:"elementary charge",pluralName:"elementary charges",symbol:"e"},temperature:{name:"Kelvin",pluralName:"Kelvin",symbol:"K"},pressure:{name:"bar",pluralName:"bar",symbol:"bar"},angle:{name:"radian",pluralName:"radians",symbol:"rad"}}}}),define("models/md2d/models/unit-definitions/mks",[],function(){return{name:"mks",translated:!0,units:{length:{name:"meter",pluralName:"meters",symbol:"m",representationInMD2DUnits:1,valueInSIUnits:1},mass:{name:"kilogram",pluralName:"kilograms",symbol:"kg",representationInMD2DUnits:1,valueInSIUnits:1},time:{name:"second",pluralName:"seconds",symbol:"s",representationInMD2DUnits:1e4,valueInSIUnits:1},inverseTime:{name:"1/second",pluralName:"1/seconds",symbol:"1/s",valueInSIUnits:1},velocity:{name:"meter per second",pluralName:"meters per second",symbol:"m/s",valueInSIUnits:1},acceleration:{name:"meter per second squared",pluralName:"meters per second squared",symbol:"m/s²",valueInSIUnits:1},force:{name:"Newton",pluralName:"Newtons",symbol:"N",valueInSIUnits:1},energy:{name:"Joule",pluralName:"Joules",symbol:"J",valueInSIUnits:1},dampingCoefficient:{name:"Newton second per meter",pluralName:"Newton seconds per meter",symbol:"N⋅s/m",valueInSIUnits:1},stiffness:{name:"Newton per meter",pluralName:"Newtons per meter",symbol:"N/m",valueInSIUnits:1},rotationalStiffness:{name:"Newton-meter per radian",pluralName:"Newton-meters per radian",symbol:"N⋅m/rad",valueInSIUnits:1},charge:{name:"Coulomb",pluralName:"Coulombs",symbol:"C",valueInSIUnits:1}}}}),define("models/md2d/models/unit-definitions/index",["require","models/md2d/models/unit-definitions/md2d","models/md2d/models/unit-definitions/mks","underscore"],function(e){var t={md2d:e("models/md2d/models/unit-definitions/md2d"),mks:e("models/md2d/models/unit-definitions/mks")},n=e("underscore");return{get:function(e){var r;return"md2d"===e?t.md2d:(r=n.extend({},t[e]),r.units=n.extend({},t.md2d.units,t[e].units),r)}}}),define("models/md2d/models/units-translation",["require","underscore","models/md2d/models/engine/constants/index","models/md2d/models/engine/potentials/coulomb"],function(e){var t=e("underscore"),n=e("models/md2d/models/engine/constants/index"),r=e("models/md2d/models/engine/potentials/coulomb"),i=n.COULOMB_CONSTANT.as(n.unit.METERS_PER_FARAD),o=["length","mass","time"];return function(e){var a,s={},l={};return t.each(o,function(t){var n=e.units[t];s[t]=n.valueInSIUnits/n.representationInMD2DUnits}),s.inverseTime=1/s.time,s.velocity=s.length/s.time,s.acceleration=s.velocity/s.time,s.force=s.mass*s.acceleration,s.energy=n.ratio(n.unit.MW_ENERGY_UNIT,{per:n.unit.EV}),s.energy*=s.force*s.length,s.dampingCoefficient=s.force/s.velocity,s.stiffness=s.energy/s.length/s.length,s.rotationalStiffness=s.energy/s.length,a=r.force(1,-1,1,1),s.charge=Math.sqrt(a*s.force*s.length*s.length/i),t.each(t.keys(s),function(t){l[t]=s[t]/e.units[t].valueInSIUnits}),{translateToModelUnits:function(e,t){return null==l[t]?e:e/l[t]},translateFromModelUnits:function(e,t){return null==l[t]?e:e*l[t]}}}}),function(){define("cs!models/md2d/models/solvent",["require"],function(e){var t,n;return n={vacuum:{forceType:0,dielectricConstant:1,color:"#eee"},oil:{forceType:-1,dielectricConstant:10,color:"#f5f1dd"},water:{forceType:1,dielectricConstant:80,color:"#B8EBF0"}},t=function(){function e(e){var t,r,i;if(this.type=e,r=n[this.type],null==r)throw new Error("Solvent: unknown type. Use 'vacuum', 'oil' or 'water'.");for(t in r)i=r[t],this[t]=i}return e}()})}.call(this),define("models/md2d/views/nucleotide-paths",[],function(){return{outline:{A:"M20.7,0.4l-0.075-0.075C20.672,0.273,20.73,0.231,20.8,0.2             c0.122-0.049,0.247-0.058,0.375-0.025c0.031,0.002,0.064,0.011,0.1,0.025c0.151,0.054,0.26,0.154,0.325,0.3l6.35,14.15             c0.026,0.065,0.043,0.132,0.05,0.2c0.092,0.104,0.142,0.229,0.15,0.375c0.01,0.163-0.041,0.304-0.15,0.425l-9.025,9.85             c-1.65,1.667-3.292,3.55-4.925,5.65L0.2,15.65c-0.11-0.121-0.16-0.262-0.15-0.425c0.008-0.146,0.058-0.271,0.15-0.375             c0.005-0.068,0.021-0.134,0.05-0.2L6.6,0.5c0.074-0.146,0.19-0.246,0.35-0.3c0.151-0.064,0.301-0.064,0.45,0             c0.038,0.019,0.071,0.043,0.1,0.075C7.593,0.339,7.66,0.431,7.7,0.55c0.047,0.112-0.012,0.154-0.175,0.125             C7.461,0.656,7.386,0.63,7.3,0.6L1.65,15.125l12.4,13.625l12.6-13.725L20.7,0.4z",C:"M12.45,0c2.167,0.5,4.066,1.95,5.7,4.35             c2.033,2.967,3.05,6.533,3.05,10.7c0,3.8-0.867,7.117-2.6,9.95c-0.067,0.133-0.167,0.217-0.3,0.25c-0.133,0.067-0.267,0.067-0.4,0             c-0.133-0.033-0.233-0.117-0.3-0.25c-0.133-0.233-0.283-0.45-0.45-0.65V24.3c-1.8-2.667-3.983-4-6.55-4             c-2.567,0.034-4.767,1.383-6.6,4.05c-0.167,0.2-0.3,0.417-0.4,0.65c-0.1,0.133-0.217,0.217-0.35,0.25             c-0.133,0.067-0.267,0.067-0.4,0c-0.133-0.033-0.233-0.117-0.3-0.25C0.85,22.167,0,18.85,0,15.05c0-4.167,1-7.733,3-10.7             C4.633,1.95,6.55,0.5,8.75,0H12.45z M4,5.05V5C3.991,5.016,3.982,5.033,3.975,5.05C2.289,7.935,1.431,11.126,1.4,14.625             c-0.03,3.519,0.536,6.477,1.7,8.875c2.066-3.39,4.566-5.064,7.5-5.025c2.933,0.04,5.433,1.731,7.5,5.075             c1.088-2.518,1.605-5.559,1.55-9.125c-0.055-3.565-0.888-6.69-2.5-9.375V5c-1.8-2.397-3.983-3.589-6.55-3.575             C8.033,1.439,5.833,2.647,4,5.05z",
G:"M8.75,0h3.675c2.191,0.504,4.1,1.963,5.725,4.375V4.35             c2.035,2.963,3.052,6.53,3.05,10.7c0.001,4.17-1.015,7.737-3.05,10.7v-0.025c-2.066,3.065-4.583,4.59-7.55,4.575             c-2.966,0.023-5.5-1.494-7.6-4.55v-0.025C0.999,22.77-0.001,19.211,0,15.05c-0.001-4.161,0.999-7.72,3-10.675V4.35             C4.647,1.953,6.564,0.503,8.75,0z M17.15,25.05c1.754-2.938,2.621-6.354,2.6-10.25c-0.022-3.895-0.889-7.145-2.6-9.75V5.025             c-1.8-2.269-3.984-3.402-6.55-3.4C8.033,1.63,5.833,2.771,4,5.05V5.025c-1.646,2.778-2.496,6.12-2.55,10.025             C1.396,18.955,2.246,22.297,4,25.075V25.05c1.583,2.593,3.667,3.985,6.25,4.175c2.583,0.189,4.883-1.194,6.9-4.15V25.05z",T:"M7.45,0.2H7.9C7.794,0.442,7.677,0.709,7.55,1             C6.388,3.721,4.504,8.396,1.9,15.025l6.9,8.35l1.025-1.35c1.258-1.424,2.55-2.816,3.875-4.175l0.025-0.025             c0.148-0.186,0.314-0.336,0.5-0.45c0.046-0.028,0.096-0.036,0.15-0.025c0.059,0.007,0.109,0.032,0.15,0.075l5.325,5.95l6.95-8.35             C24.252,8.584,22.369,3.909,21.15,1c-0.127-0.284-0.243-0.551-0.35-0.8h0.6h0.575c0.041,0.045,0.075,0.095,0.1,0.15l6.35,14.15             c0.028,0.066,0.053,0.133,0.075,0.2c0.087,0.129,0.137,0.279,0.15,0.45c0.01,0.238-0.065,0.447-0.225,0.625l-8.2,8.95             c-0.102,0.12-0.227,0.204-0.375,0.25c-0.167,0.043-0.334,0.043-0.5,0c-0.147-0.046-0.272-0.129-0.375-0.25l-4.675-5.1l-4.625,5.1             c-0.101,0.121-0.226,0.204-0.375,0.25c-0.167,0.043-0.334,0.043-0.5,0c-0.147-0.046-0.272-0.129-0.375-0.25l-8.15-8.95             c-0.16-0.178-0.235-0.387-0.225-0.625c0.014-0.168,0.063-0.318,0.15-0.45c0.019-0.066,0.044-0.133,0.075-0.2l6.35-14.15V0.325             C6.649,0.28,6.674,0.238,6.7,0.2H7.45z",U:"M20.8,0.2h0.6h0.575c0.041,0.045,0.075,0.095,0.1,0.15             l6.35,14.15c0.028,0.066,0.053,0.133,0.075,0.2c0.087,0.129,0.137,0.279,0.15,0.45c0.01,0.238-0.065,0.447-0.225,0.625l-8.2,8.95             c-0.102,0.12-0.227,0.204-0.375,0.25c-0.167,0.043-0.334,0.043-0.5,0c-0.147-0.046-0.272-0.129-0.375-0.25l-4.675-5.1l-4.625,5.1             c-0.101,0.121-0.226,0.204-0.375,0.25c-0.167,0.043-0.334,0.043-0.5,0c-0.147-0.046-0.272-0.129-0.375-0.25l-8.15-8.95             c-0.16-0.178-0.235-0.387-0.225-0.625c0.014-0.168,0.063-0.318,0.15-0.45c0.019-0.066,0.044-0.133,0.075-0.2l6.35-14.15V0.325             C6.649,0.28,6.674,0.238,6.7,0.2h0.75H7.9C7.794,0.442,7.677,0.709,7.55,1C6.388,3.721,4.504,8.396,1.9,15.025l6.9,8.35             l1.025-1.35c1.258-1.424,2.55-2.816,3.875-4.175l0.025-0.025c0.148-0.186,0.314-0.336,0.5-0.45             c0.046-0.028,0.096-0.036,0.15-0.025c0.059,0.007,0.109,0.032,0.15,0.075l5.325,5.95l6.95-8.35C24.252,8.584,22.369,3.909,21.15,1             C21.023,0.716,20.907,0.449,20.8,0.2z"},interior:{A:"M21.175,0.175C21.046,0.143,20.921,0.151,20.8,0.2             c-0.069,0.031-0.128,0.073-0.175,0.125c-0.055,0.054-0.097,0.121-0.125,0.2c-0.063,0.16,0.003,0.118,0.2-0.125l5.95,14.625             L14.05,28.75L1.65,15.125L7.3,0.6c0.086,0.03,0.161,0.056,0.225,0.075C7.688,0.704,7.747,0.662,7.7,0.55             C7.66,0.431,7.593,0.339,7.5,0.275L7.6,0.2c4.8-0.067,7.283-0.1,7.45-0.1l6.1,0.05L21.175,0.175z",C:"M3.975,5.05H4c1.833-2.402,4.033-3.611,6.6-3.625             C13.167,1.411,15.35,2.603,17.15,5v0.05c1.612,2.685,2.445,5.81,2.5,9.375c0.055,3.566-0.461,6.607-1.55,9.125             c-2.067-3.344-4.567-5.035-7.5-5.075c-2.934-0.04-5.434,1.635-7.5,5.025c-1.164-2.398-1.73-5.356-1.7-8.875             C1.431,11.126,2.289,7.935,3.975,5.05z",G:"M17.15,25.05v0.025c-2.017,2.956-4.317,4.339-6.9,4.15             C7.667,29.035,5.583,27.643,4,25.05v0.025c-1.754-2.778-2.604-6.12-2.55-10.025C1.504,11.145,2.354,7.803,4,5.025V5.05             c1.833-2.278,4.033-3.42,6.6-3.425c2.566-0.002,4.75,1.131,6.55,3.4V5.05c1.711,2.605,2.578,5.855,2.6,9.75             C19.771,18.695,18.904,22.112,17.15,25.05z",T:"M21.4,0.2h-0.6c0.107,0.249,0.223,0.516,0.35,0.8             c1.219,2.909,3.103,7.584,5.65,14.025l-6.95,8.35l-5.325-5.95c-0.041-0.042-0.091-0.067-0.15-0.075             c-0.054-0.011-0.104-0.003-0.15,0.025c-0.186,0.114-0.352,0.264-0.5,0.45L13.7,17.85c-1.325,1.358-2.617,2.75-3.875,4.175             L8.8,23.375l-6.9-8.35C4.504,8.396,6.388,3.721,7.55,1C7.677,0.709,7.794,0.442,7.9,0.2H7.45c0.133-0.067,0.333-0.1,0.6-0.1             c0.406,0,1.606-0.008,3.6-0.025l-1.375,0.05C17.28,0.048,20.955,0.056,21.3,0.15C21.334,0.164,21.368,0.181,21.4,0.2z",U:"M7.9,0.2l0.15-0.1c0.406,0,1.606-0.008,3.6-0.025l-1.375,0.05             c6.009-0.066,9.568-0.066,10.675,0L20.8,0.2c0.107,0.249,0.223,0.516,0.35,0.8c1.219,2.909,3.103,7.584,5.65,14.025l-6.95,8.35             l-5.325-5.95c-0.041-0.042-0.091-0.067-0.15-0.075c-0.054-0.011-0.104-0.003-0.15,0.025c-0.186,0.114-0.352,0.264-0.5,0.45             L13.7,17.85c-1.325,1.358-2.617,2.75-3.875,4.175L8.8,23.375l-6.9-8.35C4.504,8.396,6.388,3.721,7.55,1             C7.677,0.709,7.794,0.442,7.9,0.2z"},letter:{A:{1:"M12.85,12.55h2.6l-1.3-3.95L12.85,12.55z M13,6.25h2.4l3.55,10.1               h-2.3L16,14.3h-3.7l-0.7,2.05H9.4L13,6.25z",2:"M18.7,5.95l-3.55,10.1h-2.4l-3.6-10.1h2.2L12.05,8h3.7l0.65-2.05               H18.7z M12.6,9.75l1.3,3.95l1.3-3.95H12.6z"},C:{1:"M10.45,6.4c1.667,0,2.883,0.55,3.65,1.65               c0.433,0.633,0.667,1.267,0.7,1.9h-2.1c-0.133-0.5-0.3-0.867-0.5-1.1c-0.4-0.434-0.967-0.65-1.7-0.65S9.183,8.5,8.75,9.1               C8.317,9.733,8.1,10.617,8.1,11.75c0,1.1,0.217,1.933,0.65,2.5c0.467,0.567,1.05,0.85,1.75,0.85c0.733,0,1.283-0.233,1.65-0.7               c0.233-0.267,0.417-0.667,0.55-1.2h2.05c-0.167,1.1-0.617,2-1.35,2.7c-0.733,0.7-1.683,1.05-2.85,1.05               c-1.433,0-2.566-0.467-3.4-1.4c-0.8-0.933-1.2-2.216-1.2-3.85c0-1.767,0.466-3.117,1.4-4.05C8.15,6.817,9.183,6.4,10.45,6.4z",2:"M15,12.35c-0.033,0.633-0.267,1.267-0.7,1.9               c-0.767,1.1-1.983,1.65-3.65,1.65c-1.267,0-2.3-0.417-3.1-1.25c-0.933-0.933-1.4-2.283-1.4-4.05c0-1.633,0.4-2.917,1.2-3.85               c0.833-0.933,1.967-1.4,3.4-1.4c1.167,0,2.117,0.35,2.85,1.05c0.733,0.7,1.183,1.6,1.35,2.7H12.9               c-0.133-0.533-0.316-0.934-0.55-1.2c-0.367-0.467-0.917-0.7-1.65-0.7c-0.7,0-1.284,0.283-1.75,0.85               c-0.434,0.567-0.65,1.4-0.65,2.5c0,1.133,0.217,2.017,0.65,2.65c0.433,0.6,1.017,0.9,1.75,0.9c0.733,0,1.3-0.217,1.7-0.65               c0.2-0.233,0.367-0.6,0.5-1.1H15z"},G:{1:"M14.8,10.8h-2.05c-0.167-0.667-0.567-1.133-1.2-1.4               c-0.333-0.167-0.716-0.25-1.15-0.25c-0.8,0-1.467,0.3-2,0.9c-0.5,0.633-0.75,1.567-0.75,2.8s0.283,2.1,0.85,2.6               c0.567,0.533,1.2,0.8,1.9,0.8c0.7,0,1.283-0.217,1.75-0.65c0.434-0.4,0.717-0.934,0.85-1.6h-2.35v-1.65h4.2v5.4h-1.4l-0.2-1.25               c-0.4,0.467-0.767,0.8-1.1,1C11.583,17.833,10.9,18,10.1,18c-1.333,0-2.434-0.467-3.3-1.4c-0.867-0.9-1.3-2.167-1.3-3.8               s0.45-2.933,1.35-3.9c0.867-1,2.05-1.5,3.55-1.5c1.267,0,2.3,0.333,3.1,1C14.267,9.033,14.7,9.833,14.8,10.8z",2:"M10.65,9.65c-0.7,0-1.333,0.267-1.9,0.8               c-0.567,0.5-0.85,1.367-0.85,2.6c0,1.233,0.25,2.167,0.75,2.8c0.533,0.6,1.2,0.9,2,0.9c0.434,0,0.817-0.083,1.15-0.25               c0.633-0.267,1.034-0.733,1.2-1.4h2.05c-0.1,0.967-0.533,1.767-1.3,2.4c-0.8,0.667-1.833,1-3.1,1c-1.5,0-2.683-0.5-3.55-1.5               c-0.9-0.967-1.35-2.267-1.35-3.9s0.433-2.9,1.3-3.8c0.867-0.933,1.967-1.4,3.3-1.4c0.8,0,1.483,0.167,2.05,0.5               c0.333,0.2,0.7,0.533,1.1,1l0.2-1.25h1.4v5.4h-4.2V11.9h2.35c-0.133-0.667-0.417-1.2-0.85-1.6C11.933,9.867,11.35,9.65,10.65,9.65z"},T:{1:"M10.3,5 L18.45,5 L18.45,6.8 L15.4,6.8 L15.4,15.1 L13.3,15.1               L13.3,6.8 L10.3,6.8z",2:"M10.2,14.65 L10.2,12.85 L13.2,12.85 L13.2,4.55 L15.3,4.55               L15.3,12.85 L18.35,12.85 L18.35,14.65z"},U:{1:"M10.15,10.8V4.6h2.15v6.2c0,0.7,0.083,1.217,0.25,1.55               c0.267,0.566,0.817,0.85,1.65,0.85c0.867,0,1.417-0.284,1.65-0.85c0.167-0.333,0.25-0.85,0.25-1.55V4.6h2.15v6.2               c0,1.067-0.167,1.9-0.5,2.5c-0.633,1.1-1.817,1.65-3.55,1.65c-1.733,0-2.917-0.55-3.55-1.65C10.317,12.7,10.15,11.867,10.15,10.8z",2:"M12.45,8.4v6.2H10.3V8.4c0-1.066,0.167-1.9,0.5-2.5               c0.633-1.1,1.817-1.65,3.55-1.65S17.267,4.8,17.9,5.9c0.333,0.6,0.5,1.434,0.5,2.5v6.2h-2.15V8.4c0-0.7-0.083-1.217-0.25-1.55               C15.767,6.283,15.217,6,14.35,6c-0.833,0-1.383,0.283-1.65,0.85C12.533,7.183,12.45,7.7,12.45,8.4z"}}}}),define("models/md2d/views/nucleotides",["require","models/md2d/views/nucleotide-paths","common/resources-url"],function(e){function t(){function e(e){var n,r;e?(n=Math.random()>=.5?.25*Math.PI:1.25*Math.PI,n+=Math.random()*Math.PI*.5,r=6*t.HEIGHT,y=r*Math.cos(n),b=r*Math.sin(n)):y=b=0}function s(e){return"translate("+u(y+t.WIDTH*e.idx)+" "+u(b)+")"}function l(t){t.each(function(t,l){var y,b,_,x,w,C,T,S,A,k,P=d3.select(this),E=f?.9*a.BACKB:0,O=u(E+.5*a.A),M=u(E+.97*a.A),L="function"==typeof c?c(t,l):c;"string"==typeof L&&(L=L.split(""),L.forEach(function(e,t){L[t]={id:t,idx:t,type:e}})),y=P.selectAll(".nucleotide").data(L,function(e){return e.id}),b=y.enter(),_=y.exit(),e(m),b=b.append("g").attr({transform:s}).style({opacity:m?0:1}),x=b.append("g").attr({class:"scale",transform:"scale(1, "+(1===d?1:-1)+")"}),x.append("path").attr("class","bonds").style({"stroke-width":u(.01),stroke:"#fff"}),C=x.append("g").classed("nucleo-shape",!0).classed("clickable-nucleo",function(e){return"c"===e.region&&g}).on("click",function(){}),g&&C.append("image").attr({class:"glow",y:u(E-.17*o.G_GLOW),preserveAspectRatio:"none"}),T=C.append("svg").attr({y:u(E),preserveAspectRatio:"none"}),T.append("path").attr({class:"outline","fill-rule":"evenodd","clip-rule":"evenodd"}),T.append("path").attr({class:"interior","fill-rule":"evenodd","clip-rule":"evenodd"}),T.append("path").attr({class:"letter","fill-rule":"evenodd","clip-rule":"evenodd",d:function(e){return n.letter[e.type][d]}}),f&&(w=x.append("image").attr({class:"backbone",x:0,y:0,width:u(o.BACKB),height:u(a.BACKB),preserveAspectRatio:"none","xlink:href":r("dna/Backbone_"+f+".svg")})),v&&(y=b),y.attr("class",function(e){var t="";switch(e.region){case"c":t="coding-region";break;case"j":t="junk-region";break;case"p":t="promoter-region";break;case"t":t="terminator-region"}return"nucleotide "+t}),y.select(".bonds").attr("d",function(e){return"C"===e.type||"G"===e.type?"M"+u(20*i)+" "+O+" L "+u(20*i)+" "+M+"M"+u(26*i)+" "+O+" L "+u(26*i)+" "+M+"M"+u(32*i)+" "+O+" L "+u(32*i)+" "+M:"M"+u(22*i)+" "+O+" L "+u(22*i)+" "+M+"M"+u(30*i)+" "+O+" L "+u(30*i)+" "+M}),y.select(".glow").attr({x:function(e){return u(o.BACKB)/2-u(o[e.type+"_GLOW"])/2},width:function(e){return u(o[e.type+"_GLOW"])},height:function(e){return u(a[e.type+"_GLOW"])},"xlink:href":function(e){return r("dna/NucleotideGlow_"+e.type+".svg")}}),S=y.select(".nucleo-shape > svg"),S.attr({class:function(e){var t="type-"+e.type;return h&&h[e.idx]&&(t+=" stop-codon"),t},viewBox:function(e){return"0 0 "+o[e.type]/i+" "+a[e.type]/i},x:function(e){return u(o.BACKB)/2-u(o[e.type])/2},width:function(e){return u(o[e.type])},height:function(e){return u(a[e.type])}}),S.select("path.interior").attr("d",function(e){return n.interior[e.type]}),S.select("path.outline").attr("d",function(e){return n.outline[e.type]}),e(!1),A=d3.transition(y).attr("transform",s).style("opacity",1),A.select(".bonds").style("opacity",p),A.attrTween?(k="scale(1, "+(1===d?1:-1)+")",A.select("g.scale").attrTween("transform",function(e,t,n){return d3.interpolateString(n,k)}),A.select("path.letter").attrTween("d",function(e,t,r){return function(t){return t<.5?r:n.letter[e.type][d]}})):(y.select("g.scale").attr("transform","scale(1, "+(1===d?1:-1)+")"),y.select("path.letter").attr("d",function(e){return n.letter[e.type][d]})),e(!0),d3.transition(_).attr("transform",s).style("opacity",0).remove()})}var u=null,c="",d=1,p=1,f="DNA",h=null,m=!0,g=!1,v=!1,y=0,b=0;return l.sequence=function(e){return arguments.length?(c=e,l):c},l.model2px=function(e){return arguments.length?(u=e,l):u},l.direction=function(e){return arguments.length?(d=e,l):d},l.bonds=function(e){return arguments.length?(p=e,l):p},l.randomEnter=function(e){return arguments.length?(m=e,l):m},l.glow=function(e){return arguments.length?(g=e,l):g},l.backbone=function(e){return arguments.length?(f=e,l):f},l.stopCodonsHash=function(e){return arguments.length?(h=e,l):h},l.enterExitOnly=function(e){return arguments.length?(v=e,l):v},l}var n=e("models/md2d/views/nucleotide-paths"),r=e("common/resources-url"),i=.007,o={BACKB:52,A:28.151,C:21.2,G:21.2,T:28.651,U:28.651,A_GLOW:44.125,C_GLOW:37.2,G_GLOW:36.2,T_GLOW:45.566},a={BACKB:14,A:31.15,C:25.3,G:30.3,T:25.007,U:25.007,A_GLOW:44.55,C_GLOW:41.417,G_GLOW:45.3,T_GLOW:40.65};return function(){var e;for(e in o)o.hasOwnProperty(e)&&(o[e]*=i);for(e in a)a.hasOwnProperty(e)&&(a[e]*=i)}(),t.WIDTH=.92*o.BACKB,t.HEIGHT=.96*(.9*a.BACKB+a.A),t}),define("models/md2d/models/engine/genetic-engine",["require","cs!models/md2d/models/aminoacids-helper","common/alert","models/md2d/views/nucleotides"],function(e){function t(e){return e.replace(/A/g,"t").replace(/G/g,"c").replace(/T/g,"a").replace(/C/g,"g").toUpperCase()}function n(e){var t,n=["A","G","T","C"],r=n.length,i="";for(t=0;t<e;t++)i+=n[Math.floor(Math.random()*r)];return i}function r(){return c++}var i,o,a=e("cs!models/md2d/models/aminoacids-helper"),s=e("common/alert"),l=(e("models/md2d/views/nucleotides").WIDTH,["undefined","intro-cells","intro-zoom1","intro-zoom2","intro-zoom3","intro-polymerase","dna","transcription","transcription-end","after-transcription","before-translation","translation","translation-end"]),u={},c=0,d="TGACCTCTCCGCGCCATCTATAAACCGAAGCGCTAGCTACA",p="ACCACAGGCCGCCAGTTCCGCTGGCGGCATTTT",f=t(d),h=t(p),m="change";return function(){var e,r;for(e=0,r=l.length;e<r;e++)u[l[e]]=e;i=n(50),o=t(i)}(),function(e){var n,c,g,v=m,y=[],b="",_="",x=d3.dispatch("change","transition"),w=function(){for(var e=T(0),t="";e;)t+=e,e=T(t.length);return t},C=function(){var e,t,n;for(c={},g=null,t=0,n=_.length;t<n;t+=3)e=_.substr(t,3),"STOP"===a.codonToAbbr(e)&&(null===g&&(g=t/3),3===e.length&&(c[t]=c[t+1]=c[t+2]=!0));null===g&&(g=Math.floor(_.length/3))},T=function(e){if(e>=b.length)return null;switch(b[e]){case"A":return"U";case"G":return"C";case"T":return"A";case"C":return"G"}},S=function(e,t){var n,i,o;for(e.length=t.length,n=0,i=t.length;n<i;n++)o=e[n]||{},o.idx=n,o.type!==t[n]&&(o.type=t[n],o.id=r(),e[n]=o);return e},A=function(e,t,n){var a,s,l,u=n?o+f+t+h+o:i+d+t+p+i,c=i.length,m=c+d.length,g=m+t.length,v=g+p.length;for(e.length=u.length,a=0,s=u.length;a<s;a++)l=e[a]||{},l.idx=a,a<c?l.region="j":a<m?l.region="p":a<g?l.region="c":a<v?l.region="t":l.region="j",l.type!==u[a]&&(l.type=u[a],l.id=r(),e[a]=l);return e},k=function(){var r=e.get("DNA");A(n.viewModel.DNA,r,!1),b=t(r),A(n.viewModel.DNAComp,b,!0),_=w(),C(),n.stateBefore("transcription:0")?S(n.viewModel.mRNA,""):"transcription"===n.state().name?S(n.viewModel.mRNA,_.substr(0,n.state().step)):n.stateAfter("transcription")&&S(n.viewModel.mRNA,_),"transition"!==v&&(n.stateBefore("translation:1")?P():n.stateEqual("translation-end")&&E())},P=function(){var t;if(t=e.getNumberOfAtoms(),t>0){for(e.startBatch();t>0;)e.removeAtom(t-1),t--;e.endBatch()}e.stop()},E=function(){for(var t=[],r=0,i=a.codonToAbbr(n.codon(0));"STOP"!==i;)t.push(i),i=a.codonToAbbr(n.codon(++r));n.generateProtein(t,void 0,2.3,.3),n.centerProtein(),e.start()},O=function(t){var r,i,o=t.name;return"transcription"===o?t.step<e.get("DNA").length-1?"transcription:"+(t.step+1):"transcription-end":"translation"===o?(i=a.codonToAbbr(n.codon(t.step)),"STOP"!==i?"translation:"+(t.step+1):"translation-end"):(r=l[u[t.name]+1],"transcription"!==r&&"translation"!==r||(r+=":0"),r)},M=function(t){var n=t.name,r=t.step;return"transcription"===n&&r>0?"transcription:"+(r-1):"transcription-end"===n?"transcription:"+(e.get("DNA").length-1):"translation-end"===n||"translation"===n&&r>0?"translation:0":l[u[n]-1]},L=function(e,t){return e===t?0:(e=n.parseState(e),t=n.parseState(t),e.name===t.name?isNaN(e.step)||isNaN(t.step)?0:e.step<t.step?-1:1:u[e.name]<u[t.name]?-1:1)},N=function(e){"undefined"!=typeof e&&(y.length>0?y.push(e):(y.push(e),R(e)))},R=function(e){B("DNAState",e,"transition")},I=function(e){B("DNA",e,"transition")},D=function(t){y.length=0,e.cancelTransitions(),x.change(t)},B=function(t,n,r){v=r||m,e.properties[t]=n,v=m},V=function(){var t=e.get("DNAState");if("suppress"!==v)if(k(),"transition"===v)x.transition(t);else{if(n.stateAfter("translation:0")&&n.stateBefore("translation-end"))return s("'"+t+"' cannot be set explicitly. 'translation:0' should be set and then animation to '"+t+"' should be triggered."),void B("DNAState","translation:0");D()}},j=function(){if("suppress"!==v){if(n.stateAfter("translation:0")&&n.stateBefore("translation-end"))return void B("DNAState","translation:0");k(),"transition"===v?x.transition("dna-updated",!0):D(!0)}};return n={PRECODING_LEN:i.length+d.length,viewModel:{mRNA:[],DNA:[],DNAComp:[]},on:function(e,t){x.on(e,t)},mutate:function(r,i,o){var a=e.get("DNA"),s=r-n.PRECODING_LEN;if(s<0||s>=a.length)throw new Error("Mutation can be performed only on DNA coding region.");a=a.substr(0,s)+(o?t(i):i)+a.substr(s+1),B("DNA",a)},insert:function(i,o,a){var s={type:a?t(o):o,id:r(),region:"c"},l={type:a?o:t(o),id:r(),region:"c"},u={type:a?t(o):o,id:r(),region:"c"},c=e.get("DNA"),d=n.state(),p=i-n.PRECODING_LEN;if(p<0||p>=c.length)throw new Error("Mutation can be performed only on DNA coding region.");n.viewModel.DNA.splice(i,0,s),n.viewModel.DNAComp.splice(i,0,l),n.viewModel.mRNA.splice(p,0,u),c=c.substr(0,p)+s.type+c.substr(p),"transcription"===d.name&&p<d.step&&B("DNAState",d.name+":"+(d.step+1),"suppress"),I(c)},delete:function(t){var r=e.get("DNA"),i=n.state(),o=t-n.PRECODING_LEN;if(o<0||o>=r.length)throw new Error("Mutation can be performed only on DNA coding region.");n.viewModel.DNA.splice(t,1),n.viewModel.DNAComp.splice(t,1),n.viewModel.mRNA.splice(o,1),r=r.substr(0,o)+r.substr(o+1),"transcription"===i.name&&o<i.step&&B("DNAState",M(i),"suppress"),I(r)},transitionToNextState:function(){n.stopTransition(),0===y.length&&N(O(n.lastState()))},stopTransition:function(){y.length>1&&(y.length=1)},jumpToNextState:function(){n.stateBefore("translation:0")?B("DNAState",O(n.state())):n.stateBefore("translation-end")&&B("DNAState","translation-end")},jumpToPrevState:function(){n.stateAfter("intro-cells")&&B("DNAState",M(n.state()))},transitionTo:function(e){for(;n.lastStateBefore(e);)N(O(n.lastState()))},transcribeStep:function(e){var t,r;if(t=n.state(),"dna"===t.name&&"undefined"==typeof e)n.transitionToNextState();else if("transcription"===t.name){if(r=T(t.step),e&&e.toUpperCase()!==r)return;n.transitionToNextState()}},state:function(){return n.parseState(e.get("DNAState"))},stateBefore:function(t){return L(e.get("DNAState"),t)===-1},stateEqual:function(t){return 0===L(e.get("DNAState"),t)},stateAfter:function(t){return 1===L(e.get("DNAState"),t)},lastState:function(){var e=y.length;return e>0?n.parseState(y[e-1]):n.state()},lastStateBefore:function(t){var n=y.length,r=n?y[n-1]:e.get("DNAState");return L(r,t)===-1},lastStateAfter:function(t){var n=y.length,r=n?y[n-1]:e.get("DNAState");return 1===L(r,t)},parseState:function(e){return e=e.split(":"),{name:e[0],step:Number(e[1])}},codon:function(e){return _.substr(3*e,3)},codonComplement:function(e){return n.codon(e).replace(/A/g,"u").replace(/G/g,"c").replace(/U/g,"a").replace(/C/g,"g").toUpperCase()},translationStepStarted:function(t,r,i,o,s,l){var u=a.codonToAbbr(n.codon(t)),c=a.abbrToElement(u);s+=.02*Math.random()-.01,e.addAtom({x:r,y:i,element:c,visible:!0,pinned:!0},{suppressCheck:!0}),e.atomTransition().id(t).duration(l).prop("x",o),e.atomTransition().id(t).duration(l).prop("y",s),e.start()},shiftAminoAcids:function(t,n,r){if(!(t<1)){var i,o,a;for(i=0;i<t;i++)o=e.getAtomProperties(i).x+n,a=e.getAtomProperties(i).y,e.atomTransition().id(i).duration(r).prop("x",o),e.atomTransition().id(i).duration(r).prop("y",a)}},centerProtein:function(t){e.batch(function(){var r,i,o,a=n.proteinCenterOfMass(),s=e.properties.viewPortX+e.properties.viewPortWidth/2-a.x,l=e.properties.viewPortY+e.properties.viewPortHeight/2-a.y,u=e.properties.minX+.1,c=e.properties.maxX-.1,d=e.properties.minY+.1,p=e.properties.maxY-.1,f=e.getNumberOfAtoms();for(r=0;r<f;r++)i=e.getAtomProperties(r).x,o=e.getAtomProperties(r).y,i+s>c&&(s=c-i),i+s<u&&(s=u-i),o+l>p&&(l=p-o),o+l<d&&(l=d-o);for(r=0;r<f;r++)i=e.getAtomProperties(r).x+s,o=e.getAtomProperties(r).y+l,t?(e.atomTransition().id(r).duration(t).prop("x",i),e.atomTransition().id(r).duration(t).prop("y",o)):e.setAtomProperties(r,{x:i,y:o})}),e.tickInPlace()},connectAminoAcid:function(t){if(!(t<1)){var n=e.getAtomProperties(t-1).radius,r=e.getAtomProperties(t).radius,i=1.25*(n+r);e.addRadialBond({atom1:t,atom2:t-1,length:i,strength:1e4}),e.setAtomProperties(t-1,{pinned:!1})}},translationCompleted:function(){var t=e.getNumberOfAtoms();t>0&&e.setAtomProperties(t-1,{pinned:!1})},transitionEnded:function(){y.shift(),y.length>0&&R(y[0])},stopCodonsHash:function(){return c},lastTranslationStep:function(){return g},proteinCenterOfMass:function(){var t,n,r=0,i=0,o=0,a=e.getNumberOfAtoms();if(0===a)return null;for(n=0,a=e.getNumberOfAtoms();n<a;n++)t=e.getAtomProperties(n),i+=t.x*t.mass,o+=t.y*t.mass,r+=t.mass;return i/=r,o/=r,{x:i,y:o}},generateProtein:function(t,n,r,i){n=t?t.length:n,r=r||0,i=i||0;var o=e.properties.minX,s=e.properties.minY+i,l=e.properties.maxX,u=e.properties.maxY-r,c=0;return P(),e.batch(function(){var r,i,d,p,f,h,m,g,v,y,b={suppressCheck:!0},_=l-o,x=u-s,w=a.lastElementID-a.firstElementID+1,C=.6,T=function(e){return e>x-C||e<C?.1:.02-.04*Math.random()},S=.3,A=function(e,t){return 0===t?e>.5*u?-.1:.1:i>u-S||i<S?0:t},k=function(){return Math.floor(w*Math.random())+a.firstElementID};for(r=o+.1,i=s+.1,d=0,p=0,f=t?a.abbrToElement(t[0]):k(),m=e.getElementProperties(f).radius,h={x:r,y:i,element:f,visible:!0},e.addAtom(h,b),c+=1,y=1;y<n;y++){if(r=h.x,i=h.y,d=T(i),p=A(i,p),r+=1.7*d,i+=1.7*p,r>_-.1)return;f=t?a.abbrToElement(t[y]):k(),h={x:r,y:i,element:f,visible:!0},e.addAtom(h,b),c+=1,g=m,m=e.getElementProperties(f).radius,v=1.25*(m+g),e.addRadialBond({atom1:y,atom2:y-1,length:v,strength:1e4})}}),e.batch(function(){var t,r=e.getAtomProperties(c-1).x,i=(r-o)/2,a=e.properties.viewPortX+e.properties.viewPortWidth/2,s=l-r,u=Math.max(0,Math.min(a-i,s));for(t=0;t<n;t++)e.setAtomProperties(t,{x:e.getAtomProperties(t).x+u})}),e.minimizeEnergy(),c}},e.addPropertiesListener(["DNA"],j),e.addPropertiesListener(["DNAState"],V),k(),n}}),define("models/md2d/models/performance-optimizer",[],function(){function e(e){this._model=e,this._initialTimeStep=this._model.get("timeStep"),this._maxTimeStep=2*this._initialTimeStep,this._targetProgressRate=this._initialTimeStep*this._model.get("timeStepsPerTick")*60,this.enabled=!1}var t=2.5;return e.prototype._assessPerformance=function(){if(this.enabled&&!this._model.isStopped()){var e=this._model.getSimulationProgressRate(),n=this._model.getFPS(),r=this._model.get("timeStep"),i=this._model.get("timeStepsPerTick"),o=this._model.get("temperatureControl")?2.5*this._maxTimeStep:this._maxTimeStep;e<.9*this._targetProgressRate?1.1*r<o?this._model.set("timeStep",1.1*r):n>t&&this._model.set("timeStepsPerTick",Math.round(1.1*i+.5)):e>1.1*this._targetProgressRate&&this._model.set("timeStepsPerTick",Math.round(.9*i-.5)),setTimeout($.proxy(this._assessPerformance,this),250)}},e.prototype.enable=function(){this.enabled||(this._model.start(),this.enabled=!0,this._model.set("timeStepsPerTick",5),setTimeout($.proxy(this._assessPerformance,this),250))},e.prototype.disable=function(){this.enabled=!1},e}),define("common/models/property-transition",[],function(){function e(){if(this.isFinished=!1,this._duration=0,this._easeFunc=d3.ease("cubic-in-out"),this._elapsedTime=0,this._id=null,this._propName=null,this._endValue=null,this._interpolator=null,null==this.getObjectProperties)throw new Error("getObjectProperties method must be implemented by descendant!");if(null==this.setObjectProperties)throw new Error("setObjectProperties method must be implemented by descendant!")}return e.prototype.id=function(e){return this._id=e,this},e.prototype.prop=function(e,t){return this._propName=e,this._endValue=t,this},e.prototype.duration=function(e){return this._duration=e,this},e.prototype.delay=function(e){return this._elapsedTime=-e,this},e.prototype.ease=function(e){return this._easeFunc=d3.ease(e),this},e.prototype.process=function(e){if(!this.isFinished&&!this._incompleteSpec()){var t,n;this._elapsedTime+=e,this._elapsedTime<0||(null==this._interpolator&&(this._interpolator=d3.interpolate(this.getObjectProperties(this._id)[this._propName],this._endValue)),t=Math.min(1,this._elapsedTime/this._duration),t=this._easeFunc(t),n={},n[this._propName]=this._interpolator(t),this.setObjectProperties(this._id,n),t>=1&&(this.isFinished=!0))}},e.prototype.getObjectProperties=null,e.prototype.setObjectProperties=null,e.prototype._incompleteSpec=function(){return null==this._id||null==this._propName||null==this._endValue},e}),define("models/md2d/models/atom-transition",["require","common/inherit","common/models/property-transition"],function(e){function t(e){r.call(this),this._model=e}var n=e("common/inherit"),r=e("common/models/property-transition");return n(t,r),t.prototype.setObjectProperties=function(e,t){this._model.setAtomProperties(e,t)},t.prototype.getObjectProperties=function(e){return this._model.getAtomProperties(e)},t}),define("models/md2d/models/engine/plugins/chemical-reactions",["require","arrays","common/array-types","models/md2d/models/metadata","common/validator","models/md2d/models/engine/constants/index","models/md2d/models/engine/math/utils"],function(e){function t(e,t,n,r){return e*n+t*r}function n(e,t){var n,r,i,o=e.length,a=t.length;for(n=0;n<o;n++)for(i=e[n],r=0;r<a;r++)if(i===t[r])return!0;return!1}var r=e("arrays"),i=e("common/array-types"),o=e("models/md2d/models/metadata"),a=e("common/validator"),s=e("models/md2d/models/engine/constants/index"),l=e("models/md2d/models/engine/math/utils").getAngleBetweenVec,u=s.unit,c=.6,d={1:101,2:107,3:108},p=function(){var e={};return Object.keys(d).forEach(function(t){e[d[t]]=t}),e}(),f=50;return function(e,h){function m(){var e=J.x.length;J.sharedElectrons=r.create(e,0,i.int8Type)}function g(){var e=ee.atom1.length;ee.creationPotential=r.create(e,0,i.floatType)}function v(e){var t=ae[J.element[e]],n=J.sharedElectrons[e];return n<t&&t+n<8}function y(e,t){return c*(Z.sigma[e]+Z.sigma[t])}function b(e,t){return 2e4*Math.sqrt(Z.epsilon[e]*Z.epsilon[t])}function _(e){var t=ae[J.element[e]];return Math.min(Math.min(8-t,t)-J.sharedElectrons[e])}function x(e,t,n){void 0===n&&(n=0);var r=Math.min(3,_(e),_(t)+n);if(r<=1)return r;var i=S(J.element[e],J.element[t]),o=Math.random();return 3===r?o<i[0]?1:o<i[0]+i[1]?2:3:o<i[0]+i[2]?1:2}function w(e){var t=ee.type[e]-105;return t<0?1:t}function C(e,t,n){switch(void 0===n&&(n=1),n){case 1:return null!=se[e+"-"+t]?se[e+"-"+t]:null!=se[t+"-"+e]?se[t+"-"+e]:se.default;case 2:return null!=se[e+"="+t]?se[e+"="+t]:null!=se[t+"="+e]?se[t+"="+e]:2*C(e,t,1);case 3:return null!=se[e+"#"+t]?se[e+"#"+t]:null!=se[t+"#"+e]?se[t+"#"+e]:3*C(e,t,1)}}function T(e,t,n){return null!=le[e+"+"+t+"-"+n]?le[e+"+"+t+"-"+n]:null!=le[e+"+"+n+"-"+t]?le[e+"+"+n+"-"+t]:le.default}function S(e,t){return null!=ue[e+"-"+t]?ue[e+"-"+t]:null!=ue[t+"-"+e]?ue[t+"+"+e]:ue.default}function A(e,t,n,r,i){var o=C(t,n,r),a=C(e,t,i);return a>o?T(e,t,n):T(e,t,n)+o-a}function k(t,n,r,i){t.atom1=n,t.atom2=r,t.type=d[i],e.addRadialBond(t),de=!0,pe[n]=!0,pe[r]=!0,J.sharedElectrons[n]+=i,J.sharedElectrons[r]+=i}function P(t,n,r,i){e.removeRadialBond(t,!0),de=!0,pe[n]=!0,pe[r]=!0,J.sharedElectrons[n]-=i,J.sharedElectrons[r]-=i}function E(t,n,r,i,o,a,s){n.atom1=r,n.atom2=i,n.type=d[a],e.setRadialBondProperties(t,n,!0),de=!0,pe[r]=!0,pe[i]=!0,pe[o]=!0,J.sharedElectrons[r]+=a,J.sharedElectrons[i]+=a-s,J.sharedElectrons[o]-=s,ce[o]===t&&(ce[o]=void 0),ce[i]=void 0}function O(t){e.addAngularBond(t),de=!0}function M(t,n){e.setAngularBondProperties(t,n),de=!0}function L(){de=!1,Object.keys(pe).forEach(function(e){delete pe[e]})}function N(){var t,n,r;for(n=0,r=e.getNumberOfAtoms();n<r;n++)J.sharedElectrons[n]=0;for(n=0,r=e.getNumberOfRadialBonds();n<r;n++)t=w(n),J.sharedElectrons[ee.atom1[n]]+=t,J.sharedElectrons[ee.atom2[n]]+=t}function R(){var t,n;for(ce.length=0,t=0,n=e.getNumberOfRadialBonds();t<n;t++)ce[ee.atom1[t]]=ce[ee.atom2[t]]=t}function I(t){var n,r,i,o,a,s,l,u,c,d,p,f,h,m;for(n=0;n<e.getNumberOfRadialBonds();)m=!1,r=ee.atom1[n],i=ee.atom2[n],d=ee.length[n],l=J.x[r]-J.x[i],u=J.y[r]-J.y[i],c=l*l+u*u,s=Math.sqrt(c)-d,(s>0||t)&&(s=.5*ee.strength[n]*s*s,o=J.element[r],a=J.element[i],p=w(n),h=-ee.creationPotential[n]-e.ljCalculator[o][a].potentialFromSquaredDistance(c),f=C(o,a,p),(s-h>f||t)&&(s-=f,s-=h,e.addKEToAtomPairAndConserveMomentum(s,r,i)?(P(n,r,i,p),m=!0):t&&(e.addKEToAtoms(s),P(n,r,i,p),m=!0))),m||n++}function D(t){var n,r,i,o,a,s,l,u,d,p,f,h,m=e.getNumberOfAtoms(),g=t.getList();for(i=0;i<m;i++)for(a=J.element[i],l=J.x[i],u=J.y[i],n=t.getStartIdxFor(i),r=t.getEndIdxFor(i);n<r;n++)o=g[n],e.atomsBonded(i,o)||(s=J.element[o],d=l-J.x[o],p=u-J.y[o],f=d*d+p*p,h=c*(Z.sigma[a]+Z.sigma[s]),f<h*h&&V(i,o,d,p,f))}function B(e,n,r,i){return!(t(J.vx[e],J.vy[e],r,i)>=0&&t(J.vx[n],J.vy[n],r,i)<=0)}function V(t,r,i,o,a){var s,l,u,c,d;if(B(t,r,i,o)&&(s=v(t),l=v(r),u=s&&l,c=s&&void 0!==ce[r],d=l&&void 0!==ce[t],u||c||d)){if(n(e.getBondedAtoms(t),e.getBondedAtoms(r)))return;if(oe&&e.getMoleculeAtoms(r).indexOf(t)!==-1)return;u?j(t,r,a):c?F(t,r,ce[r],i,o,a):d&&F(r,t,ce[t],i,o,a)}}function j(t,n,r){var i,o,a,s,l=J.element[t],u=J.element[n],c=x(t,n),d=C(l,u,c);d<=0||(i=y(l,u),o=b(l,u),a=Math.sqrt(r)-i,a*=-.5*o*a,a+=d,s=-e.ljCalculator[l][u].potentialFromSquaredDistance(r),s>0||e.addKEToAtomPairAndConserveMomentum(a,t,n)&&k({length:i,strength:o,creationPotential:s},t,n,c))}function F(t,n,r,i,o,a){var l,c,d,p,f,h,m,g,v=J.element[t],_=J.element[n],T=ee.atom1[r],S=ee.atom2[r],k=J.element[T],P=J.element[S],O=T!==t&&T!==n?T:S,M=J.element[O],L=w(r),N=x(t,n,L),R=A(v,_,M,L,N),I=1/Math.sqrt(a),D=J.vx[t]-J.vx[n],B=J.vy[t]-J.vy[n],V=D*i*I+B*o*I,j=J.mass[t],F=J.mass[n],z=s.convert(j*F/(j+F)*V*V,{from:u.MW_ENERGY_UNIT,to:u.EV});if(z>R){if(l=y(v,_),c=b(v,_),d=ee.length[r],p=ee.strength[r],f=Math.sqrt(a)-l,h=-.5*c*f*f,h+=C(v,_,N),g=-e.ljCalculator[v][_].potentialFromSquaredDistance(a),g>0)return;i=J.x[T]-J.x[S],o=J.y[T]-J.y[S],a=i*i+o*o,f=Math.sqrt(a)-d,h+=.5*p*f*f,h-=C(k,P,L),m=-ee.creationPotential[r]-e.ljCalculator[k][P].potentialFromSquaredDistance(a),h-=m,e.addKEToAtoms(h,t,n,O)&&E(r,{length:l,strength:c,creationPotential:g},t,n,O,N,L)}}function z(){for(var t=0;t<e.getNumberOfAngularBonds();)pe[te.atom3[t]]?e.removeAngularBond(t,!0):t++}function G(){var t,n,r,i,o,a;for(t=0,n=e.getNumberOfAngularBonds();t<n;t++)0===te.strength[t]&&(r=te.atom1[t],i=te.atom2[t],o=te.atom3[t],a=te.angle[t]-$(r,i,o),a*=-.5*f*a,e.addKEToAtoms(a,r,i,o)&&M(t,{strength:f}))}function $(e,t,n){return l(J.x[e],J.y[e],J.x[t],J.y[t],J.x[n],J.y[n])}function U(e,t,n){return 2*Math.PI/(Math.min(4,e)-(t-n))}function q(){var t,n,r,i,o,a,s,l,u=[];for(t=0,n=e.getNumberOfRadialBonds();t<n;t++)r=ee.atom1[t],i=ee.atom2[t],o=p[ee.type],pe[r]&&(u[r]?u[r].push(i):u[r]=[i]),pe[i]&&(u[i]?u[i].push(r):u[i]=[r]);for(t=0,n=u.length;t<n;t++)s=u[t],!s||s.length<2||(a=U(ae[J.element[t]],J.sharedElectrons[t],s.length),2===s.length?(r=s[0],i=s[1],X(r,i,t,a)):(l=[],3===s.length?(H(l,s[0],s[1],t),H(l,s[0],s[2],t),H(l,s[1],s[2],t)):4===s.length&&(H(l,s[0],s[1],t),H(l,s[0],s[2],t),H(l,s[0],s[3],t),H(l,s[1],s[2],t),H(l,s[1],s[3],t),H(l,s[2],s[3],t)),l.sort(W),Y(l,s.length-1,a)))}function H(e,t,n,r){e.push({angle:$(t,n,r),a1:t,a2:n,aCentral:r})}function W(e,t){return e.angle<t.angle?-1:e.angle>t.angle?1:0}function Y(e,t,n){var r,i;for(r=0;r<t;r++)i=e[r],X(i.a1,i.a2,i.aCentral,n,i.angle)}function X(t,n,r,i,o){o||(o=$(t,n,r));var a={atom1:t,atom2:n,atom3:r,angle:i},s=i-o;s*=-.5*f*s,e.addKEToAtoms(s,t,n,r)?a.strength=f:a.strength=0,O(a)}function Q(){var t,n,r=0;for(t=0,n=e.getNumberOfRadialBonds();t<n;++t)r-=C(J.element[ee.atom1[t]],J.element[ee.atom2[t]],w(t))-ee.creationPotential[t];
return r}var K,J,Z,ee,te,ne=a.validateCompleteness(o.chemicalReactions,h),re=ne.updateInterval,ie=ne.createAngularBonds,oe=ne.noLoops,ae=ne.valenceElectrons,se=ne.bondEnergy,le=ne.activationEnergy,ue=ne.bondProbability,ce=[],de=!1,pe={};return K={initialize:function(e){J=e.atoms,Z=e.elements,ee=e.radialBonds,te=e.angularBonds,m(),g()},performActionWithinIntegrationLoop:function(t,n,r){var i=r%re;(0===i||i<n&&Math.floor(r/re)===Math.round(r/re))&&(L(),N(),I(),R(),D(t),ie&&(Object.keys(pe).length>0?(z(),G(),q()):G()),de&&e.updateParticlesAccelerations())},getState:function(){return[]},processOutputState:function(e){e.PE+=Q()},setBondEnergy:function(e,t){se[e]=t},setValenceElectrons:function(e,t){ae[e]=t,I(!0),N()}}}}),define("models/md2d/models/modeler",["require","common/performance","common/serialize","common/validator","common/lab-modeler-mixin","common/output-support","common/models/tick-history","models/md2d/models/engine/md2d","models/md2d/models/metadata","models/md2d/models/engine/constants/units","models/md2d/models/unit-definitions/index","models/md2d/models/units-translation","common/property-description","cs!models/md2d/models/solvent","models/md2d/models/aminoacids-props","cs!models/md2d/models/aminoacids-helper","models/md2d/models/engine/genetic-engine","models/md2d/models/performance-optimizer","models/md2d/models/atom-transition","underscore","models/md2d/models/engine/plugins/quantum-dynamics","models/md2d/models/engine/plugins/chemical-reactions"],function(e){var t=e("common/performance"),n=e("common/serialize"),r=e("common/validator"),i=e("common/lab-modeler-mixin"),o=e("common/output-support"),a=e("common/models/tick-history"),s=e("models/md2d/models/engine/md2d"),l=e("models/md2d/models/metadata"),u=e("models/md2d/models/engine/constants/units"),c=e("models/md2d/models/unit-definitions/index"),d=e("models/md2d/models/units-translation"),p=e("common/property-description"),f=e("cs!models/md2d/models/solvent"),h=e("models/md2d/models/aminoacids-props"),m=e("cs!models/md2d/models/aminoacids-helper"),g=e("models/md2d/models/engine/genetic-engine"),v=e("models/md2d/models/performance-optimizer"),y=e("models/md2d/models/atom-transition"),b=e("underscore"),_=e("models/md2d/models/engine/plugins/quantum-dynamics"),x=e("models/md2d/models/engine/plugins/chemical-reactions"),w=0;return function(e,C,T){function S(e){var t,n;for(re.startBatch(),t=0,n=ge.length;t<n;t++)ge[t].process(e);for(t=0;t<ge.length;)ge[t].isFinished?ge.splice(t,1):t++;re.endBatch()}function A(e,t){e=b.extend({},e);for(var n in e)e.hasOwnProperty(n)&&(e[n]=t(n,e[n]));return e}function k(e,t){return se?A(e,function(e,n){return se.translateToModelUnits(n,t[e]&&t[e].unitType)}):e}function P(e,t){return se?A(e,function(e,n){return se.translateFromModelUnits(n,t[e]&&t[e].unitType)}):e}function E(){ve.updateParticlesAccelerations(),ve.computeOutputState(me),ee=ve.callPluginAccessor("getViewPhotons"),O(me.atoms),M(me.radialBonds,me.atoms),L()}function O(e){var t,n,r,i,o=ve.getNumberOfAtoms();for(ye.length=o,t=0,o;t<o;t++){ye[t]||(ye[t]={idx:t}),i=ye[t];for(n in e)e.hasOwnProperty(n)&&(i[n]=e[n][t]);i.aminoAcid=m.isAminoAcid(e.element[t]),i.aminoAcid&&(r=m.getAminoAcidByElement(e.element[t]),i.symbol=r.symbol,i.label=r.abbreviation)}}function M(e,t){var n,r,i,o=ve.getNumberOfRadialBonds();for(be.length=o,i=0;i<o;i++){be[i]||(be[i]={idx:i}),n=be[i];for(r in e)n[r]=e[r][i];n.x1=t.x[n.atom1],n.y1=t.y[n.atom1],n.x2=t.x[n.atom2],n.y2=t.y[n.atom2]}}function L(){if(_e.length&&re.properties.showElectricField){var e,t,n;for(e=0,t=_e.length;e<t;e++)n=_e[e],ve.getCoulombForceAt(n.x,n.y,n)}}function N(){for(var e=ve.getNumberOfElements(),t=Math.floor(Math.random()*e);m.isAminoAcid(t);)t=Math.floor(Math.random()*e);return t}function R(){var e,t,n,r;for(n=ve.getNumberOfElements();n<=m.lastElementID;n++)re.addElement({id:n});for(n=0,r=h.length;n<r;n++)e=18*Math.pow(h[n].volume/h[0].volume,.3333333333333),t=u.convert(e/10,{from:u.unit.ANGSTROM,to:u.unit.NANOMETER}),ve.setElementProperties(m.firstElementID+n,{mass:h[n].molWeight,sigma:t})}function I(e){var t=e.minX,n=e.minY,r=e.maxX,i=e.maxY;e.minX=null!=t?t:0,e.maxX=null!=r?r:e.width,e.minY=null!=n?n:0,e.maxY=null!=i?i:e.height}function D(e,t){ve.setDimensions([e.minX,e.minY,e.maxX,e.maxY]),t.quantumDynamics?(e.useQuantumDynamics=!0,ve.addPlugin(new _(ve,t.quantumDynamics))):e.useQuantumDynamics=!1,t.chemicalReactions?(e.useChemicalReactions=!0,ve.addPlugin(new x(ve,t.chemicalReactions))):e.useChemicalReactions=!1,H=ve.elements,K=ve.radialBonds,J=ve.angularBonds,Z=ve.restraints,W=ve.obstacles,Y=ve.shapes,X=ve.lines,Q=ve.electricFields}function B(e){var t={};return 0===e.length?{}:(Object.keys(e[0]).forEach(function(e){t[e]=[]}),e.forEach(function(e){Object.keys(e).forEach(function(n){t[n].push(e[n])})}),t)}function V(){var e=re.getPhotons(),t={photons:n(l.photon,B(e),e.length),elementEnergyLevels:ve.callPluginAccessor("getElementEnergyLevels"),radiationlessEmissionProbability:ve.callPluginAccessor("getRadiationlessEmissionProbability"),lightSource:ve.callPluginAccessor("getLightSource")};return t.lightSource||delete t.lightSource,t}function j(){return{}}function F(){ce.invalidatingChangePreHook(),ce.invalidatingChangePostHook()}this.constructor.type="md2d",C=C||{};var z,G,$,U,q,H,W,Y,X,Q,K,J,Z,ee,te,ne,re={},ie="md2dModel"+ ++w,oe={targetTemperature:function(e){ve.setTargetTemperature(e)},temperatureControl:function(e){ve.useThermostat(e)},lennardJonesForces:function(e){ve.useLennardJonesInteraction(e)},coulombForces:function(e){ve.useCoulombInteraction(e)},solventForceType:function(e){ve.setSolventForceType(e)},DNAState:function(e){ve.setDNAState(e)},solventForceFactor:function(e){ve.setSolventForceFactor(e)},additionalSolventForceMult:function(e){ve.setAdditionalSolventForceMult(e)},additionalSolventForceThreshold:function(e){ve.setAdditionalSolventForceThreshold(e)},dielectricConstant:function(e){ve.setDielectricConstant(e)},realisticDielectricEffect:function(e){ve.setRealisticDielectricEffect(e)},VDWLinesCutoff:function(e){var t=de[e];t&&ve.setVDWLinesRatio(t)},gravitationalField:function(e){ve.setGravitationalField(e)},modelSampleRate:function(){re.isStopped()||re.restart()},viscosity:function(e){ve.setViscosity(e)},polarAAEpsilon:function(e){var t,n,r,i,o,a;for(t=m.getPolarAminoAcids(),i=0,a=t.length;i<a;i++)for(n=t[i],o=i+1;o<a;o++)r=t[o],ve.pairwiseLJProperties.set(n,r,{epsilon:e})},electricFieldDensity:function(e){if(_e.length=0,e)for(var t,n=0,r=0,i=re.properties.width,o=re.properties.height,a=re.properties.width/e,s=o/a%1*a,l=r+.5*(s+(a<=o?a:0));l<o;){for(t=n+.5*a;t<i;)_e.push({x:t,y:l}),t+=a;l+=a}}},ae=c.get(e.unitsScheme||"md2d"),se=function(){var t=e.unitsScheme||"md2d";if("md2d"!==t)return new d(ae)}(),le=new i({metadata:l,setters:oe,unitsDefinition:ae,unitsTranslation:se,initialProperties:e}),ue=function(){var e=le.dispatchSupport;return e.addEventTypes("tick","addAtom","removeAtom","addRadialBond","removeRadialBond","addElectricField","removeElectricField","changeElectricField","removeAngularBond","textBoxesChanged","imagesChanged"),e}(),ce=le.propertySupport,de={short:1.33,medium:1.67,long:2},pe=1e3,fe=!1,he=[],me=window.state={},ge=[],ve=function(){var e=s.createEngine();return e.pairwiseLJProperties.registerChangeHooks(ce.invalidatingChangePreHook,ce.invalidatingChangePostHook),e}(),ye=[],be=[],_e=[],xe=null,we=function(){var e=[{getNum:"getNumberOfAtoms",addEvent:"addAtom",removeEvent:"removeAtom"},{getNum:"getNumberOfRadialBonds",addEvent:"addRadialBond",removeEvent:"removeRadialBond"}];return function(t){var n,r,i;for(n=0;n<e.length;n++)r=e[n],r.num=ve[r.getNum]();for(t(),n=0;n<e.length;n++)r=e[n],i=ve[r.getNum](),i>r.num?ue[r.addEvent]():i<r.num&&ue[r.removeEvent]()}}();re.stepCounter=function(){return $.get("counter")},re.stepStartCounter=function(){return $.get("startCounter")},re.steps=function(){return $.get("length")},re.isNewStep=function(){return fe},re.seek=function(e){return arguments.length||(e=0),re.isStopped()||re.stop(),fe=!1,we(function(){$.seekExtract(e),E(),re.updateAllOutputProperties(),ue.seek()}),$.get("counter")},re.stepBack=function(e){return arguments.length||(e=1),re.isStopped()||re.stop(),fe=!1,we(function(){var t,n;for(t=-1;++t<e;)n=$.get("index"),n>0&&($.decrementExtract(),E(),re.updateAllOutputProperties(),ue.stepBack())}),$.get("counter")},re.stepForward=function(e){return arguments.length||(e=1),re.isStopped()||re.stop(),we(function(){var t,n,r;for(t=-1;++t<e;)n=$.get("index"),r=$.get("length"),n<r-1?($.incrementExtract(),E(),re.updateAllOutputProperties(),ue.stepForward()):re.tick()}),$.get("counter")},re.createElements=function(e){var t,n,r,i;if(re.startBatch(),void 0===e)return re.addElement({id:0}),void re.endBatch();for(t=0,n=e.mass.length;t<n;t++){i={};for(r in e)e.hasOwnProperty(r)&&(i[r]=e[r][t]);re.addElement(i)}return re.endBatch(),re},re.createAtoms=function(e){var t,n,r,i,o={suppressCheck:!0};for(ue.willReset(),re.startBatch(),n=e.x.length,t=0;t<n;t++){i={};for(r in e)e.hasOwnProperty(r)&&(i[r]=e[r][t]);re.addAtom(i,o)}re.endBatch(),ue.reset()},re.createRadialBonds=function(e){var t,n,r,i=e.strength.length;for(re.startBatch(),t=0;t<i;t++){r={};for(n in e)e.hasOwnProperty(n)&&(r[n]=e[n][t]);re.addRadialBond(r)}return re.endBatch(),re},re.createAngularBonds=function(e){var t,n,r,i=e.strength.length;for(re.startBatch(),t=0;t<i;t++){r={};for(n in e)e.hasOwnProperty(n)&&(r[n]=e[n][t]);re.addAngularBond(r)}return re.endBatch(),re},re.createRestraints=function(e){var t,n,r,i=e.atomIndex.length;for(t=0;t<i;t++){r={};for(n in e)e.hasOwnProperty(n)&&(r[n]=e[n][t]);re.addRestraint(r)}return re},re.createObstacles=function(e){var t,n,r,i=e.x.length;for(t=0;t<i;t++){r={};for(n in e)e.hasOwnProperty(n)&&(r[n]=e[n][t]);re.addObstacle(r)}return re},re.createShapes=function(e){var t,n,r,i=e.x.length;for(t=0;t<i;t++){r={};for(n in e)e.hasOwnProperty(n)&&(r[n]=e[n][t]);re.addShape(r)}return re},re.createLines=function(e){var t,n,r,i=e.x1.length;for(t=0;t<i;t++){r={};for(n in e)e.hasOwnProperty(n)&&(r[n]=e[n][t]);re.addLine(r)}return re},re.createElectricFields=function(e){return re.batch(function(){var t,n,r,i=e.intensity.length;for(t=0;t<i;t++){r={};for(n in e)e.hasOwnProperty(n)&&(r[n]=e[n][t]);re.addElectricField(r)}}),re},re.reset=function(){ue.willReset(),ce.invalidatingChangePreHook(),ve.setTime(0),$.restoreInitialState(),ce.invalidatingChangePostHook(),re.resetAllOutputProperties(),ue.reset()},re.getTotalMass=function(){return ve.getTotalMass()},re.getAtomKineticEnergy=function(e){return ve.getAtomKineticEnergy(e)},re.addRandomAtom=function(e,t){null==e&&(e=N()),null==t&&(t=0);var n,r,i,o=re.get("width"),a=re.get("height"),s=re.get("minX"),l=re.get("minY"),u=ve.getRadiusOfElement(e),c=0,d=10;do if(n=s+Math.random()*o-2*u,r=l+Math.random()*a-2*u,i=ve.findMinimumPELocation(e,n,r,0,0,t),i&&re.addAtom({element:e,x:i[0],y:i[1],charge:t}))return!0;while(++c<d);return!1},re.addAtom=function(e,t){var n,i=re.get("minX"),o=re.get("minY"),a=re.get("maxX"),s=re.get("maxY");return t=t||{},e=r.validateCompleteness(l.atom,e),n=ve.getRadiusOfElement(e.element),e.x<i+n&&(e.x=i+n),e.x>a-n&&(e.x=a-n),e.y<o+n&&(e.y=o+n),e.y>s-n&&(e.y=s-n),!(!t.suppressCheck&&!ve.canPlaceAtom(e.element,e.x,e.y,null,re.get("skipPECheckOnAddAtom")))&&(ce.invalidatingChangePreHook(),ve.addAtom(e),ce.invalidatingChangePostHook(),ue.addAtom(),!0)},re.removeAtom=function(e){var t=ve.getNumberOfRadialBonds(),n=ve.getNumberOfAngularBonds();ce.invalidatingChangePreHook(),ve.removeAtom(e),ye.length=0,ce.invalidatingChangePostHook(),ue.removeAtom(),ve.getNumberOfRadialBonds()!==t&&ue.removeRadialBond(),ve.getNumberOfAngularBonds()!==n&&ue.removeAngularBond()},re.addElement=function(e){e=r.validateCompleteness(l.element,e),ve.addElement(e)},re.addObstacle=function(e){var t;t=r.validateCompleteness(l.obstacle,e),ce.invalidatingChangePreHook(),ve.addObstacle(t),ce.invalidatingChangePostHook()},re.removeObstacle=function(e){ce.invalidatingChangePreHook(),ve.removeObstacle(e),ce.invalidatingChangePostHook()},re.addShape=function(e){var t;t=r.validateCompleteness(l.shape,e),ce.invalidatingChangePreHook(),ve.addShape(t),ce.invalidatingChangePostHook()},re.removeShape=function(e){var t=ve.getNumberOfElectricFields();ce.invalidatingChangePreHook(),ve.removeShape(e),ce.invalidatingChangePostHook(),ve.getNumberOfElectricFields()!==t&&ue.removeElectricField()},re.addLine=function(e){var t;t=r.validateCompleteness(l.line,e),ce.invalidatingChangePreHook(),ve.addLine(t),ce.invalidatingChangePostHook()},re.removeLine=function(e){ce.invalidatingChangePreHook(),ve.removeLine(e),ce.invalidatingChangePostHook()},re.addElectricField=function(e){var t;t=r.validateCompleteness(l.electricField,e),ce.invalidatingChangePreHook(),ve.addElectricField(t),ce.invalidatingChangePostHook(),ue.addElectricField()},re.removeElectricField=function(e){ce.invalidatingChangePreHook(),ve.removeElectricField(e),ce.invalidatingChangePostHook(),ue.removeElectricField()},re.addRadialBond=function(e){e=r.validateCompleteness(l.radialBond,e),ce.invalidatingChangePreHook(),ve.addRadialBond(e),ce.invalidatingChangePostHook(),ue.addRadialBond()},re.removeRadialBond=function(e){ce.invalidatingChangePreHook(),ve.removeRadialBond(e),ce.invalidatingChangePostHook(),ue.removeRadialBond()},re.addAngularBond=function(e){e=r.validateCompleteness(l.angularBond,e),ce.invalidatingChangePreHook(),ve.addAngularBond(e),ce.invalidatingChangePostHook()},re.removeAngularBond=function(e){ce.invalidatingChangePreHook(),ve.removeAngularBond(e),ce.invalidatingChangePostHook(),ue.removeAngularBond()},re.addRestraint=function(e){e=r.validateCompleteness(l.restraint,e),ce.invalidatingChangePreHook(),ve.addRestraint(e),ce.invalidatingChangePostHook()},re.getMoleculeBoundingBox=function(e){var t,n,r,i,o,a,s,l=me.atoms,u=-(1/0),c=1/0,d=1/0,p=-(1/0);for(t=ve.getMoleculeAtoms(e),t.push(e),n=0;n<t.length;n++)r=l.x[t[n]],i=l.y[t[n]],o=l.radius[t[n]],r-o<c&&(c=r-o),r+o>p&&(p=r+o),i-o<d&&(d=i-o),i+o>u&&(u=i+o);return a=l.x[e],s=l.y[e],{top:u-s,left:c-a,bottom:d-s,right:p-a}},re.setTemperatureOfAtoms=function(e,t){ce.invalidatingChangePreHook(),ve.setTemperatureOfAtoms(e,t),ce.invalidatingChangePostHook()},re.addKEToAtoms=function(e,t){ce.invalidatingChangePreHook(),null==t?ve.addKEToAtoms(e):ve.addKEToAtoms.apply(ve,[e].concat(t)),ce.invalidatingChangePostHook()},re.getTemperatureOfAtoms=function(e){return ve.getTemperatureOfAtoms(e)},re.setAtomProperties=function(e,t,n,i,o){var a,s,u,c,d,p,f,h=me.atoms;if(t=r.validate(l.atom,t),i&&(a=ve.getMoleculeAtoms(e),a.length>0))for(s="number"==typeof t.x?t.x-h.x[e]:0,u="number"==typeof t.y?t.y-h.y[e]:0,p=0,f=a.length;p<f;p++)if(c=h.x[a[p]]+s,d=h.y[a[p]]+u,!re.setAtomProperties(a[p],{x:c,y:d},n,!1))return!1;if(n){var m="number"==typeof t.x?t.x:h.x[e],g="number"==typeof t.y?t.y:h.y[e],v="number"==typeof t.element?t.y:h.element[e];if(!ve.canPlaceAtom(v,m,g,e,o))return!1}return ce.invalidatingChangePreHook(),ve.setAtomProperties(e,k(t,l.atom)),ce.invalidatingChangePostHook(),!0},re.getAtomProperties=function(e){var t,n=me.atoms,r=l.atom,i={};for(t in r)r.hasOwnProperty(t)&&n[t]&&(i[t]=n[t][e]);return P(i,r)},re.getRadialBondsForAtom=function(e){return ve.getRadialBondsForAtom(e)},re.getBondedAtoms=function(e){return ve.getBondedAtoms(e)},re.getAngularBondsForAtom=function(e){return ve.getAngularBondsForAtom(e)},re.getMoleculeAtoms=function(e){return ve.getMoleculeAtoms(e)},re.setElementProperties=function(e,t){if(t=r.validate(l.element,t),m.isAminoAcid(e))throw new Error("Elements: elements with ID "+e+" cannot be edited, as they define amino acids.");ce.invalidatingChangePreHook(),ve.setElementProperties(e,k(t,l.element)),ce.invalidatingChangePostHook()},re.getElementProperties=function(e){var t,n=l.element,r={};for(t in n)n.hasOwnProperty(t)&&(r[t]=H[t][e]);return P(r,n)},re.setObstacleProperties=function(e,t){t=r.validate(l.obstacle,t),ce.invalidatingChangePreHook(),ve.setObstacleProperties(e,k(t,l.obstacle)),ce.invalidatingChangePostHook()},re.getObstacleProperties=function(e){var t,n=l.obstacle,r={};for(t in n)n.hasOwnProperty(t)&&(r[t]=W[t][e]);return P(r,n)},re.setShapeProperties=function(e,t){t=r.validate(l.shape,t),ce.invalidatingChangePreHook(),ve.setShapeProperties(e,k(t,l.shape)),ce.invalidatingChangePostHook()},re.getShapeProperties=function(e){var t,n=l.shape,r={};for(t in n)n.hasOwnProperty(t)&&(r[t]=Y[t][e]);return P(r,n)},re.setLineProperties=function(e,t){t=r.validate(l.line,t),ce.invalidatingChangePreHook(),ve.setLineProperties(e,k(t,l.line)),ce.invalidatingChangePostHook()},re.getLineProperties=function(e){var t,n=l.line,r={};for(t in n)n.hasOwnProperty(t)&&(r[t]=X[t][e]);return P(r,n)},re.setElectricFieldProperties=function(e,t){t=r.validate(l.electricField,t),ce.invalidatingChangePreHook(),ve.setElectricFieldProperties(e,k(t,l.electricField)),ce.invalidatingChangePostHook(),ue.changeElectricField()},re.getElectricFieldProperties=function(e){var t,n=l.electricField,r={};for(t in n)n.hasOwnProperty(t)&&(r[t]=Q[t][e]);return P(r,n)},re.setRadialBondProperties=function(e,t){t=r.validate(l.radialBond,t),ce.invalidatingChangePreHook(),ve.setRadialBondProperties(e,k(t,l.radialBond)),ce.invalidatingChangePostHook()},re.getRadialBondProperties=function(e){var t,n=l.radialBond,r={};for(t in n)n.hasOwnProperty(t)&&(r[t]=K[t][e]);return P(r,n)},re.setRestraintProperties=function(e,t){t=r.validate(l.restraint,t),ce.invalidatingChangePreHook(),ve.setRestraintProperties(e,k(t,l.restraint)),ce.invalidatingChangePostHook()},re.getRestraintProperties=function(e){var t,n=l.restraint,r={};for(t in n)n.hasOwnProperty(t)&&(r[t]=Z[t][e]);return P(r,n)},re.setAngularBondProperties=function(e,t){t=r.validate(l.angularBond,t),ce.invalidatingChangePreHook(),ve.setAngularBondProperties(e,k(t,l.angularBond)),ce.invalidatingChangePostHook()},re.getAngularBondProperties=function(e){var t,n=l.angularBond,r={};for(t in n)n.hasOwnProperty(t)&&(r[t]=J[t][e]);return P(r,n)},re.setSolvent=function(e){var t=new f(e),n={solventForceType:t.forceType,dielectricConstant:t.dielectricConstant,backgroundColor:t.color};re.set(n)},re.addSpringForce=function(e,t,n,r){return null==r&&(r=500),se&&(r=se.translateToModelUnits(r,"stiffness")),ve.addSpringForce(e,t,n,r)},re.updateSpringForce=function(e,t,n){ve.updateSpringForce(e,t,n)},re.removeSpringForce=function(e){ve.removeSpringForce(e)},re.addTextBox=function(e){e=r.validateCompleteness(l.textBox,e),re.get("textBoxes").push(e),ue.textBoxesChanged()},re.removeTextBox=function(e){var t=re.get("textBoxes");if(!(e>=0&&e<t.length))throw new Error('Text box "'+e+'" does not exist, so it cannot be removed.');re.set("textBoxes",t.slice(0,e).concat(t.slice(e+1))),ue.textBoxesChanged()},re.setTextBoxProperties=function(e,t){var n,i=re.get("textBoxes")[e];if(!i)throw new Error('Text box "'+e+'" does not exist, so it cannot have properties set.');t=r.validate(l.textBox,t);for(n in t)t.hasOwnProperty(n)&&(i[n]=t[n]);ue.textBoxesChanged()},re.setImageProperties=function(e,t){var n,i=re.get("images")[e];if(!i)throw new Error('Image "'+e+'" does not exist, so it cannot have properties set.');t=r.validate(l.image,t);for(n in t)t.hasOwnProperty(n)&&(i[n]=t[n]);ue.imagesChanged()},re.getTextBoxProperties=function(e){return re.get("textBoxes")[e]},re.getImageProperties=function(e){return re.get("images")[e]},re.liveDragStart=function(e,t,n){null==xe&&(null==t&&(t=me.atoms.x[e]),null==n&&(n=me.atoms.y[e]),te=re.getAtomProperties(e).friction,re.setAtomProperties(e,{friction:re.LIVE_DRAG_FRICTION}),xe=re.addSpringForce(e,t,n,500))},re.liveDrag=function(e,t){re.updateSpringForce(xe,e,t)},re.liveDragEnd=function(){var e=ve.springForceAtomIndex(xe);re.setAtomProperties(e,{friction:te}),re.removeSpringForce(xe),xe=null},re.getFPS=function(){for(var e=0,t=he.length,n=-1;++n<t;)e+=he[n];return e/=t,e?1/e*1e3:0},re.getSimulationProgressRate=function(){return re.getFPS()*re.get("timeStep")*re.get("timeStepsPerTick")},re.get_elements=function(){return H},re.getAtoms=function(){return ye},re.getRadialBonds=function(){return be},re.getElectricField=function(){return _e},re.getPhotons=function(){return ee},re.turnOnLightSource=function(){ve.callPluginAccessor("turnOnLightSource")},re.turnOffLightSource=function(){ve.callPluginAccessor("turnOffLightSource")},re.setLightSourceAngle=function(e){ve.callPluginAccessor("setLightSourceAngle",[e])},re.setLightSourceFrequency=function(e){ve.callPluginAccessor("setLightSourceFrequency",[e])},re.setLightSourcePeriod=function(e){ve.callPluginAccessor("setLightSourcePeriod",[e])},re.setLightSourceNumber=function(e){ve.callPluginAccessor("setLightSourceNumber",[e])},re.setBondEnergy=function(e,t){ve.callPluginAccessor("setBondEnergy",[e,t])},re.setValenceElectrons=function(e,t){ve.callPluginAccessor("setValenceElectrons",[e,t])};var Ce=0;return re.onPhotonAbsorbed=function(e){ve.callPluginAccessor("on",["photonAbsorbed.external-handler-"+Ce,e])},re.getNumberOfAtoms=function(e){return e?ye.reduce(function(t,n){return e(n)?t+1:t},0):ye.length},re.get_obstacles=function(){return W},re.get_shapes=function(){return Y},re.get_lines=function(){return X},re.getNumberOfElements=function(){return ve.getNumberOfElements()},re.getNumberOfObstacles=function(){return ve.getNumberOfObstacles()},re.getNumberOfShapes=function(){return ve.getNumberOfShapes()},re.getNumberOfLines=function(){return ve.getNumberOfLines()},re.getNumberOfRadialBonds=function(){return ve.getNumberOfRadialBonds()},re.getNumberOfAngularBonds=function(){return ve.getNumberOfAngularBonds()},re.getNumberOfSpringForces=function(){return ve.getNumberOfSpringForces()},re.getNumberOfElectricFields=function(){return ve.getNumberOfElectricFields()},re.getNumberOfTextBoxes=function(){return re.get("textBoxes").length},re.get_restraints=function(){return Z},re.getPairwiseLJProperties=function(){return ve.pairwiseLJProperties},re.geneticEngine=function(){return U},re.get_vdw_pairs=function(){return ve.getVdwPairsArray()},re.tickInPlace=function(){return ue.tick(),re},re.tick=function(){var e,n,r=re.get("timeStep");se&&(r=se.translateToModelUnits(r,"time")),re.isStopped()||(e=t.now(),G?(n=e-G,G=e,he.push(n),he.splice(0,he.length-64),S(n)):G=e),t.enterScope("engine"),ve.integrate(re.get("timeStepsPerTick")*r,r),t.leaveScope("engine"),E(),re.updateAllOutputProperties(),$.push(),fe=!0,ve.radialBondsChanged&&ue.addRadialBond(),ue.tick()},re.minimizeEnergy=function(){return ce.invalidatingChangePreHook(),ve.minimizeEnergy(),ce.invalidatingChangePostHook(),ue.tick(),re},re.dimensions=function(){return ve.getDimensions()},re.format=function(e,t){t=t||{};var n=re.getPropertyDescription(e);return n?n.format(re.get(e),t):d3.format(t.format||"g")(re.get(e))},re.getUnitDefinition=function(e){return ae.units[e]},re.atomTransition=function(){var e=new y(re);return ge.push(e),e},re.cancelTransitions=function(){ge.length=0},re.startBatch=function(){ce.startBatch(),ue.startBatch()},re.endBatch=function(){ce.endBatch(),ue.endBatch()},re.batch=function(e){re.startBatch(),e(),re.endBatch()},re.serialize=function(){var e,t,r,i={},o=ce.rawValues,a=function(e,t){i.atoms[e].every(function(e){return e===t})&&delete i.atoms[e]};if(i=n(l.mainProperties,o),i.viewOptions=n(l.viewOptions,o),i.atoms=n(l.atom,me.atoms,ve.getNumberOfAtoms()),ve.getNumberOfRadialBonds()&&(i.radialBonds=n(l.radialBond,K,ve.getNumberOfRadialBonds())),ve.getNumberOfAngularBonds()&&(i.angularBonds=n(l.angularBond,J,ve.getNumberOfAngularBonds())),ve.getNumberOfObstacles())for(i.obstacles=n(l.obstacle,W,ve.getNumberOfObstacles()),t=0,r=i.obstacles.x.length;t<r;t++)i.obstacles.westProbe[t]=Boolean(i.obstacles.westProbe[t]),i.obstacles.northProbe[t]=Boolean(i.obstacles.northProbe[t]),i.obstacles.eastProbe[t]=Boolean(i.obstacles.eastProbe[t]),i.obstacles.southProbe[t]=Boolean(i.obstacles.southProbe[t]);for(ve.getNumberOfShapes()&&(i.shapes=n(l.shape,Y,ve.getNumberOfShapes())),ve.getNumberOfLines()&&(i.lines=n(l.line,X,ve.getNumberOfLines())),ve.getNumberOfElectricFields()&&(i.electricFields=n(l.electricField,Q,ve.getNumberOfElectricFields())),ve.getNumberOfRestraints()&&(i.restraints=n(l.restraint,Z,ve.getNumberOfRestraints())),i.elements=n(l.element,H,5),i.pairwiseLJProperties=[],e=ve.pairwiseLJProperties.serialize(),t=0,r=e.length;t<r;t++)e[t].element1<=5&&e[t].element2<=5&&i.pairwiseLJProperties.push(e[t]);return i.temperatureControl===!1&&delete i.targetTemperature,i.viewOptions.showAtomTrace===!1&&delete i.viewOptions.atomTraceId,"default"===i.modelSampleRate&&delete i.modelSampleRate,re.properties.useQuantumDynamics&&(i.quantumDynamics=V()),re.properties.useChemicalReactions?i.chemicalReactions=j():delete i.atoms.radical,["marked","visible","draggable","draggableWhenStopped"].forEach(function(e){a(e,l.atom[e].defaultValue)}),i},re.LIVE_DRAG_FRICTION=10,e.DNA&&(e.width=200,e.height=5,e.viewOptions=e.viewOptions||{},e.viewOptions.viewPortX=0,e.viewOptions.viewPortY=0,e.viewOptions.viewPortWidth=5,e.viewOptions.viewPortHeight=3),function(){if(e.viewOptions){var t,n,i=e.viewOptions.textBoxes||[],o=e.viewOptions.images||[];for(t=0,n=i.length;t<n;t++)i[t]=r.validateCompleteness(l.textBox,i[t]);for(t=0,n=o.length;t<n;t++)o[t]=r.validateCompleteness(l.image,o[t])}}(),ne={quantumDynamics:e.quantumDynamics,chemicalReactions:e.chemicalReactions},q=e.elements,re.createElements(q),R(),le.mixInto(re),I(re.properties),re.on("stop.last-sample-time-reset",function(){G=null}),ce.on("afterInvalidatingChange.read-model-state",E),ce.on("afterInvalidatingChangeSequence.tick-history",function(){$&&$.invalidateFollowingState(),ue.invalidation()}),D(re.properties,ne),U=new g(re),re.set({polarAAEpsilon:re.get("polarAAEpsilon")}),e.atoms&&re.createAtoms(e.atoms),e.radialBonds&&re.createRadialBonds(e.radialBonds),e.angularBonds&&re.createAngularBonds(e.angularBonds),e.restraints&&re.createRestraints(e.restraints),e.obstacles&&re.createObstacles(e.obstacles),e.shapes&&re.createShapes(e.shapes),e.lines&&re.createLines(e.lines),e.electricFields&&re.createElectricFields(e.electricFields),e.pairwiseLJProperties&&ve.pairwiseLJProperties.deserialize(e.pairwiseLJProperties),$=new a({getProperties:function(){return ce.historyStateRawValues},restoreProperties:ce.setRawValues,state:ve.getState()},re,pe),le.tickHistory=$,z=new o({propertySupport:ce,unitsDefinition:ae,tickHistory:$}),z.mixInto(re),fe=!0,re.defineOutput("time",{label:"Time",unitType:"time",format:"f"},function(){var e=me.time;return se&&(e=se.translateFromModelUnits(e,"time")),e}),re.defineOutput("timePerTick",{label:"Model time per tick",unitType:"time",format:"f"},function(){return re.get("timeStep")*re.get("timeStepsPerTick")}),function(){var e,t;ae.units.time.displayValue?e=ae.units.time.displayValue:(e=b.extend({},ae.units.time),e.unitsPerBaseUnit=1),t=new p(e,{unitName:e.name,unitPluralName:e.pluralName,unitAbbreviation:e.symbol,format:".1f"}),re.defineOutput("displayTime",{label:"Time",unitName:e.name,unitPluralName:e.pluralName,unitAbbreviation:e.symbol,format:".1f"},function(){return re.get("time")*e.unitsPerBaseUnit}),re.defineOutput("displayTimePerTick",{label:"Model time per tick",unitName:e.name,unitPluralName:e.pluralName,unitAbbreviation:e.symbol,format:".3f"},function(){return re.get("timePerTick")*e.unitsPerBaseUnit}),re.formatTime=function(n){return t.format(n*e.unitsPerBaseUnit)}}(),re.defineOutput("tickCounter",{label:"Tick Counter",unitType:"",format:"4g"},function(){return $.get("counter")}),re.defineOutput("newStep",{label:"New Step",unitType:"",format:""},function(){return fe}),re.defineOutput("kineticEnergy",{label:"Kinetic Energy",unitType:"energy",format:".4g"},function(){var e=me.KE;return se&&(e=se.translateFromModelUnits(e,"energy")),e}),re.defineOutput("potentialEnergy",{label:"Potential Energy",unitType:"energy",format:".4g"},function(){var e=me.PE;return se&&(e=se.translateFromModelUnits(e,"energy")),e}),re.defineOutput("totalEnergy",{label:"Total Energy",unitType:"energy",format:".4g"},function(){var e=me.KE+me.PE;return se&&(e=se.translateFromModelUnits(e,"energy")),e}),re.defineOutput("temperature",{label:"Temperature",unitType:"temperature",format:"f"},function(){var e=me.temperature;return se&&(e=se.translateFromModelUnits(e,"temperature")),e}),re.on("play.model",F),re.on("stop.model",F),re.defineOutput("isPlayable",{label:"Playable"},function(){return re.isReady&&re.isStopped()}),re.defineOutput("hasPlayed",{label:"has Played"},function(){return re.hasPlayed}),re.defineOutput("isStopped",{label:"Stopped?"},function(){return re.isStopped()}),E(),re.updateAllOutputProperties(),C.waitForSetup||re.ready(),re.performanceOptimizer=new v(re),re.namespace=ie,re}}),define("common/views/tab-index",[],function(){var e=0;return function(){return e++}}),define("common/feature-tests",[],function(){var e={};return{get cssPointerEvents(){return void 0===e.cssPointerEvents&&(e.cssPointerEvents=function(){var e,t,n,r;switch(e=$("<div class='supported'>").css({position:"fixed",left:0,top:0,width:"10px",height:"10px"}).appendTo("body"),t=$("<div class='unsupported'>").css({position:"fixed",left:0,top:0,width:"10px",height:"10px","pointer-events":"none"}).appendTo("body"),n=$("<svg class='unsupported'>").css({position:"fixed",left:0,top:0,width:"10px",height:"10px","pointer-events":"none"}).appendTo("body"),r=$(document.elementFromPoint(5,5)).attr("class"),n.remove(),t.remove(),e.remove(),r){case"supported":return!0;case"unsupported":return!1;default:return console.warn("CSS pointer-events feature test failed"),!1}}()),e.cssPointerEvents}}}),define("common/views/hit-testing-helper",["require","common/feature-tests"],function(e){function t(e,t,n){window.addEventListener(e,t,n),a.push({type:e,func:t,capture:n})}function n(){for(var e;a.length>0;)e=a.pop(),window.removeEventListener(e.type,e.func,e.capture)}function r(){}var i=e("common/feature-tests"),o=["mousedown","mouseup","contextmenu"],a=[];return function(e){function a(e,t){var n=document.createEvent("MouseEvent");if(n.initMouseEvent(e.type,e.bubbles,e.cancelable,e.view,e.detail,e.screenX,e.screenY,e.clientX,e.clientY,e.ctrlKey,e.altKey,e.shiftKey,e.metaKey,e.button,e.relatedTarget),n.target=t,n.forwardedTouchEvent=e.forwardedTouchEvent,0===n.pageX&&0===n.pageY&&Object.defineProperty){var r=document.documentElement,i=document.body,o=e.clientX,a=e.clientY;Object.defineProperty(n,"pageX",{get:function(){return o+(r&&r.scrollLeft||i&&i.scrollLeft||0)-(r&&r.clientLeft||i&&i.clientLeft||0)}}),Object.defineProperty(n,"pageY",{get:function(){return a+(r&&r.scrollTop||i&&i.scrollTop||0)-(r&&r.clientTop||i&&i.clientTop||0)}})}return n}function s(e,t){var n=document.createEvent("MouseEvent");return n.initMouseEvent("click",!0,e.cancelable,e.view,e.detail,e.screenX,e.screenY,e.clientX,e.clientY,e.ctrlKey,e.altKey,e.shiftKey,e.metaKey,e.button,e.relatedTarget),n.target=t,n}function l(e){var t=h[e];m[e]=t.style[_],t.style[_]=x}function u(e){for(var t=e;t>=0;t--)h[t].style[_]=m[t]}function c(e){m=[];var t,n,i,o,s,c;v=null;for(var d=0,p=h.length;d<p;d++)if(t=h[d],d>0&&l(d-1),"canvas"===t.tagName.toLowerCase()){if(i=a(e,t),f.hitTestCallback=function(e){o=e,e||(i.stopPropagation(),i.preventDefault())},f.mouseupCallback=function(e){s=e},t.dispatchEvent(i),f.hitTestCallback=r,f.mouseupCallback=r,s&&(v=t),o)return u(d-1),y=i.defaultPrevented,t}else if(c=t.style.backgroundColor,t.style.backgroundColor="rgba(0,0,0,0)",n=document.elementFromPoint(e.clientX,e.clientY),t.style.backgroundColor=c,n!==t)return u(d-1),i=a(e,n),n.dispatchEvent(i),y=i.defaultPrevented,n;u(h.length-2)}function d(e){function n(e,t){var n=document.createEvent("MouseEvent");return n.initMouseEvent(t,!0,!0,window,1,e.screenX,e.screenY,e.clientX,e.clientY,!1,!1,!1,!1,0,null),n.forwardedTouchEvent=!0,n}function r(e){return Math.abs(e.screenX-a)>10||Math.abs(e.screenY-s)>10}function i(t){var r=t.changedTouches[0];t.touches.length>1||r.target!==e||(b=!1,a=r.screenX,s=r.screenY,l=r.identifier,e.dispatchEvent(n(r,"mousedown")),y&&t.preventDefault(),t.stopPropagation());
}function o(e){if(null!==l){if("touchmove"===e.type&&e.touches.length>1)return b=!0,void e.stopPropagation();var t,i,o,a,s;for(t=0,i=e.changedTouches.length;t<i;t++)if(o=e.changedTouches[t],o.identifier===l)return 1===i&&e.stopPropagation(),a=document.elementFromPoint(o.clientX,o.clientY)||window,"touchmove"===e.type?(b||(b=r(o)),s=n(o,"mousemove"),a.dispatchEvent(s),s.replacedBySynthetic||(y=s.defaultPrevented)):"touchend"===e.type?(a.dispatchEvent(n(o,"mouseup")),l=null):"touchcancel"===e.type&&(b=!0,a.dispatchEvent(n(o,"mouseup")),l=null),void(("touchend"===e.type||y)&&e.preventDefault())}}var a,s,l=null;t("touchstart",i,!0),["touchmove","touchend","touchcancel"].forEach(function(e){t(e,o,!0)})}function p(){n(),h=[e],o.forEach(function(n){t(n,function(t){var n;t.target===e&&(t.stopPropagation(),"mousedown"!==t.type&&t.preventDefault(),n=c(t),"mousedown"===t.type?g=n:"mouseup"===t.type&&(n&&n===g&&"canvas"!==n.tagName.toLowerCase()&&!b&&n.dispatchEvent(s(t),n),v&&!b&&v.dispatchEvent(s(t),v)))},!0)}),t("click",function(t){t.target===e&&(t.stopPropagation(),t.preventDefault())},!0),d(e)}var f,h,m,g,v,y,b,_=i.cssPointerEvents?"pointerEvents":"visibility",x=i.cssPointerEvents?"none":"hidden";return f={passMouseMove:function(e,n){function i(e,t,n,r){var i=document.createEvent("MouseEvent");return i.initMouseEvent(t,e.bubbles,e.cancelable,e.view,e.detail,e.screenX,e.screenY,e.clientX,e.clientY,e.ctrlKey,e.altKey,e.shiftKey,e.metaKey,e.button,r||e.relatedTarget),i.target=n,i}var o;t("mousemove",function(t){if(!t.synthetic){var s,l;if(t.target!==e)return o===n&&n.dispatchEvent(i(t,"mouseout",n,t.target)),void(o=t.target);s=n,s!==o&&n.dispatchEvent(i(t,"mouseover",n,o)),t.stopPropagation(),t.preventDefault(),t.replacedBySynthetic=!0,l=a(t,s),l.synthetic=!0,f.hitTestCallback=r,s.dispatchEvent(l),y=l.defaultPrevented,o=s}},!0)},addLayer:function(e){h.splice(1,0,e)},hitTestCallback:r,mouseupCallback:r},p(),f}}),function(){function e(){return i.Matrix="undefined"!=typeof Float32Array?Float32Array:Array,i.Matrix}function t(e){return[(e>>16&255)/255,(e>>8&255)/255,(255&e)/255]}function t(e){return[(e>>16&255)/255,(e>>8&255)/255,(255&e)/255]}var n=this,i=i||{};i.Point=function(e,t){this.x=e||0,this.y=t||0},i.Point.prototype.clone=function(){return new i.Point(this.x,this.y)},i.Point.prototype.constructor=i.Point,i.Rectangle=function(e,t,n,r){this.x=e||0,this.y=t||0,this.width=n||0,this.height=r||0},i.Rectangle.prototype.clone=function(){return new i.Rectangle(this.x,this.y,this.width,this.height)},i.Rectangle.prototype.contains=function(e,t){if(this.width<=0||this.height<=0)return!1;var n=this.x;if(e>=n&&e<=n+this.width){var r=this.y;if(t>=r&&t<=r+this.height)return!0}return!1},i.Rectangle.prototype.constructor=i.Rectangle,i.Polygon=function(e){if(e instanceof Array||(e=Array.prototype.slice.call(arguments)),"number"==typeof e[0]){for(var t=[],n=0,r=e.length;n<r;n+=2)t.push(new i.Point(e[n],e[n+1]));e=t}this.points=e},i.Polygon.prototype.clone=function(){for(var e=[],t=0;t<this.points.length;t++)e.push(this.points[t].clone());return new i.Polygon(e)},i.Polygon.prototype.contains=function(e,t){for(var n=!1,r=0,i=this.points.length-1;r<this.points.length;i=r++){var o=this.points[r].x,a=this.points[r].y,s=this.points[i].x,l=this.points[i].y,u=a>t!=l>t&&e<(s-o)*(t-a)/(l-a)+o;u&&(n=!n)}return n},i.Polygon.prototype.constructor=i.Polygon,i.Circle=function(e,t,n){this.x=e||0,this.y=t||0,this.radius=n||0},i.Circle.prototype.clone=function(){return new i.Circle(this.x,this.y,this.radius)},i.Circle.prototype.contains=function(e,t){if(this.radius<=0)return!1;var n=this.x-e,r=this.y-t,i=this.radius*this.radius;return n*=n,r*=r,n+r<=i},i.Circle.prototype.constructor=i.Circle,i.Ellipse=function(e,t,n,r){this.x=e||0,this.y=t||0,this.width=n||0,this.height=r||0},i.Ellipse.prototype.clone=function(){return new i.Ellipse(this.x,this.y,this.width,this.height)},i.Ellipse.prototype.contains=function(e,t){if(this.width<=0||this.height<=0)return!1;var n=(e-this.x)/this.width-.5,r=(t-this.y)/this.height-.5;return n*=n,r*=r,n+r<.25},i.Ellipse.getBounds=function(){return new i.Rectangle(this.x,this.y,this.width,this.height)},i.Ellipse.prototype.constructor=i.Ellipse,e(),i.mat3={},i.mat3.create=function(){var e=new i.Matrix(9);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e},i.mat3.identity=function(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e},i.mat4={},i.mat4.create=function(){var e=new i.Matrix(16);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},i.mat3.multiply=function(e,t,n){n||(n=e);var r=e[0],i=e[1],o=e[2],a=e[3],s=e[4],l=e[5],u=e[6],c=e[7],d=e[8],p=t[0],f=t[1],h=t[2],m=t[3],g=t[4],v=t[5],y=t[6],b=t[7],_=t[8];return n[0]=p*r+f*a+h*u,n[1]=p*i+f*s+h*c,n[2]=p*o+f*l+h*d,n[3]=m*r+g*a+v*u,n[4]=m*i+g*s+v*c,n[5]=m*o+g*l+v*d,n[6]=y*r+b*a+_*u,n[7]=y*i+b*s+_*c,n[8]=y*o+b*l+_*d,n},i.mat3.clone=function(e){var t=new i.Matrix(9);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t},i.mat3.transpose=function(e,t){if(!t||e===t){var n=e[1],r=e[2],i=e[5];return e[1]=e[3],e[2]=e[6],e[3]=n,e[5]=e[7],e[6]=r,e[7]=i,e}return t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8],t},i.mat3.toMat4=function(e,t){return t||(t=i.mat4.create()),t[15]=1,t[14]=0,t[13]=0,t[12]=0,t[11]=0,t[10]=e[8],t[9]=e[7],t[8]=e[6],t[7]=0,t[6]=e[5],t[5]=e[4],t[4]=e[3],t[3]=0,t[2]=e[2],t[1]=e[1],t[0]=e[0],t},i.mat4.create=function(){var e=new i.Matrix(16);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},i.mat4.transpose=function(e,t){if(!t||e===t){var n=e[1],r=e[2],i=e[3],o=e[6],a=e[7],s=e[11];return e[1]=e[4],e[2]=e[8],e[3]=e[12],e[4]=n,e[6]=e[9],e[7]=e[13],e[8]=r,e[9]=o,e[11]=e[14],e[12]=i,e[13]=a,e[14]=s,e}return t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15],t},i.mat4.multiply=function(e,t,n){n||(n=e);var r=e[0],i=e[1],o=e[2],a=e[3],s=e[4],l=e[5],u=e[6],c=e[7],d=e[8],p=e[9],f=e[10],h=e[11],m=e[12],g=e[13],v=e[14],y=e[15],b=t[0],_=t[1],x=t[2],w=t[3];return n[0]=b*r+_*s+x*d+w*m,n[1]=b*i+_*l+x*p+w*g,n[2]=b*o+_*u+x*f+w*v,n[3]=b*a+_*c+x*h+w*y,b=t[4],_=t[5],x=t[6],w=t[7],n[4]=b*r+_*s+x*d+w*m,n[5]=b*i+_*l+x*p+w*g,n[6]=b*o+_*u+x*f+w*v,n[7]=b*a+_*c+x*h+w*y,b=t[8],_=t[9],x=t[10],w=t[11],n[8]=b*r+_*s+x*d+w*m,n[9]=b*i+_*l+x*p+w*g,n[10]=b*o+_*u+x*f+w*v,n[11]=b*a+_*c+x*h+w*y,b=t[12],_=t[13],x=t[14],w=t[15],n[12]=b*r+_*s+x*d+w*m,n[13]=b*i+_*l+x*p+w*g,n[14]=b*o+_*u+x*f+w*v,n[15]=b*a+_*c+x*h+w*y,n},i.DisplayObject=function(){this.last=this,this.first=this,this.position=new i.Point,this.scale=new i.Point(1,1),this.pivot=new i.Point(0,0),this.rotation=0,this.alpha=1,this.visible=!0,this.hitArea=null,this.buttonMode=!1,this.renderable=!1,this.parent=null,this.stage=null,this.worldAlpha=1,this._interactive=!1,this.worldTransform=i.mat3.create(),this.localTransform=i.mat3.create(),this.color=[],this.dynamic=!0,this._sr=0,this._cr=1},i.DisplayObject.prototype.constructor=i.DisplayObject,i.DisplayObject.prototype.setInteractive=function(e){this.interactive=e},Object.defineProperty(i.DisplayObject.prototype,"interactive",{get:function(){return this._interactive},set:function(e){this._interactive=e,this.stage&&(this.stage.dirty=!0)}}),Object.defineProperty(i.DisplayObject.prototype,"mask",{get:function(){return this._mask},set:function(e){this._mask=e,e?this.addFilter(e):this.removeFilter()}}),i.DisplayObject.prototype.addFilter=function(e){if(!this.filter){this.filter=!0;var t=new i.FilterBlock,n=new i.FilterBlock;t.mask=e,n.mask=e,t.first=t.last=this,n.first=n.last=this,t.open=!0;var r,o,a=t,s=t;o=this.first._iPrev,o?(r=o._iNext,a._iPrev=o,o._iNext=a):r=this,r&&(r._iPrev=s,s._iNext=r);var a=n,s=n,r=null,o=null;o=this.last,r=o._iNext,r&&(r._iPrev=s,s._iNext=r),a._iPrev=o,o._iNext=a;for(var l=this,u=this.last;l;)l.last==u&&(l.last=n),l=l.parent;this.first=t,this.__renderGroup&&this.__renderGroup.addFilterBlocks(t,n),e.renderable=!1}},i.DisplayObject.prototype.removeFilter=function(){if(this.filter){this.filter=!1;var e=this.first,t=e._iNext,n=e._iPrev;t&&(t._iPrev=n),n&&(n._iNext=t),this.first=e._iNext;var r=this.last,t=r._iNext,n=r._iPrev;t&&(t._iPrev=n),n._iNext=t;for(var i=r._iPrev,o=this;o.last==r&&(o.last=i,o=o.parent););var a=e.mask;a.renderable=!0,this.__renderGroup&&this.__renderGroup.removeFilterBlocks(e,r)}},i.DisplayObject.prototype.updateTransform=function(){this.rotation!==this.rotationCache&&(this.rotationCache=this.rotation,this._sr=Math.sin(this.rotation),this._cr=Math.cos(this.rotation));var e=this.localTransform,t=this.parent.worldTransform,n=this.worldTransform;e[0]=this._cr*this.scale.x,e[1]=-this._sr*this.scale.y,e[3]=this._sr*this.scale.x,e[4]=this._cr*this.scale.y;var r=this.pivot.x,o=this.pivot.y,a=e[0],s=e[1],l=this.position.x-e[0]*r-o*e[1],u=e[3],c=e[4],d=this.position.y-e[4]*o-r*e[3],p=t[0],f=t[1],h=t[2],m=t[3],g=t[4],v=t[5];e[2]=l,e[5]=d,n[0]=p*a+f*u,n[1]=p*s+f*c,n[2]=p*l+f*d+h,n[3]=m*a+g*u,n[4]=m*s+g*c,n[5]=m*l+g*d+v,this.worldAlpha=this.alpha*this.parent.worldAlpha,this.vcount=i.visibleCount},i.visibleCount=0,i.DisplayObjectContainer=function(){i.DisplayObject.call(this),this.children=[]},i.DisplayObjectContainer.prototype=Object.create(i.DisplayObject.prototype),i.DisplayObjectContainer.prototype.constructor=i.DisplayObjectContainer,i.DisplayObjectContainer.prototype.addChild=function(e){if(void 0!=e.parent&&e.parent.removeChild(e),e.parent=this,this.children.push(e),this.stage){var t=e;do t.interactive&&(this.stage.dirty=!0),t.stage=this.stage,t=t._iNext;while(t)}var n,r,i=e.first,o=e.last;r=this.filter?this.last._iPrev:this.last,n=r._iNext;for(var a=this,s=r;a;)a.last==s&&(a.last=e.last),a=a.parent;n&&(n._iPrev=o,o._iNext=n),i._iPrev=r,r._iNext=i,this.__renderGroup&&(e.__renderGroup&&e.__renderGroup.removeDisplayObjectAndChildren(e),this.__renderGroup.addDisplayObjectAndChildren(e))},i.DisplayObjectContainer.prototype.addChildAt=function(e,t){if(!(t>=0&&t<=this.children.length))throw new Error(e+" The index "+t+" supplied is out of bounds "+this.children.length);if(void 0!=e.parent&&e.parent.removeChild(e),e.parent=this,this.stage){var n=e;do n.interactive&&(this.stage.dirty=!0),n.stage=this.stage,n=n._iNext;while(n)}var r,i,o=e.first,a=e.last;if(t==this.children.length){i=this.last;for(var s=this,l=this.last;s;)s.last==l&&(s.last=e.last),s=s.parent}else i=0==t?this:this.children[t-1].last;r=i._iNext,r&&(r._iPrev=a,a._iNext=r),o._iPrev=i,i._iNext=o,this.children.splice(t,0,e),this.__renderGroup&&(e.__renderGroup&&e.__renderGroup.removeDisplayObjectAndChildren(e),this.__renderGroup.addDisplayObjectAndChildren(e))},i.DisplayObjectContainer.prototype.swapChildren=function(e,t){},i.DisplayObjectContainer.prototype.getChildAt=function(e){if(e>=0&&e<this.children.length)return this.children[e];throw new Error(child+" Both the supplied DisplayObjects must be a child of the caller "+this)},i.DisplayObjectContainer.prototype.removeChild=function(e){var t=this.children.indexOf(e);if(t===-1)throw new Error(e+" The supplied DisplayObject must be a child of the caller "+this);var n=e.first,r=e.last,i=r._iNext,o=n._iPrev;if(i&&(i._iPrev=o),o._iNext=i,this.last==r)for(var a=n._iPrev,s=this;s.last==r.last&&(s.last=a,s=s.parent););if(r._iNext=null,n._iPrev=null,this.stage){var l=e;do l.interactive&&(this.stage.dirty=!0),l.stage=null,l=l._iNext;while(l)}e.__renderGroup&&e.__renderGroup.removeDisplayObjectAndChildren(e),e.parent=void 0,this.children.splice(t,1)},i.DisplayObjectContainer.prototype.updateTransform=function(){if(this.visible){i.DisplayObject.prototype.updateTransform.call(this);for(var e=0,t=this.children.length;e<t;e++)this.children[e].updateTransform()}},i.blendModes={},i.blendModes.NORMAL=0,i.blendModes.SCREEN=1,i.Sprite=function(e){i.DisplayObjectContainer.call(this),this.anchor=new i.Point,this.texture=e,this.blendMode=i.blendModes.NORMAL,this._width=0,this._height=0,e.baseTexture.hasLoaded?this.updateFrame=!0:(this.onTextureUpdateBind=this.onTextureUpdate.bind(this),this.texture.addEventListener("update",this.onTextureUpdateBind)),this.renderable=!0},i.Sprite.prototype=Object.create(i.DisplayObjectContainer.prototype),i.Sprite.prototype.constructor=i.Sprite,Object.defineProperty(i.Sprite.prototype,"width",{get:function(){return this.scale.x*this.texture.frame.width},set:function(e){this.scale.x=e/this.texture.frame.width,this._width=e}}),Object.defineProperty(i.Sprite.prototype,"height",{get:function(){return this.scale.y*this.texture.frame.height},set:function(e){this.scale.y=e/this.texture.frame.height,this._height=e}}),i.Sprite.prototype.setTexture=function(e){this.texture.baseTexture!=e.baseTexture?(this.textureChange=!0,this.texture=e,this.__renderGroup&&this.__renderGroup.updateTexture(this)):this.texture=e,this.updateFrame=!0},i.Sprite.prototype.onTextureUpdate=function(e){this._width&&(this.scale.x=this._width/this.texture.frame.width),this._height&&(this.scale.y=this._height/this.texture.frame.height),this.updateFrame=!0},i.Sprite.fromFrame=function(e){var t=i.TextureCache[e];if(!t)throw new Error("The frameId '"+e+"' does not exist in the texture cache"+this);return new i.Sprite(t)},i.Sprite.fromImage=function(e){var t=i.Texture.fromImage(e);return new i.Sprite(t)},i.MovieClip=function(e){i.Sprite.call(this,e[0]),this.textures=e,this.animationSpeed=1,this.loop=!0,this.onComplete=null,this.currentFrame=0,this.playing=!1},i.MovieClip.prototype=Object.create(i.Sprite.prototype),i.MovieClip.prototype.constructor=i.MovieClip,i.MovieClip.prototype.stop=function(){this.playing=!1},i.MovieClip.prototype.play=function(){this.playing=!0},i.MovieClip.prototype.gotoAndStop=function(e){this.playing=!1,this.currentFrame=e;var t=this.currentFrame+.5|0;this.setTexture(this.textures[t%this.textures.length])},i.MovieClip.prototype.gotoAndPlay=function(e){this.currentFrame=e,this.playing=!0},i.MovieClip.prototype.updateTransform=function(){if(i.Sprite.prototype.updateTransform.call(this),this.playing){this.currentFrame+=this.animationSpeed;var e=this.currentFrame+.5|0;this.loop||e<this.textures.length?this.setTexture(this.textures[e%this.textures.length]):e>=this.textures.length&&(this.gotoAndStop(this.textures.length-1),this.onComplete&&this.onComplete())}},i.FilterBlock=function(e){this.graphics=e,this.visible=!0,this.renderable=!0},i.Text=function(e,t){this.canvas=document.createElement("canvas"),this.context=this.canvas.getContext("2d"),i.Sprite.call(this,i.Texture.fromCanvas(this.canvas)),this.setText(e),this.setStyle(t),this.updateText(),this.dirty=!1},i.Text.prototype=Object.create(i.Sprite.prototype),i.Text.prototype.constructor=i.Text,i.Text.prototype.setStyle=function(e){e=e||{},e.font=e.font||"bold 20pt Arial",e.fill=e.fill||"black",e.align=e.align||"left",e.stroke=e.stroke||"black",e.strokeThickness=e.strokeThickness||0,e.wordWrap=e.wordWrap||!1,e.wordWrapWidth=e.wordWrapWidth||100,this.style=e,this.dirty=!0},i.Sprite.prototype.setText=function(e){this.text=e.toString()||" ",this.dirty=!0},i.Text.prototype.updateText=function(){this.context.font=this.style.font;var e=this.text;this.style.wordWrap&&(e=this.wordWrap(this.text));for(var t=e.split(/(?:\r\n|\r|\n)/),n=[],r=0,o=0;o<t.length;o++){var a=this.context.measureText(t[o]).width;n[o]=a,r=Math.max(r,a)}this.canvas.width=r+this.style.strokeThickness;var s=this.determineFontHeight("font: "+this.style.font+";")+this.style.strokeThickness;for(this.canvas.height=s*t.length,this.context.fillStyle=this.style.fill,this.context.font=this.style.font,this.context.strokeStyle=this.style.stroke,this.context.lineWidth=this.style.strokeThickness,this.context.textBaseline="top",o=0;o<t.length;o++){var l=new i.Point(this.style.strokeThickness/2,this.style.strokeThickness/2+o*s);"right"==this.style.align?l.x+=r-n[o]:"center"==this.style.align&&(l.x+=(r-n[o])/2),this.style.stroke&&this.style.strokeThickness&&this.context.strokeText(t[o],l.x,l.y),this.style.fill&&this.context.fillText(t[o],l.x,l.y)}this.updateTexture()},i.Text.prototype.updateTexture=function(){this.texture.baseTexture.width=this.canvas.width,this.texture.baseTexture.height=this.canvas.height,this.texture.frame.width=this.canvas.width,this.texture.frame.height=this.canvas.height,this._width=this.canvas.width,this._height=this.canvas.height,i.texturesToUpdate.push(this.texture.baseTexture)},i.Text.prototype.updateTransform=function(){this.dirty&&(this.updateText(),this.dirty=!1),i.Sprite.prototype.updateTransform.call(this)},i.Text.prototype.determineFontHeight=function(e){var t=i.Text.heightCache[e];if(!t){var n=document.getElementsByTagName("body")[0],r=document.createElement("div"),o=document.createTextNode("M");r.appendChild(o),r.setAttribute("style",e+";position:absolute;top:0;left:0"),n.appendChild(r),t=r.offsetHeight,i.Text.heightCache[e]=t,n.removeChild(r)}return t},i.Text.prototype.wordWrap=function(e){for(var t=function(e,t,n,r,i){var o=Math.floor((r-n)/2)+n;return o==n?1:e.measureText(t.substring(0,o)).width<=i?e.measureText(t.substring(0,o+1)).width>i?o:arguments.callee(e,t,o,r,i):arguments.callee(e,t,n,o,i)},n=function(e,n,r){if(e.measureText(n).width<=r||n.length<1)return n;var i=t(e,n,0,n.length,r);return n.substring(0,i)+"\n"+arguments.callee(e,n.substring(i),r)},r="",i=e.split("\n"),o=0;o<i.length;o++)r+=n(this.context,i[o],this.style.wordWrapWidth)+"\n";return r},i.Text.prototype.destroy=function(e){e&&this.texture.destroy()},i.Text.heightCache={},i.BitmapText=function(e,t){i.DisplayObjectContainer.call(this),this.setText(e),this.setStyle(t),this.updateText(),this.dirty=!1},i.BitmapText.prototype=Object.create(i.DisplayObjectContainer.prototype),i.BitmapText.prototype.constructor=i.BitmapText,i.BitmapText.prototype.setText=function(e){this.text=e||" ",this.dirty=!0},i.BitmapText.prototype.setStyle=function(e){e=e||{},e.align=e.align||"left",this.style=e;var t=e.font.split(" ");this.fontName=t[t.length-1],this.fontSize=t.length>=2?parseInt(t[t.length-2],10):i.BitmapText.fonts[this.fontName].size,this.dirty=!0},i.BitmapText.prototype.updateText=function(){for(var e=i.BitmapText.fonts[this.fontName],t=new i.Point,n=null,r=[],o=0,a=[],s=0,l=this.fontSize/e.size,u=0;u<this.text.length;u++){var c=this.text.charCodeAt(u);if(/(?:\r\n|\r|\n)/.test(this.text.charAt(u)))a.push(t.x),o=Math.max(o,t.x),s++,t.x=0,t.y+=e.lineHeight,n=null;else{var d=e.chars[c];d&&(n&&d[n]&&(t.x+=d.kerning[n]),r.push({texture:d.texture,line:s,charCode:c,position:new i.Point(t.x+d.xOffset,t.y+d.yOffset)}),t.x+=d.xAdvance,n=c)}}a.push(t.x),o=Math.max(o,t.x);var p=[];for(u=0;u<=s;u++){var f=0;"right"==this.style.align?f=o-a[u]:"center"==this.style.align&&(f=(o-a[u])/2),p.push(f)}for(u=0;u<r.length;u++){var h=new i.Sprite(r[u].texture);h.position.x=(r[u].position.x+p[r[u].line])*l,h.position.y=r[u].position.y*l,h.scale.x=h.scale.y=l,this.addChild(h)}this.width=t.x*l,this.height=(t.y+e.lineHeight)*l},i.BitmapText.prototype.updateTransform=function(){if(this.dirty){for(;this.children.length>0;)this.removeChild(this.getChildAt(0));this.updateText(),this.dirty=!1}i.DisplayObjectContainer.prototype.updateTransform.call(this)},i.BitmapText.fonts={},i.InteractionManager=function(e){this.stage=e,this.mouse=new i.InteractionData,this.touchs={},this.tempPoint=new i.Point,this.mouseoverEnabled=!0,this.pool=[],this.interactiveItems=[],this.last=0},i.InteractionManager.prototype.constructor=i.InteractionManager,i.InteractionManager.prototype.collectInteractiveSprite=function(e,t){for(var n=e.children,r=n.length,i=r-1;i>=0;i--){var o=n[i];o.interactive?(t.interactiveChildren=!0,this.interactiveItems.push(o),o.children.length>0&&this.collectInteractiveSprite(o,o)):(o.__iParent=null,o.children.length>0&&this.collectInteractiveSprite(o,t))}},i.InteractionManager.prototype.setTarget=function(e){window.navigator.msPointerEnabled&&(e.view.style["-ms-content-zooming"]="none",e.view.style["-ms-touch-action"]="none"),this.target=e,e.view.addEventListener("mousemove",this.onMouseMove.bind(this),!0),e.view.addEventListener("mousedown",this.onMouseDown.bind(this),!0),document.body.addEventListener("mouseup",this.onMouseUp.bind(this),!0),e.view.addEventListener("mouseout",this.onMouseOut.bind(this),!0),e.view.addEventListener("touchstart",this.onTouchStart.bind(this),!0),e.view.addEventListener("touchend",this.onTouchEnd.bind(this),!0),e.view.addEventListener("touchmove",this.onTouchMove.bind(this),!0)},i.InteractionManager.prototype.update=function(){if(this.target){var e=Date.now(),t=e-this.last;if(t=30*t/1e3,!(t<1)){if(this.last=e,this.dirty){this.dirty=!1;for(var n=this.interactiveItems.length,r=0;r<n;r++)this.interactiveItems[r].interactiveChildren=!1;this.interactiveItems=[],this.stage.interactive&&this.interactiveItems.push(this.stage),this.collectInteractiveSprite(this.stage,this.stage)}var i=this.interactiveItems.length;this.target.view.style.cursor="default";for(var r=0;r<i;r++){var o=this.interactiveItems[r];(o.mouseover||o.mouseout||o.buttonMode)&&(o.__hit=this.hitTest(o,this.mouse),this.mouse.target=o,o.__hit?(o.buttonMode&&(this.target.view.style.cursor="pointer"),o.__isOver||(o.mouseover&&o.mouseover(this.mouse),o.__isOver=!0)):o.__isOver&&(o.mouseout&&o.mouseout(this.mouse),o.__isOver=!1))}}}},i.InteractionManager.prototype.onMouseMove=function(e){this.mouse.originalEvent=e||window.event;var t=this.target.view.getBoundingClientRect();this.mouse.global.x=(e.clientX-t.left)*(this.target.width/t.width),this.mouse.global.y=(e.clientY-t.top)*(this.target.height/t.height);for(var n=this.interactiveItems.length,r=(this.mouse.global,0);r<n;r++){var i=this.interactiveItems[r];i.mousemove&&i.mousemove(this.mouse)}},i.InteractionManager.prototype.onMouseDown=function(e){this.mouse.originalEvent=e||window.event;for(var t=this.interactiveItems.length,n=(this.mouse.global,this.stage,0);n<t;n++){var r=this.interactiveItems[n];if((r.mousedown||r.click)&&(r.__mouseIsDown=!0,r.__hit=this.hitTest(r,this.mouse),r.__hit&&(r.mousedown&&r.mousedown(this.mouse),r.__isDown=!0,!r.interactiveChildren)))break}},i.InteractionManager.prototype.onMouseOut=function(e){var t=this.interactiveItems.length;this.target.view.style.cursor="default";for(var n=0;n<t;n++){var r=this.interactiveItems[n];r.__isOver&&(this.mouse.target=r,r.mouseout&&r.mouseout(this.mouse),r.__isOver=!1)}},i.InteractionManager.prototype.onMouseUp=function(e){this.mouse.originalEvent=e||window.event;for(var t=(this.mouse.global,this.interactiveItems.length),n=!1,r=0;r<t;r++){var i=this.interactiveItems[r];(i.mouseup||i.mouseupoutside||i.click)&&(i.__hit=this.hitTest(i,this.mouse),i.__hit&&!n?(i.mouseup&&i.mouseup(this.mouse),i.__isDown&&i.click&&i.click(this.mouse),i.interactiveChildren||(n=!0)):i.__isDown&&i.mouseupoutside&&i.mouseupoutside(this.mouse),i.__isDown=!1)}},i.InteractionManager.prototype.hitTest=function(e,t){var n=t.global;if(e.vcount!==i.visibleCount)return!1;var r=e instanceof i.Sprite,o=e.worldTransform,a=o[0],s=o[1],l=o[2],u=o[3],c=o[4],d=o[5],p=1/(a*c+s*-u),f=c*p*n.x+-s*p*n.y+(d*s-l*c)*p,h=a*p*n.y+-u*p*n.x+(-d*a+l*u)*p;if(t.target=e,e.hitArea&&e.hitArea.contains)return!!e.hitArea.contains(f,h)&&(t.target=e,!0);if(r){var m,g=e.texture.frame.width,v=e.texture.frame.height,y=-g*e.anchor.x;if(f>y&&f<y+g&&(m=-v*e.anchor.y,h>m&&h<m+v))return t.target=e,!0}for(var b=e.children.length,_=0;_<b;_++){var x=e.children[_],w=this.hitTest(x,t);if(w)return t.target=e,!0}return!1},i.InteractionManager.prototype.onTouchMove=function(e){for(var t=this.target.view.getBoundingClientRect(),n=e.changedTouches,r=0;r<n.length;r++){var i=n[r],o=this.touchs[i.identifier];o.originalEvent=e||window.event,o.global.x=(i.clientX-t.left)*(this.target.width/t.width),o.global.y=(i.clientY-t.top)*(this.target.height/t.height)}for(var a=this.interactiveItems.length,r=0;r<a;r++){var s=this.interactiveItems[r];s.touchmove&&s.touchmove(o)}},i.InteractionManager.prototype.onTouchStart=function(e){for(var t=this.target.view.getBoundingClientRect(),n=e.changedTouches,r=0;r<n.length;r++){var o=n[r],a=this.pool.pop();a||(a=new i.InteractionData),a.originalEvent=e||window.event,this.touchs[o.identifier]=a,a.global.x=(o.clientX-t.left)*(this.target.width/t.width),a.global.y=(o.clientY-t.top)*(this.target.height/t.height);for(var s=this.interactiveItems.length,l=0;l<s;l++){var u=this.interactiveItems[l];if((u.touchstart||u.tap)&&(u.__hit=this.hitTest(u,a),u.__hit&&(u.touchstart&&u.touchstart(a),u.__isDown=!0,u.__touchData=a,!u.interactiveChildren)))break}}},i.InteractionManager.prototype.onTouchEnd=function(e){for(var t=this.target.view.getBoundingClientRect(),n=e.changedTouches,r=0;r<n.length;r++){var i=n[r],o=this.touchs[i.identifier],a=!1;o.global.x=(i.clientX-t.left)*(this.target.width/t.width),o.global.y=(i.clientY-t.top)*(this.target.height/t.height);for(var s=this.interactiveItems.length,l=0;l<s;l++){var u=this.interactiveItems[l],c=u.__touchData;u.__hit=this.hitTest(u,o),c==o&&(o.originalEvent=e||window.event,(u.touchend||u.tap)&&(u.__hit&&!a?(u.touchend&&u.touchend(o),u.__isDown&&u.tap&&u.tap(o),u.interactiveChildren||(a=!0)):u.__isDown&&u.touchendoutside&&u.touchendoutside(o),u.__isDown=!1),u.__touchData=null)}this.pool.push(o),this.touchs[i.identifier]=null}},i.InteractionData=function(){this.global=new i.Point,this.local=new i.Point,this.target,this.originalEvent},i.InteractionData.prototype.getLocalPosition=function(e){var t=e.worldTransform,n=this.global,r=t[0],o=t[1],a=t[2],s=t[3],l=t[4],u=t[5],c=1/(r*l+o*-s);return new i.Point(l*c*n.x+-o*c*n.y+(u*o-a*l)*c,r*c*n.y+-s*c*n.x+(-u*r+a*s)*c)},i.InteractionData.prototype.constructor=i.InteractionData,i.Stage=function(e,t){i.DisplayObjectContainer.call(this),this.worldTransform=i.mat3.create(),this.interactive=t,this.interactionManager=new i.InteractionManager(this),this.dirty=!0,this.__childrenAdded=[],this.__childrenRemoved=[],this.stage=this,this.stage.hitArea=new i.Rectangle(0,0,1e5,1e5),this.setBackgroundColor(e),this.worldVisible=!0},i.Stage.prototype=Object.create(i.DisplayObjectContainer.prototype),i.Stage.prototype.constructor=i.Stage,i.Stage.prototype.updateTransform=function(){this.worldAlpha=1,this.vcount=i.visibleCount;for(var e=0,t=this.children.length;e<t;e++)this.children[e].updateTransform();this.dirty&&(this.dirty=!1,this.interactionManager.dirty=!0),this.interactive&&this.interactionManager.update()},i.Stage.prototype.setBackgroundColor=function(e){this.backgroundColor=e||0,this.backgroundColorSplit=t(this.backgroundColor);var n=this.backgroundColor.toString(16);n="000000".substr(0,6-n.length)+n,this.backgroundColorString="#"+n},i.Stage.prototype.getMousePosition=function(){return this.interactionManager.mouse.global};for(var o=0,s=["ms","moz","webkit","o"],l=0;l<s.length&&!window.requestAnimationFrame;++l)window.requestAnimationFrame=window[s[l]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[s[l]+"CancelAnimationFrame"]||window[s[l]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(e,t){var n=(new Date).getTime(),r=Math.max(0,16-(n-o)),i=window.setTimeout(function(){e(n+r)},r);return o=n+r,i}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(e){clearTimeout(e)}),window.requestAnimFrame=window.requestAnimationFrame,"function"!=typeof Function.prototype.bind&&(Function.prototype.bind=function(){var e=Array.prototype.slice;return function(t){function n(){var o=i.concat(e.call(arguments));r.apply(this instanceof n?this:t,o)}var r=this,i=e.call(arguments,1);if("function"!=typeof r)throw new TypeError;return n.prototype=function e(t){if(t&&(e.prototype=t),!(this instanceof e))return new e}(r.prototype),n}}());var u=i.AjaxRequest=function(){var e=["Msxml2.XMLHTTP","Microsoft.XMLHTTP"];if(!window.ActiveXObject)return!!window.XMLHttpRequest&&new XMLHttpRequest;for(var t=0;t<e.length;t++)try{return new ActiveXObject(e[t])}catch(e){}};i.runList=function(e){console.log(">>>>>>>>>"),console.log("_");var t=0,n=e.first;for(console.log(n);n._iNext;)if(t++,n=n._iNext,console.log(n),t>100){console.log("BREAK");break}},i.EventTarget=function(){var e={};this.addEventListener=this.on=function(t,n){void 0===e[t]&&(e[t]=[]),e[t].indexOf(n)===-1&&e[t].push(n)},this.dispatchEvent=this.emit=function(t){for(var n in e[t.type])e[t.type][n](t)},this.removeEventListener=this.off=function(t,n){var r=e[t].indexOf(n);r!==-1&&e[t].splice(r,1)}},i.autoDetectRenderer=function(e,t,n,r,o){e||(e=800),t||(t=600);var a=function(){try{return!!window.WebGLRenderingContext&&!!document.createElement("canvas").getContext("experimental-webgl")}catch(e){return!1}}();return a?new i.WebGLRenderer(e,t,n,r,o):new i.CanvasRenderer(e,t,n,r)},i.PolyK={},i.PolyK.Triangulate=function(e){var t=!0,n=e.length>>1;if(n<3)return[];for(var r=[],o=[],a=0;a<n;a++)o.push(a);for(var a=0,s=n;s>3;){var l=o[(a+0)%s],u=o[(a+1)%s],c=o[(a+2)%s],d=e[2*l],p=e[2*l+1],f=e[2*u],h=e[2*u+1],m=e[2*c],g=e[2*c+1],v=!1;if(i.PolyK._convex(d,p,f,h,m,g,t)){v=!0;for(var y=0;y<s;y++){var b=o[y];if(b!=l&&b!=u&&b!=c&&i.PolyK._PointInTriangle(e[2*b],e[2*b+1],d,p,f,h,m,g)){v=!1;break}}}if(v)r.push(l,u,c),o.splice((a+1)%s,1),s--,a=0;else if(a++>3*s){if(!t)return console.log("PIXI Warning: shape too complex to fill"),[];var r=[];o=[];for(var a=0;a<n;a++)o.push(a);a=0,s=n,t=!1}}return r.push(o[0],o[1],o[2]),r},i.PolyK._PointInTriangle=function(e,t,n,r,i,o,a,s){var l=a-n,u=s-r,c=i-n,d=o-r,p=e-n,f=t-r,h=l*l+u*u,m=l*c+u*d,g=l*p+u*f,v=c*c+d*d,y=c*p+d*f,b=1/(h*v-m*m),_=(v*g-m*y)*b,x=(h*y-m*g)*b;return _>=0&&x>=0&&_+x<1},i.PolyK._convex=function(e,t,n,r,i,o,a){return(t-r)*(i-n)+(n-e)*(o-r)>=0==a},i.shaderFragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying float vColor;","uniform sampler2D uSampler;","void main(void) {","gl_FragColor = texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y));","gl_FragColor = gl_FragColor * vColor;","}"],i.shaderVertexSrc=["attribute vec2 aVertexPosition;","attribute vec2 aTextureCoord;","attribute float aColor;","uniform vec2 projectionVector;","varying vec2 vTextureCoord;","varying float vColor;","void main(void) {","gl_Position = vec4( aVertexPosition.x / projectionVector.x -1.0, aVertexPosition.y / -projectionVector.y + 1.0 , 0.0, 1.0);","vTextureCoord = aTextureCoord;","vColor = aColor;","}"],i.stripShaderFragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying float vColor;","uniform float alpha;","uniform sampler2D uSampler;","void main(void) {","gl_FragColor = texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y));","gl_FragColor = gl_FragColor * alpha;","}"],i.stripShaderVertexSrc=["attribute vec2 aVertexPosition;","attribute vec2 aTextureCoord;","attribute float aColor;","uniform mat3 translationMatrix;","uniform vec2 projectionVector;","varying vec2 vTextureCoord;","varying float vColor;","void main(void) {","vec3 v = translationMatrix * vec3(aVertexPosition, 1.0);","gl_Position = vec4( v.x / projectionVector.x -1.0, v.y / -projectionVector.y + 1.0 , 0.0, 1.0);","vTextureCoord = aTextureCoord;","vColor = aColor;","}"],i.primitiveShaderFragmentSrc=["precision mediump float;","varying vec4 vColor;","void main(void) {","gl_FragColor = vColor;","}"],i.primitiveShaderVertexSrc=["attribute vec2 aVertexPosition;","attribute vec4 aColor;","uniform mat3 translationMatrix;","uniform vec2 projectionVector;","uniform float alpha;","varying vec4 vColor;","void main(void) {","vec3 v = translationMatrix * vec3(aVertexPosition, 1.0);","gl_Position = vec4( v.x / projectionVector.x -1.0, v.y / -projectionVector.y + 1.0 , 0.0, 1.0);","vColor = aColor  * alpha;","}"],i.initPrimitiveShader=function(){var e=i.gl,t=i.compileProgram(i.primitiveShaderVertexSrc,i.primitiveShaderFragmentSrc);e.useProgram(t),t.vertexPositionAttribute=e.getAttribLocation(t,"aVertexPosition"),t.colorAttribute=e.getAttribLocation(t,"aColor"),t.projectionVector=e.getUniformLocation(t,"projectionVector"),
t.translationMatrix=e.getUniformLocation(t,"translationMatrix"),t.alpha=e.getUniformLocation(t,"alpha"),i.primitiveProgram=t},i.initDefaultShader=function(){var e=this.gl,t=i.compileProgram(i.shaderVertexSrc,i.shaderFragmentSrc);e.useProgram(t),t.vertexPositionAttribute=e.getAttribLocation(t,"aVertexPosition"),t.projectionVector=e.getUniformLocation(t,"projectionVector"),t.textureCoordAttribute=e.getAttribLocation(t,"aTextureCoord"),t.colorAttribute=e.getAttribLocation(t,"aColor"),t.samplerUniform=e.getUniformLocation(t,"uSampler"),i.shaderProgram=t},i.initDefaultStripShader=function(){var e=this.gl,t=i.compileProgram(i.stripShaderVertexSrc,i.stripShaderFragmentSrc);e.useProgram(t),t.vertexPositionAttribute=e.getAttribLocation(t,"aVertexPosition"),t.projectionVector=e.getUniformLocation(t,"projectionVector"),t.textureCoordAttribute=e.getAttribLocation(t,"aTextureCoord"),t.translationMatrix=e.getUniformLocation(t,"translationMatrix"),t.alpha=e.getUniformLocation(t,"alpha"),t.colorAttribute=e.getAttribLocation(t,"aColor"),t.projectionVector=e.getUniformLocation(t,"projectionVector"),t.samplerUniform=e.getUniformLocation(t,"uSampler"),i.stripShaderProgram=t},i.CompileVertexShader=function(e,t){return i._CompileShader(e,t,e.VERTEX_SHADER)},i.CompileFragmentShader=function(e,t){return i._CompileShader(e,t,e.FRAGMENT_SHADER)},i._CompileShader=function(e,t,n){var r=t.join("\n"),i=e.createShader(n);return e.shaderSource(i,r),e.compileShader(i),e.getShaderParameter(i,e.COMPILE_STATUS)?i:(alert(e.getShaderInfoLog(i)),null)},i.compileProgram=function(e,t){var n=i.gl,r=i.CompileFragmentShader(n,t),o=i.CompileVertexShader(n,e),a=n.createProgram();return n.attachShader(a,o),n.attachShader(a,r),n.linkProgram(a),n.getProgramParameter(a,n.LINK_STATUS)||alert("Could not initialise shaders"),a},i.activateDefaultShader=function(){var e=i.gl,t=i.shaderProgram;e.useProgram(t),e.enableVertexAttribArray(t.vertexPositionAttribute),e.enableVertexAttribArray(t.textureCoordAttribute),e.enableVertexAttribArray(t.colorAttribute)},i.activatePrimitiveShader=function(){var e=i.gl;e.disableVertexAttribArray(i.shaderProgram.textureCoordAttribute),e.disableVertexAttribArray(i.shaderProgram.colorAttribute),e.useProgram(i.primitiveProgram),e.enableVertexAttribArray(i.primitiveProgram.vertexPositionAttribute),e.enableVertexAttribArray(i.primitiveProgram.colorAttribute)},i.WebGLGraphics=function(){},i.WebGLGraphics.renderGraphics=function(e,t){var n=i.gl;e._webGL||(e._webGL={points:[],indices:[],lastIndex:0,buffer:n.createBuffer(),indexBuffer:n.createBuffer()}),e.dirty&&(e.dirty=!1,e.clearDirty&&(e.clearDirty=!1,e._webGL.lastIndex=0,e._webGL.points=[],e._webGL.indices=[]),i.WebGLGraphics.updateGraphics(e)),i.activatePrimitiveShader();var r=i.mat3.clone(e.worldTransform);i.mat3.transpose(r),n.blendFunc(n.ONE,n.ONE_MINUS_SRC_ALPHA),n.uniformMatrix3fv(i.primitiveProgram.translationMatrix,!1,r),n.uniform2f(i.primitiveProgram.projectionVector,t.x,t.y),n.uniform1f(i.primitiveProgram.alpha,e.worldAlpha),n.bindBuffer(n.ARRAY_BUFFER,e._webGL.buffer),n.vertexAttribPointer(i.shaderProgram.vertexPositionAttribute,2,n.FLOAT,!1,0,0),n.vertexAttribPointer(i.primitiveProgram.vertexPositionAttribute,2,n.FLOAT,!1,24,0),n.vertexAttribPointer(i.primitiveProgram.colorAttribute,4,n.FLOAT,!1,24,8),n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,e._webGL.indexBuffer),n.drawElements(n.TRIANGLE_STRIP,e._webGL.indices.length,n.UNSIGNED_SHORT,0),i.activateDefaultShader()},i.WebGLGraphics.updateGraphics=function(e){for(var t=e._webGL.lastIndex;t<e.graphicsData.length;t++){var n=e.graphicsData[t];n.type==i.Graphics.POLY?(n.fill&&n.points.length>3&&i.WebGLGraphics.buildPoly(n,e._webGL),n.lineWidth>0&&i.WebGLGraphics.buildLine(n,e._webGL)):n.type==i.Graphics.RECT?i.WebGLGraphics.buildRectangle(n,e._webGL):n.type!=i.Graphics.CIRC&&n.type!=i.Graphics.ELIP||i.WebGLGraphics.buildCircle(n,e._webGL)}e._webGL.lastIndex=e.graphicsData.length;var r=i.gl;e._webGL.glPoints=new Float32Array(e._webGL.points),r.bindBuffer(r.ARRAY_BUFFER,e._webGL.buffer),r.bufferData(r.ARRAY_BUFFER,e._webGL.glPoints,r.STATIC_DRAW),e._webGL.glIndicies=new Uint16Array(e._webGL.indices),r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,e._webGL.indexBuffer),r.bufferData(r.ELEMENT_ARRAY_BUFFER,e._webGL.glIndicies,r.STATIC_DRAW)},i.WebGLGraphics.buildRectangle=function(e,n){var r=e.points,o=r[0],a=r[1],s=r[2],l=r[3];if(e.fill){var u=t(e.fillColor),c=e.fillAlpha,d=u[0]*c,p=u[1]*c,f=u[2]*c,h=n.points,m=n.indices,g=h.length/6;h.push(o,a),h.push(d,p,f,c),h.push(o+s,a),h.push(d,p,f,c),h.push(o,a+l),h.push(d,p,f,c),h.push(o+s,a+l),h.push(d,p,f,c),m.push(g,g,g+1,g+2,g+3,g+3)}e.lineWidth&&(e.points=[o,a,o+s,a,o+s,a+l,o,a+l,o,a],i.WebGLGraphics.buildLine(e,n))},i.WebGLGraphics.buildCircle=function(e,n){var r=e.points,o=r[0],a=r[1],s=r[2],l=r[3],u=40,c=2*Math.PI/u;if(e.fill){var d=t(e.fillColor),p=e.fillAlpha,f=d[0]*p,h=d[1]*p,m=d[2]*p,g=n.points,v=n.indices,y=g.length/6;v.push(y);for(var b=0;b<u+1;b++)g.push(o,a,f,h,m,p),g.push(o+Math.sin(c*b)*s,a+Math.cos(c*b)*l,f,h,m,p),v.push(y++,y++);v.push(y-1)}if(e.lineWidth){e.points=[];for(var b=0;b<u+1;b++)e.points.push(o+Math.sin(c*b)*s,a+Math.cos(c*b)*l);i.WebGLGraphics.buildLine(e,n)}},i.WebGLGraphics.buildLine=function(e,n){var r=e.points;if(0!=r.length){var o=new i.Point(r[0],r[1]),a=new i.Point(r[r.length-2],r[r.length-1]);if(o.x==a.x&&o.y==a.y){r.pop(),r.pop(),a=new i.Point(r[r.length-2],r[r.length-1]);var s=a.x+.5*(o.x-a.x),l=a.y+.5*(o.y-a.y);r.unshift(s,l),r.push(s,l)}var u,c,d,p,f,h,m,g,v,y,b,_,x,w,C,T,S,A,k,P,E,O=n.points,M=n.indices,L=r.length/2,N=r.length,R=O.length/6,I=e.lineWidth/2,D=t(e.lineColor),B=e.lineAlpha,V=D[0]*B,j=D[1]*B,F=D[2]*B;u=r[0],c=r[1],d=r[2],p=r[3],m=-(c-p),g=u-d,E=Math.sqrt(m*m+g*g),m/=E,g/=E,m*=I,g*=I,O.push(u-m,c-g,V,j,F,B),O.push(u+m,c+g,V,j,F,B);for(var z=1;z<L-1;z++)u=r[2*(z-1)],c=r[2*(z-1)+1],d=r[2*z],p=r[2*z+1],f=r[2*(z+1)],h=r[2*(z+1)+1],m=-(c-p),g=u-d,E=Math.sqrt(m*m+g*g),m/=E,g/=E,m*=I,g*=I,v=-(p-h),y=d-f,E=Math.sqrt(v*v+y*y),v/=E,y/=E,v*=I,y*=I,x=-g+c-(-g+p),w=-m+d-(-m+u),C=(-m+u)*(-g+p)-(-m+d)*(-g+c),T=-y+h-(-y+p),S=-v+d-(-v+f),A=(-v+f)*(-y+p)-(-v+d)*(-y+h),k=x*S-T*w,0==k&&(k+=1),px=(w*A-S*C)/k,py=(T*C-x*A)/k,P=(px-d)*(px-d)+(py-p)+(py-p),P>19600?(b=m-v,_=g-y,E=Math.sqrt(b*b+_*_),b/=E,_/=E,b*=I,_*=I,O.push(d-b,p-_),O.push(V,j,F,B),O.push(d+b,p+_),O.push(V,j,F,B),O.push(d-b,p-_),O.push(V,j,F,B),N++):(O.push(px,py),O.push(V,j,F,B),O.push(d-(px-d),p-(py-p)),O.push(V,j,F,B));u=r[2*(L-2)],c=r[2*(L-2)+1],d=r[2*(L-1)],p=r[2*(L-1)+1],m=-(c-p),g=u-d,E=Math.sqrt(m*m+g*g),m/=E,g/=E,m*=I,g*=I,O.push(d-m,p-g),O.push(V,j,F,B),O.push(d+m,p+g),O.push(V,j,F,B),M.push(R);for(var z=0;z<N;z++)M.push(R++);M.push(R-1)}},i.WebGLGraphics.buildPoly=function(e,n){var r=e.points;if(!(r.length<6)){for(var o=n.points,a=n.indices,s=r.length/2,l=t(e.fillColor),u=e.fillAlpha,c=l[0]*u,d=l[1]*u,p=l[2]*u,f=i.PolyK.Triangulate(r),h=o.length/6,m=0;m<f.length;m+=3)a.push(f[m]+h),a.push(f[m]+h),a.push(f[m+1]+h),a.push(f[m+2]+h),a.push(f[m+2]+h);for(var m=0;m<s;m++)o.push(r[2*m],r[2*m+1],c,d,p,u)}},i._defaultFrame=new i.Rectangle(0,0,1,1),i.gl,i.WebGLRenderer=function(e,t,n,r,o){this.transparent=!!r,this.width=e||800,this.height=t||600,this.view=n||document.createElement("canvas"),this.view.width=this.width,this.view.height=this.height;var a=this;this.view.addEventListener("webglcontextlost",function(e){a.handleContextLost(e)},!1),this.view.addEventListener("webglcontextrestored",function(e){a.handleContextRestored(e)},!1),this.batchs=[];try{i.gl=this.gl=this.view.getContext("experimental-webgl",{alpha:this.transparent,antialias:!!o,premultipliedAlpha:!0,stencil:!0})}catch(e){throw new Error(" This browser does not support webGL. Try using the canvas renderer"+this)}i.initPrimitiveShader(),i.initDefaultShader(),i.initDefaultStripShader(),i.activateDefaultShader();var s=this.gl;i.WebGLRenderer.gl=s,this.batch=new i.WebGLBatch(s),s.disable(s.DEPTH_TEST),s.disable(s.CULL_FACE),s.enable(s.BLEND),s.colorMask(!0,!0,!0,this.transparent),i.projection=new i.Point(400,300),this.resize(this.width,this.height),this.contextLost=!1,this.stageRenderGroup=new i.WebGLRenderGroup(this.gl)},i.WebGLRenderer.prototype.constructor=i.WebGLRenderer,i.WebGLRenderer.getBatch=function(){return 0==i._batchs.length?new i.WebGLBatch(i.WebGLRenderer.gl):i._batchs.pop()},i.WebGLRenderer.returnBatch=function(e){e.clean(),i._batchs.push(e)},i.WebGLRenderer.prototype.render=function(e){if(!this.contextLost){this.__stage!==e&&(this.__stage=e,this.stageRenderGroup.setRenderable(e)),i.WebGLRenderer.updateTextures(),i.visibleCount++,e.updateTransform();var t=this.gl;if(t.colorMask(!0,!0,!0,this.transparent),t.viewport(0,0,this.width,this.height),t.bindFramebuffer(t.FRAMEBUFFER,null),this.transparent?t.clearColor(0,0,0,0):t.clearColor(e.backgroundColorSplit[0],e.backgroundColorSplit[1],e.backgroundColorSplit[2],1),t.clear(t.COLOR_BUFFER_BIT),this.stageRenderGroup.backgroundColor=e.backgroundColorSplit,this.stageRenderGroup.render(i.projection),e.interactive&&(e._interactiveEventsAdded||(e._interactiveEventsAdded=!0,e.interactionManager.setTarget(this))),i.Texture.frameUpdates.length>0){for(var n=0;n<i.Texture.frameUpdates.length;n++)i.Texture.frameUpdates[n].updateFrame=!1;i.Texture.frameUpdates=[]}}},i.WebGLRenderer.updateTextures=function(){for(var e=0;e<i.texturesToUpdate.length;e++)i.WebGLRenderer.updateTexture(i.texturesToUpdate[e]);for(var e=0;e<i.texturesToDestroy.length;e++)i.WebGLRenderer.destroyTexture(i.texturesToDestroy[e]);i.texturesToUpdate=[],i.texturesToDestroy=[]},i.WebGLRenderer.updateTexture=function(e){var t=i.gl;e._glTexture||(e._glTexture=t.createTexture()),e.hasLoaded&&(t.bindTexture(t.TEXTURE_2D,e._glTexture),t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!0),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,e.source),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),e._powerOf2?(t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.REPEAT),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.REPEAT)):(t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE)),t.bindTexture(t.TEXTURE_2D,null))},i.WebGLRenderer.destroyTexture=function(e){var t=i.gl;e._glTexture&&(e._glTexture=t.createTexture(),t.deleteTexture(t.TEXTURE_2D,e._glTexture))},i.WebGLRenderer.prototype.resize=function(e,t){this.width=e,this.height=t,this.view.width=e,this.view.height=t,this.gl.viewport(0,0,this.width,this.height),i.projection.x=this.width/2,i.projection.y=this.height/2},i.WebGLRenderer.prototype.handleContextLost=function(e){e.preventDefault(),this.contextLost=!0},i.WebGLRenderer.prototype.handleContextRestored=function(e){this.gl=this.view.getContext("experimental-webgl",{alpha:!0}),this.initShaders();for(var t in i.TextureCache){var n=i.TextureCache[t].baseTexture;n._glTexture=null,i.WebGLRenderer.updateTexture(n)}for(var r=0;r<this.batchs.length;r++)this.batchs[r].restoreLostContext(this.gl),this.batchs[r].dirty=!0;i._restoreBatchs(this.gl),this.contextLost=!1},i._batchs=[],i._getBatch=function(e){return 0==i._batchs.length?new i.WebGLBatch(e):i._batchs.pop()},i._returnBatch=function(e){e.clean(),i._batchs.push(e)},i._restoreBatchs=function(e){for(var t=0;t<i._batchs.length;t++)i._batchs[t].restoreLostContext(e)},i.WebGLBatch=function(e){this.gl=e,this.size=0,this.vertexBuffer=e.createBuffer(),this.indexBuffer=e.createBuffer(),this.uvBuffer=e.createBuffer(),this.colorBuffer=e.createBuffer(),this.blendMode=i.blendModes.NORMAL,this.dynamicSize=1},i.WebGLBatch.prototype.constructor=i.WebGLBatch,i.WebGLBatch.prototype.clean=function(){this.verticies=[],this.uvs=[],this.indices=[],this.colors=[],this.dynamicSize=1,this.texture=null,this.last=null,this.size=0,this.head,this.tail},i.WebGLBatch.prototype.restoreLostContext=function(e){this.gl=e,this.vertexBuffer=e.createBuffer(),this.indexBuffer=e.createBuffer(),this.uvBuffer=e.createBuffer(),this.colorBuffer=e.createBuffer()},i.WebGLBatch.prototype.init=function(e){e.batch=this,this.dirty=!0,this.blendMode=e.blendMode,this.texture=e.texture.baseTexture,this.head=e,this.tail=e,this.size=1,this.growBatch()},i.WebGLBatch.prototype.insertBefore=function(e,t){this.size++,e.batch=this,this.dirty=!0;var n=t.__prev;t.__prev=e,e.__next=t,n?(e.__prev=n,n.__next=e):this.head=e},i.WebGLBatch.prototype.insertAfter=function(e,t){this.size++,e.batch=this,this.dirty=!0;var n=t.__next;t.__next=e,e.__prev=t,n?(e.__next=n,n.__prev=e):this.tail=e},i.WebGLBatch.prototype.remove=function(e){return this.size--,0==this.size?(e.batch=null,e.__prev=null,void(e.__next=null)):(e.__prev?e.__prev.__next=e.__next:(this.head=e.__next,this.head.__prev=null),e.__next?e.__next.__prev=e.__prev:(this.tail=e.__prev,this.tail.__next=null),e.batch=null,e.__next=null,e.__prev=null,void(this.dirty=!0))},i.WebGLBatch.prototype.split=function(e){this.dirty=!0;var t=new i.WebGLBatch(this.gl);t.init(e),t.texture=this.texture,t.tail=this.tail,this.tail=e.__prev,this.tail.__next=null,e.__prev=null;for(var n=0;e;)n++,e.batch=t,e=e.__next;return t.size=n,this.size-=n,t},i.WebGLBatch.prototype.merge=function(e){this.dirty=!0,this.tail.__next=e.head,e.head.__prev=this.tail,this.size+=e.size,this.tail=e.tail;for(var t=e.head;t;)t.batch=this,t=t.__next},i.WebGLBatch.prototype.growBatch=function(){var e=this.gl;1==this.size?this.dynamicSize=1:this.dynamicSize=1.5*this.size,this.verticies=new Float32Array(8*this.dynamicSize),e.bindBuffer(e.ARRAY_BUFFER,this.vertexBuffer),e.bufferData(e.ARRAY_BUFFER,this.verticies,e.DYNAMIC_DRAW),this.uvs=new Float32Array(8*this.dynamicSize),e.bindBuffer(e.ARRAY_BUFFER,this.uvBuffer),e.bufferData(e.ARRAY_BUFFER,this.uvs,e.DYNAMIC_DRAW),this.dirtyUVS=!0,this.colors=new Float32Array(4*this.dynamicSize),e.bindBuffer(e.ARRAY_BUFFER,this.colorBuffer),e.bufferData(e.ARRAY_BUFFER,this.colors,e.DYNAMIC_DRAW),this.dirtyColors=!0,this.indices=new Uint16Array(6*this.dynamicSize);for(var t=this.indices.length/6,n=0;n<t;n++){var r=6*n,i=4*n;this.indices[r+0]=i+0,this.indices[r+1]=i+1,this.indices[r+2]=i+2,this.indices[r+3]=i+0,this.indices[r+4]=i+2,this.indices[r+5]=i+3}e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,this.indexBuffer),e.bufferData(e.ELEMENT_ARRAY_BUFFER,this.indices,e.STATIC_DRAW)},i.WebGLBatch.prototype.refresh=function(){this.gl;this.dynamicSize<this.size&&this.growBatch();for(var e,t=0,n=this.head;n;){e=8*t;var r=n.texture,i=r.frame,o=r.baseTexture.width,a=r.baseTexture.height;this.uvs[e+0]=i.x/o,this.uvs[e+1]=i.y/a,this.uvs[e+2]=(i.x+i.width)/o,this.uvs[e+3]=i.y/a,this.uvs[e+4]=(i.x+i.width)/o,this.uvs[e+5]=(i.y+i.height)/a,this.uvs[e+6]=i.x/o,this.uvs[e+7]=(i.y+i.height)/a,n.updateFrame=!1,colorIndex=4*t,this.colors[colorIndex]=this.colors[colorIndex+1]=this.colors[colorIndex+2]=this.colors[colorIndex+3]=n.worldAlpha,n=n.__next,t++}this.dirtyUVS=!0,this.dirtyColors=!0},i.WebGLBatch.prototype.update=function(){for(var e,t,n,r,o,a,s,l,u,c,d,p,f,h,m,g,v=(this.gl,0),y=this.head;y;){if(y.vcount===i.visibleCount){if(t=y.texture.frame.width,n=y.texture.frame.height,r=y.anchor.x,o=y.anchor.y,a=t*(1-r),s=t*-r,l=n*(1-o),u=n*-o,c=8*v,e=y.worldTransform,d=e[0],p=e[3],f=e[1],h=e[4],m=e[2],g=e[5],this.verticies[c+0]=d*s+f*u+m,this.verticies[c+1]=h*u+p*s+g,this.verticies[c+2]=d*a+f*u+m,this.verticies[c+3]=h*u+p*a+g,this.verticies[c+4]=d*a+f*l+m,this.verticies[c+5]=h*l+p*a+g,this.verticies[c+6]=d*s+f*l+m,this.verticies[c+7]=h*l+p*s+g,y.updateFrame||y.texture.updateFrame){this.dirtyUVS=!0;var b=y.texture,_=b.frame,x=b.baseTexture.width,w=b.baseTexture.height;this.uvs[c+0]=_.x/x,this.uvs[c+1]=_.y/w,this.uvs[c+2]=(_.x+_.width)/x,this.uvs[c+3]=_.y/w,this.uvs[c+4]=(_.x+_.width)/x,this.uvs[c+5]=(_.y+_.height)/w,this.uvs[c+6]=_.x/x,this.uvs[c+7]=(_.y+_.height)/w,y.updateFrame=!1}if(y.cacheAlpha!=y.worldAlpha){y.cacheAlpha=y.worldAlpha;var C=4*v;this.colors[C]=this.colors[C+1]=this.colors[C+2]=this.colors[C+3]=y.worldAlpha,this.dirtyColors=!0}}else c=8*v,this.verticies[c+0]=0,this.verticies[c+1]=0,this.verticies[c+2]=0,this.verticies[c+3]=0,this.verticies[c+4]=0,this.verticies[c+5]=0,this.verticies[c+6]=0,this.verticies[c+7]=0;v++,y=y.__next}},i.WebGLBatch.prototype.render=function(e,t){if(e=e||0,void 0==t&&(t=this.size),this.dirty&&(this.refresh(),this.dirty=!1),0!=this.size){this.update();var n=this.gl,r=i.shaderProgram;n.useProgram(r),n.bindBuffer(n.ARRAY_BUFFER,this.vertexBuffer),n.bufferSubData(n.ARRAY_BUFFER,0,this.verticies),n.vertexAttribPointer(r.vertexPositionAttribute,2,n.FLOAT,!1,0,0),n.bindBuffer(n.ARRAY_BUFFER,this.uvBuffer),this.dirtyUVS&&(this.dirtyUVS=!1,n.bufferSubData(n.ARRAY_BUFFER,0,this.uvs)),n.vertexAttribPointer(r.textureCoordAttribute,2,n.FLOAT,!1,0,0),n.activeTexture(n.TEXTURE0),n.bindTexture(n.TEXTURE_2D,this.texture._glTexture),n.bindBuffer(n.ARRAY_BUFFER,this.colorBuffer),this.dirtyColors&&(this.dirtyColors=!1,n.bufferSubData(n.ARRAY_BUFFER,0,this.colors)),n.vertexAttribPointer(r.colorAttribute,1,n.FLOAT,!1,0,0),n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,this.indexBuffer);var o=t-e;n.drawElements(n.TRIANGLES,6*o,n.UNSIGNED_SHORT,2*e*6)}},i.WebGLRenderGroup=function(e){this.gl=e,this.root,this.backgroundColor,this.batchs=[],this.toRemove=[]},i.WebGLRenderGroup.prototype.constructor=i.WebGLRenderGroup,i.WebGLRenderGroup.prototype.setRenderable=function(e){this.root&&this.removeDisplayObjectAndChildren(this.root),e.worldVisible=e.visible,this.root=e,this.addDisplayObjectAndChildren(e)},i.WebGLRenderGroup.prototype.render=function(e){i.WebGLRenderer.updateTextures();var t=this.gl;t.uniform2f(i.shaderProgram.projectionVector,e.x,e.y),t.blendFunc(t.ONE,t.ONE_MINUS_SRC_ALPHA);for(var n,r=0;r<this.batchs.length;r++)if(n=this.batchs[r],n instanceof i.WebGLBatch)this.batchs[r].render();else{var o=n.vcount===i.visibleCount;n instanceof i.TilingSprite?o&&this.renderTilingSprite(n,e):n instanceof i.Strip?o&&this.renderStrip(n,e):n instanceof i.Graphics?o&&n.renderable&&i.WebGLGraphics.renderGraphics(n,e):n instanceof i.FilterBlock&&(n.open?(t.enable(t.STENCIL_TEST),t.colorMask(!1,!1,!1,!1),t.stencilFunc(t.ALWAYS,1,255),t.stencilOp(t.KEEP,t.KEEP,t.REPLACE),i.WebGLGraphics.renderGraphics(n.mask,e),t.colorMask(!0,!0,!0,!1),t.stencilFunc(t.NOTEQUAL,0,255),t.stencilOp(t.KEEP,t.KEEP,t.KEEP)):t.disable(t.STENCIL_TEST))}},i.WebGLRenderGroup.prototype.handleFilter=function(e,t){},i.WebGLRenderGroup.prototype.renderSpecific=function(e,t){i.WebGLRenderer.updateTextures();var n=this.gl;n.uniform2f(i.shaderProgram.projectionVector,t.x,t.y);for(var r,o,a,s,l=e.first;l._iNext&&(l=l._iNext,!l.renderable||!l.__renderGroup););var u=l.batch;if(l instanceof i.Sprite){u=l.batch;var c=u.head;if(c==l)r=0;else for(r=1;c.__next!=l;)r++,c=c.__next}else u=l;for(var d,p=e,f=e;f.children.length>0;)f=f.children[f.children.length-1],f.renderable&&(p=f);if(p instanceof i.Sprite){d=p.batch;var c=d.head;if(c==p)a=0;else for(a=1;c.__next!=p;)a++,c=c.__next}else d=p;if(u==d)return void(u instanceof i.WebGLBatch?u.render(r,a+1):this.renderSpecial(u,t));o=this.batchs.indexOf(u),s=this.batchs.indexOf(d),u instanceof i.WebGLBatch?u.render(r):this.renderSpecial(u,t);for(var h=o+1;h<s;h++)renderable=this.batchs[h],renderable instanceof i.WebGLBatch?this.batchs[h].render():this.renderSpecial(renderable,t);d instanceof i.WebGLBatch?d.render(0,a+1):this.renderSpecial(d,t)},i.WebGLRenderGroup.prototype.renderSpecial=function(e,t){var n=e.vcount===i.visibleCount;if(e instanceof i.TilingSprite)n&&this.renderTilingSprite(e,t);else if(e instanceof i.Strip)n&&this.renderStrip(e,t);else if(e instanceof i.CustomRenderable)n&&e.renderWebGL(this,t);else if(e instanceof i.Graphics)n&&e.renderable&&i.WebGLGraphics.renderGraphics(e,t);else if(e instanceof i.FilterBlock){var r=i.gl;e.open?(r.enable(r.STENCIL_TEST),r.colorMask(!1,!1,!1,!1),r.stencilFunc(r.ALWAYS,1,255),r.stencilOp(r.KEEP,r.KEEP,r.REPLACE),i.WebGLGraphics.renderGraphics(e.mask,t),r.colorMask(!0,!0,!0,!0),r.stencilFunc(r.NOTEQUAL,0,255),r.stencilOp(r.KEEP,r.KEEP,r.KEEP)):r.disable(r.STENCIL_TEST)}},i.WebGLRenderGroup.prototype.updateTexture=function(e){this.removeObject(e);for(var t=e.first;t!=this.root&&(t=t._iPrev,!t.renderable||!t.__renderGroup););for(var n=e.last;n._iNext&&(n=n._iNext,!n.renderable||!n.__renderGroup););this.insertObject(e,t,n)},i.WebGLRenderGroup.prototype.addFilterBlocks=function(e,t){e.__renderGroup=this,t.__renderGroup=this;for(var n=e;n!=this.root&&(n=n._iPrev,!n.renderable||!n.__renderGroup););this.insertAfter(e,n);for(var r=t;r!=this.root&&(r=r._iPrev,!r.renderable||!r.__renderGroup););this.insertAfter(t,r)},i.WebGLRenderGroup.prototype.removeFilterBlocks=function(e,t){this.removeObject(e),this.removeObject(t)},i.WebGLRenderGroup.prototype.addDisplayObjectAndChildren=function(e){e.__renderGroup&&e.__renderGroup.removeDisplayObjectAndChildren(e);for(var t=e.first;t!=this.root.first&&(t=t._iPrev,!t.renderable||!t.__renderGroup););for(var n=e.last;n._iNext&&(n=n._iNext,!n.renderable||!n.__renderGroup););var r=e.first,i=e.last._iNext;do r.__renderGroup=this,r.renderable&&(this.insertObject(r,t,n),t=r),r=r._iNext;while(r!=i)},i.WebGLRenderGroup.prototype.removeDisplayObjectAndChildren=function(e){if(e.__renderGroup==this){e.last;do e.__renderGroup=null,e.renderable&&this.removeObject(e),e=e._iNext;while(e)}},i.WebGLRenderGroup.prototype.insertObject=function(e,t,n){var r=t,o=n;if(e instanceof i.Sprite){var a,s;if(r instanceof i.Sprite){if(a=r.batch,a&&a.texture==e.texture.baseTexture&&a.blendMode==e.blendMode)return void a.insertAfter(e,r)}else a=r;if(o)if(o instanceof i.Sprite){if(s=o.batch){if(s.texture==e.texture.baseTexture&&s.blendMode==e.blendMode)return void s.insertBefore(e,o);if(s==a){var l=a.split(o),u=i.WebGLRenderer.getBatch(),c=this.batchs.indexOf(a);return u.init(e),void this.batchs.splice(c+1,0,u,l)}}}else s=o;var u=i.WebGLRenderer.getBatch();if(u.init(e),a){var c=this.batchs.indexOf(a);this.batchs.splice(c+1,0,u)}else this.batchs.push(u)}else e instanceof i.TilingSprite?this.initTilingSprite(e):e instanceof i.Strip&&this.initStrip(e),this.insertAfter(e,r)},i.WebGLRenderGroup.prototype.insertAfter=function(e,t){if(t instanceof i.Sprite){var n=t.batch;if(n)if(n.tail==t){var r=this.batchs.indexOf(n);this.batchs.splice(r+1,0,e)}else{var o=n.split(t.__next),r=this.batchs.indexOf(n);this.batchs.splice(r+1,0,e,o)}else this.batchs.push(e)}else{var r=this.batchs.indexOf(t);this.batchs.splice(r+1,0,e)}},i.WebGLRenderGroup.prototype.removeObject=function(e){var t;if(e instanceof i.Sprite){var n=e.batch;if(!n)return;n.remove(e),0==n.size&&(t=n)}else t=e;if(t){var r=this.batchs.indexOf(t);if(r==-1)return;if(0==r||r==this.batchs.length-1)return this.batchs.splice(r,1),void(t instanceof i.WebGLBatch&&i.WebGLRenderer.returnBatch(t));if(this.batchs[r-1]instanceof i.WebGLBatch&&this.batchs[r+1]instanceof i.WebGLBatch&&this.batchs[r-1].texture==this.batchs[r+1].texture&&this.batchs[r-1].blendMode==this.batchs[r+1].blendMode)return this.batchs[r-1].merge(this.batchs[r+1]),t instanceof i.WebGLBatch&&i.WebGLRenderer.returnBatch(t),i.WebGLRenderer.returnBatch(this.batchs[r+1]),void this.batchs.splice(r,2);this.batchs.splice(r,1),t instanceof i.WebGLBatch&&i.WebGLRenderer.returnBatch(t)}},i.WebGLRenderGroup.prototype.initTilingSprite=function(e){var t=this.gl;e.verticies=new Float32Array([0,0,e.width,0,e.width,e.height,0,e.height]),e.uvs=new Float32Array([0,0,1,0,1,1,0,1]),e.colors=new Float32Array([1,1,1,1]),e.indices=new Uint16Array([0,1,3,2]),e._vertexBuffer=t.createBuffer(),e._indexBuffer=t.createBuffer(),e._uvBuffer=t.createBuffer(),e._colorBuffer=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,e._vertexBuffer),t.bufferData(t.ARRAY_BUFFER,e.verticies,t.STATIC_DRAW),t.bindBuffer(t.ARRAY_BUFFER,e._uvBuffer),t.bufferData(t.ARRAY_BUFFER,e.uvs,t.DYNAMIC_DRAW),t.bindBuffer(t.ARRAY_BUFFER,e._colorBuffer),t.bufferData(t.ARRAY_BUFFER,e.colors,t.STATIC_DRAW),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,e._indexBuffer),t.bufferData(t.ELEMENT_ARRAY_BUFFER,e.indices,t.STATIC_DRAW),e.texture.baseTexture._glTexture?(t.bindTexture(t.TEXTURE_2D,e.texture.baseTexture._glTexture),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.REPEAT),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.REPEAT),e.texture.baseTexture._powerOf2=!0):e.texture.baseTexture._powerOf2=!0},i.WebGLRenderGroup.prototype.renderStrip=function(e,t){var n=this.gl,r=i.shaderProgram;n.useProgram(i.stripShaderProgram);var o=i.mat3.clone(e.worldTransform);i.mat3.transpose(o),n.uniformMatrix3fv(i.stripShaderProgram.translationMatrix,!1,o),n.uniform2f(i.stripShaderProgram.projectionVector,t.x,t.y),n.uniform1f(i.stripShaderProgram.alpha,e.worldAlpha),e.dirty?(e.dirty=!1,n.bindBuffer(n.ARRAY_BUFFER,e._vertexBuffer),n.bufferData(n.ARRAY_BUFFER,e.verticies,n.STATIC_DRAW),n.vertexAttribPointer(r.vertexPositionAttribute,2,n.FLOAT,!1,0,0),n.bindBuffer(n.ARRAY_BUFFER,e._uvBuffer),n.bufferData(n.ARRAY_BUFFER,e.uvs,n.STATIC_DRAW),n.vertexAttribPointer(r.textureCoordAttribute,2,n.FLOAT,!1,0,0),n.activeTexture(n.TEXTURE0),n.bindTexture(n.TEXTURE_2D,e.texture.baseTexture._glTexture),n.bindBuffer(n.ARRAY_BUFFER,e._colorBuffer),n.bufferData(n.ARRAY_BUFFER,e.colors,n.STATIC_DRAW),n.vertexAttribPointer(r.colorAttribute,1,n.FLOAT,!1,0,0),n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,e._indexBuffer),n.bufferData(n.ELEMENT_ARRAY_BUFFER,e.indices,n.STATIC_DRAW)):(n.bindBuffer(n.ARRAY_BUFFER,e._vertexBuffer),n.bufferSubData(n.ARRAY_BUFFER,0,e.verticies),n.vertexAttribPointer(r.vertexPositionAttribute,2,n.FLOAT,!1,0,0),n.bindBuffer(n.ARRAY_BUFFER,e._uvBuffer),n.vertexAttribPointer(r.textureCoordAttribute,2,n.FLOAT,!1,0,0),n.activeTexture(n.TEXTURE0),n.bindTexture(n.TEXTURE_2D,e.texture.baseTexture._glTexture),n.bindBuffer(n.ARRAY_BUFFER,e._colorBuffer),n.vertexAttribPointer(r.colorAttribute,1,n.FLOAT,!1,0,0),n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,e._indexBuffer)),n.drawElements(n.TRIANGLE_STRIP,e.indices.length,n.UNSIGNED_SHORT,0),n.useProgram(i.shaderProgram)},i.WebGLRenderGroup.prototype.renderTilingSprite=function(e,t){var n=this.gl,r=(i.shaderProgram,e.tilePosition),o=e.tileScale,a=r.x/e.texture.baseTexture.width,s=r.y/e.texture.baseTexture.height,l=e.width/e.texture.baseTexture.width/o.x,u=e.height/e.texture.baseTexture.height/o.y;e.uvs[0]=0-a,e.uvs[1]=0-s,e.uvs[2]=1*l-a,e.uvs[3]=0-s,e.uvs[4]=1*l-a,e.uvs[5]=1*u-s,e.uvs[6]=0-a,e.uvs[7]=1*u-s,n.bindBuffer(n.ARRAY_BUFFER,e._uvBuffer),n.bufferSubData(n.ARRAY_BUFFER,0,e.uvs),this.renderStrip(e,t)},i.WebGLRenderGroup.prototype.initStrip=function(e){var t=this.gl;this.shaderProgram;e._vertexBuffer=t.createBuffer(),e._indexBuffer=t.createBuffer(),e._uvBuffer=t.createBuffer(),e._colorBuffer=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,e._vertexBuffer),t.bufferData(t.ARRAY_BUFFER,e.verticies,t.DYNAMIC_DRAW),t.bindBuffer(t.ARRAY_BUFFER,e._uvBuffer),t.bufferData(t.ARRAY_BUFFER,e.uvs,t.STATIC_DRAW),t.bindBuffer(t.ARRAY_BUFFER,e._colorBuffer),t.bufferData(t.ARRAY_BUFFER,e.colors,t.STATIC_DRAW),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,e._indexBuffer),t.bufferData(t.ELEMENT_ARRAY_BUFFER,e.indices,t.STATIC_DRAW)},i.CanvasRenderer=function(e,t,n,r){this.transparent=r,this.width=e||800,this.height=t||600,this.view=n||document.createElement("canvas"),this.context=this.view.getContext("2d"),this.refresh=!0,this.view.width=this.width,this.view.height=this.height,this.count=0},i.CanvasRenderer.prototype.constructor=i.CanvasRenderer,i.CanvasRenderer.prototype.render=function(e){i.texturesToUpdate=[],i.texturesToDestroy=[],i.visibleCount++,e.updateTransform(),this.view.style.backgroundColor==e.backgroundColorString||this.transparent||(this.view.style.backgroundColor=e.backgroundColorString),this.context.setTransform(1,0,0,1,0,0),this.context.clearRect(0,0,this.width,this.height),this.renderDisplayObject(e),e.interactive&&(e._interactiveEventsAdded||(e._interactiveEventsAdded=!0,e.interactionManager.setTarget(this))),i.Texture.frameUpdates.length>0&&(i.Texture.frameUpdates=[])},i.CanvasRenderer.prototype.resize=function(e,t){this.width=e,this.height=t,this.view.width=e,this.view.height=t},i.CanvasRenderer.prototype.renderDisplayObject=function(e){var t,n=this.context;n.globalCompositeOperation="source-over";var r=e.last._iNext;e=e.first;do if(t=e.worldTransform,e.visible)if(e.renderable){if(e instanceof i.Sprite){var o=e.texture.frame;o&&(n.globalAlpha=e.worldAlpha,n.setTransform(t[0],t[3],t[1],t[4],t[2],t[5]),n.drawImage(e.texture.baseTexture.source,o.x,o.y,o.width,o.height,e.anchor.x*-o.width,e.anchor.y*-o.height,o.width,o.height))}else if(e instanceof i.Strip)n.setTransform(t[0],t[3],t[1],t[4],t[2],t[5]),this.renderStrip(e);else if(e instanceof i.TilingSprite)n.setTransform(t[0],t[3],t[1],t[4],t[2],t[5]),this.renderTilingSprite(e);else if(e instanceof i.CustomRenderable)e.renderCanvas(this);else if(e instanceof i.Graphics)n.setTransform(t[0],t[3],t[1],t[4],t[2],t[5]),i.CanvasGraphics.renderGraphics(e,n);else if(e instanceof i.FilterBlock)if(e.open){n.save();var a=e.mask.alpha,s=e.mask.worldTransform;n.setTransform(s[0],s[3],s[1],s[4],s[2],s[5]),e.mask.worldAlpha=.5,n.worldAlpha=0,i.CanvasGraphics.renderGraphicsMask(e.mask,n),n.clip(),e.mask.worldAlpha=a}else n.restore();e=e._iNext}else e=e._iNext;else e=e.last._iNext;while(e!=r)},i.CanvasRenderer.prototype.renderStripFlat=function(e){var t=this.context,n=e.verticies,r=(e.uvs,n.length/2);this.count++,t.beginPath();for(var i=1;i<r-2;i++){var o=2*i,a=n[o],s=n[o+2],l=n[o+4],u=n[o+1],c=n[o+3],d=n[o+5];t.moveTo(a,u),t.lineTo(s,c),t.lineTo(l,d)}t.fillStyle="#FF0000",t.fill(),t.closePath()},i.CanvasRenderer.prototype.renderTilingSprite=function(e){var t=this.context;t.globalAlpha=e.worldAlpha,e.__tilePattern||(e.__tilePattern=t.createPattern(e.texture.baseTexture.source,"repeat")),t.beginPath();var n=e.tilePosition,r=e.tileScale;t.scale(r.x,r.y),t.translate(n.x,n.y),t.fillStyle=e.__tilePattern,t.fillRect(-n.x,-n.y,e.width/r.x,e.height/r.y),t.scale(1/r.x,1/r.y),t.translate(-n.x,-n.y),t.closePath()},i.CanvasRenderer.prototype.renderStrip=function(e){var t=this.context,n=e.verticies,r=e.uvs,i=n.length/2;this.count++;for(var o=1;o<i-2;o++){var a=2*o,s=n[a],l=n[a+2],u=n[a+4],c=n[a+1],d=n[a+3],p=n[a+5],f=r[a]*e.texture.width,h=r[a+2]*e.texture.width,m=r[a+4]*e.texture.width,g=r[a+1]*e.texture.height,v=r[a+3]*e.texture.height,y=r[a+5]*e.texture.height;t.save(),t.beginPath(),t.moveTo(s,c),t.lineTo(l,d),t.lineTo(u,p),t.closePath(),t.clip();var b=f*v+g*m+h*y-v*m-g*h-f*y,_=s*v+g*u+l*y-v*u-g*l-s*y,x=f*l+s*m+h*u-l*m-s*h-f*u,w=f*v*u+g*l*m+s*h*y-s*v*m-g*h*u-f*l*y,C=c*v+g*p+d*y-v*p-g*d-c*y,T=f*d+c*m+h*p-d*m-c*h-f*p,S=f*v*p+g*d*m+c*h*y-c*v*m-g*h*p-f*d*y;t.transform(_/b,C/b,x/b,T/b,w/b,S/b),t.drawImage(e.texture.baseTexture.source,0,0),t.restore()}},i.CanvasGraphics=function(){},i.CanvasGraphics.renderGraphics=function(e,t){for(var n=e.worldAlpha,r=0;r<e.graphicsData.length;r++){var o=e.graphicsData[r],a=o.points;if(t.strokeStyle=color="#"+("00000"+(0|o.lineColor).toString(16)).substr(-6),t.lineWidth=o.lineWidth,o.type==i.Graphics.POLY){t.beginPath(),t.moveTo(a[0],a[1]);for(var s=1;s<a.length/2;s++)t.lineTo(a[2*s],a[2*s+1]);a[0]==a[a.length-2]&&a[1]==a[a.length-1]&&t.closePath(),o.fill&&(t.globalAlpha=o.fillAlpha*n,t.fillStyle=color="#"+("00000"+(0|o.fillColor).toString(16)).substr(-6),t.fill()),o.lineWidth&&(t.globalAlpha=o.lineAlpha*n,t.stroke())}else if(o.type==i.Graphics.RECT)void 0!=o.fillColor&&(t.globalAlpha=o.fillAlpha*n,t.fillStyle=color="#"+("00000"+(0|o.fillColor).toString(16)).substr(-6),t.fillRect(a[0],a[1],a[2],a[3])),o.lineWidth&&(t.globalAlpha=o.lineAlpha*n,t.strokeRect(a[0],a[1],a[2],a[3]));else if(o.type==i.Graphics.CIRC)t.beginPath(),t.arc(a[0],a[1],a[2],0,2*Math.PI),t.closePath(),o.fill&&(t.globalAlpha=o.fillAlpha*n,t.fillStyle=color="#"+("00000"+(0|o.fillColor).toString(16)).substr(-6),t.fill()),o.lineWidth&&(t.globalAlpha=o.lineAlpha*n,t.stroke());else if(o.type==i.Graphics.ELIP){var l=o.points,u=2*l[2],c=2*l[3],d=l[0]-u/2,p=l[1]-c/2;t.beginPath();var f=.5522848,h=u/2*f,m=c/2*f,g=d+u,v=p+c,y=d+u/2,b=p+c/2;t.moveTo(d,b),t.bezierCurveTo(d,b-m,y-h,p,y,p),t.bezierCurveTo(y+h,p,g,b-m,g,b),
t.bezierCurveTo(g,b+m,y+h,v,y,v),t.bezierCurveTo(y-h,v,d,b+m,d,b),t.closePath(),o.fill&&(t.globalAlpha=o.fillAlpha*n,t.fillStyle=color="#"+("00000"+(0|o.fillColor).toString(16)).substr(-6),t.fill()),o.lineWidth&&(t.globalAlpha=o.lineAlpha*n,t.stroke())}}},i.CanvasGraphics.renderGraphicsMask=function(e,t){var n=(e.worldAlpha,e.graphicsData.length);n>1&&(n=1,console.log("Pixi.js warning: masks in canvas can only mask using the first path in the graphics object"));for(var r=0;r<1;r++){var o=e.graphicsData[r],a=o.points;if(o.type==i.Graphics.POLY){t.beginPath(),t.moveTo(a[0],a[1]);for(var s=1;s<a.length/2;s++)t.lineTo(a[2*s],a[2*s+1]);a[0]==a[a.length-2]&&a[1]==a[a.length-1]&&t.closePath()}else if(o.type==i.Graphics.RECT)t.beginPath(),t.rect(a[0],a[1],a[2],a[3]),t.closePath();else if(o.type==i.Graphics.CIRC)t.beginPath(),t.arc(a[0],a[1],a[2],0,2*Math.PI),t.closePath();else if(o.type==i.Graphics.ELIP){var l=o.points,u=2*l[2],c=2*l[3],d=l[0]-u/2,p=l[1]-c/2;t.beginPath();var f=.5522848,h=u/2*f,m=c/2*f,g=d+u,v=p+c,y=d+u/2,b=p+c/2;t.moveTo(d,b),t.bezierCurveTo(d,b-m,y-h,p,y,p),t.bezierCurveTo(y+h,p,g,b-m,g,b),t.bezierCurveTo(g,b+m,y+h,v,y,v),t.bezierCurveTo(y-h,v,d,b+m,d,b),t.closePath()}}},i.Graphics=function(){i.DisplayObjectContainer.call(this),this.renderable=!0,this.fillAlpha=1,this.lineWidth=0,this.lineColor="black",this.graphicsData=[],this.currentPath={points:[]}},i.Graphics.prototype=Object.create(i.DisplayObjectContainer.prototype),i.Graphics.prototype.constructor=i.Graphics,i.Graphics.prototype.lineStyle=function(e,t,n){0==this.currentPath.points.length&&this.graphicsData.pop(),this.lineWidth=e||0,this.lineColor=t||0,this.lineAlpha=void 0==n?1:n,this.currentPath={lineWidth:this.lineWidth,lineColor:this.lineColor,lineAlpha:this.lineAlpha,fillColor:this.fillColor,fillAlpha:this.fillAlpha,fill:this.filling,points:[],type:i.Graphics.POLY},this.graphicsData.push(this.currentPath)},i.Graphics.prototype.moveTo=function(e,t){0==this.currentPath.points.length&&this.graphicsData.pop(),this.currentPath=this.currentPath={lineWidth:this.lineWidth,lineColor:this.lineColor,lineAlpha:this.lineAlpha,fillColor:this.fillColor,fillAlpha:this.fillAlpha,fill:this.filling,points:[],type:i.Graphics.POLY},this.currentPath.points.push(e,t),this.graphicsData.push(this.currentPath)},i.Graphics.prototype.lineTo=function(e,t){this.currentPath.points.push(e,t),this.dirty=!0},i.Graphics.prototype.beginFill=function(e,t){this.filling=!0,this.fillColor=e||0,this.fillAlpha=void 0==t?1:t},i.Graphics.prototype.endFill=function(){this.filling=!1,this.fillColor=null,this.fillAlpha=1},i.Graphics.prototype.drawRect=function(e,t,n,r){0==this.currentPath.points.length&&this.graphicsData.pop(),this.currentPath={lineWidth:this.lineWidth,lineColor:this.lineColor,lineAlpha:this.lineAlpha,fillColor:this.fillColor,fillAlpha:this.fillAlpha,fill:this.filling,points:[e,t,n,r],type:i.Graphics.RECT},this.graphicsData.push(this.currentPath),this.dirty=!0},i.Graphics.prototype.drawCircle=function(e,t,n){0==this.currentPath.points.length&&this.graphicsData.pop(),this.currentPath={lineWidth:this.lineWidth,lineColor:this.lineColor,lineAlpha:this.lineAlpha,fillColor:this.fillColor,fillAlpha:this.fillAlpha,fill:this.filling,points:[e,t,n,n],type:i.Graphics.CIRC},this.graphicsData.push(this.currentPath),this.dirty=!0},i.Graphics.prototype.drawElipse=function(e,t,n,r){0==this.currentPath.points.length&&this.graphicsData.pop(),this.currentPath={lineWidth:this.lineWidth,lineColor:this.lineColor,lineAlpha:this.lineAlpha,fillColor:this.fillColor,fillAlpha:this.fillAlpha,fill:this.filling,points:[e,t,n,r],type:i.Graphics.ELIP},this.graphicsData.push(this.currentPath),this.dirty=!0},i.Graphics.prototype.clear=function(){this.lineWidth=0,this.filling=!1,this.dirty=!0,this.clearDirty=!0,this.graphicsData=[]},i.Graphics.POLY=0,i.Graphics.RECT=1,i.Graphics.CIRC=2,i.Graphics.ELIP=3,i.Strip=function(e,t,n){i.DisplayObjectContainer.call(this),this.texture=e,this.blendMode=i.blendModes.NORMAL;try{this.uvs=new Float32Array([0,1,1,1,1,0,0,1]),this.verticies=new Float32Array([0,0,0,0,0,0,0,0,0]),this.colors=new Float32Array([1,1,1,1]),this.indices=new Uint16Array([0,1,2,3])}catch(e){this.uvs=[0,1,1,1,1,0,0,1],this.verticies=[0,0,0,0,0,0,0,0,0],this.colors=[1,1,1,1],this.indices=[0,1,2,3]}this.width=t,this.height=n,e.baseTexture.hasLoaded?(this.width=this.texture.frame.width,this.height=this.texture.frame.height,this.updateFrame=!0):(this.onTextureUpdateBind=this.onTextureUpdate.bind(this),this.texture.addEventListener("update",this.onTextureUpdateBind)),this.renderable=!0},i.Strip.prototype=Object.create(i.DisplayObjectContainer.prototype),i.Strip.prototype.constructor=i.Strip,i.Strip.prototype.setTexture=function(e){this.texture=e,this.width=e.frame.width,this.height=e.frame.height,this.updateFrame=!0},i.Strip.prototype.onTextureUpdate=function(e){this.updateFrame=!0},i.Rope=function(e,t){i.Strip.call(this,e),this.points=t;try{this.verticies=new Float32Array(4*t.length),this.uvs=new Float32Array(4*t.length),this.colors=new Float32Array(2*t.length),this.indices=new Uint16Array(2*t.length)}catch(e){this.verticies=verticies,this.uvs=uvs,this.colors=colors,this.indices=indices}this.refresh()},i.Rope.prototype=Object.create(i.Strip.prototype),i.Rope.prototype.constructor=i.Rope,i.Rope.prototype.refresh=function(){var e=this.points;if(!(e.length<1)){var t=this.uvs,n=this.indices,r=this.colors,i=e[0],o=e[0];this.count-=.2,t[0]=0,t[1]=1,t[2]=0,t[3]=1,r[0]=1,r[1]=1,n[0]=0,n[1]=1;for(var a=e.length,s=1;s<a;s++){var o=e[s],l=4*s,u=s/(a-1);s%2?(t[l]=u,t[l+1]=0,t[l+2]=u,t[l+3]=1):(t[l]=u,t[l+1]=0,t[l+2]=u,t[l+3]=1),l=2*s,r[l]=1,r[l+1]=1,l=2*s,n[l]=l,n[l+1]=l+1,i=o}}},i.Rope.prototype.updateTransform=function(){var e=this.points;if(!(e.length<1)){var t,n=this.verticies,r=e[0],o={x:0,y:0},a=e[0];this.count-=.2,n[0]=a.x+o.x,n[1]=a.y+o.y,n[2]=a.x-o.x,n[3]=a.y-o.y;for(var s=e.length,l=1;l<s;l++){var a=e[l],u=4*l;t=l<e.length-1?e[l+1]:a,o.y=-(t.x-r.x),o.x=t.y-r.y;var c=10*(1-l/(s-1));c>1&&(c=1);var d=Math.sqrt(o.x*o.x+o.y*o.y),p=this.texture.height/2;o.x/=d,o.y/=d,o.x*=p,o.y*=p,n[u]=a.x+o.x,n[u+1]=a.y+o.y,n[u+2]=a.x-o.x,n[u+3]=a.y-o.y,r=a}i.DisplayObjectContainer.prototype.updateTransform.call(this)}},i.Rope.prototype.setTexture=function(e){this.texture=e,this.updateFrame=!0},i.TilingSprite=function(e,t,n){i.DisplayObjectContainer.call(this),this.texture=e,this.width=t,this.height=n,this.tileScale=new i.Point(1,1),this.tilePosition=new i.Point(0,0),this.renderable=!0,this.blendMode=i.blendModes.NORMAL},i.TilingSprite.prototype=Object.create(i.DisplayObjectContainer.prototype),i.TilingSprite.prototype.constructor=i.TilingSprite,i.TilingSprite.prototype.setTexture=function(e){this.texture=e,this.updateFrame=!0},i.TilingSprite.prototype.onTextureUpdate=function(e){this.updateFrame=!0},i.Spine=function(e){if(i.DisplayObjectContainer.call(this),this.spineData=i.AnimCache[e],!this.spineData)throw new Error("Spine data must be preloaded using PIXI.SpineLoader or PIXI.AssetLoader: "+e);this.skeleton=new c.Skeleton(this.spineData),this.skeleton.updateWorldTransform(),this.stateData=new c.AnimationStateData(this.spineData),this.state=new c.AnimationState(this.stateData),this.slotContainers=[];for(var t=0,n=this.skeleton.drawOrder.length;t<n;t++){var r=this.skeleton.drawOrder[t],o=r.attachment,a=new i.DisplayObjectContainer;if(this.slotContainers.push(a),this.addChild(a),o instanceof c.RegionAttachment){var s=o.rendererObject.name,l=this.createSprite(r,o.rendererObject);r.currentSprite=l,r.currentSpriteName=s,a.addChild(l)}}},i.Spine.prototype=Object.create(i.DisplayObjectContainer.prototype),i.Spine.prototype.constructor=i.Spine,i.Spine.prototype.updateTransform=function(){this.lastTime=this.lastTime||Date.now();var e=.001*(Date.now()-this.lastTime);this.lastTime=Date.now(),this.state.update(e),this.state.apply(this.skeleton),this.skeleton.updateWorldTransform();for(var t=this.skeleton.drawOrder,n=0,r=t.length;n<r;n++){var o=t[n],a=o.attachment,s=this.slotContainers[n];if(a instanceof c.RegionAttachment){if(a.rendererObject&&(!o.currentSpriteName||o.currentSpriteName!=a.name)){var l=a.rendererObject.name;if(void 0!==o.currentSprite&&(o.currentSprite.visible=!1),o.sprites=o.sprites||{},void 0!==o.sprites[l])o.sprites[l].visible=!0;else{var u=this.createSprite(o,a.rendererObject);s.addChild(u)}o.currentSprite=o.sprites[l],o.currentSpriteName=l}s.visible=!0;var d=o.bone;s.position.x=d.worldX+a.x*d.m00+a.y*d.m01,s.position.y=d.worldY+a.x*d.m10+a.y*d.m11,s.scale.x=d.worldScaleX,s.scale.y=d.worldScaleY,s.rotation=-(o.bone.worldRotation*Math.PI/180)}else s.visible=!1}i.DisplayObjectContainer.prototype.updateTransform.call(this)},i.Spine.prototype.createSprite=function(e,t){var n=i.TextureCache[t.name]?t.name:t.name+".png",r=new i.Sprite(i.Texture.fromFrame(n));return r.scale=t.scale,r.rotation=t.rotation,r.anchor.x=r.anchor.y=.5,e.sprites=e.sprites||{},e.sprites[t.name]=r,r};var c={};c.BoneData=function(e,t){this.name=e,this.parent=t},c.BoneData.prototype={length:0,x:0,y:0,rotation:0,scaleX:1,scaleY:1},c.SlotData=function(e,t){this.name=e,this.boneData=t},c.SlotData.prototype={r:1,g:1,b:1,a:1,attachmentName:null},c.Bone=function(e,t){this.data=e,this.parent=t,this.setToSetupPose()},c.Bone.yDown=!1,c.Bone.prototype={x:0,y:0,rotation:0,scaleX:1,scaleY:1,m00:0,m01:0,worldX:0,m10:0,m11:0,worldY:0,worldRotation:0,worldScaleX:1,worldScaleY:1,updateWorldTransform:function(e,t){var n=this.parent;null!=n?(this.worldX=this.x*n.m00+this.y*n.m01+n.worldX,this.worldY=this.x*n.m10+this.y*n.m11+n.worldY,this.worldScaleX=n.worldScaleX*this.scaleX,this.worldScaleY=n.worldScaleY*this.scaleY,this.worldRotation=n.worldRotation+this.rotation):(this.worldX=this.x,this.worldY=this.y,this.worldScaleX=this.scaleX,this.worldScaleY=this.scaleY,this.worldRotation=this.rotation);var r=this.worldRotation*Math.PI/180,i=Math.cos(r),o=Math.sin(r);this.m00=i*this.worldScaleX,this.m10=o*this.worldScaleX,this.m01=-o*this.worldScaleY,this.m11=i*this.worldScaleY,e&&(this.m00=-this.m00,this.m01=-this.m01),t&&(this.m10=-this.m10,this.m11=-this.m11),c.Bone.yDown&&(this.m10=-this.m10,this.m11=-this.m11)},setToSetupPose:function(){var e=this.data;this.x=e.x,this.y=e.y,this.rotation=e.rotation,this.scaleX=e.scaleX,this.scaleY=e.scaleY}},c.Slot=function(e,t,n){this.data=e,this.skeleton=t,this.bone=n,this.setToSetupPose()},c.Slot.prototype={r:1,g:1,b:1,a:1,_attachmentTime:0,attachment:null,setAttachment:function(e){this.attachment=e,this._attachmentTime=this.skeleton.time},setAttachmentTime:function(e){this._attachmentTime=this.skeleton.time-e},getAttachmentTime:function(){return this.skeleton.time-this._attachmentTime},setToSetupPose:function(){var e=this.data;this.r=e.r,this.g=e.g,this.b=e.b,this.a=e.a;for(var t=this.skeleton.data.slots,n=0,r=t.length;n<r;n++)if(t[n]==e){this.setAttachment(e.attachmentName?this.skeleton.getAttachmentBySlotIndex(n,e.attachmentName):null);break}}},c.Skin=function(e){this.name=e,this.attachments={}},c.Skin.prototype={addAttachment:function(e,t,n){this.attachments[e+":"+t]=n},getAttachment:function(e,t){return this.attachments[e+":"+t]},_attachAll:function(e,t){for(var n in t.attachments){var r=n.indexOf(":"),i=parseInt(n.substring(0,r)),o=n.substring(r+1),a=e.slots[i];if(a.attachment&&a.attachment.name==o){var s=this.getAttachment(i,o);s&&a.setAttachment(s)}}}},c.Animation=function(e,t,n){this.name=e,this.timelines=t,this.duration=n},c.Animation.prototype={apply:function(e,t,n){n&&0!=this.duration&&(t%=this.duration);for(var r=this.timelines,i=0,o=r.length;i<o;i++)r[i].apply(e,t,1)},mix:function(e,t,n,r){n&&0!=this.duration&&(t%=this.duration);for(var i=this.timelines,o=0,a=i.length;o<a;o++)i[o].apply(e,t,r)}},c.binarySearch=function(e,t,n){var r=0,i=Math.floor(e.length/n)-2;if(0==i)return n;for(var o=i>>>1;;){if(e[(o+1)*n]<=t?r=o+1:i=o,r==i)return(r+1)*n;o=r+i>>>1}},c.linearSearch=function(e,t,n){for(var r=0,i=e.length-n;r<=i;r+=n)if(e[r]>t)return r;return-1},c.Curves=function(e){this.curves=[],this.curves.length=6*(e-1)},c.Curves.prototype={setLinear:function(e){this.curves[6*e]=0},setStepped:function(e){this.curves[6*e]=-1},setCurve:function(e,t,n,r,i){var o=.1,a=o*o,s=a*o,l=3*o,u=3*a,c=6*a,d=6*s,p=2*-t+r,f=2*-n+i,h=3*(t-r)+1,m=3*(n-i)+1,g=6*e,v=this.curves;v[g]=t*l+p*u+h*s,v[g+1]=n*l+f*u+m*s,v[g+2]=p*c+h*d,v[g+3]=f*c+m*d,v[g+4]=h*d,v[g+5]=m*d},getCurvePercent:function(e,t){t=t<0?0:t>1?1:t;var n=6*e,r=this.curves,i=r[n];if(!i)return t;if(i==-1)return 0;for(var o=r[n+1],a=r[n+2],s=r[n+3],l=r[n+4],u=r[n+5],c=i,d=o,p=8;;){if(c>=t){var f=c-i,h=d-o;return h+(d-h)*(t-f)/(c-f)}if(0==p)break;p--,i+=a,o+=s,a+=l,s+=u,c+=i,d+=o}return d+(1-d)*(t-c)/(1-c)}},c.RotateTimeline=function(e){this.curves=new c.Curves(e),this.frames=[],this.frames.length=2*e},c.RotateTimeline.prototype={boneIndex:0,getFrameCount:function(){return this.frames.length/2},setFrame:function(e,t,n){e*=2,this.frames[e]=t,this.frames[e+1]=n},apply:function(e,t,n){var r=this.frames;if(!(t<r[0])){var i=e.bones[this.boneIndex];if(t>=r[r.length-2]){for(var o=i.data.rotation+r[r.length-1]-i.rotation;o>180;)o-=360;for(;o<-180;)o+=360;return void(i.rotation+=o*n)}var a=c.binarySearch(r,t,2),s=r[a-1],l=r[a],u=1-(t-l)/(r[a-2]-l);u=this.curves.getCurvePercent(a/2-1,u);for(var o=r[a+1]-s;o>180;)o-=360;for(;o<-180;)o+=360;for(o=i.data.rotation+(s+o*u)-i.rotation;o>180;)o-=360;for(;o<-180;)o+=360;i.rotation+=o*n}}},c.TranslateTimeline=function(e){this.curves=new c.Curves(e),this.frames=[],this.frames.length=3*e},c.TranslateTimeline.prototype={boneIndex:0,getFrameCount:function(){return this.frames.length/3},setFrame:function(e,t,n,r){e*=3,this.frames[e]=t,this.frames[e+1]=n,this.frames[e+2]=r},apply:function(e,t,n){var r=this.frames;if(!(t<r[0])){var i=e.bones[this.boneIndex];if(t>=r[r.length-3])return i.x+=(i.data.x+r[r.length-2]-i.x)*n,void(i.y+=(i.data.y+r[r.length-1]-i.y)*n);var o=c.binarySearch(r,t,3),a=r[o-2],s=r[o-1],l=r[o],u=1-(t-l)/(r[o+-3]-l);u=this.curves.getCurvePercent(o/3-1,u),i.x+=(i.data.x+a+(r[o+1]-a)*u-i.x)*n,i.y+=(i.data.y+s+(r[o+2]-s)*u-i.y)*n}}},c.ScaleTimeline=function(e){this.curves=new c.Curves(e),this.frames=[],this.frames.length=3*e},c.ScaleTimeline.prototype={boneIndex:0,getFrameCount:function(){return this.frames.length/3},setFrame:function(e,t,n,r){e*=3,this.frames[e]=t,this.frames[e+1]=n,this.frames[e+2]=r},apply:function(e,t,n){var r=this.frames;if(!(t<r[0])){var i=e.bones[this.boneIndex];if(t>=r[r.length-3])return i.scaleX+=(i.data.scaleX-1+r[r.length-2]-i.scaleX)*n,void(i.scaleY+=(i.data.scaleY-1+r[r.length-1]-i.scaleY)*n);var o=c.binarySearch(r,t,3),a=r[o-2],s=r[o-1],l=r[o],u=1-(t-l)/(r[o+-3]-l);u=this.curves.getCurvePercent(o/3-1,u),i.scaleX+=(i.data.scaleX-1+a+(r[o+1]-a)*u-i.scaleX)*n,i.scaleY+=(i.data.scaleY-1+s+(r[o+2]-s)*u-i.scaleY)*n}}},c.ColorTimeline=function(e){this.curves=new c.Curves(e),this.frames=[],this.frames.length=5*e},c.ColorTimeline.prototype={slotIndex:0,getFrameCount:function(){return this.frames.length/2},setFrame:function(e,t,n,i){e*=5,this.frames[e]=t,this.frames[e+1]=r,this.frames[e+2]=g,this.frames[e+3]=b,this.frames[e+4]=a},apply:function(e,t,n){var r=this.frames;if(!(t<r[0])){var i=e.slots[this.slotIndex];if(t>=r[r.length-5]){var o=r.length-1;return i.r=r[o-3],i.g=r[o-2],i.b=r[o-1],void(i.a=r[o])}var a=c.binarySearch(r,t,5),s=r[a-4],l=r[a-3],u=r[a-2],d=r[a-1],p=r[a],f=1-(t-p)/(r[a-5]-p);f=this.curves.getCurvePercent(a/5-1,f);var h=s+(r[a+1]-s)*f,m=l+(r[a+2]-l)*f,g=u+(r[a+3]-u)*f,v=d+(r[a+4]-d)*f;n<1?(i.r+=(h-i.r)*n,i.g+=(m-i.g)*n,i.b+=(g-i.b)*n,i.a+=(v-i.a)*n):(i.r=h,i.g=m,i.b=g,i.a=v)}}},c.AttachmentTimeline=function(e){this.curves=new c.Curves(e),this.frames=[],this.frames.length=e,this.attachmentNames=[],this.attachmentNames.length=e},c.AttachmentTimeline.prototype={slotIndex:0,getFrameCount:function(){return this.frames.length},setFrame:function(e,t,n){this.frames[e]=t,this.attachmentNames[e]=n},apply:function(e,t,n){var r=this.frames;if(!(t<r[0])){var i;i=t>=r[r.length-1]?r.length-1:c.binarySearch(r,t,1)-1;var o=this.attachmentNames[i];e.slots[this.slotIndex].setAttachment(o?e.getAttachmentBySlotIndex(this.slotIndex,o):null)}}},c.SkeletonData=function(){this.bones=[],this.slots=[],this.skins=[],this.animations=[]},c.SkeletonData.prototype={defaultSkin:null,findBone:function(e){for(var t=this.bones,n=0,r=t.length;n<r;n++)if(t[n].name==e)return t[n];return null},findBoneIndex:function(e){for(var t=this.bones,n=0,r=t.length;n<r;n++)if(t[n].name==e)return n;return-1},findSlot:function(e){for(var t=this.slots,n=0,r=t.length;n<r;n++)if(t[n].name==e)return slot[n];return null},findSlotIndex:function(e){for(var t=this.slots,n=0,r=t.length;n<r;n++)if(t[n].name==e)return n;return-1},findSkin:function(e){for(var t=this.skins,n=0,r=t.length;n<r;n++)if(t[n].name==e)return t[n];return null},findAnimation:function(e){for(var t=this.animations,n=0,r=t.length;n<r;n++)if(t[n].name==e)return t[n];return null}},c.Skeleton=function(e){this.data=e,this.bones=[];for(var t=0,n=e.bones.length;t<n;t++){var r=e.bones[t],i=r.parent?this.bones[e.bones.indexOf(r.parent)]:null;this.bones.push(new c.Bone(r,i))}this.slots=[],this.drawOrder=[];for(var t=0,n=e.slots.length;t<n;t++){var o=e.slots[t],a=this.bones[e.bones.indexOf(o.boneData)],s=new c.Slot(o,this,a);this.slots.push(s),this.drawOrder.push(s)}},c.Skeleton.prototype={x:0,y:0,skin:null,r:1,g:1,b:1,a:1,time:0,flipX:!1,flipY:!1,updateWorldTransform:function(){for(var e=this.flipX,t=this.flipY,n=this.bones,r=0,i=n.length;r<i;r++)n[r].updateWorldTransform(e,t)},setToSetupPose:function(){this.setBonesToSetupPose(),this.setSlotsToSetupPose()},setBonesToSetupPose:function(){for(var e=this.bones,t=0,n=e.length;t<n;t++)e[t].setToSetupPose()},setSlotsToSetupPose:function(){for(var e=this.slots,t=0,n=e.length;t<n;t++)e[t].setToSetupPose(t)},getRootBone:function(){return 0==this.bones.length?null:this.bones[0]},findBone:function(e){for(var t=this.bones,n=0,r=t.length;n<r;n++)if(t[n].data.name==e)return t[n];return null},findBoneIndex:function(e){for(var t=this.bones,n=0,r=t.length;n<r;n++)if(t[n].data.name==e)return n;return-1},findSlot:function(e){for(var t=this.slots,n=0,r=t.length;n<r;n++)if(t[n].data.name==e)return t[n];return null},findSlotIndex:function(e){for(var t=this.slots,n=0,r=t.length;n<r;n++)if(t[n].data.name==e)return n;return-1},setSkinByName:function(e){var t=this.data.findSkin(e);if(!t)throw"Skin not found: "+e;this.setSkin(t)},setSkin:function(e){this.skin&&e&&e._attachAll(this,this.skin),this.skin=e},getAttachmentBySlotName:function(e,t){return this.getAttachmentBySlotIndex(this.data.findSlotIndex(e),t)},getAttachmentBySlotIndex:function(e,t){if(this.skin){var n=this.skin.getAttachment(e,t);if(n)return n}return this.data.defaultSkin?this.data.defaultSkin.getAttachment(e,t):null},setAttachment:function(e,t){for(var n=this.slots,r=0,i=n.size;r<i;r++){var o=n[r];if(o.data.name==e){var a=null;if(t&&(a=this.getAttachment(r,t),null==a))throw"Attachment not found: "+t+", for slot: "+e;return void o.setAttachment(a)}}throw"Slot not found: "+e},update:function(e){time+=e}},c.AttachmentType={region:0},c.RegionAttachment=function(){this.offset=[],this.offset.length=8,this.uvs=[],this.uvs.length=8},c.RegionAttachment.prototype={x:0,y:0,rotation:0,scaleX:1,scaleY:1,width:0,height:0,rendererObject:null,regionOffsetX:0,regionOffsetY:0,regionWidth:0,regionHeight:0,regionOriginalWidth:0,regionOriginalHeight:0,setUVs:function(e,t,n,r,i){var o=this.uvs;i?(o[2]=e,o[3]=r,o[4]=e,o[5]=t,o[6]=n,o[7]=t,o[0]=n,o[1]=r):(o[0]=e,o[1]=r,o[2]=e,o[3]=t,o[4]=n,o[5]=t,o[6]=n,o[7]=r)},updateOffset:function(){var e=this.width/this.regionOriginalWidth*this.scaleX,t=this.height/this.regionOriginalHeight*this.scaleY,n=-this.width/2*this.scaleX+this.regionOffsetX*e,r=-this.height/2*this.scaleY+this.regionOffsetY*t,i=n+this.regionWidth*e,o=r+this.regionHeight*t,a=this.rotation*Math.PI/180,s=Math.cos(a),l=Math.sin(a),u=n*s+this.x,c=n*l,d=r*s+this.y,p=r*l,f=i*s+this.x,h=i*l,m=o*s+this.y,g=o*l,v=this.offset;v[0]=u-p,v[1]=d+c,v[2]=u-g,v[3]=m+c,v[4]=f-g,v[5]=m+h,v[6]=f-p,v[7]=d+h},computeVertices:function(e,t,n,r){e+=n.worldX,t+=n.worldY;var i=n.m00,o=n.m01,a=n.m10,s=n.m11,l=this.offset;r[0]=l[0]*i+l[1]*o+e,r[1]=l[0]*a+l[1]*s+t,r[2]=l[2]*i+l[3]*o+e,r[3]=l[2]*a+l[3]*s+t,r[4]=l[4]*i+l[5]*o+e,r[5]=l[4]*a+l[5]*s+t,r[6]=l[6]*i+l[7]*o+e,r[7]=l[6]*a+l[7]*s+t}},c.AnimationStateData=function(e){this.skeletonData=e,this.animationToMixTime={}},c.AnimationStateData.prototype={defaultMix:0,setMixByName:function(e,t,n){var r=this.skeletonData.findAnimation(e);if(!r)throw"Animation not found: "+e;var i=this.skeletonData.findAnimation(t);if(!i)throw"Animation not found: "+t;this.setMix(r,i,n)},setMix:function(e,t,n){this.animationToMixTime[e.name+":"+t.name]=n},getMix:function(e,t){var n=this.animationToMixTime[e.name+":"+t.name];return n?n:this.defaultMix}},c.AnimationState=function(e){this.data=e,this.queue=[]},c.AnimationState.prototype={current:null,previous:null,currentTime:0,previousTime:0,currentLoop:!1,previousLoop:!1,mixTime:0,mixDuration:0,update:function(e){if(this.currentTime+=e,this.previousTime+=e,this.mixTime+=e,this.queue.length>0){var t=this.queue[0];this.currentTime>=t.delay&&(this._setAnimation(t.animation,t.loop),this.queue.shift())}},apply:function(e){if(this.current)if(this.previous){this.previous.apply(e,this.previousTime,this.previousLoop);var t=this.mixTime/this.mixDuration;t>=1&&(t=1,this.previous=null),this.current.mix(e,this.currentTime,this.currentLoop,t)}else this.current.apply(e,this.currentTime,this.currentLoop)},clearAnimation:function(){this.previous=null,this.current=null,this.queue.length=0},_setAnimation:function(e,t){this.previous=null,e&&this.current&&(this.mixDuration=this.data.getMix(this.current,e),this.mixDuration>0&&(this.mixTime=0,this.previous=this.current,this.previousTime=this.currentTime,this.previousLoop=this.currentLoop)),this.current=e,this.currentLoop=t,this.currentTime=0},setAnimationByName:function(e,t){var n=this.data.skeletonData.findAnimation(e);if(!n)throw"Animation not found: "+e;this.setAnimation(n,t)},setAnimation:function(e,t){this.queue.length=0,this._setAnimation(e,t)},addAnimationByName:function(e,t,n){var r=this.data.skeletonData.findAnimation(e);if(!r)throw"Animation not found: "+e;this.addAnimation(r,t,n)},addAnimation:function(e,t,n){var r={};if(r.animation=e,r.loop=t,!n||n<=0){var i=0==this.queue.length?this.current:this.queue[this.queue.length-1].animation;n=null!=i?i.duration-this.data.getMix(i,e)+(n||0):0}r.delay=n,this.queue.push(r)},isComplete:function(){return!this.current||this.currentTime>=this.current.duration}},c.SkeletonJson=function(e){this.attachmentLoader=e},c.SkeletonJson.prototype={scale:1,readSkeletonData:function(e){for(var t=new c.SkeletonData,n=e.bones,r=0,i=n.length;r<i;r++){var o=n[r],a=null;if(o.parent&&(a=t.findBone(o.parent),!a))throw"Parent bone not found: "+o.parent;var s=new c.BoneData(o.name,a);s.length=(o.length||0)*this.scale,s.x=(o.x||0)*this.scale,s.y=(o.y||0)*this.scale,s.rotation=o.rotation||0,s.scaleX=o.scaleX||1,s.scaleY=o.scaleY||1,t.bones.push(s)}for(var l=e.slots,r=0,i=l.length;r<i;r++){var u=l[r],s=t.findBone(u.bone);if(!s)throw"Slot bone not found: "+u.bone;var d=new c.SlotData(u.name,s),p=u.color;p&&(d.r=c.SkeletonJson.toColor(p,0),d.g=c.SkeletonJson.toColor(p,1),d.b=c.SkeletonJson.toColor(p,2),d.a=c.SkeletonJson.toColor(p,3)),d.attachmentName=u.attachment,t.slots.push(d)}var f=e.skins;for(var h in f)if(f.hasOwnProperty(h)){var m=f[h],g=new c.Skin(h);for(var v in m)if(m.hasOwnProperty(v)){var y=t.findSlotIndex(v),b=m[v];for(var _ in b)if(b.hasOwnProperty(_)){var x=this.readAttachment(g,_,b[_]);null!=x&&g.addAttachment(y,_,x)}}t.skins.push(g),"default"==g.name&&(t.defaultSkin=g)}var w=e.animations;for(var C in w)w.hasOwnProperty(C)&&this.readAnimation(C,w[C],t);return t},readAttachment:function(e,t,n){t=n.name||t;var r=c.AttachmentType[n.type||"region"];if(r==c.AttachmentType.region){var i=new c.RegionAttachment;return i.x=(n.x||0)*this.scale,i.y=(n.y||0)*this.scale,i.scaleX=n.scaleX||1,i.scaleY=n.scaleY||1,i.rotation=n.rotation||0,i.width=(n.width||32)*this.scale,i.height=(n.height||32)*this.scale,i.updateOffset(),i.rendererObject={},i.rendererObject.name=t,i.rendererObject.scale={},i.rendererObject.scale.x=i.scaleX,i.rendererObject.scale.y=i.scaleY,i.rendererObject.rotation=-i.rotation*Math.PI/180,i}throw"Unknown attachment type: "+r},readAnimation:function(e,t,n){var r=[],i=0,o=t.bones;for(var a in o)if(o.hasOwnProperty(a)){var s=n.findBoneIndex(a);if(s==-1)throw"Bone not found: "+a;var l=o[a];for(var u in l)if(l.hasOwnProperty(u)){var d=l[u];if("rotate"==u){var p=new c.RotateTimeline(d.length);p.boneIndex=s;for(var f=0,h=0,m=d.length;h<m;h++){var g=d[h];p.setFrame(f,g.time,g.angle),c.SkeletonJson.readCurve(p,f,g),f++}r.push(p),i=Math.max(i,p.frames[2*p.getFrameCount()-2])}else{if("translate"!=u&&"scale"!=u)throw"Invalid timeline type for a bone: "+u+" ("+a+")";var p,v=1;"scale"==u?p=new c.ScaleTimeline(d.length):(p=new c.TranslateTimeline(d.length),v=this.scale),p.boneIndex=s;for(var f=0,h=0,m=d.length;h<m;h++){var g=d[h],y=(g.x||0)*v,b=(g.y||0)*v;p.setFrame(f,g.time,y,b),c.SkeletonJson.readCurve(p,f,g),f++}r.push(p),i=Math.max(i,p.frames[3*p.getFrameCount()-3])}}}var _=t.slots;for(var x in _)if(_.hasOwnProperty(x)){var w=_[x],C=n.findSlotIndex(x);for(var u in w)if(w.hasOwnProperty(u)){var d=w[u];if("color"==u){var p=new c.ColorTimeline(d.length);p.slotIndex=C;for(var f=0,h=0,m=d.length;h<m;h++){var g=d[h],T=g.color,S=c.SkeletonJson.toColor(T,0),A=c.SkeletonJson.toColor(T,1),k=c.SkeletonJson.toColor(T,2),P=c.SkeletonJson.toColor(T,3);p.setFrame(f,g.time,S,A,k,P),c.SkeletonJson.readCurve(p,f,g),f++}r.push(p),i=Math.max(i,p.frames[5*p.getFrameCount()-5])}else{if("attachment"!=u)throw"Invalid timeline type for a slot: "+u+" ("+x+")";var p=new c.AttachmentTimeline(d.length);p.slotIndex=C;for(var f=0,h=0,m=d.length;h<m;h++){var g=d[h];p.setFrame(f++,g.time,g.name)}r.push(p),i=Math.max(i,p.frames[p.getFrameCount()-1])}}}n.animations.push(new c.Animation(e,r,i))}},c.SkeletonJson.readCurve=function(e,t,n){var r=n.curve;r&&("stepped"==r?e.curves.setStepped(t):r instanceof Array&&e.curves.setCurve(t,r[0],r[1],r[2],r[3]))},c.SkeletonJson.toColor=function(e,t){if(8!=e.length)throw"Color hexidecimal length must be 8, recieved: "+e;return parseInt(e.substring(2*t,2),16)/255},c.Atlas=function(e,t){this.textureLoader=t,this.pages=[],this.regions=[];var n=new c.AtlasReader(e),r=[];r.length=4;for(var i=null;;){var o=n.readLine();if(null==o)break;if(o=n.trim(o),0==o.length)i=null;else if(i){var a=new c.AtlasRegion;a.name=o,a.page=i,a.rotate="true"==n.readValue(),n.readTuple(r);var s=parseInt(r[0]),l=parseInt(r[1]);n.readTuple(r);var u=parseInt(r[0]),d=parseInt(r[1]);a.u=s/i.width,a.v=l/i.height,a.rotate?(a.u2=(s+d)/i.width,a.v2=(l+u)/i.height):(a.u2=(s+u)/i.width,a.v2=(l+d)/i.height),a.x=s,a.y=l,a.width=Math.abs(u),a.height=Math.abs(d),4==n.readTuple(r)&&(a.splits=[parseInt(r[0]),parseInt(r[1]),parseInt(r[2]),parseInt(r[3])],4==n.readTuple(r)&&(a.pads=[parseInt(r[0]),parseInt(r[1]),parseInt(r[2]),parseInt(r[3])],n.readTuple(r))),a.originalWidth=parseInt(r[0]),a.originalHeight=parseInt(r[1]),n.readTuple(r),a.offsetX=parseInt(r[0]),a.offsetY=parseInt(r[1]),a.index=parseInt(n.readValue()),this.regions.push(a)}else{i=new c.AtlasPage,i.name=o,i.format=c.Atlas.Format[n.readValue()],n.readTuple(r),i.minFilter=c.Atlas.TextureFilter[r[0]],i.magFilter=c.Atlas.TextureFilter[r[1]];var p=n.readValue();i.uWrap=c.Atlas.TextureWrap.clampToEdge,i.vWrap=c.Atlas.TextureWrap.clampToEdge,"x"==p?i.uWrap=c.Atlas.TextureWrap.repeat:"y"==p?i.vWrap=c.Atlas.TextureWrap.repeat:"xy"==p&&(i.uWrap=i.vWrap=c.Atlas.TextureWrap.repeat),t.load(i,o),this.pages.push(i)}}},c.Atlas.prototype={findRegion:function(e){for(var t=this.regions,n=0,r=t.length;n<r;n++)if(t[n].name==e)return t[n];return null},dispose:function(){for(var e=this.pages,t=0,n=e.length;t<n;t++)this.textureLoader.unload(e[t].rendererObject)},updateUVs:function(e){for(var t=this.regions,n=0,r=t.length;n<r;n++){var i=t[n];i.page==e&&(i.u=i.x/e.width,i.v=i.y/e.height,i.rotate?(i.u2=(i.x+i.height)/e.width,i.v2=(i.y+i.width)/e.height):(i.u2=(i.x+i.width)/e.width,i.v2=(i.y+i.height)/e.height))}}},c.Atlas.Format={alpha:0,intensity:1,luminanceAlpha:2,rgb565:3,rgba4444:4,rgb888:5,rgba8888:6},c.Atlas.TextureFilter={nearest:0,linear:1,mipMap:2,mipMapNearestNearest:3,mipMapLinearNearest:4,mipMapNearestLinear:5,mipMapLinearLinear:6},c.Atlas.TextureWrap={mirroredRepeat:0,clampToEdge:1,repeat:2},c.AtlasPage=function(){},c.AtlasPage.prototype={name:null,format:null,minFilter:null,magFilter:null,uWrap:null,vWrap:null,rendererObject:null,width:0,height:0},c.AtlasRegion=function(){},c.AtlasRegion.prototype={page:null,name:null,x:0,y:0,width:0,height:0,u:0,v:0,u2:0,v2:0,offsetX:0,offsetY:0,originalWidth:0,originalHeight:0,index:0,rotate:!1,splits:null,pads:null},c.AtlasReader=function(e){this.lines=e.split(/\r\n|\r|\n/)},c.AtlasReader.prototype={index:0,trim:function(e){return e.replace(/^\s+|\s+$/g,"")},readLine:function(){return this.index>=this.lines.length?null:this.lines[this.index++]},readValue:function(){var e=this.readLine(),t=e.indexOf(":");if(t==-1)throw"Invalid line: "+e;return this.trim(e.substring(t+1))},readTuple:function(e){var t=this.readLine(),n=t.indexOf(":");if(n==-1)throw"Invalid line: "+t;for(var r=0,i=n+1;r<3;r++){var o=t.indexOf(",",i);if(o==-1){if(0==r)throw"Invalid line: "+t;break}e[r]=this.trim(t.substr(i,o-i)),i=o+1}return e[r]=this.trim(t.substring(i)),r+1}},c.AtlasAttachmentLoader=function(e){this.atlas=e},c.AtlasAttachmentLoader.prototype={newAttachment:function(e,t,n){switch(t){case c.AttachmentType.region:var r=this.atlas.findRegion(n);if(!r)throw"Region not found in atlas: "+n+" ("+t+")";var i=new c.RegionAttachment(n);return i.rendererObject=r,i.setUVs(r.u,r.v,r.u2,r.v2,r.rotate),i.regionOffsetX=r.offsetX,i.regionOffsetY=r.offsetY,i.regionWidth=r.width,i.regionHeight=r.height,i.regionOriginalWidth=r.originalWidth,i.regionOriginalHeight=r.originalHeight,i}throw"Unknown attachment type: "+t}},i.AnimCache={},c.Bone.yDown=!0,i.CustomRenderable=function(){i.DisplayObject.call(this)},i.CustomRenderable.prototype=Object.create(i.DisplayObject.prototype),i.CustomRenderable.prototype.constructor=i.CustomRenderable,i.CustomRenderable.prototype.renderCanvas=function(e){},i.CustomRenderable.prototype.initWebGL=function(e){},i.CustomRenderable.prototype.renderWebGL=function(e,t){},i.BaseTextureCache={},i.texturesToUpdate=[],i.texturesToDestroy=[],i.BaseTexture=function(e){if(i.EventTarget.call(this),this.width=100,this.height=100,this.hasLoaded=!1,this.source=e,e){if(this.source instanceof Image||this.source instanceof HTMLImageElement)if(this.source.complete)this.hasLoaded=!0,this.width=this.source.width,this.height=this.source.height,i.texturesToUpdate.push(this);else{var t=this;this.source.onload=function(){t.hasLoaded=!0,t.width=t.source.width,t.height=t.source.height,i.texturesToUpdate.push(t),t.dispatchEvent({type:"loaded",content:t})}}else this.hasLoaded=!0,this.width=this.source.width,this.height=this.source.height,i.texturesToUpdate.push(this);this._powerOf2=!1}},i.BaseTexture.prototype.constructor=i.BaseTexture,i.BaseTexture.prototype.destroy=function(){this.source instanceof Image&&(this.source.src=null),this.source=null,i.texturesToDestroy.push(this)},i.BaseTexture.fromImage=function(e,t){var n=i.BaseTextureCache[e];if(!n){var r=new Image;t&&(r.crossOrigin=""),r.src=e,n=new i.BaseTexture(r),i.BaseTextureCache[e]=n}return n},i.TextureCache={},i.FrameCache={},i.Texture=function(e,t){if(i.EventTarget.call(this),t||(this.noFrame=!0,t=new i.Rectangle(0,0,1,1)),e instanceof i.Texture&&(e=e.baseTexture),this.baseTexture=e,this.frame=t,this.trim=new i.Point,this.scope=this,e.hasLoaded)this.noFrame&&(t=new i.Rectangle(0,0,e.width,e.height)),this.setFrame(t);else{var n=this;e.addEventListener("loaded",function(){n.onBaseTextureLoaded()})}},i.Texture.prototype.constructor=i.Texture,i.Texture.prototype.onBaseTextureLoaded=function(e){
var t=this.baseTexture;t.removeEventListener("loaded",this.onLoaded),this.noFrame&&(this.frame=new i.Rectangle(0,0,t.width,t.height)),this.noFrame=!1,this.width=this.frame.width,this.height=this.frame.height,this.scope.dispatchEvent({type:"update",content:this})},i.Texture.prototype.destroy=function(e){e&&this.baseTexture.destroy()},i.Texture.prototype.setFrame=function(e){if(this.frame=e,this.width=e.width,this.height=e.height,e.x+e.width>this.baseTexture.width||e.y+e.height>this.baseTexture.height)throw new Error("Texture Error: frame does not fit inside the base Texture dimensions "+this);this.updateFrame=!0,i.Texture.frameUpdates.push(this)},i.Texture.fromImage=function(e,t){var n=i.TextureCache[e];return n||(n=new i.Texture(i.BaseTexture.fromImage(e,t)),i.TextureCache[e]=n),n},i.Texture.fromFrame=function(e){var t=i.TextureCache[e];if(!t)throw new Error("The frameId '"+e+"' does not exist in the texture cache "+this);return t},i.Texture.fromCanvas=function(e){var t=new i.BaseTexture(e);return new i.Texture(t)},i.Texture.addTextureToCache=function(e,t){i.TextureCache[t]=e},i.Texture.removeTextureFromCache=function(e){var t=i.TextureCache[e];return i.TextureCache[e]=null,t},i.Texture.frameUpdates=[],i.RenderTexture=function(e,t){i.EventTarget.call(this),this.width=e||100,this.height=t||100,this.indetityMatrix=i.mat3.create(),this.frame=new i.Rectangle(0,0,this.width,this.height),i.gl?this.initWebGL():this.initCanvas()},i.RenderTexture.prototype=Object.create(i.Texture.prototype),i.RenderTexture.prototype.constructor=i.RenderTexture,i.RenderTexture.prototype.initWebGL=function(){var e=i.gl;this.glFramebuffer=e.createFramebuffer(),e.bindFramebuffer(e.FRAMEBUFFER,this.glFramebuffer),this.glFramebuffer.width=this.width,this.glFramebuffer.height=this.height,this.baseTexture=new i.BaseTexture,this.baseTexture.width=this.width,this.baseTexture.height=this.height,this.baseTexture._glTexture=e.createTexture(),e.bindTexture(e.TEXTURE_2D,this.baseTexture._glTexture),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,this.width,this.height,0,e.RGBA,e.UNSIGNED_BYTE,null),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),this.baseTexture.isRender=!0,e.bindFramebuffer(e.FRAMEBUFFER,this.glFramebuffer),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,this.baseTexture._glTexture,0),this.projection=new i.Point(this.width/2,this.height/2),this.render=this.renderWebGL},i.RenderTexture.prototype.resize=function(e,t){if(this.width=e,this.height=t,i.gl){this.projection.x=this.width/2,this.projection.y=this.height/2;var n=i.gl;n.bindTexture(n.TEXTURE_2D,this.baseTexture._glTexture),n.texImage2D(n.TEXTURE_2D,0,n.RGBA,this.width,this.height,0,n.RGBA,n.UNSIGNED_BYTE,null)}else this.frame.width=this.width,this.frame.height=this.height,this.renderer.resize(this.width,this.height)},i.RenderTexture.prototype.initCanvas=function(){this.renderer=new i.CanvasRenderer(this.width,this.height,null,0),this.baseTexture=new i.BaseTexture(this.renderer.view),this.frame=new i.Rectangle(0,0,this.width,this.height),this.render=this.renderCanvas},i.RenderTexture.prototype.renderWebGL=function(e,t,n){var r=i.gl;r.colorMask(!0,!0,!0,!0),r.viewport(0,0,this.width,this.height),r.bindFramebuffer(r.FRAMEBUFFER,this.glFramebuffer),n&&(r.clearColor(0,0,0,0),r.clear(r.COLOR_BUFFER_BIT));var o=e.children,a=e.worldTransform;e.worldTransform=i.mat3.create(),e.worldTransform[4]=-1,e.worldTransform[5]=2*this.projection.y,t&&(e.worldTransform[2]=t.x,e.worldTransform[5]-=t.y),i.visibleCount++,e.vcount=i.visibleCount;for(var s=0,l=o.length;s<l;s++)o[s].updateTransform();var u=e.__renderGroup;u?e==u.root?u.render(this.projection):u.renderSpecific(e,this.projection):(this.renderGroup||(this.renderGroup=new i.WebGLRenderGroup(r)),this.renderGroup.setRenderable(e),this.renderGroup.render(this.projection)),e.worldTransform=a},i.RenderTexture.prototype.renderCanvas=function(e,t,n){var r=e.children;e.worldTransform=i.mat3.create(),t&&(e.worldTransform[2]=t.x,e.worldTransform[5]=t.y);for(var o=0,a=r.length;o<a;o++)r[o].updateTransform();n&&this.renderer.context.clearRect(0,0,this.width,this.height),this.renderer.renderDisplayObject(e),this.renderer.context.setTransform(1,0,0,1,0,0)},i.AssetLoader=function(e,t){i.EventTarget.call(this),this.assetURLs=e,this.crossorigin=t,this.loadersByType={jpg:i.ImageLoader,jpeg:i.ImageLoader,png:i.ImageLoader,gif:i.ImageLoader,json:i.JsonLoader,anim:i.SpineLoader,xml:i.BitmapFontLoader,fnt:i.BitmapFontLoader}},i.AssetLoader.prototype.constructor=i.AssetLoader,i.AssetLoader.prototype.load=function(){var e=this;this.loadCount=this.assetURLs.length;for(var t=0;t<this.assetURLs.length;t++){var n=this.assetURLs[t],r=n.split(".").pop().toLowerCase(),i=this.loadersByType[r];if(!i)throw new Error(r+" is an unsupported file type");var o=new i(n,this.crossorigin);o.addEventListener("loaded",function(){e.onAssetLoaded()}),o.load()}},i.AssetLoader.prototype.onAssetLoaded=function(){this.loadCount--,this.dispatchEvent({type:"onProgress",content:this}),this.onProgress&&this.onProgress(),0==this.loadCount&&(this.dispatchEvent({type:"onComplete",content:this}),this.onComplete&&this.onComplete())},i.JsonLoader=function(e,t){i.EventTarget.call(this),this.url=e,this.crossorigin=t,this.baseUrl=e.replace(/[^\/]*$/,""),this.loaded=!1},i.JsonLoader.prototype.constructor=i.JsonLoader,i.JsonLoader.prototype.load=function(){this.ajaxRequest=new u;var e=this;this.ajaxRequest.onreadystatechange=function(){e.onJSONLoaded()},this.ajaxRequest.open("GET",this.url,!0),this.ajaxRequest.overrideMimeType&&this.ajaxRequest.overrideMimeType("application/json"),this.ajaxRequest.send(null)},i.JsonLoader.prototype.onJSONLoaded=function(){if(4==this.ajaxRequest.readyState)if(200==this.ajaxRequest.status||window.location.href.indexOf("http")==-1)if(this.json=JSON.parse(this.ajaxRequest.responseText),this.json.frames){var e=this,t=this.baseUrl+this.json.meta.image,n=new i.ImageLoader(t,this.crossorigin),r=this.json.frames;this.texture=n.texture.baseTexture,n.addEventListener("loaded",function(t){e.onLoaded()});for(var o in r){var a=r[o].frame;a&&(i.TextureCache[o]=new i.Texture(this.texture,{x:a.x,y:a.y,width:a.w,height:a.h}),r[o].trimmed&&(i.TextureCache[o].realSize=r[o].spriteSourceSize,i.TextureCache[o].trim.x=0))}n.load()}else if(this.json.bones){var s=new c.SkeletonJson,l=s.readSkeletonData(this.json);i.AnimCache[this.url]=l,this.onLoaded()}else this.onLoaded();else this.onError()},i.JsonLoader.prototype.onLoaded=function(){this.loaded=!0,this.dispatchEvent({type:"loaded",content:this})},i.JsonLoader.prototype.onError=function(){this.dispatchEvent({type:"error",content:this})},i.SpriteSheetLoader=function(e,t){i.EventTarget.call(this),this.url=e,this.crossorigin=t,this.baseUrl=e.replace(/[^\/]*$/,""),this.texture=null,this.frames={}},i.SpriteSheetLoader.prototype.constructor=i.SpriteSheetLoader,i.SpriteSheetLoader.prototype.load=function(){var e=this,t=new i.JsonLoader(this.url,this.crossorigin);t.addEventListener("loaded",function(t){e.json=t.content.json,e.onJSONLoaded()}),t.load()},i.SpriteSheetLoader.prototype.onJSONLoaded=function(){var e=this,t=this.baseUrl+this.json.meta.image,n=new i.ImageLoader(t,this.crossorigin),r=this.json.frames;this.texture=n.texture.baseTexture,n.addEventListener("loaded",function(t){e.onLoaded()});for(var o in r){var a=r[o].frame;a&&(i.TextureCache[o]=new i.Texture(this.texture,{x:a.x,y:a.y,width:a.w,height:a.h}),r[o].trimmed&&(i.TextureCache[o].realSize=r[o].spriteSourceSize,i.TextureCache[o].trim.x=0))}n.load()},i.SpriteSheetLoader.prototype.onLoaded=function(){this.dispatchEvent({type:"loaded",content:this})},i.ImageLoader=function(e,t){i.EventTarget.call(this),this.texture=i.Texture.fromImage(e,t)},i.ImageLoader.prototype.constructor=i.ImageLoader,i.ImageLoader.prototype.load=function(){if(this.texture.baseTexture.hasLoaded)this.onLoaded();else{var e=this;this.texture.baseTexture.addEventListener("loaded",function(){e.onLoaded()})}},i.ImageLoader.prototype.onLoaded=function(){this.dispatchEvent({type:"loaded",content:this})},i.BitmapFontLoader=function(e,t){i.EventTarget.call(this),this.url=e,this.crossorigin=t,this.baseUrl=e.replace(/[^\/]*$/,""),this.texture=null},i.BitmapFontLoader.prototype.constructor=i.BitmapFontLoader,i.BitmapFontLoader.prototype.load=function(){this.ajaxRequest=new XMLHttpRequest;var e=this;this.ajaxRequest.onreadystatechange=function(){e.onXMLLoaded()},this.ajaxRequest.open("GET",this.url,!0),this.ajaxRequest.overrideMimeType&&this.ajaxRequest.overrideMimeType("application/xml"),this.ajaxRequest.send(null)},i.BitmapFontLoader.prototype.onXMLLoaded=function(){if(4==this.ajaxRequest.readyState&&(200==this.ajaxRequest.status||window.location.href.indexOf("http")==-1)){var e=this.baseUrl+this.ajaxRequest.responseXML.getElementsByTagName("page")[0].attributes.getNamedItem("file").nodeValue,t=new i.ImageLoader(e,this.crossorigin);this.texture=t.texture.baseTexture;var n={},r=this.ajaxRequest.responseXML.getElementsByTagName("info")[0],o=this.ajaxRequest.responseXML.getElementsByTagName("common")[0];n.font=r.attributes.getNamedItem("face").nodeValue,n.size=parseInt(r.attributes.getNamedItem("size").nodeValue,10),n.lineHeight=parseInt(o.attributes.getNamedItem("lineHeight").nodeValue,10),n.chars={};for(var a=this.ajaxRequest.responseXML.getElementsByTagName("char"),s=0;s<a.length;s++){var l=parseInt(a[s].attributes.getNamedItem("id").nodeValue,10),u={x:parseInt(a[s].attributes.getNamedItem("x").nodeValue,10),y:parseInt(a[s].attributes.getNamedItem("y").nodeValue,10),width:parseInt(a[s].attributes.getNamedItem("width").nodeValue,10),height:parseInt(a[s].attributes.getNamedItem("height").nodeValue,10)};i.TextureCache[l]=new i.Texture(this.texture,u),n.chars[l]={xOffset:parseInt(a[s].attributes.getNamedItem("xoffset").nodeValue,10),yOffset:parseInt(a[s].attributes.getNamedItem("yoffset").nodeValue,10),xAdvance:parseInt(a[s].attributes.getNamedItem("xadvance").nodeValue,10),kerning:{},texture:new i.Texture(this.texture,u)}}var c=this.ajaxRequest.responseXML.getElementsByTagName("kerning");for(s=0;s<c.length;s++){var d=parseInt(c[s].attributes.getNamedItem("first").nodeValue,10),p=parseInt(c[s].attributes.getNamedItem("second").nodeValue,10),f=parseInt(c[s].attributes.getNamedItem("amount").nodeValue,10);n.chars[p].kerning[d]=f}i.BitmapText.fonts[n.font]=n;var h=this;t.addEventListener("loaded",function(){h.onLoaded()}),t.load()}},i.BitmapFontLoader.prototype.onLoaded=function(){this.dispatchEvent({type:"loaded",content:this})},i.SpineLoader=function(e,t){i.EventTarget.call(this),this.url=e,this.crossorigin=t,this.loaded=!1},i.SpineLoader.prototype.constructor=i.SpineLoader,i.SpineLoader.prototype.load=function(){var e=this,t=new i.JsonLoader(this.url,this.crossorigin);t.addEventListener("loaded",function(t){e.json=t.content.json,e.onJSONLoaded()}),t.load()},i.SpineLoader.prototype.onJSONLoaded=function(e){var t=new c.SkeletonJson,n=t.readSkeletonData(this.json);i.AnimCache[this.url]=n,this.onLoaded()},i.SpineLoader.prototype.onLoaded=function(){this.loaded=!0,this.dispatchEvent({type:"loaded",content:this})},"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=i),exports.PIXI=i):n.PIXI=i}.call(this),define("pixi",function(e){return function(){var t;return t||e.PIXI}}(this)),define("common/views/svg-container",["require","common/performance","common/benchmark/benchmark","common/views/tab-index","common/views/hit-testing-helper","common/console","pixi"],function(e){function t(e,n){if(null==t.instance){var i,o=r.browser;i="Firefox"===o.browser&&o.oscpu.match(/Mac OS X 10.6/)?function(e,t,n,r){return new s.CanvasRenderer(e,t,n,r)}:s.autoDetectRenderer,t.instance=i(e*l,n*l,null,!0)}else t.instance.resize(e,n);return t.instance}var n=e("common/performance"),r=e("common/benchmark/benchmark"),i=e("common/views/tab-index"),o=e("common/views/hit-testing-helper"),a=e("common/console"),s=e("pixi"),l=2,u=1e3;return t.instance=null,function(e,r,c,d){function p(){return Q++}function f(){return parseFloat(A.css("font-size"))||18}function h(){var t,n,r=e.get("viewPortWidth"),i=e.get("viewPortHeight"),o=e.get("viewPortX"),a=e.get("viewPortY");G=e.get("viewPortZoom")||1,n={minX:e.get("minX"),minY:e.get("minY"),maxX:e.get("maxX"),maxY:e.get("maxY")},z={width:null!=r?r:n.maxX-n.minX,height:null!=i?i:n.maxY-n.minY,x:null!=o?o:n.minX,y:null!=a?a:n.minY},z.scaledWidth=z.width/G,z.scaledHeight=z.height/G,"bottom-left"===X&&(z.y+=z.scaledHeight),t=z.width/z.height,j=A.width(),F=j/t,k.style.height=F+"px",Z.domain([0,z.width]).range([0,j]),K.domain([0,z.scaledWidth]).range([0,j*l]),ee.domain([z.height,0]).range("bottom-left"===X?[0,F]:[F,0]),J.domain([z.scaledHeight,0]).range("bottom-left"===X?[0,F*l]:[F*l,0]),H&&H.x(Z).y(ee)}function m(){var t,n,r=.7*f(),i=d3.scale.linear().domain([z.x+.07*z.scaledWidth,z.x+z.scaledWidth]).range([.07*j,j]),o=d3.scale.linear().domain([z.y,z.y-.93*z.scaledHeight]).range([0,.93*F]),a=function(e){return"translate("+i(e)+",0)"},s=function(e){return"translate(0,"+o(e)+")"},l=function(e){return e?"#ccc":"#666"},u=i.tickFormat(5),c=o.tickFormat(5),d=e.getUnitDefinition?e.getUnitDefinition("length"):"",p=e.get("xunits"),h=e.get("yunits"),m=e.get("xlabel"),g=e.get("ylabel");d3.event&&d3.event.transform&&d3.event.transform(i,o),P.selectAll("g.x, g.y").remove();var v=P.selectAll("g.x").data(i.ticks(5),String).attr("transform",a).classed("axes",!0);v.select("text").text(u);var y=v.enter().append("g").attr("class","x").attr("transform",a);e.get("gridLines")?y.append("line").attr("stroke",l).attr("y1",0).attr("y2",F-(m?r:0)-(p?r:0)):y.selectAll("line").remove(),t=P.selectAll("text.xlabel").data(m?[d.pluralName]:[]),t.enter().append("text"),t.attr("class","axis").attr("class","xlabel").attr("x",j/2).attr("y",F).attr("dy","-0.1em").style("text-anchor","middle").text(String),t.exit().remove(),p?y.append("text").attr("class","xunits").attr("y",F).attr("dy",e.get("xlabel")?"-1em":"-0.1em").attr("text-anchor","middle").text(u):y.select("text.xunits").remove();var b=P.selectAll("g.y").data(o.ticks(5),String).attr("transform",s).classed("axes",!0);b.select("text").text(c);var _=b.enter().append("g").attr("class","y").attr("transform",s).attr("background-fill","#FFEEB6");e.get("gridLines")?_.append("line").attr("stroke",l).attr("x1",(g?r:0)+(h?2*r:0)).attr("x2",j):_.selectAll("line").remove(),n=P.selectAll("text.ylabel").data(g?[d.pluralName]:[]),n.enter().append("text"),n.attr("class","axis").attr("class","ylabel").attr("transform","translate(0 "+.5*F+") rotate(-90)").attr("dy","0.75em").style("text-anchor","middle").text(String),n.exit().remove(),h?_.append("text").attr("class","yunits").attr("dy","0.34em").attr("dx",e.get("ylabel")?"1em":"0.1em").text(c):y.select("text.yunits").remove()}function g(){var t=e.get("backgroundColor")||"rgba(0, 0, 0, 0)";M.attr("fill",t),D.forEach(function(e){e.setBackgroundColor(parseInt(d3.rgb(t.replace("rgba","rgb")).toString().substr(1),16))})}function v(){y()}function y(){e.get("enableKeyboardHandlers")&&k.focus()}function b(){return this.attr({xmlns:"http://www.w3.org/2000/svg","xmlns:xmlns:xlink":"http://www.w3.org/1999/xlink",overflow:"hidden"})}function _(){return this.style({position:"absolute",top:0,left:0})}function x(){var t;void 0===P&&(P=d3.select(k).append("svg").attr("class","root-layer container plot-container").style("z-index",p()).call(b),M=P.append("rect").attr("class","container-background background"),E=d3.select(k).append("svg").attr("class","root-layer container background-container svg-viewport").style("z-index",p()).call(b),L=E.append("g"),O=d3.select(k).append("svg").attr("class","root-layer container foreground-container svg-viewport").style("z-index",u).style("background-color","rgba(0,0,0,0)").on("contextmenu",function(){d3.event.preventDefault()}).call(b),N=O.append("g"),R=O.append("g").attr("class","brush-container"),d3.select(k).selectAll(".root-layer").call(_),e.get("enableKeyboardHandlers")&&d3.select(k).attr("tabindex",0).on("mousedown",v),I=[],D=[],B=[],V=new o(O.node()),V.addLayer(P.node()),V.addLayer(E.node())),h(),d3.select(k).selectAll(".root-layer").attr({width:j,height:F}).style({width:j+"px",height:F+"px"}),I.forEach(function(e){e.resize(j*l,F*l),$(e.view).css({width:j,height:F})}),t=Z(z.x)+" "+ee(z.y)+" "+Z(z.scaledWidth)+" "+Z(z.scaledHeight),d3.select(k).selectAll(".svg-viewport").attr({viewBox:t,x:0,y:0,width:Z(z.width),height:Z(z.height)}),B.forEach(function(e){e.pivot.x=K(z.x),e.pivot.y=J(z.y)}),M.attr({width:Z(z.width),height:Z(z.height),x:0,y:0}),m(),S.renderCanvas()}function w(){function t(){l.push(e.properties.viewPortX),u.push(e.properties.viewPortY),c.push(n.now()),l.length>d&&(l.shift(),u.shift(),c.shift())}function r(){if(p)return!0;var t=n.now(),r=t-a,s=-.003*i,l=-.003*o;return e.properties.viewPortX+=i*r+.5*s*r*r,e.properties.viewPortY+=o*r+.5*l*r*r,te.viewportDrag(),i+=s*r,o+=l*r,a=t,Math.abs(i)<1e-5&&Math.abs(o)<1e-5}var i,o,a,s,l=[],u=[],c=[],d=8,p=!1,f=e.properties.viewPortDrag||!1;return f===!1?void P.on("mousedown.drag",null).on("touchstart.drag",null).classed("draggable",!1):(s=d3.behavior.drag(),s.on("dragstart",function(){p=!0,l.length=0,u.length=0,c.length=0,t(),d3.select(window).on("mousemove.viewport-drag",function(){d3.event.preventDefault()})}).on("drag",function(){var n="y"===f?0:Z.invert(d3.event.dx),r="x"===f?0:Z.invert(d3.event.dy);e.properties.viewPortX-=n,e.properties.viewPortY+=r,te.viewportDrag(),t()}).on("dragend",function(){d3.select(window).on("mousemove.viewport-drag",null),t();var e=l.length-1,n=c[e]-c[0];n<1e-5||c[e]-c[e-1]>100||(i=(l[e]-l[0])/n,o=(u[e]-u[0])/n,a=c[e],p=!1,d3.timer(r))}),void P.call(s).classed("draggable",!0))}function C(){var e;for(e in U)U.hasOwnProperty(e)&&P.selectAll(e).on("click.custom",null)}function T(){x(),w(),U={},q={},e.addPropertiesListener(["backgroundColor"],S.repaint),e.addPropertiesListener(["gridLines","xunits","yunits","xlabel","ylabel","viewPortX","viewPortY","viewPortZoom"],x),e.addPropertiesListener(["viewPortDrag"],w)}var S,A,k,P,E,O,M,L,N,R,I,D,B,V,j,F,z,G,U,q,H,W,Y=d&&d.i18n||null,X=d&&d.origin||"bottom-left",Q=0,K=d3.scale.linear(),J=d3.scale.linear(),Z=d3.scale.linear(),ee=d3.scale.linear(),te=d3.dispatch("viewportDrag");return S={get $el(){return A},get node(){return k},get foregroundContainer(){return O},get model2px(){return Z},get model2canvas(){return K},get model2pxInv(){return ee},get model2canvasInv(){return J},get i18n(){return Y},get setFocus(){return y},get fontFamily(){return this.$el.css("font-family")},get getFontSizeInPixels(){return f},get url(){return r},get clickHandler(){return U},get dragHandler(){return q},get hitTestCallback(){return V.hitTestCallback},get mouseupCallback(){return V.mouseupCallback},repaint:function(){g(),W.repaint&&W.repaint(),S.updateClickHandlers(),S.renderCanvas()},appendViewport:function(){var e=I.length>0?N:L;return e.append("g")},appendPixiViewport:function(){var e,n;0===I.length&&(e=t(j,F),n=new s.Stage(null),k.appendChild(e.view),d3.select(e.view).attr("class","pixi-viewport").style("z-index",p()).call(_),I.push(e),D.push(n),V.addLayer(e.view),V.passMouseMove(O.node(),I[0].view));var r=new s.DisplayObjectContainer;return D[0].addChild(r),B.push(r),{pixiContainer:r,canvas:I[0].view}},resize:function(){x(),S.repaint(),H&&R.select("g.select-area").call(H),W.resize&&W.resize(),S.renderCanvas()},setup:function(){W.setup&&W.setup(e),S.renderCanvas()},update:function(){W.update&&W.update(),S.renderCanvas()},renderCanvas:function(){var e,t;for(e=0,t=I.length;e<t;e++)I[e].render(D[e])},getHeightForWidth:function(e){var t=z.width/z.height;return e/t},bindModel:function(t,n){r=n||r,e=t||e,C(),S.setSelectHandler(null),T(),W.bindModel&&W.bindModel(t,n)},pos:function(){var e={bottom:0,top:0,height:0,left:0,right:0,width:0};return A&&(e.top=A.position().top,e.left=A.position().left,e.width=A.width(),e.height=A.height(),e.bottom=e.top+e.height,e.right=e.left+e.width),e},on:function(e,t){te.on(e,t)},setClickHandler:function(e,t){if("function"!=typeof t)throw new Error("Click handler should be a function.");U[e]=t,S.updateClickHandlers()},updateClickHandlers:function(){function e(e){return function(t,n){if(!d3.event.defaultPrevented){var r=d3.mouse(M.node()),i=Z.invert(r[0]),o=ee.invert(r[1]);a.log("[view] click at ("+i.toFixed(3)+", "+o.toFixed(3)+")"),e(i,o,t,n)}}}var t;for(t in U)U.hasOwnProperty(t)&&d3.selectAll(t).on("click.custom",e(U[t]))},setSelectHandler:function(e){if("function"!=typeof e&&null!==e)throw new Error("Select handler should be a function or null.");return R.select("g.select-area").remove(),null===e?void(H=null):(H=d3.svg.brush().x(Z).y(ee).on("brushstart.select",function(){d3.select(window).on("mousemove.select",function(){d3.event.preventDefault()})}).on("brushend.select",function(){d3.select(window).on("mousemove.select",null);var t=H.extent(),n=t[0][0],r=t[0][1],i=t[1][0]-n,o=t[1][1]-r;a.log("[view] selection area ("+n.toFixed(3)+", "+r.toFixed(3)+"), width: "+i+", height: "+o),e(n,r,i,o),H.clear(),R.select("g.select-area").call(H)}),void R.append("g").classed("select-area",!0).call(H))},setDragHandler:function(e,t){q[e]=t}},A=$("<div>").attr({id:"model-container",class:"container",tabindex:i}).css({width:"50px",height:"50px"}),k=A[0],e&&T(),W=new c(S,e),S}}),define("rgbcolor",function(e){return function(){var t;return t||e.rgbcolor}}(this)),function(){function e(){var e={};return e.FRAMERATE=30,e.MAX_VIRTUAL_PIXELS=3e4,e.init=function(t){var n=0;e.UniqueId=function(){return n++,"canvg"+n},e.Definitions={},e.Styles={},e.Animations=[],e.Images=[],e.ctx=t,e.ViewPort=new function(){this.viewPorts=[],this.Clear=function(){this.viewPorts=[]},this.SetCurrent=function(e,t){this.viewPorts.push({width:e,height:t})},this.RemoveCurrent=function(){this.viewPorts.pop()},this.Current=function(){return this.viewPorts[this.viewPorts.length-1]},this.width=function(){return this.Current().width},this.height=function(){return this.Current().height},this.ComputeSize=function(e){return null!=e&&"number"==typeof e?e:"x"==e?this.width():"y"==e?this.height():Math.sqrt(Math.pow(this.width(),2)+Math.pow(this.height(),2))/Math.sqrt(2)}}},e.init(),e.ImagesLoaded=function(){for(var t=0;t<e.Images.length;t++)if(!e.Images[t].loaded)return!1;return!0},e.trim=function(e){return e.replace(/^\s+|\s+$/g,"")},e.compressSpaces=function(e){return e.replace(/[\s\r\t\n]+/gm," ")},e.ajax=function(e){var t;return t=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP"),t?(t.open("GET",e,!1),t.send(null),t.responseText):null},e.parseXml=function(e){if(window.DOMParser){var t=new DOMParser;return t.parseFromString(e,"text/xml")}e=e.replace(/<!DOCTYPE svg[^>]*>/,"");var n=new ActiveXObject("Microsoft.XMLDOM");return n.async="false",n.loadXML(e),n},e.Property=function(e,t){this.name=e,this.value=t},e.Property.prototype.getValue=function(){return this.value},e.Property.prototype.hasValue=function(){return null!=this.value&&""!==this.value},e.Property.prototype.numValue=function(){if(!this.hasValue())return 0;var e=parseFloat(this.value);return(this.value+"").match(/%$/)&&(e/=100),e},e.Property.prototype.valueOrDefault=function(e){return this.hasValue()?this.value:e},e.Property.prototype.numValueOrDefault=function(e){return this.hasValue()?this.numValue():e},e.Property.prototype.addOpacity=function(t){var n=this.value;if(null!=t&&""!=t&&"string"==typeof this.value){var r=new RGBColor(this.value);r.ok&&(n="rgba("+r.r+", "+r.g+", "+r.b+", "+t+")")}return new e.Property(this.name,n)},e.Property.prototype.getDefinition=function(){var t=this.value.match(/#([^\)'"]+)/);return t&&(t=t[1]),t||(t=this.value),e.Definitions[t]},e.Property.prototype.isUrlDefinition=function(){return 0==this.value.indexOf("url(")},e.Property.prototype.getFillStyleDefinition=function(t,n){var r=this.getDefinition();if(null!=r&&r.createGradient)return r.createGradient(e.ctx,t,n);if(null!=r&&r.createPattern){if(r.getHrefAttribute().hasValue()){var i=r.attribute("patternTransform");r=r.getHrefAttribute().getDefinition(),i.hasValue()&&(r.attribute("patternTransform",!0).value=i.value)}return r.createPattern(e.ctx,t)}return null},e.Property.prototype.getDPI=function(e){return 96},e.Property.prototype.getEM=function(t){var n=12,r=new e.Property("fontSize",e.Font.Parse(e.ctx.font).fontSize);return r.hasValue()&&(n=r.toPixels(t)),n},e.Property.prototype.getUnits=function(){var e=this.value+"";return e.replace(/[0-9\.\-]/g,"")},e.Property.prototype.toPixels=function(t,n){if(!this.hasValue())return 0;var r=this.value+"";if(r.match(/em$/))return this.numValue()*this.getEM(t);if(r.match(/ex$/))return this.numValue()*this.getEM(t)/2;if(r.match(/px$/))return this.numValue();if(r.match(/pt$/))return this.numValue()*this.getDPI(t)*(1/72);if(r.match(/pc$/))return 15*this.numValue();if(r.match(/cm$/))return this.numValue()*this.getDPI(t)/2.54;if(r.match(/mm$/))return this.numValue()*this.getDPI(t)/25.4;if(r.match(/in$/))return this.numValue()*this.getDPI(t);if(r.match(/%$/))return this.numValue()*e.ViewPort.ComputeSize(t);var i=this.numValue();return n&&i<1?i*e.ViewPort.ComputeSize(t):i},e.Property.prototype.toMilliseconds=function(){if(!this.hasValue())return 0;var e=this.value+"";return e.match(/s$/)?1e3*this.numValue():e.match(/ms$/)?this.numValue():this.numValue()},e.Property.prototype.toRadians=function(){if(!this.hasValue())return 0;var e=this.value+"";return e.match(/deg$/)?this.numValue()*(Math.PI/180):e.match(/grad$/)?this.numValue()*(Math.PI/200):e.match(/rad$/)?this.numValue():this.numValue()*(Math.PI/180)},e.Font=new function(){this.Styles="normal|italic|oblique|inherit",this.Variants="normal|small-caps|inherit",this.Weights="normal|bold|bolder|lighter|100|200|300|400|500|600|700|800|900|inherit",this.CreateFont=function(t,n,r,i,o,a){var s=null!=a?this.Parse(a):this.CreateFont("","","","","",e.ctx.font);return{fontFamily:o||s.fontFamily,fontSize:i||s.fontSize,fontStyle:t||s.fontStyle,fontWeight:r||s.fontWeight,fontVariant:n||s.fontVariant,toString:function(){return[this.fontStyle,this.fontVariant,this.fontWeight,this.fontSize,this.fontFamily].join(" ")}}};var t=this;this.Parse=function(n){for(var r={},i=e.trim(e.compressSpaces(n||"")).split(" "),o={fontSize:!1,fontStyle:!1,fontWeight:!1,fontVariant:!1},a="",s=0;s<i.length;s++)o.fontStyle||t.Styles.indexOf(i[s])==-1?o.fontVariant||t.Variants.indexOf(i[s])==-1?o.fontWeight||t.Weights.indexOf(i[s])==-1?o.fontSize?"inherit"!=i[s]&&(a+=i[s]):("inherit"!=i[s]&&(r.fontSize=i[s].split("/")[0]),o.fontStyle=o.fontVariant=o.fontWeight=o.fontSize=!0):("inherit"!=i[s]&&(r.fontWeight=i[s]),o.fontStyle=o.fontVariant=o.fontWeight=!0):("inherit"!=i[s]&&(r.fontVariant=i[s]),o.fontStyle=o.fontVariant=!0):("inherit"!=i[s]&&(r.fontStyle=i[s]),o.fontStyle=!0);return""!=a&&(r.fontFamily=a),r}},e.ToNumberArray=function(t){for(var n=e.trim(e.compressSpaces((t||"").replace(/,/g," "))).split(" "),r=0;r<n.length;r++)n[r]=parseFloat(n[r]);return n},e.Point=function(e,t){this.x=e,this.y=t},e.Point.prototype.angleTo=function(e){return Math.atan2(e.y-this.y,e.x-this.x)},e.Point.prototype.applyTransform=function(e){var t=this.x*e[0]+this.y*e[2]+e[4],n=this.x*e[1]+this.y*e[3]+e[5];this.x=t,this.y=n},e.CreatePoint=function(t){var n=e.ToNumberArray(t);return new e.Point(n[0],n[1])},e.CreatePath=function(t){for(var n=e.ToNumberArray(t),r=[],i=0;i<n.length;i+=2)r.push(new e.Point(n[i],n[i+1]));return r},e.BoundingBox=function(e,t,n,r){this.x1=Number.NaN,this.y1=Number.NaN,this.x2=Number.NaN,this.y2=Number.NaN,this.x=function(){return this.x1},this.y=function(){return this.y1},this.width=function(){return this.x2-this.x1},this.height=function(){return this.y2-this.y1},this.addPoint=function(e,t){null!=e&&((isNaN(this.x1)||isNaN(this.x2))&&(this.x1=e,this.x2=e),e<this.x1&&(this.x1=e),e>this.x2&&(this.x2=e)),null!=t&&((isNaN(this.y1)||isNaN(this.y2))&&(this.y1=t,this.y2=t),t<this.y1&&(this.y1=t),t>this.y2&&(this.y2=t))},this.addX=function(e){this.addPoint(e,null)},this.addY=function(e){this.addPoint(null,e)},this.addBoundingBox=function(e){this.addPoint(e.x1,e.y1),this.addPoint(e.x2,e.y2)},this.addQuadraticCurve=function(e,t,n,r,i,o){var a=e+2/3*(n-e),s=t+2/3*(r-t),l=a+1/3*(i-e),u=s+1/3*(o-t);this.addBezierCurve(e,t,a,l,s,u,i,o)},this.addBezierCurve=function(e,t,n,r,o,a,s,l){var u=[e,t],c=[n,r],d=[o,a],p=[s,l];for(this.addPoint(u[0],u[1]),this.addPoint(p[0],p[1]),i=0;i<=1;i++){var f=function(e){return Math.pow(1-e,3)*u[i]+3*Math.pow(1-e,2)*e*c[i]+3*(1-e)*Math.pow(e,2)*d[i]+Math.pow(e,3)*p[i]},h=6*u[i]-12*c[i]+6*d[i],m=-3*u[i]+9*c[i]-9*d[i]+3*p[i],g=3*c[i]-3*u[i];if(0!=m){var v=Math.pow(h,2)-4*g*m;if(!(v<0)){var y=(-h+Math.sqrt(v))/(2*m);0<y&&y<1&&(0==i&&this.addX(f(y)),1==i&&this.addY(f(y)));var b=(-h-Math.sqrt(v))/(2*m);0<b&&b<1&&(0==i&&this.addX(f(b)),1==i&&this.addY(f(b)))}}else{if(0==h)continue;var _=-g/h;0<_&&_<1&&(0==i&&this.addX(f(_)),1==i&&this.addY(f(_)))}}},this.isPointInBox=function(e,t){return this.x1<=e&&e<=this.x2&&this.y1<=t&&t<=this.y2},this.addPoint(e,t),this.addPoint(n,r)},e.Transform=function(t){var n=this;this.Type={},this.Type.translate=function(t){this.p=e.CreatePoint(t),this.apply=function(e){e.translate(this.p.x||0,this.p.y||0)},this.unapply=function(e){e.translate(-1*this.p.x||0,-1*this.p.y||0)},this.applyToPoint=function(e){e.applyTransform([1,0,0,1,this.p.x||0,this.p.y||0])}},this.Type.rotate=function(t){var n=e.ToNumberArray(t);this.angle=new e.Property("angle",n[0]),this.cx=n[1]||0,this.cy=n[2]||0,this.apply=function(e){e.translate(this.cx,this.cy),e.rotate(this.angle.toRadians()),e.translate(-this.cx,-this.cy)},this.unapply=function(e){e.translate(this.cx,this.cy),e.rotate(-1*this.angle.toRadians()),e.translate(-this.cx,-this.cy)},this.applyToPoint=function(e){var t=this.angle.toRadians();e.applyTransform([1,0,0,1,this.p.x||0,this.p.y||0]),e.applyTransform([Math.cos(t),Math.sin(t),-Math.sin(t),Math.cos(t),0,0]),e.applyTransform([1,0,0,1,-this.p.x||0,-this.p.y||0])}},this.Type.scale=function(t){this.p=e.CreatePoint(t),this.apply=function(e){e.scale(this.p.x||1,this.p.y||this.p.x||1)},this.unapply=function(e){e.scale(1/this.p.x||1,1/this.p.y||this.p.x||1)},this.applyToPoint=function(e){e.applyTransform([this.p.x||0,0,0,this.p.y||0,0,0])}},this.Type.matrix=function(t){this.m=e.ToNumberArray(t),this.apply=function(e){e.transform(this.m[0],this.m[1],this.m[2],this.m[3],this.m[4],this.m[5])},this.applyToPoint=function(e){e.applyTransform(this.m)}},this.Type.SkewBase=function(t){this.base=n.Type.matrix,this.base(t),this.angle=new e.Property("angle",t)},this.Type.SkewBase.prototype=new this.Type.matrix,this.Type.skewX=function(e){this.base=n.Type.SkewBase,this.base(e),this.m=[1,0,Math.tan(this.angle.toRadians()),1,0,0]},this.Type.skewX.prototype=new this.Type.SkewBase,this.Type.skewY=function(e){this.base=n.Type.SkewBase,this.base(e),this.m=[1,Math.tan(this.angle.toRadians()),0,1,0,0]},this.Type.skewY.prototype=new this.Type.SkewBase,this.transforms=[],this.apply=function(e){for(var t=0;t<this.transforms.length;t++)this.transforms[t].apply(e)},this.unapply=function(e){for(var t=this.transforms.length-1;t>=0;t--)this.transforms[t].unapply(e)},this.applyToPoint=function(e){for(var t=0;t<this.transforms.length;t++)this.transforms[t].applyToPoint(e)};for(var r=e.trim(e.compressSpaces(t)).replace(/\)(\s?,\s?)/g,") ").split(/\s(?=[a-z])/),i=0;i<r.length;i++){var o=e.trim(r[i].split("(")[0]),a=r[i].split("(")[1].replace(")",""),s=new this.Type[o](a);s.type=o,this.transforms.push(s)}},e.AspectRatio=function(t,n,r,i,o,a,s,l,u,c){n=e.compressSpaces(n),n=n.replace(/^defer\s/,"");var d=n.split(" ")[0]||"xMidYMid",p=n.split(" ")[1]||"meet",f=r/i,h=o/a,m=Math.min(f,h),g=Math.max(f,h);"meet"==p&&(i*=m,a*=m),"slice"==p&&(i*=g,a*=g),u=new e.Property("refX",u),c=new e.Property("refY",c),u.hasValue()&&c.hasValue()?t.translate(-m*u.toPixels("x"),-m*c.toPixels("y")):(d.match(/^xMid/)&&("meet"==p&&m==h||"slice"==p&&g==h)&&t.translate(r/2-i/2,0),
d.match(/YMid$/)&&("meet"==p&&m==f||"slice"==p&&g==f)&&t.translate(0,o/2-a/2),d.match(/^xMax/)&&("meet"==p&&m==h||"slice"==p&&g==h)&&t.translate(r-i,0),d.match(/YMax$/)&&("meet"==p&&m==f||"slice"==p&&g==f)&&t.translate(0,o-a)),"none"==d?t.scale(f,h):"meet"==p?t.scale(m,m):"slice"==p&&t.scale(g,g),t.translate(null==s?0:-s,null==l?0:-l)},e.Element={},e.EmptyProperty=new e.Property("EMPTY",""),e.Element.ElementBase=function(t){if(this.attributes={},this.styles={},this.children=[],this.attribute=function(t,n){var r=this.attributes[t];return null!=r?r:(1==n&&(r=new e.Property(t,""),this.attributes[t]=r),r||e.EmptyProperty)},this.getHrefAttribute=function(){for(var t in this.attributes)if(t.match(/:href$/))return this.attributes[t];return e.EmptyProperty},this.style=function(t,n){var r=this.styles[t];if(null!=r)return r;var i=this.attribute(t);if(null!=i&&i.hasValue())return this.styles[t]=i,i;var o=this.parent;if(null!=o){var a=o.style(t);if(null!=a&&a.hasValue())return a}return 1==n&&(r=new e.Property(t,""),this.styles[t]=r),r||e.EmptyProperty},this.render=function(e){if("none"!=this.style("display").value&&"hidden"!=this.attribute("visibility").value){if(e.save(),this.attribute("mask").hasValue()){var t=this.attribute("mask").getDefinition();null!=t&&t.apply(e,this)}else if(this.style("filter").hasValue()){var n=this.style("filter").getDefinition();null!=n&&n.apply(e,this)}else this.setContext(e),this.renderChildren(e),this.clearContext(e);e.restore()}},this.setContext=function(e){},this.clearContext=function(e){},this.renderChildren=function(e){for(var t=0;t<this.children.length;t++)this.children[t].render(e)},this.addChild=function(t,n){var r=t;n&&(r=e.CreateElement(t)),r.parent=this,this.children.push(r)},null!=t&&1==t.nodeType){for(var n=0;n<t.childNodes.length;n++){var r=t.childNodes[n];if(1==r.nodeType&&this.addChild(r,!0),this.captureTextNodes&&3==r.nodeType){var i=r.nodeValue||r.text||"";""!=e.trim(e.compressSpaces(i))&&this.addChild(new e.Element.tspan(r),!1)}}for(var n=0;n<t.attributes.length;n++){var o=t.attributes[n];this.attributes[o.nodeName]=new e.Property(o.nodeName,o.nodeValue)}var a=e.Styles[t.nodeName];if(null!=a)for(var s in a)this.styles[s]=a[s];if(this.attribute("class").hasValue())for(var l=e.compressSpaces(this.attribute("class").value).split(" "),u=0;u<l.length;u++){if(a=e.Styles["."+l[u]],null!=a)for(var s in a)this.styles[s]=a[s];if(a=e.Styles[t.nodeName+"."+l[u]],null!=a)for(var s in a)this.styles[s]=a[s]}if(this.attribute("id").hasValue()){var a=e.Styles["#"+this.attribute("id").value];if(null!=a)for(var s in a)this.styles[s]=a[s]}if(this.attribute("style").hasValue())for(var a=this.attribute("style").value.split(";"),n=0;n<a.length;n++)if(""!=e.trim(a[n])){var c=a[n].split(":"),s=e.trim(c[0]),d=e.trim(c[1]);this.styles[s]=new e.Property(s,d)}this.attribute("id").hasValue()&&null==e.Definitions[this.attribute("id").value]&&(e.Definitions[this.attribute("id").value]=this)}},e.Element.RenderedElementBase=function(t){this.base=e.Element.ElementBase,this.base(t),this.setContext=function(t){if(this.style("fill").isUrlDefinition()){var n=this.style("fill").getFillStyleDefinition(this,this.style("fill-opacity"));null!=n&&(t.fillStyle=n)}else if(this.style("fill").hasValue()){var r=this.style("fill");"currentColor"==r.value&&(r.value=this.style("color").value),t.fillStyle="none"==r.value?"rgba(0,0,0,0)":r.value}if(this.style("fill-opacity").hasValue()){var r=new e.Property("fill",t.fillStyle);r=r.addOpacity(this.style("fill-opacity").value),t.fillStyle=r.value}if(this.style("stroke").isUrlDefinition()){var n=this.style("stroke").getFillStyleDefinition(this,this.style("stroke-opacity"));null!=n&&(t.strokeStyle=n)}else if(this.style("stroke").hasValue()){var i=this.style("stroke");"currentColor"==i.value&&(i.value=this.style("color").value),t.strokeStyle="none"==i.value?"rgba(0,0,0,0)":i.value}if(this.style("stroke-opacity").hasValue()){var i=new e.Property("stroke",t.strokeStyle);i=i.addOpacity(this.style("stroke-opacity").value),t.strokeStyle=i.value}if(this.style("stroke-width").hasValue()){var o=this.style("stroke-width").toPixels();t.lineWidth=0==o?.001:o}if(this.style("stroke-linecap").hasValue()&&(t.lineCap=this.style("stroke-linecap").value),this.style("stroke-linejoin").hasValue()&&(t.lineJoin=this.style("stroke-linejoin").value),this.style("stroke-miterlimit").hasValue()&&(t.miterLimit=this.style("stroke-miterlimit").value),this.style("stroke-dasharray").hasValue()){var a=e.ToNumberArray(this.style("stroke-dasharray").value);"undefined"!=typeof t.setLineDash?t.setLineDash(a):"undefined"!=typeof t.webkitLineDash?t.webkitLineDash=a:"undefined"!=typeof t.mozDash&&(t.mozDash=a);var s=this.style("stroke-dashoffset").numValueOrDefault(1);"undefined"!=typeof t.lineDashOffset?t.lineDashOffset=s:"undefined"!=typeof t.webkitLineDashOffset?t.webkitLineDashOffset=s:"undefined"!=typeof t.mozDashOffset&&(t.mozDashOffset=s)}if("undefined"!=typeof t.font&&(t.font=e.Font.CreateFont(this.style("font-style").value,this.style("font-variant").value,this.style("font-weight").value,this.style("font-size").hasValue()?this.style("font-size").toPixels()+"px":"",this.style("font-family").value).toString()),this.attribute("transform").hasValue()){var l=new e.Transform(this.attribute("transform").value);l.apply(t)}if(this.style("clip-path").hasValue()){var u=this.style("clip-path").getDefinition();null!=u&&u.apply(t)}this.style("opacity").hasValue()&&(t.globalAlpha=this.style("opacity").numValue())}},e.Element.RenderedElementBase.prototype=new e.Element.ElementBase,e.Element.PathElementBase=function(t){this.base=e.Element.RenderedElementBase,this.base(t),this.path=function(t){return null!=t&&t.beginPath(),new e.BoundingBox},this.renderChildren=function(t){this.path(t),e.Mouse.checkPath(this,t),""!=t.fillStyle&&(this.attribute("fill-rule").hasValue()?t.fill(this.attribute("fill-rule").value):t.fill()),""!=t.strokeStyle&&t.stroke();var n=this.getMarkers();if(null!=n){if(this.style("marker-start").isUrlDefinition()){var r=this.style("marker-start").getDefinition();r.render(t,n[0][0],n[0][1])}if(this.style("marker-mid").isUrlDefinition())for(var r=this.style("marker-mid").getDefinition(),i=1;i<n.length-1;i++)r.render(t,n[i][0],n[i][1]);if(this.style("marker-end").isUrlDefinition()){var r=this.style("marker-end").getDefinition();r.render(t,n[n.length-1][0],n[n.length-1][1])}}},this.getBoundingBox=function(){return this.path()},this.getMarkers=function(){return null}},e.Element.PathElementBase.prototype=new e.Element.RenderedElementBase,e.Element.svg=function(t){this.base=e.Element.RenderedElementBase,this.base(t),this.baseClearContext=this.clearContext,this.clearContext=function(t){this.baseClearContext(t),e.ViewPort.RemoveCurrent()},this.baseSetContext=this.setContext,this.setContext=function(t){t.strokeStyle="rgba(0,0,0,0)",t.lineCap="butt",t.lineJoin="miter",t.miterLimit=4,this.baseSetContext(t),this.attribute("x").hasValue()||(this.attribute("x",!0).value=0),this.attribute("y").hasValue()||(this.attribute("y",!0).value=0),t.translate(this.attribute("x").toPixels("x"),this.attribute("y").toPixels("y"));var n=e.ViewPort.width(),r=e.ViewPort.height();if(this.attribute("width").hasValue()||(this.attribute("width",!0).value="100%"),this.attribute("height").hasValue()||(this.attribute("height",!0).value="100%"),"undefined"==typeof this.root){n=this.attribute("width").toPixels("x"),r=this.attribute("height").toPixels("y");var i=0,o=0;this.attribute("refX").hasValue()&&this.attribute("refY").hasValue()&&(i=-this.attribute("refX").toPixels("x"),o=-this.attribute("refY").toPixels("y")),t.beginPath(),t.moveTo(i,o),t.lineTo(n,o),t.lineTo(n,r),t.lineTo(i,r),t.closePath(),t.clip()}if(e.ViewPort.SetCurrent(n,r),this.attribute("viewBox").hasValue()){var a=e.ToNumberArray(this.attribute("viewBox").value),s=a[0],l=a[1];n=a[2],r=a[3],e.AspectRatio(t,this.attribute("preserveAspectRatio").value,e.ViewPort.width(),n,e.ViewPort.height(),r,s,l,this.attribute("refX").value,this.attribute("refY").value),e.ViewPort.RemoveCurrent(),e.ViewPort.SetCurrent(a[2],a[3])}}},e.Element.svg.prototype=new e.Element.RenderedElementBase,e.Element.rect=function(t){this.base=e.Element.PathElementBase,this.base(t),this.path=function(t){var n=this.attribute("x").toPixels("x"),r=this.attribute("y").toPixels("y"),i=this.attribute("width").toPixels("x"),o=this.attribute("height").toPixels("y"),a=this.attribute("rx").toPixels("x"),s=this.attribute("ry").toPixels("y");return this.attribute("rx").hasValue()&&!this.attribute("ry").hasValue()&&(s=a),this.attribute("ry").hasValue()&&!this.attribute("rx").hasValue()&&(a=s),a=Math.min(a,i/2),s=Math.min(s,o/2),null!=t&&(t.beginPath(),t.moveTo(n+a,r),t.lineTo(n+i-a,r),t.quadraticCurveTo(n+i,r,n+i,r+s),t.lineTo(n+i,r+o-s),t.quadraticCurveTo(n+i,r+o,n+i-a,r+o),t.lineTo(n+a,r+o),t.quadraticCurveTo(n,r+o,n,r+o-s),t.lineTo(n,r+s),t.quadraticCurveTo(n,r,n+a,r),t.closePath()),new e.BoundingBox(n,r,n+i,r+o)}},e.Element.rect.prototype=new e.Element.PathElementBase,e.Element.circle=function(t){this.base=e.Element.PathElementBase,this.base(t),this.path=function(t){var n=this.attribute("cx").toPixels("x"),r=this.attribute("cy").toPixels("y"),i=this.attribute("r").toPixels();return null!=t&&(t.beginPath(),t.arc(n,r,i,0,2*Math.PI,!0),t.closePath()),new e.BoundingBox(n-i,r-i,n+i,r+i)}},e.Element.circle.prototype=new e.Element.PathElementBase,e.Element.ellipse=function(t){this.base=e.Element.PathElementBase,this.base(t),this.path=function(t){var n=4*((Math.sqrt(2)-1)/3),r=this.attribute("rx").toPixels("x"),i=this.attribute("ry").toPixels("y"),o=this.attribute("cx").toPixels("x"),a=this.attribute("cy").toPixels("y");return null!=t&&(t.beginPath(),t.moveTo(o,a-i),t.bezierCurveTo(o+n*r,a-i,o+r,a-n*i,o+r,a),t.bezierCurveTo(o+r,a+n*i,o+n*r,a+i,o,a+i),t.bezierCurveTo(o-n*r,a+i,o-r,a+n*i,o-r,a),t.bezierCurveTo(o-r,a-n*i,o-n*r,a-i,o,a-i),t.closePath()),new e.BoundingBox(o-r,a-i,o+r,a+i)}},e.Element.ellipse.prototype=new e.Element.PathElementBase,e.Element.line=function(t){this.base=e.Element.PathElementBase,this.base(t),this.getPoints=function(){return[new e.Point(this.attribute("x1").toPixels("x"),this.attribute("y1").toPixels("y")),new e.Point(this.attribute("x2").toPixels("x"),this.attribute("y2").toPixels("y"))]},this.path=function(t){var n=this.getPoints();return null!=t&&(t.beginPath(),t.moveTo(n[0].x,n[0].y),t.lineTo(n[1].x,n[1].y)),new e.BoundingBox(n[0].x,n[0].y,n[1].x,n[1].y)},this.getMarkers=function(){var e=this.getPoints(),t=e[0].angleTo(e[1]);return[[e[0],t],[e[1],t]]}},e.Element.line.prototype=new e.Element.PathElementBase,e.Element.polyline=function(t){this.base=e.Element.PathElementBase,this.base(t),this.points=e.CreatePath(this.attribute("points").value),this.path=function(t){var n=new e.BoundingBox(this.points[0].x,this.points[0].y);null!=t&&(t.beginPath(),t.moveTo(this.points[0].x,this.points[0].y));for(var r=1;r<this.points.length;r++)n.addPoint(this.points[r].x,this.points[r].y),null!=t&&t.lineTo(this.points[r].x,this.points[r].y);return n},this.getMarkers=function(){for(var e=[],t=0;t<this.points.length-1;t++)e.push([this.points[t],this.points[t].angleTo(this.points[t+1])]);return e.push([this.points[this.points.length-1],e[e.length-1][1]]),e}},e.Element.polyline.prototype=new e.Element.PathElementBase,e.Element.polygon=function(t){this.base=e.Element.polyline,this.base(t),this.basePath=this.path,this.path=function(e){var t=this.basePath(e);return null!=e&&(e.lineTo(this.points[0].x,this.points[0].y),e.closePath()),t}},e.Element.polygon.prototype=new e.Element.polyline,e.Element.path=function(t){this.base=e.Element.PathElementBase,this.base(t);var n=this.attribute("d").value;n=n.replace(/,/gm," "),n=n.replace(/([MmZzLlHhVvCcSsQqTtAa])([MmZzLlHhVvCcSsQqTtAa])/gm,"$1 $2"),n=n.replace(/([MmZzLlHhVvCcSsQqTtAa])([MmZzLlHhVvCcSsQqTtAa])/gm,"$1 $2"),n=n.replace(/([MmZzLlHhVvCcSsQqTtAa])([^\s])/gm,"$1 $2"),n=n.replace(/([^\s])([MmZzLlHhVvCcSsQqTtAa])/gm,"$1 $2"),n=n.replace(/([0-9])([+\-])/gm,"$1 $2"),n=n.replace(/(\.[0-9]*)(\.)/gm,"$1 $2"),n=n.replace(/([Aa](\s+[0-9]+){3})\s+([01])\s*([01])/gm,"$1 $3 $4 "),n=e.compressSpaces(n),n=e.trim(n),this.PathParser=new function(t){this.tokens=t.split(" "),this.reset=function(){this.i=-1,this.command="",this.previousCommand="",this.start=new e.Point(0,0),this.control=new e.Point(0,0),this.current=new e.Point(0,0),this.points=[],this.angles=[]},this.isEnd=function(){return this.i>=this.tokens.length-1},this.isCommandOrEnd=function(){return!!this.isEnd()||null!=this.tokens[this.i+1].match(/^[A-Za-z]$/)},this.isRelativeCommand=function(){switch(this.command){case"m":case"l":case"h":case"v":case"c":case"s":case"q":case"t":case"a":case"z":return!0}return!1},this.getToken=function(){return this.i++,this.tokens[this.i]},this.getScalar=function(){return parseFloat(this.getToken())},this.nextCommand=function(){this.previousCommand=this.command,this.command=this.getToken()},this.getPoint=function(){var t=new e.Point(this.getScalar(),this.getScalar());return this.makeAbsolute(t)},this.getAsControlPoint=function(){var e=this.getPoint();return this.control=e,e},this.getAsCurrentPoint=function(){var e=this.getPoint();return this.current=e,e},this.getReflectedControlPoint=function(){if("c"!=this.previousCommand.toLowerCase()&&"s"!=this.previousCommand.toLowerCase()&&"q"!=this.previousCommand.toLowerCase()&&"t"!=this.previousCommand.toLowerCase())return this.current;var t=new e.Point(2*this.current.x-this.control.x,2*this.current.y-this.control.y);return t},this.makeAbsolute=function(e){return this.isRelativeCommand()&&(e.x+=this.current.x,e.y+=this.current.y),e},this.addMarker=function(e,t,n){null!=n&&this.angles.length>0&&null==this.angles[this.angles.length-1]&&(this.angles[this.angles.length-1]=this.points[this.points.length-1].angleTo(n)),this.addMarkerAngle(e,null==t?null:t.angleTo(e))},this.addMarkerAngle=function(e,t){this.points.push(e),this.angles.push(t)},this.getMarkerPoints=function(){return this.points},this.getMarkerAngles=function(){for(var e=0;e<this.angles.length;e++)if(null==this.angles[e])for(var t=e+1;t<this.angles.length;t++)if(null!=this.angles[t]){this.angles[e]=this.angles[t];break}return this.angles}}(n),this.path=function(t){var n=this.PathParser;n.reset();var r=new e.BoundingBox;for(null!=t&&t.beginPath();!n.isEnd();)switch(n.nextCommand(),n.command){case"M":case"m":var i=n.getAsCurrentPoint();for(n.addMarker(i),r.addPoint(i.x,i.y),null!=t&&t.moveTo(i.x,i.y),n.start=n.current;!n.isCommandOrEnd();){var i=n.getAsCurrentPoint();n.addMarker(i,n.start),r.addPoint(i.x,i.y),null!=t&&t.lineTo(i.x,i.y)}break;case"L":case"l":for(;!n.isCommandOrEnd();){var o=n.current,i=n.getAsCurrentPoint();n.addMarker(i,o),r.addPoint(i.x,i.y),null!=t&&t.lineTo(i.x,i.y)}break;case"H":case"h":for(;!n.isCommandOrEnd();){var a=new e.Point((n.isRelativeCommand()?n.current.x:0)+n.getScalar(),n.current.y);n.addMarker(a,n.current),n.current=a,r.addPoint(n.current.x,n.current.y),null!=t&&t.lineTo(n.current.x,n.current.y)}break;case"V":case"v":for(;!n.isCommandOrEnd();){var a=new e.Point(n.current.x,(n.isRelativeCommand()?n.current.y:0)+n.getScalar());n.addMarker(a,n.current),n.current=a,r.addPoint(n.current.x,n.current.y),null!=t&&t.lineTo(n.current.x,n.current.y)}break;case"C":case"c":for(;!n.isCommandOrEnd();){var s=n.current,l=n.getPoint(),u=n.getAsControlPoint(),c=n.getAsCurrentPoint();n.addMarker(c,u,l),r.addBezierCurve(s.x,s.y,l.x,l.y,u.x,u.y,c.x,c.y),null!=t&&t.bezierCurveTo(l.x,l.y,u.x,u.y,c.x,c.y)}break;case"S":case"s":for(;!n.isCommandOrEnd();){var s=n.current,l=n.getReflectedControlPoint(),u=n.getAsControlPoint(),c=n.getAsCurrentPoint();n.addMarker(c,u,l),r.addBezierCurve(s.x,s.y,l.x,l.y,u.x,u.y,c.x,c.y),null!=t&&t.bezierCurveTo(l.x,l.y,u.x,u.y,c.x,c.y)}break;case"Q":case"q":for(;!n.isCommandOrEnd();){var s=n.current,u=n.getAsControlPoint(),c=n.getAsCurrentPoint();n.addMarker(c,u,u),r.addQuadraticCurve(s.x,s.y,u.x,u.y,c.x,c.y),null!=t&&t.quadraticCurveTo(u.x,u.y,c.x,c.y)}break;case"T":case"t":for(;!n.isCommandOrEnd();){var s=n.current,u=n.getReflectedControlPoint();n.control=u;var c=n.getAsCurrentPoint();n.addMarker(c,u,u),r.addQuadraticCurve(s.x,s.y,u.x,u.y,c.x,c.y),null!=t&&t.quadraticCurveTo(u.x,u.y,c.x,c.y)}break;case"A":case"a":for(;!n.isCommandOrEnd();){var s=n.current,d=n.getScalar(),p=n.getScalar(),f=n.getScalar()*(Math.PI/180),h=n.getScalar(),m=n.getScalar(),c=n.getAsCurrentPoint(),g=new e.Point(Math.cos(f)*(s.x-c.x)/2+Math.sin(f)*(s.y-c.y)/2,-Math.sin(f)*(s.x-c.x)/2+Math.cos(f)*(s.y-c.y)/2),v=Math.pow(g.x,2)/Math.pow(d,2)+Math.pow(g.y,2)/Math.pow(p,2);v>1&&(d*=Math.sqrt(v),p*=Math.sqrt(v));var y=(h==m?-1:1)*Math.sqrt((Math.pow(d,2)*Math.pow(p,2)-Math.pow(d,2)*Math.pow(g.y,2)-Math.pow(p,2)*Math.pow(g.x,2))/(Math.pow(d,2)*Math.pow(g.y,2)+Math.pow(p,2)*Math.pow(g.x,2)));isNaN(y)&&(y=0);var b=new e.Point(y*d*g.y/p,y*-p*g.x/d),_=new e.Point((s.x+c.x)/2+Math.cos(f)*b.x-Math.sin(f)*b.y,(s.y+c.y)/2+Math.sin(f)*b.x+Math.cos(f)*b.y),x=function(e){return Math.sqrt(Math.pow(e[0],2)+Math.pow(e[1],2))},w=function(e,t){return(e[0]*t[0]+e[1]*t[1])/(x(e)*x(t))},C=function(e,t){return(e[0]*t[1]<e[1]*t[0]?-1:1)*Math.acos(w(e,t))},T=C([1,0],[(g.x-b.x)/d,(g.y-b.y)/p]),S=[(g.x-b.x)/d,(g.y-b.y)/p],A=[(-g.x-b.x)/d,(-g.y-b.y)/p],k=C(S,A);w(S,A)<=-1&&(k=Math.PI),w(S,A)>=1&&(k=0);var P=1-m?1:-1,E=T+P*(k/2),O=new e.Point(_.x+d*Math.cos(E),_.y+p*Math.sin(E));if(n.addMarkerAngle(O,E-P*Math.PI/2),n.addMarkerAngle(c,E-P*Math.PI),r.addPoint(c.x,c.y),null!=t){var w=d>p?d:p,M=d>p?1:d/p,L=d>p?p/d:1;t.translate(_.x,_.y),t.rotate(f),t.scale(M,L),t.arc(0,0,w,T,T+k,1-m),t.scale(1/M,1/L),t.rotate(-f),t.translate(-_.x,-_.y)}}break;case"Z":case"z":null!=t&&t.closePath(),n.current=n.start}return r},this.getMarkers=function(){for(var e=this.PathParser.getMarkerPoints(),t=this.PathParser.getMarkerAngles(),n=[],r=0;r<e.length;r++)n.push([e[r],t[r]]);return n}},e.Element.path.prototype=new e.Element.PathElementBase,e.Element.pattern=function(t){this.base=e.Element.ElementBase,this.base(t),this.createPattern=function(t,n){var r=this.attribute("width").toPixels("x",!0),i=this.attribute("height").toPixels("y",!0),o=new e.Element.svg;o.attributes.viewBox=new e.Property("viewBox",this.attribute("viewBox").value),o.attributes.width=new e.Property("width",r+"px"),o.attributes.height=new e.Property("height",i+"px"),o.attributes.transform=new e.Property("transform",this.attribute("patternTransform").value),o.children=this.children;var a=document.createElement("canvas");a.width=r,a.height=i;var s=a.getContext("2d");this.attribute("x").hasValue()&&this.attribute("y").hasValue()&&s.translate(this.attribute("x").toPixels("x",!0),this.attribute("y").toPixels("y",!0));for(var l=-1;l<=1;l++)for(var u=-1;u<=1;u++)s.save(),s.translate(l*a.width,u*a.height),o.render(s),s.restore();var c=t.createPattern(a,"repeat");return c}},e.Element.pattern.prototype=new e.Element.ElementBase,e.Element.marker=function(t){this.base=e.Element.ElementBase,this.base(t),this.baseRender=this.render,this.render=function(t,n,r){t.translate(n.x,n.y),"auto"==this.attribute("orient").valueOrDefault("auto")&&t.rotate(r),"strokeWidth"==this.attribute("markerUnits").valueOrDefault("strokeWidth")&&t.scale(t.lineWidth,t.lineWidth),t.save();var i=new e.Element.svg;i.attributes.viewBox=new e.Property("viewBox",this.attribute("viewBox").value),i.attributes.refX=new e.Property("refX",this.attribute("refX").value),i.attributes.refY=new e.Property("refY",this.attribute("refY").value),i.attributes.width=new e.Property("width",this.attribute("markerWidth").value),i.attributes.height=new e.Property("height",this.attribute("markerHeight").value),i.attributes.fill=new e.Property("fill",this.attribute("fill").valueOrDefault("black")),i.attributes.stroke=new e.Property("stroke",this.attribute("stroke").valueOrDefault("none")),i.children=this.children,i.render(t),t.restore(),"strokeWidth"==this.attribute("markerUnits").valueOrDefault("strokeWidth")&&t.scale(1/t.lineWidth,1/t.lineWidth),"auto"==this.attribute("orient").valueOrDefault("auto")&&t.rotate(-r),t.translate(-n.x,-n.y)}},e.Element.marker.prototype=new e.Element.ElementBase,e.Element.defs=function(t){this.base=e.Element.ElementBase,this.base(t),this.render=function(e){}},e.Element.defs.prototype=new e.Element.ElementBase,e.Element.GradientBase=function(t){this.base=e.Element.ElementBase,this.base(t),this.gradientUnits=this.attribute("gradientUnits").valueOrDefault("objectBoundingBox"),this.stops=[];for(var n=0;n<this.children.length;n++){var r=this.children[n];"stop"==r.type&&this.stops.push(r)}this.getGradient=function(){},this.createGradient=function(t,n,r){var i=this;this.getHrefAttribute().hasValue()&&(i=this.getHrefAttribute().getDefinition());var o=function(t){if(r.hasValue()){var n=new e.Property("color",t);return n.addOpacity(r.value).value}return t},a=this.getGradient(t,n);if(null==a)return o(i.stops[i.stops.length-1].color);for(var s=0;s<i.stops.length;s++)a.addColorStop(i.stops[s].offset,o(i.stops[s].color));if(this.attribute("gradientTransform").hasValue()){var l=e.ViewPort.viewPorts[0],u=new e.Element.rect;u.attributes.x=new e.Property("x",-e.MAX_VIRTUAL_PIXELS/3),u.attributes.y=new e.Property("y",-e.MAX_VIRTUAL_PIXELS/3),u.attributes.width=new e.Property("width",e.MAX_VIRTUAL_PIXELS),u.attributes.height=new e.Property("height",e.MAX_VIRTUAL_PIXELS);var c=new e.Element.g;c.attributes.transform=new e.Property("transform",this.attribute("gradientTransform").value),c.children=[u];var d=new e.Element.svg;d.attributes.x=new e.Property("x",0),d.attributes.y=new e.Property("y",0),d.attributes.width=new e.Property("width",l.width),d.attributes.height=new e.Property("height",l.height),d.children=[c];var p=document.createElement("canvas");p.width=l.width,p.height=l.height;var f=p.getContext("2d");return f.fillStyle=a,d.render(f),f.createPattern(p,"no-repeat")}return a}},e.Element.GradientBase.prototype=new e.Element.ElementBase,e.Element.linearGradient=function(t){this.base=e.Element.GradientBase,this.base(t),this.getGradient=function(e,t){var n=t.getBoundingBox();this.attribute("x1").hasValue()||this.attribute("y1").hasValue()||this.attribute("x2").hasValue()||this.attribute("y2").hasValue()||(this.attribute("x1",!0).value=0,this.attribute("y1",!0).value=0,this.attribute("x2",!0).value=1,this.attribute("y2",!0).value=0);var r="objectBoundingBox"==this.gradientUnits?n.x()+n.width()*this.attribute("x1").numValue():this.attribute("x1").toPixels("x"),i="objectBoundingBox"==this.gradientUnits?n.y()+n.height()*this.attribute("y1").numValue():this.attribute("y1").toPixels("y"),o="objectBoundingBox"==this.gradientUnits?n.x()+n.width()*this.attribute("x2").numValue():this.attribute("x2").toPixels("x"),a="objectBoundingBox"==this.gradientUnits?n.y()+n.height()*this.attribute("y2").numValue():this.attribute("y2").toPixels("y");return r==o&&i==a?null:e.createLinearGradient(r,i,o,a)}},e.Element.linearGradient.prototype=new e.Element.GradientBase,e.Element.radialGradient=function(t){this.base=e.Element.GradientBase,this.base(t),this.getGradient=function(e,t){var n=t.getBoundingBox();this.attribute("cx").hasValue()||(this.attribute("cx",!0).value="50%"),this.attribute("cy").hasValue()||(this.attribute("cy",!0).value="50%"),this.attribute("r").hasValue()||(this.attribute("r",!0).value="50%");var r="objectBoundingBox"==this.gradientUnits?n.x()+n.width()*this.attribute("cx").numValue():this.attribute("cx").toPixels("x"),i="objectBoundingBox"==this.gradientUnits?n.y()+n.height()*this.attribute("cy").numValue():this.attribute("cy").toPixels("y"),o=r,a=i;this.attribute("fx").hasValue()&&(o="objectBoundingBox"==this.gradientUnits?n.x()+n.width()*this.attribute("fx").numValue():this.attribute("fx").toPixels("x")),this.attribute("fy").hasValue()&&(a="objectBoundingBox"==this.gradientUnits?n.y()+n.height()*this.attribute("fy").numValue():this.attribute("fy").toPixels("y"));var s="objectBoundingBox"==this.gradientUnits?(n.width()+n.height())/2*this.attribute("r").numValue():this.attribute("r").toPixels();return e.createRadialGradient(o,a,0,r,i,s)}},e.Element.radialGradient.prototype=new e.Element.GradientBase,e.Element.stop=function(t){this.base=e.Element.ElementBase,this.base(t),this.offset=this.attribute("offset").numValue(),this.offset<0&&(this.offset=0),this.offset>1&&(this.offset=1);var n=this.style("stop-color");this.style("stop-opacity").hasValue()&&(n=n.addOpacity(this.style("stop-opacity").value)),this.color=n.value},e.Element.stop.prototype=new e.Element.ElementBase,e.Element.AnimateBase=function(t){this.base=e.Element.ElementBase,this.base(t),e.Animations.push(this),this.duration=0,this.begin=this.attribute("begin").toMilliseconds(),this.maxDuration=this.begin+this.attribute("dur").toMilliseconds(),this.getProperty=function(){var e=this.attribute("attributeType").value,t=this.attribute("attributeName").value;return"CSS"==e?this.parent.style(t,!0):this.parent.attribute(t,!0)},this.initialValue=null,this.initialUnits="",this.removed=!1,this.calcValue=function(){return""},this.update=function(e){if(null==this.initialValue&&(this.initialValue=this.getProperty().value,this.initialUnits=this.getProperty().getUnits()),this.duration>this.maxDuration){if("indefinite"!=this.attribute("repeatCount").value&&"indefinite"!=this.attribute("repeatDur").value)return"remove"==this.attribute("fill").valueOrDefault("remove")&&!this.removed&&(this.removed=!0,this.getProperty().value=this.initialValue,!0);this.duration=0}this.duration=this.duration+e;var t=!1;if(this.begin<this.duration){var n=this.calcValue();if(this.attribute("type").hasValue()){var r=this.attribute("type").value;n=r+"("+n+")"}this.getProperty().value=n,t=!0}return t},this.from=this.attribute("from"),this.to=this.attribute("to"),this.values=this.attribute("values"),this.values.hasValue()&&(this.values.value=this.values.value.split(";")),this.progress=function(){var t={progress:(this.duration-this.begin)/(this.maxDuration-this.begin)};if(this.values.hasValue()){var n=t.progress*(this.values.value.length-1),r=Math.floor(n),i=Math.ceil(n);t.from=new e.Property("from",parseFloat(this.values.value[r])),t.to=new e.Property("to",parseFloat(this.values.value[i])),t.progress=(n-r)/(i-r)}else t.from=this.from,t.to=this.to;return t}},e.Element.AnimateBase.prototype=new e.Element.ElementBase,e.Element.animate=function(t){this.base=e.Element.AnimateBase,this.base(t),this.calcValue=function(){var e=this.progress(),t=e.from.numValue()+(e.to.numValue()-e.from.numValue())*e.progress;return t+this.initialUnits}},e.Element.animate.prototype=new e.Element.AnimateBase,e.Element.animateColor=function(t){this.base=e.Element.AnimateBase,this.base(t),this.calcValue=function(){var e=this.progress(),t=new RGBColor(e.from.value),n=new RGBColor(e.to.value);if(t.ok&&n.ok){var r=t.r+(n.r-t.r)*e.progress,i=t.g+(n.g-t.g)*e.progress,o=t.b+(n.b-t.b)*e.progress;return"rgb("+parseInt(r,10)+","+parseInt(i,10)+","+parseInt(o,10)+")"}return this.attribute("from").value}},e.Element.animateColor.prototype=new e.Element.AnimateBase,e.Element.animateTransform=function(t){this.base=e.Element.AnimateBase,this.base(t),this.calcValue=function(){for(var t=this.progress(),n=e.ToNumberArray(t.from.value),r=e.ToNumberArray(t.to.value),i="",o=0;o<n.length;o++)i+=n[o]+(r[o]-n[o])*t.progress+" ";return i}},e.Element.animateTransform.prototype=new e.Element.animate,e.Element.font=function(t){this.base=e.Element.ElementBase,this.base(t),this.horizAdvX=this.attribute("horiz-adv-x").numValue(),this.isRTL=!1,this.isArabic=!1,this.fontFace=null,this.missingGlyph=null,this.glyphs=[];for(var n=0;n<this.children.length;n++){var r=this.children[n];"font-face"==r.type?(this.fontFace=r,r.style("font-family").hasValue()&&(e.Definitions[r.style("font-family").value]=this)):"missing-glyph"==r.type?this.missingGlyph=r:"glyph"==r.type&&(""!=r.arabicForm?(this.isRTL=!0,this.isArabic=!0,"undefined"==typeof this.glyphs[r.unicode]&&(this.glyphs[r.unicode]=[]),this.glyphs[r.unicode][r.arabicForm]=r):this.glyphs[r.unicode]=r)}},e.Element.font.prototype=new e.Element.ElementBase,e.Element.fontface=function(t){this.base=e.Element.ElementBase,this.base(t),this.ascent=this.attribute("ascent").value,this.descent=this.attribute("descent").value,this.unitsPerEm=this.attribute("units-per-em").numValue()},e.Element.fontface.prototype=new e.Element.ElementBase,e.Element.missingglyph=function(t){this.base=e.Element.path,this.base(t),this.horizAdvX=0},e.Element.missingglyph.prototype=new e.Element.path,e.Element.glyph=function(t){this.base=e.Element.path,this.base(t),this.horizAdvX=this.attribute("horiz-adv-x").numValue(),this.unicode=this.attribute("unicode").value,this.arabicForm=this.attribute("arabic-form").value},e.Element.glyph.prototype=new e.Element.path,e.Element.text=function(t){this.captureTextNodes=!0,this.base=e.Element.RenderedElementBase,this.base(t),this.baseSetContext=this.setContext,this.setContext=function(e){this.baseSetContext(e),this.style("dominant-baseline").hasValue()&&(e.textBaseline=this.style("dominant-baseline").value),this.style("alignment-baseline").hasValue()&&(e.textBaseline=this.style("alignment-baseline").value)},this.getBoundingBox=function(){return new e.BoundingBox(this.attribute("x").toPixels("x"),this.attribute("y").toPixels("y"),0,0)},this.renderChildren=function(e){this.x=this.attribute("x").toPixels("x"),this.y=this.attribute("y").toPixels("y"),this.x+=this.getAnchorDelta(e,this,0);for(var t=0;t<this.children.length;t++)this.renderChild(e,this,t)},this.getAnchorDelta=function(e,t,n){var r=this.style("text-anchor").valueOrDefault("start");if("start"!=r){for(var i=0,o=n;o<t.children.length;o++){var a=t.children[o];if(o>n&&a.attribute("x").hasValue())break;i+=a.measureTextRecursive(e)}return-1*("end"==r?i:i/2)}return 0},this.renderChild=function(e,t,n){var r=t.children[n];r.attribute("x").hasValue()?r.x=r.attribute("x").toPixels("x")+this.getAnchorDelta(e,t,n):(this.attribute("dx").hasValue()&&(this.x+=this.attribute("dx").toPixels("x")),r.attribute("dx").hasValue()&&(this.x+=r.attribute("dx").toPixels("x")),r.x=this.x),this.x=r.x+r.measureText(e),r.attribute("y").hasValue()?r.y=r.attribute("y").toPixels("y"):(this.attribute("dy").hasValue()&&(this.y+=this.attribute("dy").toPixels("y")),r.attribute("dy").hasValue()&&(this.y+=r.attribute("dy").toPixels("y")),r.y=this.y),this.y=r.y,r.render(e);for(var n=0;n<r.children.length;n++)this.renderChild(e,r,n)}},e.Element.text.prototype=new e.Element.RenderedElementBase,e.Element.TextElementBase=function(t){this.base=e.Element.RenderedElementBase,this.base(t),this.getGlyph=function(e,t,n){var r=t[n],i=null;if(e.isArabic){var o="isolated";(0==n||" "==t[n-1])&&n<t.length-2&&" "!=t[n+1]&&(o="terminal"),n>0&&" "!=t[n-1]&&n<t.length-2&&" "!=t[n+1]&&(o="medial"),n>0&&" "!=t[n-1]&&(n==t.length-1||" "==t[n+1])&&(o="initial"),"undefined"!=typeof e.glyphs[r]&&(i=e.glyphs[r][o],null==i&&"glyph"==e.glyphs[r].type&&(i=e.glyphs[r]))}else i=e.glyphs[r];return null==i&&(i=e.missingGlyph),i},this.renderChildren=function(t){var n=this.parent.style("font-family").getDefinition();if(null==n)""!=t.fillStyle&&t.fillText(e.compressSpaces(this.getText()),this.x,this.y),""!=t.strokeStyle&&t.strokeText(e.compressSpaces(this.getText()),this.x,this.y);else{var r=this.parent.style("font-size").numValueOrDefault(e.Font.Parse(e.ctx.font).fontSize),i=this.parent.style("font-style").valueOrDefault(e.Font.Parse(e.ctx.font).fontStyle),o=this.getText();n.isRTL&&(o=o.split("").reverse().join(""));for(var a=e.ToNumberArray(this.parent.attribute("dx").value),s=0;s<o.length;s++){var l=this.getGlyph(n,o,s),u=r/n.fontFace.unitsPerEm;t.translate(this.x,this.y),t.scale(u,-u);var c=t.lineWidth;t.lineWidth=t.lineWidth*n.fontFace.unitsPerEm/r,"italic"==i&&t.transform(1,0,.4,1,0,0),l.render(t),"italic"==i&&t.transform(1,0,-.4,1,0,0),t.lineWidth=c,t.scale(1/u,-1/u),t.translate(-this.x,-this.y),this.x+=r*(l.horizAdvX||n.horizAdvX)/n.fontFace.unitsPerEm,"undefined"==typeof a[s]||isNaN(a[s])||(this.x+=a[s])}}},this.getText=function(){},
this.measureTextRecursive=function(e){for(var t=this.measureText(e),n=0;n<this.children.length;n++)t+=this.children[n].measureTextRecursive(e);return t},this.measureText=function(t){var n=this.parent.style("font-family").getDefinition();if(null!=n){var r=this.parent.style("font-size").numValueOrDefault(e.Font.Parse(e.ctx.font).fontSize),i=0,o=this.getText();n.isRTL&&(o=o.split("").reverse().join(""));for(var a=e.ToNumberArray(this.parent.attribute("dx").value),s=0;s<o.length;s++){var l=this.getGlyph(n,o,s);i+=(l.horizAdvX||n.horizAdvX)*r/n.fontFace.unitsPerEm,"undefined"==typeof a[s]||isNaN(a[s])||(i+=a[s])}return i}var u=e.compressSpaces(this.getText());if(!t.measureText)return 10*u.length;t.save(),this.setContext(t);var c=t.measureText(u).width;return t.restore(),c}},e.Element.TextElementBase.prototype=new e.Element.RenderedElementBase,e.Element.tspan=function(t){this.captureTextNodes=!0,this.base=e.Element.TextElementBase,this.base(t),this.text=t.nodeValue||t.text||"",this.getText=function(){return this.text}},e.Element.tspan.prototype=new e.Element.TextElementBase,e.Element.tref=function(t){this.base=e.Element.TextElementBase,this.base(t),this.getText=function(){var e=this.getHrefAttribute().getDefinition();if(null!=e)return e.children[0].getText()}},e.Element.tref.prototype=new e.Element.TextElementBase,e.Element.a=function(t){this.base=e.Element.TextElementBase,this.base(t),this.hasText=!0;for(var n=0;n<t.childNodes.length;n++)3!=t.childNodes[n].nodeType&&(this.hasText=!1);this.text=this.hasText?t.childNodes[0].nodeValue:"",this.getText=function(){return this.text},this.baseRenderChildren=this.renderChildren,this.renderChildren=function(t){if(this.hasText){this.baseRenderChildren(t);var n=new e.Property("fontSize",e.Font.Parse(e.ctx.font).fontSize);e.Mouse.checkBoundingBox(this,new e.BoundingBox(this.x,this.y-n.toPixels("y"),this.x+this.measureText(t),this.y))}else{var r=new e.Element.g;r.children=this.children,r.parent=this,r.render(t)}},this.onclick=function(){window.open(this.getHrefAttribute().value)},this.onmousemove=function(){e.ctx.canvas.style.cursor="pointer"}},e.Element.a.prototype=new e.Element.TextElementBase,e.Element.image=function(t){this.base=e.Element.RenderedElementBase,this.base(t);var n=this.getHrefAttribute().value,r=n.match(/\.svg$/);if(e.Images.push(this),this.loaded=!1,r)this.img=e.ajax(n),this.loaded=!0;else{this.img=document.createElement("img");var i=this;this.img.onload=function(){i.loaded=!0},this.img.onerror=function(){"undefined"!=typeof console&&(console.log('ERROR: image "'+n+'" not found'),i.loaded=!0)},this.img.src=n}this.renderChildren=function(t){var n=this.attribute("x").toPixels("x"),i=this.attribute("y").toPixels("y"),o=this.attribute("width").toPixels("x"),a=this.attribute("height").toPixels("y");0!=o&&0!=a&&(t.save(),r?t.drawSvg(this.img,n,i,o,a):(t.translate(n,i),e.AspectRatio(t,this.attribute("preserveAspectRatio").value,o,this.img.width,a,this.img.height,0,0),t.drawImage(this.img,0,0)),t.restore())},this.getBoundingBox=function(){var t=this.attribute("x").toPixels("x"),n=this.attribute("y").toPixels("y"),r=this.attribute("width").toPixels("x"),i=this.attribute("height").toPixels("y");return new e.BoundingBox(t,n,t+r,n+i)}},e.Element.image.prototype=new e.Element.RenderedElementBase,e.Element.g=function(t){this.base=e.Element.RenderedElementBase,this.base(t),this.getBoundingBox=function(){for(var t=new e.BoundingBox,n=0;n<this.children.length;n++)t.addBoundingBox(this.children[n].getBoundingBox());return t}},e.Element.g.prototype=new e.Element.RenderedElementBase,e.Element.symbol=function(t){this.base=e.Element.RenderedElementBase,this.base(t),this.baseSetContext=this.setContext,this.setContext=function(t){if(this.baseSetContext(t),this.attribute("viewBox").hasValue()){var n=e.ToNumberArray(this.attribute("viewBox").value),r=n[0],i=n[1];width=n[2],height=n[3],e.AspectRatio(t,this.attribute("preserveAspectRatio").value,this.attribute("width").toPixels("x"),width,this.attribute("height").toPixels("y"),height,r,i),e.ViewPort.SetCurrent(n[2],n[3])}}},e.Element.symbol.prototype=new e.Element.RenderedElementBase,e.Element.style=function(t){this.base=e.Element.ElementBase,this.base(t);for(var n="",r=0;r<t.childNodes.length;r++)n+=t.childNodes[r].nodeValue;n=n.replace(/(\/\*([^*]|[\r\n]|(\*+([^*\/]|[\r\n])))*\*+\/)|(^[\s]*\/\/.*)/gm,""),n=e.compressSpaces(n);for(var i=n.split("}"),r=0;r<i.length;r++)if(""!=e.trim(i[r]))for(var o=i[r].split("{"),a=o[0].split(","),s=o[1].split(";"),l=0;l<a.length;l++){var u=e.trim(a[l]);if(""!=u){for(var c={},d=0;d<s.length;d++){var p=s[d].indexOf(":"),f=s[d].substr(0,p),h=s[d].substr(p+1,s[d].length-p);null!=f&&null!=h&&(c[e.trim(f)]=new e.Property(e.trim(f),e.trim(h)))}if(e.Styles[u]=c,"@font-face"==u)for(var m=c["font-family"].value.replace(/"/g,""),g=c.src.value.split(","),v=0;v<g.length;v++)if(g[v].indexOf('format("svg")')>0)for(var y=g[v].indexOf("url"),b=g[v].indexOf(")",y),_=g[v].substr(y+5,b-y-6),x=e.parseXml(e.ajax(_)),w=x.getElementsByTagName("font"),C=0;C<w.length;C++){var T=e.CreateElement(w[C]);e.Definitions[m]=T}}}},e.Element.style.prototype=new e.Element.ElementBase,e.Element.use=function(t){this.base=e.Element.RenderedElementBase,this.base(t),this.baseSetContext=this.setContext,this.setContext=function(e){this.baseSetContext(e),this.attribute("x").hasValue()&&e.translate(this.attribute("x").toPixels("x"),0),this.attribute("y").hasValue()&&e.translate(0,this.attribute("y").toPixels("y"))},this.getDefinition=function(){var e=this.getHrefAttribute().getDefinition();return this.attribute("width").hasValue()&&(e.attribute("width",!0).value=this.attribute("width").value),this.attribute("height").hasValue()&&(e.attribute("height",!0).value=this.attribute("height").value),e},this.path=function(e){var t=this.getDefinition();null!=t&&t.path(e)},this.getBoundingBox=function(){var e=this.getDefinition();if(null!=e)return e.getBoundingBox()},this.renderChildren=function(e){var t=this.getDefinition();if(null!=t){var n=t.parent;t.parent=null,t.render(e),t.parent=n}}},e.Element.use.prototype=new e.Element.RenderedElementBase,e.Element.mask=function(t){this.base=e.Element.ElementBase,this.base(t),this.apply=function(t,n){var r=this.attribute("x").toPixels("x"),i=this.attribute("y").toPixels("y"),o=this.attribute("width").toPixels("x"),a=this.attribute("height").toPixels("y");if(0==o&&0==a){for(var s=new e.BoundingBox,l=0;l<this.children.length;l++)s.addBoundingBox(this.children[l].getBoundingBox());var r=Math.floor(s.x1),i=Math.floor(s.y1),o=Math.floor(s.width()),a=Math.floor(s.height())}var u=n.attribute("mask").value;n.attribute("mask").value="";var c=document.createElement("canvas");c.width=r+o,c.height=i+a;var d=c.getContext("2d");this.renderChildren(d);var p=document.createElement("canvas");p.width=r+o,p.height=i+a;var f=p.getContext("2d");n.render(f),f.globalCompositeOperation="destination-in",f.fillStyle=d.createPattern(c,"no-repeat"),f.fillRect(0,0,r+o,i+a),t.fillStyle=f.createPattern(p,"no-repeat"),t.fillRect(0,0,r+o,i+a),n.attribute("mask").value=u},this.render=function(e){}},e.Element.mask.prototype=new e.Element.ElementBase,e.Element.clipPath=function(t){this.base=e.Element.ElementBase,this.base(t),this.apply=function(t){for(var n=0;n<this.children.length;n++){var r=this.children[n];if("undefined"!=typeof r.path){var i=null;r.attribute("transform").hasValue()&&(i=new e.Transform(r.attribute("transform").value),i.apply(t)),r.path(t),t.clip(),i&&i.unapply(t)}}},this.render=function(e){}},e.Element.clipPath.prototype=new e.Element.ElementBase,e.Element.filter=function(t){this.base=e.Element.ElementBase,this.base(t),this.apply=function(e,t){var n=t.getBoundingBox(),r=Math.floor(n.x1),i=Math.floor(n.y1),o=Math.floor(n.width()),a=Math.floor(n.height()),s=t.style("filter").value;t.style("filter").value="";for(var l=0,u=0,c=0;c<this.children.length;c++){var d=this.children[c].extraFilterDistance||0;l=Math.max(l,d),u=Math.max(u,d)}var p=document.createElement("canvas");p.width=o+2*l,p.height=a+2*u;var f=p.getContext("2d");f.translate(-r+l,-i+u),t.render(f);for(var c=0;c<this.children.length;c++)this.children[c].apply(f,0,0,o+2*l,a+2*u);e.drawImage(p,0,0,o+2*l,a+2*u,r-l,i-u,o+2*l,a+2*u),t.style("filter",!0).value=s},this.render=function(e){}},e.Element.filter.prototype=new e.Element.ElementBase,e.Element.feMorphology=function(t){this.base=e.Element.ElementBase,this.base(t),this.apply=function(e,t,n,r,i){}},e.Element.feMorphology.prototype=new e.Element.ElementBase,e.Element.feColorMatrix=function(t){function n(e,t,n,r,i,o){return e[n*r*4+4*t+o]}function r(e,t,n,r,i,o,a){e[n*r*4+4*t+o]=a}this.base=e.Element.ElementBase,this.base(t),this.apply=function(e,t,i,o,a){for(var s=e.getImageData(0,0,o,a),i=0;i<a;i++)for(var t=0;t<o;t++){var l=n(s.data,t,i,o,a,0),u=n(s.data,t,i,o,a,1),c=n(s.data,t,i,o,a,2),d=(l+u+c)/3;r(s.data,t,i,o,a,0,d),r(s.data,t,i,o,a,1,d),r(s.data,t,i,o,a,2,d)}e.clearRect(0,0,o,a),e.putImageData(s,0,0)}},e.Element.feColorMatrix.prototype=new e.Element.ElementBase,e.Element.feGaussianBlur=function(t){this.base=e.Element.ElementBase,this.base(t),this.blurRadius=Math.floor(this.attribute("stdDeviation").numValue()),this.extraFilterDistance=this.blurRadius,this.apply=function(t,n,r,i,o){return"undefined"==typeof stackBlurCanvasRGBA?void("undefined"!=typeof console&&console.log("ERROR: StackBlur.js must be included for blur to work")):(t.canvas.id=e.UniqueId(),t.canvas.style.display="none",document.body.appendChild(t.canvas),stackBlurCanvasRGBA(t.canvas.id,n,r,i,o,this.blurRadius),void document.body.removeChild(t.canvas))}},e.Element.feGaussianBlur.prototype=new e.Element.ElementBase,e.Element.title=function(e){},e.Element.title.prototype=new e.Element.ElementBase,e.Element.desc=function(e){},e.Element.desc.prototype=new e.Element.ElementBase,e.Element.MISSING=function(e){"undefined"!=typeof console&&console.log("ERROR: Element '"+e.nodeName+"' not yet implemented.")},e.Element.MISSING.prototype=new e.Element.ElementBase,e.CreateElement=function(t){var n=t.nodeName.replace(/^[^:]+:/,"");n=n.replace(/\-/g,"");var r=null;return r="undefined"!=typeof e.Element[n]?new e.Element[n](t):new e.Element.MISSING(t),r.type=t.nodeName,r},e.load=function(t,n){e.loadXml(t,e.ajax(n))},e.loadXml=function(t,n){e.loadXmlDoc(t,e.parseXml(n))},e.loadXmlDoc=function(t,n){e.init(t);var r=function(e){for(var n=t.canvas;n;)e.x-=n.offsetLeft,e.y-=n.offsetTop,n=n.offsetParent;return window.scrollX&&(e.x+=window.scrollX),window.scrollY&&(e.y+=window.scrollY),e};1!=e.opts.ignoreMouse&&(t.canvas.onclick=function(t){var n=r(new e.Point(null!=t?t.clientX:event.clientX,null!=t?t.clientY:event.clientY));e.Mouse.onclick(n.x,n.y)},t.canvas.onmousemove=function(t){var n=r(new e.Point(null!=t?t.clientX:event.clientX,null!=t?t.clientY:event.clientY));e.Mouse.onmousemove(n.x,n.y)});var i=e.CreateElement(n.documentElement);i.root=!0;var o=!0,a=function(){e.ViewPort.Clear(),t.canvas.parentNode&&e.ViewPort.SetCurrent(t.canvas.parentNode.clientWidth,t.canvas.parentNode.clientHeight),1!=e.opts.ignoreDimensions&&(i.style("width").hasValue()&&(t.canvas.width=i.style("width").toPixels("x"),t.canvas.style.width=t.canvas.width+"px"),i.style("height").hasValue()&&(t.canvas.height=i.style("height").toPixels("y"),t.canvas.style.height=t.canvas.height+"px"));var r=t.canvas.clientWidth||t.canvas.width,a=t.canvas.clientHeight||t.canvas.height;if(1==e.opts.ignoreDimensions&&i.style("width").hasValue()&&i.style("height").hasValue()&&(r=i.style("width").toPixels("x"),a=i.style("height").toPixels("y")),e.ViewPort.SetCurrent(r,a),null!=e.opts.offsetX&&(i.attribute("x",!0).value=e.opts.offsetX),null!=e.opts.offsetY&&(i.attribute("y",!0).value=e.opts.offsetY),null!=e.opts.scaleWidth&&null!=e.opts.scaleHeight){var s=1,l=1,u=e.ToNumberArray(i.attribute("viewBox").value);i.attribute("width").hasValue()?s=i.attribute("width").toPixels("x")/e.opts.scaleWidth:isNaN(u[2])||(s=u[2]/e.opts.scaleWidth),i.attribute("height").hasValue()?l=i.attribute("height").toPixels("y")/e.opts.scaleHeight:isNaN(u[3])||(l=u[3]/e.opts.scaleHeight),i.attribute("width",!0).value=e.opts.scaleWidth,i.attribute("height",!0).value=e.opts.scaleHeight,i.attribute("viewBox",!0).value="0 0 "+r*s+" "+a*l,i.attribute("preserveAspectRatio",!0).value="none"}1!=e.opts.ignoreClear&&t.clearRect(0,0,r,a),i.render(t),o&&(o=!1,"function"==typeof e.opts.renderCallback&&e.opts.renderCallback(n))},s=!0;e.ImagesLoaded()&&(s=!1,a()),e.intervalID=setInterval(function(){var t=!1;if(s&&e.ImagesLoaded()&&(s=!1,t=!0),1!=e.opts.ignoreMouse&&(t|=e.Mouse.hasEvents()),1!=e.opts.ignoreAnimation)for(var n=0;n<e.Animations.length;n++)t|=e.Animations[n].update(1e3/e.FRAMERATE);"function"==typeof e.opts.forceRedraw&&1==e.opts.forceRedraw()&&(t=!0),t&&(a(),e.Mouse.runEvents())},1e3/e.FRAMERATE)},e.stop=function(){e.intervalID&&clearInterval(e.intervalID)},e.Mouse=new function(){this.events=[],this.hasEvents=function(){return 0!=this.events.length},this.onclick=function(e,t){this.events.push({type:"onclick",x:e,y:t,run:function(e){e.onclick&&e.onclick()}})},this.onmousemove=function(e,t){this.events.push({type:"onmousemove",x:e,y:t,run:function(e){e.onmousemove&&e.onmousemove()}})},this.eventElements=[],this.checkPath=function(e,t){for(var n=0;n<this.events.length;n++){var r=this.events[n];t.isPointInPath&&t.isPointInPath(r.x,r.y)&&(this.eventElements[n]=e)}},this.checkBoundingBox=function(e,t){for(var n=0;n<this.events.length;n++){var r=this.events[n];t.isPointInBox(r.x,r.y)&&(this.eventElements[n]=e)}},this.runEvents=function(){e.ctx.canvas.style.cursor="";for(var t=0;t<this.events.length;t++)for(var n=this.events[t],r=this.eventElements[t];r;)n.run(r),r=r.parent;this.events=[],this.eventElements=[]}},e}this.canvg=function(t,n,r){if(null!=t||null!=n||null!=r){r=r||{},"string"==typeof t&&(t=document.getElementById(t)),null!=t.svg&&t.svg.stop();var i=e();1==t.childNodes.length&&"OBJECT"==t.childNodes[0].nodeName||(t.svg=i),i.opts=r;var o=t.getContext("2d");"undefined"!=typeof n.documentElement?i.loadXmlDoc(o,n):"<"==n.substr(0,1)?i.loadXml(o,n):i.load(o,n)}else for(var a=document.getElementsByTagName("svg"),s=0;s<a.length;s++){var l=a[s],u=document.createElement("canvas");u.width=l.clientWidth,u.height=l.clientHeight,l.parentNode.insertBefore(u,l),l.parentNode.removeChild(l);var c=document.createElement("div");c.appendChild(l),canvg(u,c.innerHTML)}}}(),"undefined"!=typeof CanvasRenderingContext2D&&(CanvasRenderingContext2D.prototype.drawSvg=function(e,t,n,r,i){canvg(this.canvas,e,{ignoreMouse:!0,ignoreAnimation:!0,ignoreDimensions:!0,ignoreClear:!0,offsetX:t,offsetY:n,scaleWidth:r,scaleHeight:i})}),define("canvg",["rgbcolor"],function(e){return function(){var t;return t||e.canvg}}(this)),function(){define("cs!models/md2d/views/aminoacid-context-menu",["require","cs!models/md2d/models/aminoacids-helper"],function(e){var t,n,r,i,o,a,s,l,u,c;return u=e("cs!models/md2d/models/aminoacids-helper"),a="aminoacids-menu",i="hydrophobic",r="hydrophobic-category",n="hydrophilic",t="hydrophilic-category",l="pos-charge",s="neg-charge",o="marked",c=function(e,o){var a;return a={show:o?"slideDown":"show",hide:o?"slideUp":"hide"},"hydrophobic"===e?($("."+i)[a.show](),$("."+n)[a.hide](),$("."+r).addClass("expanded"),$("."+t).removeClass("expanded")):($("."+i)[a.hide](),$("."+n)[a.show](),$("."+r).removeClass("expanded"),$("."+t).addClass("expanded"))},{register:function(e,d,p,f){var h;return h=d.i18n,$.contextMenu("destroy",p),$.contextMenu({selector:p,appendTo:".lab-responsive-content",className:a,animation:{show:"show",hide:"hide"},trigger:"left",callback:function(t,n){var r,i,a;return a=f(),i=u.getAminoAcidByElement(a.element).abbreviation,n.items[i].$node.removeClass(o),r=u.abbrToElement(t),e.setAtomProperties(a.idx,{element:r}),d.repaint()},position:function(e,t,n){var r,i,o,a,s,l,u;return r=$(window),t||n?("maintain"===t&&"maintain"===n?a=e.$menu.position():(l=e.$trigger.parents().andSelf().filter(function(){return"fixed"===$(this).css("position")}).length,l&&(n-=r.scrollTop(),t-=r.scrollLeft()),a={top:n,left:t}),i=r.scrollTop()+r.height(),s=r.scrollLeft()+r.width(),o=e.$menu[0].scrollHeight,u=e.$menu[0].scrollWidth,a.top+o>i&&(a.top-=o),a.left+u>s&&(a.left-=u),a.left+=1,e.$menu.css(a)):void e.determinePosition.call(this,e.$menu)},events:{show:function(e){var t,n,r,a;return r=f(),n=r&&u.getAminoAcidByElement(r.element),!(!r||!n)&&(a=n.abbreviation,t=e.items[a].$node,t.addClass(o),c(t.hasClass(i)?"hydrophobic":"hydrophilic"),!0)},hide:function(e){var t,n;return n=f(),t=u.getAminoAcidByElement(n.element).abbreviation,e.items[t].$node.removeClass(o),!0}},items:{Hydrophobic:{name:h.t("md2d.aminoacid_menu.hydrophobic"),className:""+r,callback:function(){return c("hydrophobic",!0),!1}},Gly:{name:h.t("md2d.aminoacid_menu.glycine"),className:""+i},Ala:{name:h.t("md2d.aminoacid_menu.alanine"),className:""+i},Val:{name:h.t("md2d.aminoacid_menu.valine"),className:""+i},Leu:{name:h.t("md2d.aminoacid_menu.leucine"),className:""+i},Ile:{name:h.t("md2d.aminoacid_menu.isoleucine"),className:""+i},Phe:{name:h.t("md2d.aminoacid_menu.phenylalanine"),className:""+i},Pro:{name:h.t("md2d.aminoacid_menu.proline"),className:""+i},Trp:{name:h.t("md2d.aminoacid_menu.tryptophan"),className:""+i},Met:{name:h.t("md2d.aminoacid_menu.methionine"),className:""+i},Cys:{name:h.t("md2d.aminoacid_menu.cysteine"),className:""+i},Tyr:{name:h.t("md2d.aminoacid_menu.tyrosine"),className:""+i},Hydrophilic:{name:h.t("md2d.aminoacid_menu.hydrophilic"),className:""+t,callback:function(){return c("hydrophilic",!0),!1}},Asn:{name:h.t("md2d.aminoacid_menu.asparagine"),className:""+n},Gln:{name:h.t("md2d.aminoacid_menu.glutamine"),className:""+n},Ser:{name:h.t("md2d.aminoacid_menu.serine"),className:""+n},Thr:{name:h.t("md2d.aminoacid_menu.threonine"),className:""+n},Asp:{name:h.t("md2d.aminoacid_menu.asparticacid"),className:""+n+" "+s},Glu:{name:h.t("md2d.aminoacid_menu.glutamicacid"),className:""+n+" "+s},Lys:{name:h.t("md2d.aminoacid_menu.lysine"),className:""+n+" "+l},Arg:{name:h.t("md2d.aminoacid_menu.arginine"),className:""+n+" "+l},His:{name:h.t("md2d.aminoacid_menu.histidine"),className:""+n+" "+l}}}),c("hydrophobic")}}})}.call(this),define("models/md2d/views/atoms-interactions",["require","common/alert","cs!models/md2d/views/aminoacid-context-menu"],function(e){function t(e,t,n,r){return Math.atan2(n-e,r-t)}function n(e,t,n){return{x:e*Math.cos(n)-t*Math.sin(n),y:e*Math.sin(n)+t*Math.cos(n)}}var r=e("common/alert"),i=e("cs!models/md2d/views/aminoacid-context-menu"),o={},a="translate",s="rotate";return function(e,l,u){function c(e,t,n,r){if(0===r.button){var i=null;if(T(n)){var o=l.get("onAtomDrag")===a?[a,s]:[s,a];i=r.altKey?o[1]:o[0]}else C(n)&&(i=a);null!==i&&O(Q,i)}}function d(e,t,n,r){}function p(e,t,n){}function f(e,t,n,r){}function h(t,n,r,i){!Z&&e.clickHandler[".atom"]&&e.clickHandler[".atom"](t,n,r,r.idx)}function m(e,t,n,r){}function g(t){var n=E(t);Q=P(n.x,n.y),K=null,Z=!1,e.hitTestCallback(!!Q),Q&&c(n.x,n.y,Q,t)}function v(t){var n=E(t),r=P(n.x,n.y);e.hitTestCallback(!!r),r?d(n.x,n.y,r,t):p(n.x,n.y,t),J||S(r)}function y(t){var n=E(t),r=P(n.x,n.y),i=!1;e.hitTestCallback(!!r),r&&(f(n.x,n.y,r,t),r===Q&&(i=!0,h(n.x,n.y,Q))),e.mouseupCallback(i),Q=null}function b(e){}function _(e){var t=E(e);p(t.x,t.y,e),A("auto")}function x(t){var n=E(t);K=!Z&&P(n.x,n.y),e.hitTestCallback(!!K),K&&m(n.x,n.y,K)}function w(e){if(e.target!==u)return void A("auto");var t=E(e);S(P(t.x,t.y))}function C(e){return!!e&&(l.isStopped()?e.draggableWhenStopped||l.properties.isBeingEdited:e.draggable)}function T(e){return!!e&&(C(e)&&l.isStopped()&&l.getMoleculeAtoms(e.idx).length>0)}function S(e){A(C(e)?"move":"auto")}function A(e){ee!==e&&(ee=e,document.documentElement.style.cursor=e)}function k(){j=e.model2canvas,F=e.model2canvasInv,q=$(u),q.addClass("atoms-interaction-layer"),q.on("mousedown.atoms-interactions",g),q.on("mouseup.atoms-interactions",y),q.on("mousemove.atoms-interactions",v),q.on("mouseover.atoms-interactions",b),q.on("mouseout.atoms-interactions",_),q.on("contextmenu.atoms-interactions",x),V.bindModel(l)}function P(e,t){for(var n,r,i,o,a=z.length-1;a>=0;a--)if(n=z[a],r=n.x,i=n.y,o=n.radius,e>r-o&&e<r+o&&t>i-o&&t<i+o)return n;return null}function E(e,t){return t||(H=q.offset(),W=q.attr("width")/q.width(),Y=l.get("viewPortX")||0,X=l.get("viewPortY")||0),o.x=j.invert((e.pageX-H.left)*W)+Y,o.y=F.invert((e.pageY-H.top)*W)+X,o}function O(n,i){var o,s,u,c,d,p=i===a;$(window).on("mousemove.lab-drag",function(r){r.preventDefault();var i=E(r,!0),a=i.x,f=i.y;if(!Z){if(o=M(n),p)!l.isStopped()&&n.draggable&&l.liveDragStart(n.idx);else{u=l.getMoleculeAtoms(n.idx).concat(n.idx);var h=l.getMoleculeBoundingBox(n.idx);c=.5*(n.x+h.left+n.x+h.right),d=.5*(n.y+h.top+n.y+h.bottom),s=t(c,d,a,f)}J=!0,Z=!0}if(p)N(n,a,f);else{var m=t(c,d,a,f);B(u,c,d,s-m),s=m}A("move"),e.dragHandler.atom&&e.dragHandler.atom(a,f,n,n.idx),e.update()}).on("selectstart.lab-drag",function(e){e.preventDefault()}).one("mouseup.lab-drag",function(t){$(window).off(".lab-drag"),Z&&(J=!1,t.preventDefault(),w(t),p&&!l.isStopped()&&l.liveDragEnd(),l.isStopped()&&(D(n.idx)||(r(e.i18n.t("md2d.invalid_object_position_alert")),L(o),e.update())))})}function M(e){var t=l.getMoleculeAtoms(e.idx).concat(e.idx);return t.map(function(e){var t=l.getAtomProperties(e);return{idx:e,x:t.x,y:t.y}})}function L(e){e.forEach(function(e){R(e.idx,e.x,e.y)})}function N(e,t,n){var r=l.getMoleculeBoundingBox(e.idx);r.left+t<0&&(t=0-r.left),r.right+t>G&&(t=G-r.right),r.bottom+n<0&&(n=0-r.bottom),r.top+n>U&&(n=U-r.top),l.isStopped()?I(e.idx,t,n):l.liveDrag(t,n)}function R(e,t,n){return l.setAtomProperties(e,{x:t,y:n})}function I(e,t,n){return l.setAtomProperties(e,{x:t,y:n},!1,!0)}function D(e){return l.setAtomProperties(e,{},!0,!0)}function B(e,t,r,i){if(0!==i){for(var o=!0,a=0,s=e.length;a<s;a++){var u=e[a],c=l.getAtomProperties(u),d=n(c.x-t,c.y-r,i),p=R(u,d.x+t,d.y+r);o=o&&p}return o}}var V,j,F,z,G,U,q,H,W,Y,X,Q,K,J,Z,ee;return V={bindModel:function(t){l=t,z=l.getAtoms(),G=l.get("width"),U=l.get("height"),i.register(l,e,".atoms-interaction-layer",function(){return K})}},k(),V}}),define("models/md2d/views/atoms-renderer",["require","pixi","canvg","mustache","models/md2d/views/atoms-interactions","common/layout/detect-font-change"],function(e){var t=e("pixi"),n=e("canvg"),r=e("mustache"),i=e("models/md2d/views/atoms-interactions"),o=e("common/layout/detect-font-change"),a="bold",s='<svg x="0px" y="0px" width="{{ width }}px" height="{{ height }}px"        viewBox="0 0 32 32" xml:space="preserve">         <style type="text/css">         <![CDATA[           text {             font-family: {{{ fontFamily }}};             font-size: {{ fontSize }}px;             font-weight: '+a+';             fill: #222;           }           .shadow {             stroke: rgba(255, 255, 255, 0.7);             stroke-width: 3px;           }         ]]>         </style>          <defs>             <radialGradient id="grad" cx="50%" cy="47%" r="53%" fx="35%" fy="30%">               <stop stop-color="{{ lightCol }}" offset="0%"></stop>               <stop stop-color="{{ medCol }}" offset="40%"></stop>               <stop stop-color="{{ darkCol }}" offset="80%"></stop>               <stop stop-color="{{ medCol }}" offset="100%"></stop>             </radialGradient>          </defs>          <g opacity="{{ opacity }}">            {{#excited}}             <circle fill="#ffe600" cx="16" cy="16" r="12"/>             <circle fill="url(#grad)" cx="16" cy="16" r="8"/>            {{/excited}}            {{^excited}}             <circle fill="url(#grad)" cx="16" cy="16" r="16"/>            {{/excited}}            <text class="shadow" text-anchor="middle" x="16" y="16" dy="0.31em">{{ label }}</text>            <text text-anchor="middle" x="16" y="16" dy="0.31em">{{ label }}</text>          </g>        </svg>',l=["#FFFFFF","#F2F2F2","#A4A4A4"],u=["#FFFFFF","#FF8080","#FF2020"],c=25,d=["#FFFFFF","#f2f2f2","#A4A4A4"],p=d3.scale.linear().interpolate(d3.interpolateRgb).range(["#FFFFFF","#ffefff"]),f=d3.scale.linear().interpolate(d3.interpolateRgb).range(["#f2f2f2","#9090FF"]),h=d3.scale.linear().interpolate(d3.interpolateRgb).range(["#A4A4A4","#3030FF"]),m=d3.scale.linear().interpolate(d3.interpolateRgb).range(["#FFFFFF","#dfffff"]),g=d3.scale.linear().interpolate(d3.interpolateRgb).range(["#f2f2f2","#FF8080"]),v=d3.scale.linear().interpolate(d3.interpolateRgb).range(["#A4A4A4","#FF2020"]),y=function(e){var t=Math.round(Math.min(Math.abs(e)/3,1)*c);return t/=c,e>0?[p(t),f(t),h(t)]:e<0?[m(t),g(t),v(t)]:d},b=function(e){return e>0?["#F0E6D1","#E0A21B","#AD7F1C"]:["#dfffef","#75a643","#2a7216"]},_=["keShading","chargeShading","atomNumbers","showChargeSymbols","atomRadiusScale","aminoAcidColorScheme","aminoAcidLabels","useThreeLetterCode","viewPortZoom"];return function(e,c,d,p){function f(){E=c.get("width"),O=c.get("height"),h(),c.addPropertiesListener(_,function(){h(),C.setup(),e.renderCanvas()})}function h(){_.forEach(function(e){L[e]=c.get(e)})}function m(e){var t,n,r=k[e],i=r.element,o=c.getElementProperties(i);if(r.marked)return t=c.get("markColor"),n=d3.rgb(t),[n.brighter(1).toString(),n.toString(),n.darker(1).toString()];if(r.aminoAcid)switch(L.aminoAcidColorScheme){case"charge":return y(r.charge);case"hydrophobicity":return b(r.hydrophobicity);case"chargeAndHydro":return 0!==r.charge?y(r.charge):b(r.hydrophobicity)}return L.keShading?l:L.chargeShading?y(r.charge):(t=(o.color+Math.pow(2,24)).toString(16),t="000000".substr(0,6-t.length)+t,n=d3.rgb("#"+t),[n.brighter(1).toString(),n.toString(),n.darker(1).toString()])}function g(i,o){var a,l=k[i].element,u=S(c.getElementProperties(l).radius)*L.atomRadiusScale,d=k[i].visible,p=k[i].excitation,f=w(i);if(o=o||m(i),a=d?l+"-"+u+"-"+o.join("")+"-"+f.text+"-"+p+"-"+f.fontSize:u+"-invisible",void 0===M[a]){var h,g=document.createElement("canvas");x(e.fontFamily),h={width:p?4*u:2*u,height:p?4*u:2*u,lightCol:o[0],medCol:o[1],darkCol:o[2],opacity:Number(d),label:f.text,fontSize:f.fontSize,fontFamily:e.fontFamily,excited:p},n(g,r.render(s,h)),g.width<2&&(g.width=2),g.height<2&&(g.height=2),M[a]=new t.Texture.fromCanvas(g),g.svg.stop()}return M[a]}function v(){M={},P.forEach(function(e,t){e.setTexture(g(t))}),e.renderCanvas()}function x(e){o({font:e,weight:a,onchange:v})}function w(e){var t="",n=0;return L.atomNumbers?(t=e,n=1.2):L.aminoAcidLabels&&L.useThreeLetterCode&&k[e].label?(t=k[e].label,n=1):L.aminoAcidLabels&&!L.useThreeLetterCode&&k[e].symbol?(t=k[e].symbol,n=1.4):L.showChargeSymbols&&(k[e].charge>0?t="+":k[e].charge<0&&(t="-"),n=1.6),{text:t,fontSize:16*n}}var C,T,S,A,k,P,E,O,M={},L={},N=new i(e,c,p);return C={setup:function(){var n,r,i,o;for(T&&d.removeChild(T),T=new t.DisplayObjectContainer,d.addChild(T),S=e.model2canvas,A=e.model2canvasInv,P=[],k=c.getAtoms(),n=0,r=k.length;n<r;++n)i=new t.Sprite(g(n)),i.anchor.x=.5,i.anchor.y=.5,i.i=n,i.marked=k[n].marked,P.push(i),T.addChild(i);if(L.keShading)for(n=0,r=k.length;n<r;++n)o=new t.Sprite(g(n,u)),o.anchor.x=.5,o.anchor.y=.5,P[n].keSprite=o,T.addChild(o);C.update()},bindModel:function(e){c=e,f(),N.bindModel(e)},update:function(){var e,t,n,r,i,o,a,s;for(e=0,t=P.length;e<t;++e)n=P[e],r=k[e],i=S(r.x),o=A(r.y),n.position.x=i,n.position.y=o,r.marked!==n.marked&&(n.setTexture(g(e)),n.marked=k[e].marked),L.keShading&&(a=c.get("keShadingMinEnergy"),s=c.get("keShadingMaxEnergy"),n.keSprite.alpha=Math.min((c.getAtomKineticEnergy(e)-a)/(s-a),1),n.keSprite.position.x=i,n.keSprite.position.y=o),c.properties.useQuantumDynamics&&n.setTexture(g(e))},getAtomColors:m},f(),C}}),define("models/md2d/views/bonds-renderer",["require","pixi"],function(e){var t=e("pixi"),n={STANDARD_STICK:101,LONG_SPRING:102,BOND_SOLID_LINE:103,GHOST:104,UNICOLOR_STICK:105,SHORT_SPRING:106,DOUBLE_BOND:107,TRIPLE_BOND:108,DISULPHIDE_BOND:109},r=["keShading","chargeShading","aminoAcidColorScheme"];return function(e,i,o,a){function s(){i.addPropertiesListener(r,function(){p.setup(),e.renderCanvas()})}function l(e){var t,n,r,i=f(e.x1),o=h(e.y1),a=f(e.x2),s=h(e.y2),l=a-i,u=s-o,p=Math.sqrt(l*l+u*u)/f(.01),m=Math.floor(24*e.length),g=p/m,y=l/p,b=u/p,_=y*g,x=b*g,w=y*m,C=b*m;for(v.lineStyle(d(e),c(e,1)),v.moveTo(i,o),r=0;r<m;r++)r%2===0?(t=i+(r+.5)*_-.5*C,n=o+(r+.5)*x+.5*w):(t=i+(r+.5)*_+.5*C,n=o+(r+.5)*x-.5*w),v.lineTo(t,n);v.lineTo(a,s)}function u(e){var t=f(e.x1),r=h(e.y1),i=f(e.x2),o=h(e.y2),a=f(g[e.atom1].radius),s=f(g[e.atom2].radius),l=i-t,u=o-r,p=Math.sqrt(l*l+u*u);if(!(2*p-a-s<=0)){var m,y,b,_,x=.5*(p+a-s)/p,w=t+x*l,C=r+x*u,T=d(e);e.type===n.DOUBLE_BOND?(m=.4*f(Math.min(g[e.atom1].radius,g[e.atom2].radius)),y=Math.atan2(u,l),b=Math.sin(y)*m,_=-Math.cos(y)*m,v.lineStyle(T,c(e,1)),v.moveTo(t+b,r+_),v.lineTo(w+b,C+_),v.moveTo(t-b,r-_),v.lineTo(w-b,C-_),v.lineStyle(T,c(e,2)),v.moveTo(w+b,C+_),v.lineTo(i+b,o+_),v.moveTo(w-b,C-_),v.lineTo(i-b,o-_)):e.type===n.TRIPLE_BOND?(m=.52*f(Math.min(g[e.atom1].radius,g[e.atom2].radius)),y=Math.atan2(u,l),b=Math.sin(y)*m,_=-Math.cos(y)*m,v.lineStyle(T,c(e,1)),v.moveTo(t,r),v.lineTo(w,C),v.moveTo(t+b,r+_),v.lineTo(w+b,C+_),v.moveTo(t-b,r-_),v.lineTo(w-b,C-_),v.lineStyle(T,c(e,2)),v.moveTo(w,C),v.lineTo(i,o),v.moveTo(w+b,C+_),v.lineTo(i+b,o+_),v.moveTo(w-b,C-_),v.lineTo(i-b,o-_)):e.type!==n.GHOST&&(v.lineStyle(T,c(e,1)),v.moveTo(t,r),v.lineTo(w,C),v.lineStyle(T,c(e,2)),v.moveTo(w,C),v.lineTo(i,o))}}function c(e,t){return e.type===n.SHORT_SPRING?8947848:e.type===n.DISULPHIDE_BOND?16771418:1===t?parseInt(a.getAtomColors(e.atom1)[2].substr(1),16):2===t?parseInt(a.getAtomColors(e.atom2)[2].substr(1),16):void 0}function d(e){if(e.type===n.SHORT_SPRING)return f(.012);var t=f(Math.min(g[e.atom1].radius,g[e.atom2].radius));return e.type===n.DOUBLE_BOND?.5*t:e.type===n.TRIPLE_BOND?.35*t:.75*t}var p,f,h,m,g,v=new t.Graphics;return p={setup:function(){m=i.getRadialBonds(),g=i.getAtoms(),f=e.model2canvas,h=e.model2canvasInv,p.update()},bindModel:function(e){i=e,s()},update:function(){var e,t,r;for(v.clear(),e=0,t=m.length;e<t;++e)r=m[e],r.type===n.SHORT_SPRING?l(r):u(r)}},s(),o.addChild(v),p}}),define("models/md2d/views/vectors-renderer",["require","pixi"],function(e){var t=e("pixi");return function(e,n){function r(){f=n.count,h=n.x,m=n.y,g=n.vx,v=n.vy,y=n.alpha,p=n.show,b=n.length,_=n.width,x=n.color,w=n.dirOnly,l=n.m2px,u=n.m2pxInv}function i(){var e=document.createElement("canvas"),n=e.getContext("2d");return e.width=1,e.height=1,n.fillStyle=x,n.fillRect(0,0,1,1),new t.Texture.fromCanvas(e)}function o(){var e=document.createElement("canvas"),n=e.getContext("2d"),r=l(3.5*_);return e.width=r,e.height=r,n.fillStyle=x,n.beginPath(),n.moveTo(0,0),n.lineTo(r,0),n.lineTo(.5*r,r),n.closePath(),n.fill(),new t.Texture.fromCanvas(e)}function a(e){var t=d[e],n=h(e),r=m(e),i=g(e)*b,o=v(e)*b,a=Math.sqrt(i*i+o*o),s=Math.PI+Math.atan2(i,o),c=t.arrowHead;w&&(i=.15*b*i/a,o=.15*b*o/a,a=.15*b);var p=l(a);if(p<1)return t.alpha=0,void(c.alpha=0);if(y?(t.alpha=y(e),c.alpha=y(e)):(t.alpha=1,c.alpha=1),p>1e6){var f=p/1e6;i/=f,o/=f,a/=f,p/=f}t.position.x=l(n),t.position.y=u(r),t.scale.y=p,t.rotation=s,c.position.x=l(n+i),c.position.y=u(r+o),c.rotation=s}var s,l,u,c,d,p,f,h,m,g,v,y,b,_,x,w;return s={setup:function(){if(r(),c&&(e.removeChild(c),c=null),p&&0!==f){c=new t.DisplayObjectContainer,e.addChild(c);var n,a,u,h;for(d=[],h=i(),n=0;n<f;++n)a=new t.Sprite(h),a.anchor.x=.5,a.scale.x=l(_),a.i=n,d.push(a),c.addChild(a);for(h=o(),n=0;n<f;++n)u=new t.Sprite(h),u.anchor.x=.5,d[n].arrowHead=u,c.addChild(u);s.update()}},update:function(){if(p&&0!==f)for(var e=0;e<f;++e)a(e)}}}}),define("models/md2d/views/field-renderer",["require","pixi"],function(e){function t(e){return 1/(1+Math.exp(-e))}var n=e("pixi");return function(e,r){function i(){f=r.count,h=r.x,m=r.y,g=r.vx,v=r.vy,y=r.alpha,p=r.show,b=r.length,_=r.color,c=r.m2px,d=r.m2pxInv}function o(){var e=document.createElement("canvas"),r=e.getContext("2d"),i=.2,o=1/3,a=30,s=60,l=c(b),u=(l-a)/(s-a),d=i+t(-8*(u-.5))*(o-i),p=l*d;return e.height=l,e.width=p,r.beginPath(),r.moveTo(0,0),r.lineTo(.5*p,l),r.lineTo(p,0),
r.fillStyle=_,r.fill(),new n.Texture.fromCanvas(e)}function a(e){var t=u[e],n=h(e),r=m(e);t.position.x=c(n),t.position.y=d(r),t.rotation=Math.PI+Math.atan2(g(e),v(e)),t.alpha=y(e)}var s,l,u,c,d,p,f,h,m,g,v,y,b,_;return s={setup:function(){var t,r,a;if(i(),l&&(e.removeChild(l),l=null),p&&0!==f){for(l=new n.DisplayObjectContainer,e.addChild(l),u=[],a=o(),t=0;t<f;++t)r=new n.Sprite(a),r.anchor.x=.5,r.anchor.y=.5,r.i=t,u.push(r),l.addChild(r);s.update()}},update:function(){if(p&&0!==f)for(var e=0;e<f;++e)a(e)}}}}),define("models/md2d/views/vdw-lines-renderer",["require","pixi"],function(e){"use strict";var t=e("pixi"),n=5;return function(e,r,i){function o(r){var i=document.createElement("canvas"),o=i.getContext("2d"),a=e.model2canvas(.02),s=e.model2canvas(.03),l=r/2;h=n*(s+a)+s,i.width=h,i.height=r,o.strokeStyle="#aaa",o.lineWidth=r;for(var u=0,c=0;c<n;c++)o.moveTo(u,l),o.lineTo(u+s,l),o.stroke(),u+=s+a;return t.Texture.fromCanvas(i)}function a(){d&&(i.removeChild(d),d=null),m=[]}function s(){d=new t.DisplayObjectContainer,i.addChild(d),m=[]}function l(){var t;return r.properties.showVDWLines?(t=e.model2canvas(.02),t!==f&&(f=t,p=o(f),a(),s()),d||s(),void u()):void a()}function u(){if(r.properties.showVDWLines){var n,i,o,a,s,l,u,c,f,g=r.get_vdw_pairs(),v=r.getAtoms();for(n=m.length;n<g.count;n++)m[n]=new t.Sprite(p),m[n].anchor.y=.5,d.addChild(m[n]);for(n=0;n<g.count;n++)i=v[g.atom1[n]],o=v[g.atom2[n]],l=e.model2canvas(i.x),u=e.model2canvasInv(i.y),c=e.model2canvas(o.x),f=e.model2canvasInv(o.y),a=c-l,s=f-u,m[n].visible=!0,m[n].scale.x=Math.ceil(Math.sqrt(a*a+s*s))/h,m[n].position.x=l,m[n].position.y=u,m[n].rotation=Math.atan2(s,a);for(;n<m.length;n++)m[n].visible=!1}}function c(e){r=e}var d,p,f,h,m=[];return{setup:l,update:u,bindModel:c}}}),define("models/md2d/views/genetic-elements-renderer",["require","models/md2d/views/nucleotides","common/resources-url"],function(e){function t(e){var t=e.select("defs");return t.empty()&&(t=e.append("defs")),t}function n(e){var n,r=t(e);r.select("#transcription-bg").empty()&&(n=r.append("linearGradient").attr("id","transcription-bg").attr("x1","0%").attr("y1","0%").attr("x2","0%").attr("y2","100%"),n.append("stop").attr("stop-color","#C8DD69").attr("offset","0%"),n.append("stop").attr("stop-color","#778B3D").attr("offset","100%"))}function r(e,t,r,a){function u(e){return"scale("+e.scale+")"}function c(e){return e.opacity}function d(e){var n=e.translateX||0,i=e.translateY||0;return"translate("+t(n)+" "+r(i)+")"}function p(e){return d(e)+" "+u(e)}function f(e){var t=e?a.geneticEngine().PRECODING_LEN:0,n=Math.floor(a.properties.viewPortX/i.WIDTH)-2,r=Math.ceil((a.properties.viewPortX+a.properties.viewPortWidth)/i.WIDTH)+4;return[Math.max(0,n+t),r+t]}return{cells:function(e,n){var r=e.select(".background-layer").selectAll(".cells").data(n.cells);r.enter().append("image").attr({class:"cells",x:t(s.CELLS*-.567),y:t(l.CELLS*-.445),width:t(s.CELLS),height:t(l.CELLS),preserveAspectRatio:"none","xlink:href":o("dna/Cells.svg"),transform:p}).style("opacity",c),d3.transition(r).attr("transform",p).style("opacity",c),d3.transition(r.exit()).remove()},dna1:function(e,n){var r=e.select(".dna-layer").selectAll(".dna1").data(n.dna1);r.enter().append("image").attr({class:"dna1",x:t(s.DNA1*-.5),y:t(l.DNA1*-.5),width:t(s.DNA1),height:t(l.DNA1),preserveAspectRatio:"none","xlink:href":o("dna/DNA_InsideNucleus_1.svg"),transform:p}).style("opacity",c),d3.transition(r).attr("transform",p).style("opacity",c),d3.transition(r.exit()).remove()},dna2:function(e,n){var r=e.select(".dna-layer").selectAll(".dna2").data(n.dna2);r.enter().append("image").attr({class:"dna2",x:t(s.DNA2*-.5),y:t(l.DNA2*-.404),width:t(s.DNA2),height:t(l.DNA2),preserveAspectRatio:"none","xlink:href":o("dna/DNA_InsideNucleus_2.svg"),transform:p}).style("opacity",c),d3.transition(r).attr("transform",p).style("opacity",c),d3.transition(r.exit()).remove()},dna3:function(e,n){var r,i,a=14;r=e.select(".dna-layer").selectAll(".dna3").data(n.dna3),i=r.enter().append("g").attr({class:"dna3 main-dna",transform:p}).style("opacity",c),i.selectAll("dna3-unit").data(new Array(a)).enter().append("image").attr({class:"dna3-unit",x:function(e,n){return(n-.5*a)*t(s.DNA3)*.98},y:t(l.DNA3*-.5),width:t(s.DNA3),height:t(l.DNA3),preserveAspectRatio:"none","xlink:href":o("dna/DoubleHelix_Unit.svg")}),d3.transition(r).attr("transform",p).style("opacity",c),d3.transition(r.exit()).remove()},dna:function(e,n,r){var o=a.geneticEngine().viewModel,s=f(!0),l=n.dna[0]?n.dna[0].bonds:0,u=i(),c=e.select(".dna-layer").selectAll(".dna");return u.model2px(t).sequence(o.DNA.slice(s[0],s[1])).glow(a.get("DNAMutations")).bonds(l),r?void c.call(u.enterExitOnly(!0)):(c=c.data(n.dna),c.enter().append("g").attr({class:"dna",transform:d}),c.call(u),d3.transition(c).attr("transform",d),void d3.transition(c.exit()).remove())},dnaComp:function(e,n,r){var o=a.geneticEngine().viewModel,s=f(!0),l=n.dnaComp[0]?n.dnaComp[0].bonds:0,u=i(),c=e.select(".dna-layer").selectAll(".dna-comp");return u.model2px(t).sequence(o.DNAComp.slice(s[0],s[1])).direction(2).glow(a.get("DNAMutations")).bonds(l),r?void c.call(u.enterExitOnly(!0)):(c=c.data(n.dnaComp),c.enter().append("g").attr({class:"dna-comp",transform:d}),c.call(u),d3.transition(c).attr("transform",d),void d3.transition(c.exit()).remove())},mrna:function(e,n,r){var o=a.geneticEngine(),s=o.viewModel.mRNA,l=f(),u=o.stopCodonsHash(),c=n.mrna[0]?n.mrna[0].bonds:0,p=n.mrna[0]?n.mrna[0].direction:1,h=i(),m=e.select(".dna-layer").selectAll(".mrna");return h.model2px(t).sequence(s.slice(l[0],l[1])).backbone("RNA").direction(p).bonds(c).stopCodonsHash(u),r?void m.call(h.enterExitOnly(!0)):(m=m.data(n.mrna),m.enter().append("g").attr({class:"mrna",transform:d}),m.call(h),d3.transition(m).attr("transform",d),void d3.transition(m.exit()).remove())},polymeraseUnder:function(e,n){var r=e.select(".under-dna-layer").selectAll(".polymerase-under").data(n.polymeraseUnder);r.enter().append("image").attr({class:"polymerase-under",x:t(s.POLY_UNDER*-.5),y:t(l.POLY_UNDER*-.5),width:t(s.POLY_UNDER),height:t(l.POLY_UNDER),preserveAspectRatio:"none","xlink:href":o("dna/Polymerase_Under.svg"),transform:p}).style("opacity",c),d3.transition(r).attr("transform",p).style("opacity",c),d3.transition(r.exit()).remove()},polymeraseOver:function(e,n){var r=e.select(".over-dna-layer").selectAll(".polymerase-over").data(n.polymeraseOver);r.enter().append("image").attr({class:"polymerase-over",x:t(s.POLY_OVER*-.5),y:t(l.POLY_OVER*-.5),width:t(s.POLY_OVER),height:t(l.POLY_OVER),preserveAspectRatio:"none","xlink:href":o("dna/Polymerase_Over.svg"),transform:p}).style("opacity",c),d3.transition(r).attr("transform",p).style("opacity",c),d3.transition(r.exit()).remove()},nucleus:function(e,n){var r=e.select(".background-layer").selectAll(".nucleus").data(n.nucleus);r.enter().append("image").attr({class:"nucleus",x:t(s.NUCLEUS*-.5),y:t(l.NUCLEUS*-.5),width:t(s.NUCLEUS),height:t(l.NUCLEUS),preserveAspectRatio:"none","xlink:href":o("dna/BG_Nucleus.svg"),transform:d}).style("opacity",c),d3.transition(r).attr("transform",d).style("opacity",c),d3.transition(r.exit()).remove()},ribosomeBottom:function(e,n){var r=e.select(".over-dna-layer").selectAll(".ribosome-bottom").data(n.ribosomeBottom);r.enter().append("image").attr({class:"ribosome-bottom",x:t(s.RIBO_BOTTOM*-.5),y:t(l.RIBO_BOTTOM*-.5),width:t(s.RIBO_BOTTOM),height:t(l.RIBO_BOTTOM),preserveAspectRatio:"none","xlink:href":o("dna/Ribosome_bottom1.svg"),transform:d}).style("opacity",0),d3.transition(r).attr("transform",d).style("opacity",c),d3.transition(r.exit()).style("opacity",0).remove()},ribosomeTop:function(e,n){var r=e.select(".over-dna-layer").selectAll(".ribosome-top").data(n.ribosomeTop);r.enter().append("image").attr({class:"ribosome-top",x:t(s.RIBO_TOP*-.5),y:t(l.RIBO_TOP*-.5),width:t(s.RIBO_TOP),height:t(l.RIBO_TOP),preserveAspectRatio:"none","xlink:href":o("dna/Ribosome_top1.svg"),transform:d}).style("opacity",0),d3.transition(r).attr("transform",d).style("opacity",c),d3.transition(r.exit()).style("opacity",0).remove()},ribosomeUnder:function(e,n){var r=e.select(".under-dna-layer").selectAll(".ribosome-under").data(n.ribosomeUnder);r.enter().append("image").attr({class:"ribosome-under",x:t(s.RIBO_UNDER*-.5),y:t(l.RIBO_UNDER*-.5),width:t(s.RIBO_UNDER),height:t(l.RIBO_UNDER),preserveAspectRatio:"none","xlink:href":o("dna/Ribosome_under.png"),transform:d}).style({opacity:c}),d3.transition(r).attr("transform",d).style("opacity",c),d3.transition(r.exit()).remove()},ribosomeOver:function(e,n){var r=e.select(".over-dna-layer").selectAll(".ribosome-over").data(n.ribosomeOver);r.enter().append("image").attr({class:"ribosome-over",x:t(s.RIBO_OVER*-.5),y:t(l.RIBO_OVER*-.5),width:t(s.RIBO_OVER),height:t(l.RIBO_OVER),preserveAspectRatio:"none","xlink:href":o("dna/Ribosome_over.png"),transform:d}).style("opacity",c),d3.transition(r).attr("transform",d).style("opacity",c),d3.transition(r.exit()).remove()},trna:function(e,n){var r,u,p,f,h=a.geneticEngine(),m=3*i.WIDTH,g=.55*(m-s.TRNA);r=e.select(".top-layer").selectAll(".trna").data(n.trna,function(e){return e.index}),u=r.enter().append("g").attr({class:"trna",display:function(e){return e.index<0?"none":"inline"},transform:function(e,n){return"translate("+t(2*i.HEIGHT)+", "+t(-2.78)+") "+d(e,n)+" rotate(30)"}}).style("opacity",c),u.append("g").attr("transform","translate(0, "+t(-l.A)+")").call(i().model2px(t).sequence(function(e){return h.codonComplement(e.index)}).backbone(!1).randomEnter(!1)),u.append("image").attr({class:"trna-neck",x:t(.52*(m-s.TRNA_NECK)),y:t(-l.TRNA_NECK-.95*l.TRNA-.92*l.A),width:t(s.TRNA_NECK),height:t(l.TRNA_NECK),preserveAspectRatio:"none","xlink:href":o("dna/tRNA_neck.png")}),u.append("image").attr({class:"trna-base",x:t(g),y:t(-l.TRNA-.92*l.A),width:t(s.TRNA),height:t(l.TRNA),preserveAspectRatio:"none","xlink:href":o("dna/tRNA_base.png")}),p=d3.transition(r).attr("transform",d).style("opacity",c),p.select(".trna-neck").style("opacity",function(e){return e.neck}),f=d3.transition(r.exit()).attr("transform",function(e,n){return"translate("+t(i.HEIGHT*-5)+", "+t(i.HEIGHT*-4)+") "+d(e,n)+" rotate(-30)"}).style("opacity",0),f.selectAll(".bonds").style("opacity",0),f.remove()},viewPort:function(t,n){var r=n.viewPort[0].position,o=n.viewPort[0].ease,s=n.viewPort[0].drag,l=d3.transition(d3.select(e));a.set("viewPortDrag",!!s&&"x"),l.duration?(l.ease(o),l.tween("model-update",function(){var e=d3.interpolate(Number(a.properties.viewPortX),r*i.WIDTH);return function(t){var n=e(t);Math.abs(a.properties.viewPortX-n)>.001&&(a.properties.viewPortX=n)}})):a.set("viewPortX",r*i.WIDTH)},background:function(t,r){n(t),d3.transition(d3.select(e).select(".container-background")).attr("fill",r.background[0].color)}}}var i=e("models/md2d/views/nucleotides"),o=e("common/resources-url"),a=.007,s={CELLS:720,DNA1:661,DNA2:720,DNA3:337.4,POLY_UNDER:426.15,POLY_OVER:402.525,NUCLEUS:729.45,RIBO_TOP:550.7,RIBO_BOTTOM:509.031,RIBO_UNDER:550.55,RIBO_OVER:550.7,TRNA:117.325,TRNA_NECK:15.925},l={CELLS:500,DNA1:550,DNA2:414.263,DNA3:89.824,POLY_UNDER:368.6,POLY_OVER:368.6,NUCLEUS:543.199,RIBO_TOP:250,RIBO_BOTTOM:147.15,RIBO_UNDER:311.6,RIBO_OVER:311.6,TRNA:67.9,TRNA_NECK:21.14,A:31.15},u=["background","cells","dna1","dna2","dna3","polymeraseUnder","polymeraseOver","polymeraseUnder","polymeraseOver","dna","dnaComp","mrna","nucleus","ribosomeBottom","ribosomeTop","ribosomeUnder","ribosomeOver","trna","viewPort"];return function(){var e;for(e in s)s.hasOwnProperty(e)&&(s[e]*=a);for(e in l)l.hasOwnProperty(e)&&(l[e]*=a)}(),r.W=s,r.H=l,r.OBJECT_NAMES=u,r}),define("common/views/state-manager",[],function(){return function(e){var t,n=[],r={};return t={newState:function(t,i){var o=$.extend(!0,{},i);e.forEach(function(e){"undefined"==typeof o[e]&&(o[e]=[])}),n.push(o),r[t]=o},extendLastState:function(t,i){var o=n[n.length-1],a={};e.forEach(function(e){a[e]=[],"undefined"!=typeof i[e]&&i[e].forEach(function(t,n){a[e].push($.extend(!0,{},o[e][n],t))})}),n.push(a),r[t]=a},getState:function(e){var t,n=r[e],i=$.extend(!0,{},n);for(t in i)i.hasOwnProperty(t)&&i[t].forEach(function(e,r){var i;for(i in e)"function"==typeof e[i]&&(e[i]=n[t][r][i]())});return i}}}}),define("models/md2d/views/genetic-anim-states",["require","models/md2d/views/nucleotides","models/md2d/views/genetic-elements-renderer","common/views/state-manager"],function(e){var t=e("models/md2d/views/nucleotides"),n=e("models/md2d/views/genetic-elements-renderer"),r=e("common/views/state-manager"),i=n.H,o=n.OBJECT_NAMES;return function(e){function n(){var t=c.state();return"translation-end"===t.name?e.geneticEngine().lastTranslationStep():l=isNaN(t.step)?l:t.step}function a(){return(1.65+3*Math.max(0,n()-2))*t.WIDTH}function s(){return 3*this.index()*t.WIDTH}var l,u=new r(o),c=e.geneticEngine(),d=e.get("viewPortWidth"),p=e.get("viewPortHeight"),f=.5*d,h=.5*p;return u.newState("intro-cells",{cells:[{translateX:f+.33,translateY:h,scale:1}],dna1:[{translateX:f+.33,translateY:h,scale:.13,opacity:0}],viewPort:[{position:0,ease:"cubic-in-out",drag:!1}],background:[{color:"#8492ef"}]}),u.extendLastState("intro-zoom1",{cells:[{translateX:f,scale:6}],dna1:[{translateX:f,scale:.78,opacity:5}],dna2:[{translateX:f,translateY:h,scale:.5,opacity:0}],viewPort:[{}],background:[{}]}),u.extendLastState("intro-zoom2",{cells:[{scale:24}],dna1:[{scale:3.12,opacity:0}],dna2:[{scale:2,opacity:1}],dna3:[{translateX:f,translateY:h,scale:.2,opacity:0}],viewPort:[{}],background:[{}]}),u.extendLastState("intro-zoom3-s0",{cells:[{}],dna2:[{scale:3.8,opacity:0}],dna3:[{scale:.4,opacity:1}],viewPort:[{}],background:[{}]}),u.extendLastState("intro-zoom3",{cells:[{}],dna3:[{scale:.6}],polymeraseUnder:[{scale:.2,translateX:-2,translateY:4,opacity:1}],viewPort:[{}],background:[{}]}),u.extendLastState("intro-polymerase-s0",{cells:[{}],dna3:[{}],polymeraseUnder:[{scale:.8,translateX:f,translateY:h,opacity:1}],polymeraseOver:[{translateX:f,translateY:h,scale:.8,opacity:0}],viewPort:[{}],background:[{}]}),u.extendLastState("intro-polymerase",{cells:[{}],dna3:[{}],polymeraseUnder:[{scale:1}],polymeraseOver:[{scale:1,opacity:1}],viewPort:[{}],background:[{}]}),u.extendLastState("dna-s0",{cells:[{opacity:0}],dna3:[{scale:1.5}],polymeraseUnder:[{scale:2.5}],polymeraseOver:[{scale:2.5}],viewPort:[{}],background:[{}]}),u.extendLastState("dna",{polymeraseUnder:[{opacity:0}],polymeraseOver:[{opacity:0}],dna3:[{opacity:0}],dna:[{translateX:-e.geneticEngine().PRECODING_LEN*t.WIDTH,translateY:p/2+t.HEIGHT,bonds:1}],dnaComp:[{translateX:-e.geneticEngine().PRECODING_LEN*t.WIDTH,translateY:p/2-t.HEIGHT,bonds:1}],viewPort:[{position:-2,drag:!0}],background:[{color:"url(#transcription-bg)"}]}),u.extendLastState("transcription",{dna:[{translateY:p/2+2.5*t.HEIGHT,bonds:0}],dnaComp:[{translateY:p/2-2.5*t.HEIGHT,bonds:function(){var t=n()+e.geneticEngine().PRECODING_LEN;return function(e){return"c"===e.region&&e.idx<t?1:0}}}],mrna:[{translateY:p/2-.5*t.HEIGHT,bonds:1,direction:1}],viewPort:[{position:function(){return Math.max(0,Math.min(e.get("DNA").length-10,n()-6))-2},ease:"linear"}],background:[{}]}),u.extendLastState("transcription-end",{dna:[{}],dnaComp:[{bonds:function(){return function(e){return"c"===e.region?1:0}}}],mrna:[{}],polymeraseUnder:[{translateX:function(){return e.get("DNA").length*t.WIDTH},translateY:.5*p,scale:3.5,opacity:0}],polymeraseOver:[{translateX:function(){return e.get("DNA").length*t.WIDTH},translateY:.5*p,scale:3.5,opacity:0}],viewPort:[{position:function(){return Math.max(0,e.get("DNA").length-10)-2}}],background:[{}]}),u.extendLastState("after-transcription",{dna:[{}],dnaComp:[{}],mrna:[{}],polymeraseUnder:[{opacity:1}],polymeraseOver:[{opacity:1}],viewPort:[{}],background:[{}]}),u.extendLastState("before-translation-s0",{dna:[{}],dnaComp:[{}],mrna:[{}],polymeraseUnder:[{scale:1.4}],polymeraseOver:[{scale:1.4,opacity:0}],viewPort:[{}],background:[{color:"#8492ef"}]}),u.extendLastState("before-translation-s1",{dna:[{}],dnaComp:[{}],mrna:[{}],polymeraseUnder:[{translateX:function(){return e.get("viewPortX")+.5*d+5},translateY:.5*p-2,scale:.7}],viewPort:[{}],background:[{}]}),u.extendLastState("before-translation-s2",{dna:[{}],dnaComp:[{}],mrna:[{}],nucleus:[{translateX:.5*d-2*t.WIDTH,translateY:.5*p}],viewPort:[{position:-2,ease:"cubic-in-out"}],background:[{}]}),u.extendLastState("before-translation-s3",{dna:[{translateY:4*t.HEIGHT}],dnaComp:[{translateY:2*t.HEIGHT,bonds:0}],mrna:[{bonds:0}],nucleus:[{translateY:0}],viewPort:[{}],background:[{color:function(){return e.get("backgroundColor")}}]}),u.extendLastState("before-translation-s4",{dna:[{translateY:-1*t.HEIGHT}],dnaComp:[{translateY:-3*t.HEIGHT}],mrna:[{translateY:2.5*t.HEIGHT}],nucleus:[{translateY:i.NUCLEUS*-.5}],viewPort:[{}],background:[{}]}),u.extendLastState("before-translation",{mrna:[{translateY:1.5*t.HEIGHT,direction:2,bonds:0}],ribosomeBottom:[{translateX:-3,translateY:h,opacity:0}],viewPort:[{}],background:[{}]}),u.extendLastState("translation-s0",{mrna:[{}],ribosomeBottom:[{translateX:a,translateY:1.75*t.HEIGHT,opacity:1}],ribosomeTop:[{translateX:-3,translateY:6,opacity:0}],viewPort:[{}],background:[{}]}),u.extendLastState("translation-s1",{mrna:[{}],ribosomeBottom:[{}],ribosomeTop:[{translateX:a,translateY:4.52*t.HEIGHT,opacity:1}],ribosomeUnder:[{translateX:a,translateY:3.7*t.HEIGHT,opacity:0}],ribosomeOver:[{translateX:a,translateY:3.7*t.HEIGHT,opacity:0}],viewPort:[{}],background:[{}]}),u.extendLastState("translation",{mrna:[{bonds:function(){var e=n();return function(t){return t.idx<3*(e-2)||t.idx>=3*e?0:1}}}],ribosomeUnder:[{opacity:1}],ribosomeOver:[{opacity:1}],trna:[{index:function(){return n()-2},translateX:s,translateY:2.5*t.HEIGHT,neck:0},{index:function(){return n()-1},translateX:s,translateY:2.5*t.HEIGHT,neck:1}],viewPort:[{position:function(){return Math.max(0,3*(n()-3))-2},ease:"linear"}],background:[{}]}),u.extendLastState("translation-step0",{mrna:[{bonds:function(){var e=n();return function(t){return t.idx<3*(e-3)||t.idx>=3*e?0:1}}}],ribosomeUnder:[{}],ribosomeOver:[{}],trna:[{index:function(){return n()-3}},{index:function(){return n()-2}},{index:function(){return n()-1},translateX:s,translateY:2.5*t.HEIGHT,neck:1}],viewPort:[{}],background:[{}]}),u.extendLastState("translation-step1",{mrna:[{}],ribosomeUnder:[{}],ribosomeOver:[{}],trna:[{},{neck:0},{}],viewPort:[{}],background:[{}]}),u.extendLastState("translation-end-s0",{mrna:[{}],ribosomeUnder:[{}],ribosomeOver:[{}],trna:[{index:function(){return n()-2}},{index:function(){return n()-1},neck:0}],viewPort:[{}],background:[{}]}),u.extendLastState("translation-end-s1",{mrna:[{bonds:function(){var e=n();return function(t){return t.idx<3*(e-1)||t.idx>=3*e?0:1}}}],ribosomeUnder:[{}],ribosomeOver:[{}],trna:[{index:function(){return n()-1}}],viewPort:[{}],background:[{}]}),u.extendLastState("translation-end-s2",{mrna:[{bonds:0}],ribosomeUnder:[{}],ribosomeOver:[{}],viewPort:[{}],background:[{}]}),u.extendLastState("translation-end-s3",{mrna:[{}],ribosomeBottom:[{translateX:a,translateY:1.75*t.HEIGHT,opacity:1}],ribosomeTop:[{translateX:a,translateY:4.52*t.HEIGHT,opacity:1}],viewPort:[{}],background:[{}]}),u.extendLastState("translation-end-s4",{mrna:[{}],ribosomeBottom:[{translateY:1.75*t.HEIGHT-.3}],ribosomeTop:[{translateY:4.52*t.HEIGHT+.5}],viewPort:[{}],background:[{}]}),u.extendLastState("translation-end-s5",{mrna:[{}],ribosomeBottom:[{translateX:function(){return a()+8},translateY:1.75*t.HEIGHT-.5}],ribosomeTop:[{translateX:function(){return a()+8},translateY:4.52*t.HEIGHT+5}],viewPort:[{}],background:[{}]}),u.extendLastState("translation-end",{mrna:[{}],viewPort:[{}],background:[{}]}),u}}),define("common/jquery-svg-class",[],function(){function e(e,t,n,r){for(var i,o=[],a=0,s=e.length;a<s;a++)i=e[a],i instanceof SVGElement?o.push(n.apply(i,t)):o.push(r.apply($(i),t));return o}var t=$.fn.hasClass,n=$.fn.addClass,r=$.fn.removeClass,i=function(e){return new RegExp("(\\s|^)"+e+"(\\s|$)").test(this.getAttribute("class"))},o=function(e){i.apply(this,arguments)||this.setAttribute("class",this.getAttribute("class")+" "+e)},a=function(e){var t=this.getAttribute("class").replace(new RegExp("(\\s|^)"+e+"(\\s|$)","g"),"$2");i.apply(this,arguments)&&this.setAttribute("class",t)};$.fn.hasClass=function(n){for(var r=e(this,arguments,i,t),o=0,a=r.length;o<a;o++)if(r[o])return!0;return!1},$.fn.addClass=function(t){return $.isFunction(t)?n.apply(this,arguments):(e(this,arguments,o,n),this)},$.fn.removeClass=function(t){return $.isFunction(t)?r.apply(this,arguments):(e(this,arguments,a,r),this)}}),function(){var e={}.hasOwnProperty;define("cs!models/md2d/views/mutations-context-menu",["require","common/jquery-svg-class"],function(t){return t("common/jquery-svg-class"),{register:function(t,n,r,i){var o,a,s;o=null,s=function(t){var n,r,i;o=d3.select(t.$trigger[0]).datum().type,i=t.items.Substitution.items;for(r in i)e.call(i,r)&&(n=i[r],r=r.split(":")[1],n.$node.addClass(""+o+"-to-"+r));return d3.select(t.$trigger[0]).classed("glowing",!0),!0},a=function(t){var n,r,i;i=t.items.Substitution.items;for(r in i)e.call(i,r)&&(n=i[r],r=r.split(":")[1],n.$node.removeClass(""+o+"-to-"+r));return d3.select(t.$trigger[0]).classed("glowing",!1),!0},$.contextMenu("destroy",t),$.contextMenu({selector:t,appendTo:".lab-responsive-content",className:"mutations-menu",trigger:"left",events:{show:s,hide:a},callback:function(e,t){var i;switch(e=e.split(":"),i=d3.select(t.$trigger[0]).datum(),e[0]){case"substitute":return n.geneticEngine().mutate(i.idx,e[1],r);case"insert":return n.geneticEngine().insert(i.idx,e[1],r);case"delete":return n.geneticEngine().delete(i.idx)}},items:{Substitution:{name:i.t("md2d.mutations_menu.substitution_mutation"),className:"substitution-submenu",items:{"substitute:A":{name:""},"substitute:T":{name:""},"substitute:G":{name:""},"substitute:C":{name:""}}},Insertion:{name:i.t("md2d.mutations_menu.insertion_mutation"),className:"insertion-submenu",items:{"insert:A":{name:i.t("md2d.mutations_menu.insert"),className:"A"},"insert:T":{name:i.t("md2d.mutations_menu.insert"),className:"T"},"insert:G":{name:i.t("md2d.mutations_menu.insert"),className:"G"},"insert:C":{name:i.t("md2d.mutations_menu.insert"),className:"C"}}},delete:{name:i.t("md2d.mutations_menu.deletion_mutation")}}})}}})}.call(this),define("models/md2d/views/genetic-renderer",["require","models/md2d/views/nucleotides","models/md2d/views/genetic-elements-renderer","models/md2d/views/genetic-anim-states","cs!models/md2d/views/mutations-context-menu"],function(e){function t(e,t){function s(){t.geneticEngine().on("change",u),t.geneticEngine().on("transition",f),t.addPropertiesListener(["DNAMutations"],l),t.addPropertiesListener(["viewPortX"],function(){if(_&&t.get("DNA")&&("transcription"!==w.name||!A)){var e=P.getState(k||w.name);E.mrna(_,e,!0),E.dna(_,e,!0),E.dnaComp(_,e,!0),!A&&"translation-end"===w.name&&t.getNumberOfAtoms()>0&&t.geneticEngine().centerProtein()}}),o.register('[class~="dna"] [class~="clickable-nucleo"]',t,!1,e.i18n),o.register('[class~="dna-comp"] [class~="clickable-nucleo"]',t,!0,e.i18n)}function l(){w=t.geneticEngine().state(),p(),b.selectAll("g.genetics").remove(),_=null,t.get("DNA")&&(_=b.insert("g",".image-container-below").attr("class","genetics"),_.append("g").attr("class","background-layer"),_.append("g").attr("class","under-dna-layer"),_.append("g").attr("class","dna-layer"),_.append("g").attr("class","over-dna-layer"),_.append("g").attr("class","top-layer"),u())}function u(e){S=e,w=t.geneticEngine().state(),p(),c(_,w.name,null,A),A=!1}function c(e,t,n,r){function i(e){var t=!!s[e].length,n=!(!l||!l[e].length);return(!S||"viewPort"!==e)&&!!(r||t||n)}function o(){e.each(function(){var e=d3.select(this);a.forEach(function(t){i(t)&&E[t](e,s)})}),n&&n(e)}var s=P.getState(t),l=C?P.getState(C):null;e.duration?(e.each("start.transition-name",function(){k=t,o()}),e.each("end.transition-name",function(){k=null})):o(),C=t,T=w.step||0}function d(e){var t;return t=!e&&x&&x.node().__transition__?x.transition():_.transition(),x=t,t}function p(){var e=d3.select(g),t=e.select("g.genetics");!t.empty()&&t.node().__transition__&&(e.selectAll("g.genetics, g.genetics *").interrupt(),e.select(".container-background").interrupt(),x=null,k=null)}function f(e,n){A=!0,S=n,w=t.geneticEngine().state(),Number(e.split(":")[1])>0&&(e=e.split(":")[0]),m[e](),x.each("end.trans-end",function(){A=!1,t.geneticEngine().transitionEnded()})}var h,m,g=e.node,v=e.model2px,y=e.model2pxInv,b=d3.select(g).select(".below-atoms"),_=null,x=null,w=null,C=null,T=null,S=!1,A=!1,k=null,P=new i(t),E=new r(g,v,y,t);return m={"dna-updated":function(){var e=d(!0).ease("cubic-in-out").duration(800);c(e,w.name,null,!0)},"intro-zoom1":function(){var e=d(!0).ease("cubic").duration(3e3);c(e,"intro-zoom1")},"intro-zoom2":function(){var e=d(!0).ease("linear").duration(3e3);c(e,"intro-zoom2")},"intro-zoom3":function(){var e=d(!0).ease("linear").duration(2e3);c(e,"intro-zoom3-s0"),e=d().ease("quad-out").duration(3300),c(e,"intro-zoom3")},"intro-polymerase":function(){var e=d(!0).ease("quad-out").duration(3e3);c(e,"intro-polymerase-s0"),e=d().ease("cubic-in-out").duration(1e3),c(e,"intro-polymerase")},dna:function(){var e=d(!0).duration(2e3);c(e,"dna-s0"),e=d().duration(1e3),c(e,"dna",function(e){e.selectAll(".nucleotide").duration(5),e.selectAll(".container-background").duration(5)})},"transcription:0":function(){var e=d(!0).duration(1500);c(e,"transcription",function(e){e.selectAll(".bonds").duration(250)})},transcription:function(){var e=d(!0).duration(500);c(e,"transcription",function(e){e.selectAll(".bonds").ease("cubic")})},"transcription-end":function(){var e=d(!0).duration(500);c(e,"transcription-end",function(e){e.selectAll(".bonds").ease("cubic")})},"after-transcription":function(){var e=d(!0).ease("cubic-in-out").duration(700);c(e,"after-transcription")},"before-translation":function(){var e=d(!0).ease("cubic-in-out").duration(1e3);c(e,"before-translation-s0",function(e){e.selectAll(".container-background").duration(1)}),e=d().ease("cubic-in-out").duration(1500),c(e,"before-translation-s1"),e=d().ease("cubic-in-out").duration(1500),c(e,"before-translation-s2"),e=d().ease("cubic").duration(1e3),c(e,"before-translation-s3",function(e){e.selectAll(".bonds").duration(250),e.selectAll(".container-background").duration(1)}),e=d().ease("cubic-out").duration(1e3),c(e,"before-translation-s4"),e=d().ease("cubic-out").duration(500),c(e,"before-translation")},"translation:0":function(){var e=d(!0).ease("cubic-in-out").duration(1e3);c(e,"translation-s0"),e=d().ease("cubic-in-out").duration(1e3),c(e,"translation-s1"),e=d().ease("cubic-in-out").duration(500),c(e,"translation")},translation:function(){var e,r=t.geneticEngine(),i=w.step-1,o=1e3,a=500;e=d(!0).duration(o),c(e,"translation-step0",function(e){e.selectAll(".bonds").ease("cubic"),r.translationStepStarted(i,1.45+3*i*n.WIDTH,3.95,.53+3*i*n.WIDTH,1.57,o)}),e=d().duration(a),c(e,"translation-step1",function(e){e.selectAll(".trna-neck").duration(150),r.shiftAminoAcids(i,2*n.WIDTH,a)}),i>0&&(e=d().duration(900),c(e,"translation",function(e){r.connectAminoAcid(i),e.selectAll(".bonds").duration(150)}))},"translation-end":function(){var e,n=t.geneticEngine(),r=t.getNumberOfAtoms();r>=1?(e=d(!0).duration(150),c(e,"translation-end-s0"),e=d().duration(800),c(e,"translation-end-s1",function(e){n.translationCompleted(),e.selectAll(".bonds").duration(150)}),e=d().duration(800),c(e,"translation-end-s2",function(e){e.selectAll(".bonds").duration(150)}),e=d().duration(500),c(e,"translation-end-s3")):(e=d(!0).duration(500),c(e,"translation-end-s3")),e=d().duration(300),c(e,"translation-end-s4"),e=d().duration(1e3),c(e,"translation-end-s5"),e=d().duration(700),c(e,"translation-end",function(){n.centerProtein(700)})}},h={setup:l,render:u},s(),h}var n=e("models/md2d/views/nucleotides"),r=e("models/md2d/views/genetic-elements-renderer"),i=e("models/md2d/views/genetic-anim-states"),o=e("cs!models/md2d/views/mutations-context-menu"),a=r.OBJECT_NAMES;return d3.selection.prototype.interrupt=function(){return this.each(function(){var e=this.__transition__;if(e){var t=-1;for(var n in e)(n=+n)>t&&(t=n);e.active=t+1}})},t}),function(){define("cs!common/layout/wrap-svg-text",["require"],function(e){var t,n;return t="http://www.w3.org/2000/svg",n=window.wrapSVGText=function(e,n,r,i,o){var a,s,l,u,c,d,p,f,h,m,g,v,y,b,_,x,w,C,T;for(u=/-/gi,e.search("\n")>0?(w=e.split("\n"),f=!0,l=[]):(w=e.split(/[\s-]/),f=!1,l=function(){var t;for(t=[];m=u.exec(e);)t.push(m.index);return t}()),s=0,a=0,h=1,b=0,c=C=0,T=w.length;C<T;c=++C)x=w[c],s+=x.length+1,0===c||f||r>0&&a>r?(c>0&&(f?(b=Math.max(y.getComputedTextLength(),b),h++):(g=y.firstChild.nodeValue,g.length>w[c-1].length+1?(d=g.slice(g.length-w[c-1].length-1),y.firstChild.nodeValue=g.slice(0,g.length-w[c-1].length-1)):g.length===w[c-1].length+1&&(y.firstChild.nodeValue=g.slice(0,g.length-1)),b=Math.max(y.getComputedTextLength(),b),h++)),y=document.createElementNS(t,"tspan"),y.setAttributeNS(null,"x",i),y.setAttributeNS(null,"dy",0===c?0:o),v=document.createTextNode(p),y.appendChild(v),n.appendChild(y),p=~l.indexOf(s-1)?x+"-":x+" ",c&&d&&(p=d+p)):p+=~l.indexOf(s-1)?x+"-":x+" ",y.firstChild.nodeValue=p,a=y.getComputedTextLength(),f&&(b=Math.max(y.getComputedTextLength(),b)),f||c&&c===w.length-1&&r>0&&a>r&&(g=y.firstChild.nodeValue,y.firstChild.nodeValue=g.slice(0,g.length-w[c].length-1),y=document.createElementNS(t,"tspan"),y.setAttributeNS(null,"x",i),y.setAttributeNS(null,"dy",o),v=document.createTextNode(w[c]),y.appendChild(v),n.appendChild(y),h++);return 0===b&&(b=n.childNodes[0].getComputedTextLength()),_=r>b?r:b,{lines:h,width:_,textWidth:b}}})}.call(this),define("common/views/gradients",[],function(){return{createRadialGradient:function(e,t,n,r,i){var o,a,s;return a=i.select("defs"),a.empty()&&(a=i.append("defs")),s=a.select("#"+e),s.empty()?s=a.append("radialGradient").attr("id",e).attr("cx","50%").attr("cy","47%").attr("r","53%").attr("fx","35%").attr("fy","30%"):s.selectAll("stop").remove(),s.append("stop").attr("stop-color",t).attr("offset","0%"),s.append("stop").attr("stop-color",n).attr("offset","40%"),s.append("stop").attr("stop-color",r).attr("offset","80%"),s.append("stop").attr("stop-color",n).attr("offset","100%"),o="url(#"+e+")",this.mainColorOfGradient[o]=r,o},mainColorOfGradient:{},settleParens:function(e,t){var n,r,i;for(r=!1,e=e.split(""),n=0;n<e.length;n++)r?")"==e[n]?r=!1:"("==e[n]&&(e[i]=" ",i=n):"("==e[n]?t?(e[n]=" ",t=!1):(r=!0,i=n):")"==e[n]&&(e[n]=" ");return e.join("").replace(/\s+/," ").trim()},smartSplit:function(e,t){var n,r,i,o,a;for(e=this.settleParens(e,t),o=!1,i=[],r=1;r<e.length;r++)o?")"==e[r]&&(o=!1):","==e[r]||" "==e[r]?(a=e.slice(n,r).trim(),a.length>0&&i.push(this.parseWord(a)),n=r+1):"("==e[r]&&(o=!0);return r==e.length&&i.push(this.parseWord(e.slice(n,r).trim())),i},parseWord:function(e){var t,n;return t=new String(e),e.search(/(^|[^a-zA-Z])li?n?e?a?r?($|[^a-zA-Z])/)!=-1&&(t.isLinear=!0),e.search(/(^|[^a-zA-Z])ra?d?i?a?l?($|[^a-zA-Z])/)!=-1&&(t.isRadial=!0),e.search(/(^|[^a-zA-Z])gr?a?d?i?e?n?t?($|[^a-zA-Z])/)!=-1&&(t.isGradient=!0),e.search(/(\(|\))/)!=-1?(t.isParens=!0,t):(n=parseFloat(e),isNaN(n)||(t.asNumber=n),e.search(/(^|[^a-zA-Z])de?g?r?e?e?s?($|[^a-zA-Z])/)!=-1&&(t.isDegrees=!0),e.search(/(^|[^a-zA-Z])ri?g?h?t?($|[^a-zA-Z])/)!=-1&&(t.isRight=!0),e.search(/(^|[^a-zA-Z])le?f?t?($|[^a-zA-Z])/)!=-1&&(t.isLeft=!0),e.search(/(^|[^a-zA-Z])(t|u)o?p?($|[^a-zA-Z])/)!=-1&&(t.isTop=!0),e.search(/(^|[^a-zA-Z])bo?t?t?o?m?($|[^a-zA-Z])/)!=-1&&(t.isBottom=!0),e.search(/(^|[^a-zA-Z])re?pe?a?t?($|[^a-zA-Z])/)!=-1&&(t.isRepeat=!0),e.search(/(^|[^a-zA-Z])re?fl?e?c?t?($|[^a-zA-Z])/)!=-1&&(t.isReflect=!0),t)},interpolateStops:function(e){var t,n,r,i,o,a;if(0==e.length)return e;if("offset"in e[0]||(e[0].offset=0),1==e.length)return e;"offset"in e[e.length-1]||(e[e.length-1].offset=100);for(t=2;t<e.length;t++)if("offset"in e[t]&&!("offset"in e[t-1])){for(i=0,o=e[t].offset,n=t-2;n>=0;n--)if("offset"in e[n]){i=e[n].offset;
break}a=(o-i)/(t-n);for(var r=n+1;r<t;r++)e[r].offset=i+a*(r-n)}return e},fullParse:function(e){if(e=e.trim().toLowerCase(),e.search(/[^#0-9a-zA-Z-]/)==-1)return{color:e};var t,n,r,i,o,a,s,l,u,c,d;for(e=e.replace(/[\n\r:;]/g," ").replace(/\/\*.*\*\/$/,"").replace(/\{\[/,"(").replace(/\}\]/,")").replace(/[^a-zA-Z0-9%#\-\(\)\., ]*/g,"").replace(/\s*-\s+/g,"-").replace(/\s*\(/g,"(").replace(/\s+/g," "),n=this.smartSplit(e,!1),s={},a=0;a<n.length;a++)n[a].isParens!==!0||n[a].isGradient!==!0&&n[a].isLinear!==!0&&n[a].isRadial!==!0||n.splice.apply(n,[a,1].concat(this.smartSplit(n[a],!0)));for(r=!1,o=!1,i=!1,d=!1,u=0,c=0,a=0;a<n.length;a++)l=!1,n[a].isLeft===!0?(u-=1,l=!0):n[a].isRight===!0&&(u+=1,l=!0),n[a].isTop===!0?(c+=1,l=!0):n[a].isBottom===!0&&(c-=1,l=!0),n[a].isRadial===!0&&n[a].isRight!==!0&&(o=!0,l=!0),n[a].isLinear===!0&&n[a].isLeft!==!0&&(i=!0,l=!0),"asNumber"in n[a]&&(n[a].isDegrees===!0||a+1<n.length&&n[a+1].isDegrees===!0)&&(r===!1&&(r=n[a].asNumber),l=!0),n[a].isRepeat===!0?(d="repeat",l=!0):n[a].isReflect===!0&&(d="reflect",l=!0),(l||n[a].isDegrees===!0||n[a].isGradient===!0)&&(n.splice(a,1),a--);for(r!==!1||0==u&&0==c||(r=180*Math.atan2(c,u)/Math.PI%360),t=[],a=0;a<n.length;a++)"asNumber"in n[a]||(a+1<n.length&&"asNumber"in n[a+1]?(t.push({color:n[a],offset:n[a+1].asNumber}),n.splice(a,2)):(t.push({color:n[a]}),n.splice(a,1)),a--);if(1==t.length)return{color:t[0].color};if(0==t.length)return{color:"none"};for(this.interpolateStops(t),a=0;a<n.length;a++)n[a].isNumber===!0&&r===!1&&(r=n[a].asNumber);return o&&!i?(r=!1,s.gradient="radial"):(r===!1&&(r=0),r%=360,r<0&&(r+=360),s.gradient="linear",s.direction=r),d!==!1&&(s.repeat=d),s.stops=t,s.standard=this.toStandardForm(s),s},parse:function(e){if(e=e.trim().toLowerCase().replace(/\s+/g," "),e.search(/ /)==-1)return{color:e,standard:e};var t,n,r,i,o,a,s;if(t=e.split(" "),r={},i=t.shift(),"linear"!=i&&"radial"!=i)return this.fullParse(e);if(r.gradient=i,"linear"==i){if(n=parseFloat(t.shift()),isNaN(n))return this.fullParse(e);n%=360,n<0&&(n+=360),r.direction=n,s=!0}if(r.stops=[],t.length%2!=0)return this.fullParse(e);for(o=0;o<t.length;o+=2){if(a=parseFloat(t[o+1]),isNaN(a))return this.fullParse(e);r.stops.push({color:t[o],offset:a})}return s?r.standard=this.toStandardForm(r):r.standard=e,r},toCSS:function(e,t){var n,r;if("color"in e)t.style.backgroundColor=e.color.length?e.color:"inherit",t.style.backgroundImage="none";else{for(n="radial"==e.gradient?"-webkit-radial-gradient(ellipse,":"-webkit-linear-gradient("+e.direction+"deg, ",r=0;r<e.stops.length;r++)n+=e.stops[r].color+" "+e.stops[r].offset+"%",r<e.stops.length-1&&(n+=",");n+=")",t.style.backgroundColor="none",t.style.backgroundImage=n}},toStandardForm:function(e){var t,n;if("color"in e)return e.standard=e.color,e.color;for(t=e.gradient+" "+("linear"==e.gradient?e.direction+"deg ":""),n=0;n<e.stops.length;n++)t+=e.stops[n].color+" "+e.stops[n].offset+"%",n<e.stops.length-1&&(t+=" ");return e.standard=t,t},toSVG:function(e,t){if(e.color)return e.color;var n,r,i,o,a,s,l,u,c,d;if(n=t.select("defs"),n.empty()&&(n=t.append("defs")),i=e.standard.replace(/[^a-z0-9]/g,""),r=n.select("#"+i),!r.empty())return"url(#"+i+")";for("linear"==e.gradient?(l=-Math.cos(Math.PI*e.direction/180),u=-Math.sin(Math.PI*e.direction/180),Math.abs(u)>Math.abs(l)?(a=l*Math.abs(50/u),s=50*(u<0?-1:1)):(a=50*(l<0?-1:1),s=u*Math.abs(50/l)),r=n.append("linearGradient").attr("id",i).attr("x1",50+a+"%").attr("y1",50+s+"%").attr("x2",50-a+"%").attr("y2",50-s+"%")):r=n.append("radialGradient").attr("id",i).attr("cx","50%").attr("cy","50%").attr("r","50%").attr("fx","50%").attr("fy","50%"),o=0;o<e.stops.length;o++)d=r.append("stop").attr("stop-color",e.stops[o].color).attr("offset",e.stops[o].offset+"%"),c=e.stops[o].color.split(","),4!=c.length||isNaN(c=parseFloat(c[3]))||d.attr("stop-opacity",c);return"url(#"+i+")"}}}),define("common/views/color",[],function(){function e(e){var t=e.match(/rgba\(([0-9]+),([0-9]+),([0-9]+),([0-9]+)\)/i);return null!==t?d3.rgb(t[1],t[2],t[3]):d3.rgb(e)}return{contrastingColor:function(t){return t=e(t),(299*t.r+587*t.g+114*t.b)/1e3>=128?"#000":"#fff"},color2number:function(t){return parseInt(e(t).toString().substr(1),16)}}}),define("models/md2d/views/images-renderer",["lab.config"],function(){var e=require("lab.config"),t=0,n=1;return function(r,i){function o(e,t){if(!m[e]){m[e]={width:0,height:0};var n=new Image;n.src=e,n.onload=function(){var i=$(n).appendTo("body"),o=m[e];o.width=i.width()*t,o.height=i.height()*t,i.remove(),d3.select(r.node).selectAll("image").each(function(){d3.select(this).attr("xlink:href")===e&&d3.select(this).attr("width",a(o.width)).attr("height",a(o.height)).attr("transform",c)})}}}function a(e){return r.model2px(.01*e)}function s(){var e=[{},{}];h=[[],[]],(i.properties.images||[]).forEach(function(i){var a,s,l,c,d=1===i.imageLayer?1:0,p=h[d],f=e[d],m=u(i);i.imageHostType?(a=n,s=!1):(a=t,s=!0,l=r.model2px(i.imageX),c=r.model2pxInv(i.imageY)),o(m,i.scale),p.push({imageDescription:i,src:m,srcIndex:void 0===f[m]?f[m]=0:++f[m],x:l,y:c,rotation:i.rotation,scale:i.scale,opacity:i.opacity,referencePoint:a,capturesPointer:s,zOrder:i.imageLayerPosition||0,visible:i.visible})}),h.forEach(function(e){e.sort(function(e,t){return d3.ascending(e.zOrder,t.zOrder)})}),l()}function l(){h.forEach(function(e){e.forEach(function(e){var t,n,o,a,s,l=e.imageDescription,u=l.imageHostType,c=l.imageHostIndex,d=l.rotation||0;"Atom"===u?(t=i.getAtoms(),a=t[c].x,s=t[c].y):"RectangularObstacle"===u?(n=i.get_obstacles(),a=n.x[c]+n.width[c]/2,s=n.y[c]+n.height[c]/2):"RadialBond"===u&&(o=i.getRadialBonds()[c],a=(o.x1+o.x2)/2,s=(o.y1+o.y2)/2,d+=180*Math.atan2(o.y1-o.y2,o.x1-o.x2)/Math.PI),void 0!==a&&(e.x=r.model2px(a),e.y=r.model2pxInv(s)),e.rotation=d})})}function u(t){var n,o=i.properties.imageMapping;return i.properties.imagePath?n=e.modelsRootUrl+i.properties.imagePath:r.url&&(n=e.modelsRootUrl+r.url.slice(0,r.url.lastIndexOf("/")+1)),n+(o[t.imageUri]||t.imageUri)}function c(e){var n,r,i,o=m[e.src],s=a(o.width/2),l=a(o.height/2);return e.referencePoint===t?(n=e.x,r=e.y):(n=e.x-s,r=e.y-l),i=0===e.rotation?["translate(",n,", ",r,")"]:["translate(",n,", ",r,") rotate(",-e.rotation,",",s,",",l,")"],i.join("")}function d(){s(),d3.select(r.node).selectAll(".image-container").data(h).each(function(e){var t=d3.select(this).selectAll("image").data(e,function(e){return e.src+"-"+e.srcIndex});t.enter().append("image").attr("xlink:href",function(e){return e.src}),t.attr({height:function(e){return a(m[e.src].height)},width:function(e){return a(m[e.src].width)},opacity:function(e){return e.opacity},"pointer-events":function(e){return e.capturesPointer?"auto":"none"},transform:c}).style("display",function(e){return e.visible?"":"none"}),t.exit().remove()})}function p(){l(),d3.select(r.node).selectAll(".image-container image").attr("transform",c)}function f(e){i=e}var h,m={};return{setup:d,update:p,bindModel:f}}}),define("models/md2d/views/renderer",["require","lab.config","common/console","common/benchmark/benchmark","models/md2d/views/atoms-renderer","models/md2d/views/bonds-renderer","models/md2d/views/vectors-renderer","models/md2d/views/field-renderer","./vdw-lines-renderer","models/md2d/views/genetic-renderer","cs!common/layout/wrap-svg-text","common/views/gradients","common/views/color","./images-renderer"],function(e){var t=e("lab.config"),n=e("common/console"),r=e("common/benchmark/benchmark"),i=e("models/md2d/views/atoms-renderer"),o=e("models/md2d/views/bonds-renderer"),a=e("models/md2d/views/vectors-renderer"),s=e("models/md2d/views/field-renderer"),l=e("./vdw-lines-renderer"),u=e("models/md2d/views/genetic-renderer"),c=e("cs!common/layout/wrap-svg-text"),d=e("common/views/gradients"),p=e("common/views/color").contrastingColor,f=e("./images-renderer"),h=5,m=12,g=[[255,0,0],[255,200,0],[255,255,0],[0,255,0],[0,255,255],[0,0,255],[139,0,255]];return function(e,v){function y(e,t,n){if(!t||"none"===t)return"none";var r="arrowhead-path"+t.toLowerCase().replace(/[^a-z0-9]/g,"")+(n?"start":"")+de.lineColor[e].toLowerCase().replace(/[^a-z0-9]/g,"");if(!ie[r]){var i,o;i=Ee.select("defs"),i.empty()&&(i=Ee.append("defs")),o=i.select("#"+r),o=Ee.append("marker").attr("id",r).attr("class","custom-arrow-head").attr("viewBox","0 0 10 10").attr("refX","5").attr("refY","5").attr("markerUnits","strokeWidth").attr("markerWidth","4").attr("markerHeight","4").attr("orient","auto"),o.append("path").attr("d",t).attr("fill",de.lineColor[e]).attr("transform",n?"translate(10, 10) rotate(180)":""),ie[r]=!0}return"url(#"+r+")"}function b(e,t){var n,r,i="Triangle-"+t;n=Ee.select("defs"),n.empty()&&(n=Ee.append("defs")),r=n.select("#"+i).remove(),r=n.append("marker").attr("id","Triangle-"+t).attr("viewBox","0 0 10 10").attr("refX","0").attr("refY","5").attr("markerUnits","strokeWidth").attr("markerWidth","4").attr("markerHeight","3").attr("orient","auto").attr("stroke",e).attr("fill",e),r.append("path").attr("d","M 0 0 L 10 5 L 0 10 z")}function _(){var e,t;e=Ee.select("defs"),e.empty()&&(e=Ee.append("defs")),t=e.select("#glow"),t.empty()&&(t=e.append("filter").attr("id","glow").attr("x","-2").attr("y","-2").attr("width","800%").attr("height","800%"),t.append("feMorphology").attr("result","bigger").attr("in","SourceGraphic").attr("operator","dilate").attr("radius","6"),t.append("feGaussianBlur").attr("result","blurOut").attr("in","bigger").attr("stdDeviation","10"),t.append("feBlend").attr("in","SourceGraphic").attr("in2","blurOut").attr("mode","normal"))}function x(){var e="1%",t=Math.max(oe,12);je.select("#heat-bath").empty()&&je.append("image").attr({id:"heat-bath",x:e,width:2*t,height:2*t,preserveAspectRatio:"xMinYMin","xlink:href":"data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXRmLTgiPz4NCjwhLS0gR2VuZXJhdG9yOiBBZG9iZSBJbGx1c3RyYXRvciAxNC4wLjAsIFNWRyBFeHBvcnQgUGx1Zy1JbiAuIFNWRyBWZXJzaW9uOiA2LjAwIEJ1aWxkIDQzMzYzKSAgLS0+DQo8IURPQ1RZUEUgc3ZnIFBVQkxJQyAiLS8vVzNDLy9EVEQgU1ZHIDEuMS8vRU4iICJodHRwOi8vd3d3LnczLm9yZy9HcmFwaGljcy9TVkcvMS4xL0RURC9zdmcxMS5kdGQiPg0KPHN2ZyB2ZXJzaW9uPSIxLjEiIGlkPSJMYXllcl8xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB4PSIwcHgiIHk9IjBweCINCgkgd2lkdGg9Ijk2LjIzNnB4IiBoZWlnaHQ9IjUzLjMyMXB4IiB2aWV3Qm94PSIxLjc2NCAxMy44MSA5Ni4yMzYgNTMuMzIxIiBlbmFibGUtYmFja2dyb3VuZD0ibmV3IDEuNzY0IDEzLjgxIDk2LjIzNiA1My4zMjEiDQoJIHhtbDpzcGFjZT0icHJlc2VydmUiPg0KPGxpbmVhckdyYWRpZW50IGlkPSJTVkdJRF8xXyIgZ3JhZGllbnRVbml0cz0idXNlclNwYWNlT25Vc2UiIHgxPSItNjIyIiB5MT0iOTQ1LjU2MSIgeDI9Ii02MjIiIHkyPSI5MjYuNDM5OSI+DQoJPHN0b3AgIG9mZnNldD0iMCIgc3R5bGU9InN0b3AtY29sb3I6IzU1NTU1NSIvPg0KCTxzdG9wICBvZmZzZXQ9IjEiIHN0eWxlPSJzdG9wLWNvbG9yOiNGRkZGRkYiLz4NCjwvbGluZWFyR3JhZGllbnQ+DQo8cGF0aCBmaWxsPSIjRTZFN0U4IiBzdHJva2U9InVybCgjU1ZHSURfMV8pIiBzdHJva2Utd2lkdGg9IjAuNSIgc3Ryb2tlLW1pdGVybGltaXQ9IjEwIiBkPSJNNzEuMzMsMTQuMzg0DQoJYy04Ljk0MiwwLTE2LjgyNyw0LjQ1OS0yMS41OTYsMTEuMjY1Yy00Ljc3LTYuODAzLTEyLjY1NS0xMS4yNjUtMjEuNTk4LTExLjI2NWMtMTQuNTY0LDAtMjYuMzczLDExLjgwNi0yNi4zNzMsMjYuMzczDQoJYzAsMTQuNTY4LDExLjgwNSwyNi4zNzQsMjYuMzczLDI2LjM3NGM4Ljk0MiwwLDE2LjgyOC00LjQ2LDIxLjU5OC0xMS4yNjZjNC43NjksNi44MDIsMTIuNjUzLDExLjI2NiwyMS41OTYsMTEuMjY2DQoJYzE0LjU2NiwwLDI2LjM3Mi0xMS44MDYsMjYuMzcyLTI2LjM3NEM5Ny43MDIsMjYuMTksODUuODk2LDE0LjM4NCw3MS4zMywxNC4zODR6Ii8+DQo8cGF0aCBmaWxsPSIjNTU1NTU1IiBkPSJNMzEuNDQ4LDQ3LjcxOVYyNy4xMzNjMC0xLjE2LTAuOTQxLTIuMS0yLjEwMi0yLjFjLTEuMTU3LDAtMi4wOTUsMC45NC0yLjA5NSwyLjF2MjAuNTg2DQoJYy0xLjM4NSwwLjc1Mi0yLjMzOCwyLjE5Ni0yLjMzOCwzLjg4MWMwLDIuNDQ3LDEuOTg2LDQuNDI4LDQuNDMzLDQuNDI4YzIuNDUxLDAsNC40MzQtMS45OCw0LjQzNC00LjQyOA0KCUMzMy43ODMsNDkuOTE2LDMyLjgzLDQ4LjQ3MSwzMS40NDgsNDcuNzE5eiIvPg0KPHBhdGggZmlsbD0iIzU1NTU1NSIgZD0iTTgwLjIwOSwzNy42NjN2LTMuOTc0YzAtNC43NzUtMy44ODItOC42NTktOC42NTMtOC42NTlTNjIuOSwyOC45MTUsNjIuOSwzMy42ODl2My45NzRoLTIuMDY3djE1Ljk3M2gyMS43Mg0KCVYzNy42NjNIODAuMjA5eiBNNjYuMjM5LDMzLjY4OWMwLTIuOTMsMi4zODQtNS4zMTYsNS4zMTMtNS4zMTZjMi45MzEsMCw1LjMxNiwyLjM4Niw1LjMxNiw1LjMxNnYzLjk3NGgtMTAuNjNWMzMuNjg5eiIvPg0KPC9zdmc+DQo=",class:"opaque-on-hover"}).append("title").text(Ce.t("md2d.heatbath_icon_tooltip")),je.select("#ke-gradient").empty()&&je.append("image").attr({id:"ke-gradient",x:"0",width:2.2*t,height:6*t,preserveAspectRatio:"xMinYMin","xlink:href":"data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXRmLTgiPz4NCjwhLS0gR2VuZXJhdG9yOiBBZG9iZSBJbGx1c3RyYXRvciAxNC4wLjAsIFNWRyBFeHBvcnQgUGx1Zy1JbiAuIFNWRyBWZXJzaW9uOiA2LjAwIEJ1aWxkIDQzMzYzKSAgLS0+DQo8IURPQ1RZUEUgc3ZnIFBVQkxJQyAiLS8vVzNDLy9EVEQgU1ZHIDEuMS8vRU4iICJodHRwOi8vd3d3LnczLm9yZy9HcmFwaGljcy9TVkcvMS4xL0RURC9zdmcxMS5kdGQiPg0KPHN2ZyB2ZXJzaW9uPSIxLjEiIGlkPSJMYXllcl8xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB4PSIwcHgiIHk9IjBweCINCgkgd2lkdGg9IjM5cHgiIGhlaWdodD0iMTExcHgiIHZpZXdCb3g9IjI1LjUgNC4wOTMgMzkgMTExIiBlbmFibGUtYmFja2dyb3VuZD0ibmV3IDI1LjUgNC4wOTMgMzkgMTExIiB4bWw6c3BhY2U9InByZXNlcnZlIj4NCjxwYXRoIGZpbGw9IiNFNkU3RTgiIGQ9Ik02MC45MTUsMTA2LjAzOGMwLDYuODEtMS4wNTMsNy45Mi03LjY4LDcuOTJsLTE0LjQ0NSwwLjI3M2MtNi42MjcsMC03LjYyNS0xLjM4NC03LjYyNS04LjE5M1YxMy41NjMNCgljMC02LjgxLDAuOTk4LTguMjIsNy42MjUtOC4yMmgxNC40NDVjNi42MjcsMCw3LjY4LDEuNDEsNy42OCw4LjIyVjEwNi4wMzh6Ii8+DQo8bGluZWFyR3JhZGllbnQgaWQ9IlNWR0lEXzFfIiBncmFkaWVudFVuaXRzPSJ1c2VyU3BhY2VPblVzZSIgeDE9Ijk4Ni4wNDQ5IiB5MT0iMTI5MC41MjY2IiB4Mj0iOTg2LjA0NDkiIHkyPSIxMjI2LjEzMjEiPg0KCTxzdG9wICBvZmZzZXQ9IjAiIHN0eWxlPSJzdG9wLWNvbG9yOiNBN0E5QUMiLz4NCgk8c3RvcCAgb2Zmc2V0PSIxIiBzdHlsZT0ic3RvcC1jb2xvcjojRkZGRkZGIi8+DQo8L2xpbmVhckdyYWRpZW50Pg0KPHBhdGggZmlsbD0iI0U2RTdFOCIgc3Ryb2tlPSJ1cmwoI1NWR0lEXzFfKSIgc3Ryb2tlLXdpZHRoPSIwLjUiIHN0cm9rZS1taXRlcmxpbWl0PSIxMCIgZD0iTTM2Ljk3MSwyNC43NjMNCgljMC0yLjAwNSwxLjYyNC0zLjYyOCwzLjYyOC0zLjYyOGgxMC45MzdjMi4wMDQsMCwzLjYyOCwxLjYyMiwzLjYyOCwzLjYyOHY2OC40NThjMCwyLjAwMy0xLjYyNCwzLjYyOS0zLjYyOCwzLjYyOUg0MC41OTkNCgljLTIuMDA0LDAtMy42MjgtMS42MjUtMy42MjgtMy42MjlWMjQuNzYzeiIvPg0KPGxpbmVhckdyYWRpZW50IGlkPSJTVkdJRF8yXyIgZ3JhZGllbnRVbml0cz0idXNlclNwYWNlT25Vc2UiIHgxPSIxMjQ1LjU4ODkiIHkxPSI4OTAuMDQ1MiIgeDI9IjEyNDUuNTg4OSIgeTI9Ijk2Mi4yNiIgZ3JhZGllbnRUcmFuc2Zvcm09Im1hdHJpeCgtMSAwIDAgMSAxMjkxLjYyODkgLTg2Ny4yMzgzKSI+DQoJPHN0b3AgIG9mZnNldD0iMC4wMDQzIiBzdHlsZT0ic3RvcC1jb2xvcjojRUY0MTM2Ii8+DQoJPHN0b3AgIG9mZnNldD0iMC4xNjUzIiBzdHlsZT0ic3RvcC1jb2xvcjojRjE2MDRCIi8+DQoJPHN0b3AgIG9mZnNldD0iMC41MTg5IiBzdHlsZT0ic3RvcC1jb2xvcjojRjc5RTg1Ii8+DQoJPHN0b3AgIG9mZnNldD0iMSIgc3R5bGU9InN0b3AtY29sb3I6I0ZGRkZGRiIvPg0KPC9saW5lYXJHcmFkaWVudD4NCjxwYXRoIGZpbGw9InVybCgjU1ZHSURfMl8pIiBkPSJNNDIuODI3LDk1LjAyM2MtMi4yMTUsMC00LjAwOS0xLjc5Ni00LjAwOS00LjAxMVYyNi44OTNjMC0yLjI1NywxLjgyOC00LjA4Niw0LjA4NS00LjA4Nmg2LjI3NA0KCWMyLjI1NywwLDQuMDg2LDEuODI5LDQuMDg2LDQuMDg2djY0LjExOWMwLDIuMjE1LTEuNzk1LDQuMDExLTQuMDExLDQuMDExSDQyLjgyN3oiLz4NCjxyZWN0IHg9IjE0LjM5NyIgeT0iOS42MDciIGZpbGw9Im5vbmUiIHdpZHRoPSI2MS4zNiIgaGVpZ2h0PSIxNC44MTIiLz4NCjx0ZXh0IHRyYW5zZm9ybT0ibWF0cml4KDEgMCAwIDEgMzQuNjA2IDE3LjAxMjkpIiBmb250LWZhbWlseT0iJ0FyaWFsTVQnIiBmb250LXNpemU9IjkuNDc5OCI+SElHSDwvdGV4dD4NCjxyZWN0IHg9IjE0LjM5NyIgeT0iMTAzLjAzMyIgZmlsbD0ibm9uZSIgd2lkdGg9IjYxLjM2IiBoZWlnaHQ9IjE0LjgxMiIvPg0KPHRleHQgdHJhbnNmb3JtPSJtYXRyaXgoMSAwIDAgMSAzNS4yOTMgMTA4LjY2OTIpIiBmb250LWZhbWlseT0iJ0FyaWFsTVQnIiBmb250LXNpemU9IjkuNDc5OCI+TE9XPC90ZXh0Pg0KPC9zdmc+DQo=",class:"opaque-on-hover"}).append("title").text(Ce.t("md2d.ke_icon_tooltip"))}function w(){var e,t,n=v.get("temperatureControl"),r=v.get("keShading"),i=0,o=1,a=Math.max(oe,12);n?(i+=o,e=je.select("#heat-bath").attr({y:i,width:2*a,height:2*a}).style("display",""),t=parseInt(e.attr("height"),10),i+=t):je.select("#heat-bath").style("display","none"),r?(i+=o,je.select("#ke-gradient").attr({y:i,width:2.2*a,height:6*a}).style("display","")):je.select("#ke-gradient").style("display","none")}function C(){_e.enter().append("path").attr({class:"atomTrace",d:R,"stroke-width":te(.01),stroke:be,fill:"none","stroke-dasharray":"6, 6"})}function T(){var e=ae.enter().append("g");e.attr("class","obstacle").attr("transform",function(e,t){return"translate("+te(se.x[t])+" "+ne(se.y[t]+se.height[t])+")"}),e.append("rect").attr({class:"obstacle-shape",x:0,y:0,width:function(e,t){return te(se.width[t])},height:function(e,t){return te(se.height[t])},fill:function(e,t){return se.visible[t]?d.toSVG(d.parse(se.color[t]),Ee):"transparent"},"stroke-width":function(e,t){return se.visible[t]?.2:0},stroke:function(e,t){return se.visible[t]?d.toSVG(d.parse(se.color[t]),Ee):"transparent"}}),e.each(function(e,t){if(se.displayExternalAcceleration[t]&&(se.externalAx[t]||se.externalAy[t])){var n,r,i=d3.select(this),o=se.height[t],a=se.width[t],s=se.externalAx[t],l=se.externalAy[t],u=.06,c=.06;s&&(n=(o-2*c)/Math.round((o-2*c)/.2),r=d3.range(c,o,n),i.selectAll("path.obstacle-force-hor").data(r).enter().append("path").attr({class:"obstacle-force-hor",d:function(e){return s<0?"M "+te(a+u+c)+","+te(e)+" L "+te(a+c)+","+te(e):"M "+te(-u-c)+","+te(e)+" L "+te(-c)+","+te(e)}})),l&&(n=(a-2*c)/Math.round((a-2*c)/.2),r=d3.range(c,a,n),i.selectAll("path.obstacle-force-vert").data(r).enter().append("path").attr({class:"obstacle-force-vert",d:function(e){return l<0?"M "+te(e)+","+te(-u-c)+" L "+te(e)+","+te(-c):"M "+te(e)+","+te(o+u+c)+" L "+te(e)+","+te(o+c)}})),i.selectAll("path.obstacle-force-hor, path.obstacle-force-vert").attr({"marker-end":et?"":"url(#Triangle-force)","stroke-width":te(me),stroke:he,fill:"none"})}})}function S(){var e,t=[ue,ce];for(e=0;e<t.length;e++){var n=t[e].enter().append("g");n.attr("class","shape").attr("transform",function(e){return"translate("+te(le.x[e.index])+" "+ne(le.y[e.index]+le.height[e.index])+")"}),n.append("rect").attr({class:"shape-rectangle",x:0,y:0,width:function(e){return te(le.width[e.index])},height:function(e){return te(le.height[e.index])},fill:function(e){return le.visible[e.index]&&"rectangle"===le.type[e.index]?d.toSVG(d.parse(le.color[e.index]),Ee):"transparent"},"stroke-width":function(e){return le.lineWeight[e.index]},"stroke-dasharray":function(e){return le.lineDashes[e.index]},stroke:function(e){return le.visible[e.index]&&"rectangle"===le.type[e.index]?le.lineColor[e.index]:"transparent"}}),n.append("ellipse").attr({class:"shape-ellipse",cx:function(e){return te(le.width[e.index])/2},cy:function(e){return te(le.height[e.index])/2},rx:function(e){return te(le.width[e.index])/2},ry:function(e){return te(le.height[e.index])/2},fill:function(e){return le.visible[e.index]&&"ellipse"===le.type[e.index]?d.toSVG(d.parse(le.color[e.index]),Ee):"transparent"},"stroke-width":function(e){return le.lineWeight[e.index]},"stroke-dasharray":function(e){return le.lineDashes[e.index]},stroke:function(e){return le.visible[e.index]&&"ellipse"===le.type[e.index]?le.lineColor[e.index]:"transparent"}})}}function A(e){var t,n,r,i,o,a,s,l,u,c,d=te(e.fontSize);return t=e.x,n=e.y,e.hostType&&(Ke=!1,"Atom"===e.hostType?(r=X[e.hostIndex].x,i=X[e.hostIndex].y):(r=se.x[e.hostIndex]+se.width[e.hostIndex]/2,i=se.y[e.hostIndex]+se.height[e.hostIndex]/2)),e.hostType&&!e.calloutPoint&&(t=r,n=i),e.calloutPoint&&(e.hostType?(u=r,c=i):(u=e.calloutPoint[0],c=e.calloutPoint[1])),s=te(t),l=ne(n),o=s+.75*d,a=l+1.2*d,u=te(u),c=ne(c),[o,a,s,l,u,c]}function k(e,t,n,r,i){var o=[parseFloat(e[0]),parseFloat(e[1])],a=[parseFloat(t.getAttribute("x"))+n/2,parseFloat(t.getAttribute("y"))+r/2],s=Ze-Math.atan((o[0]-a[0])/(o[1]-a[1])),l=Math.min(i,r/2),u=Math.sin(s)*l,c=Math.cos(s)*l;return a[0]+u+", "+(a[1]-c)+" "+(a[0]-u)+", "+(a[1]+c)+" "+o}function P(){var e,t=[Ve,ke];e=function(e){var n=t[e-1],r=ge.filter(function(t){return t.layer===e});n.selectAll("g.textBoxWrapper rect").data(r.filter(function(e){return e.frame})).attr({x:function(e){return A(e)[2]},y:function(e){return A(e)[3]},transform:function(e){var t=e.rotate,n=A(e);return"rotate("+t+" "+n[0]+" "+n[1]+")"}}),n.selectAll("g.textBoxWrapper text").data(r).attr({y:function(e){return $(this).find("tspan").attr("x",A(e)[0]),A(e)[1]}}),n.selectAll("g.textBoxWrapper polygon").data(r.filter(function(e){return e.calloutPoint})).attr({"callout-location-data":function(e){var t=A(e);return t[4]+", "+t[5]}})},e(1),e(2),$(".textBox").each(function(){var e,t,n,r,i=$(this.parentNode),o=i.find("polygon"),a=i.find("rect")[0];a&&0!==o.length&&(e=parseFloat(this.getAttributeNS(null,"font-size")),t=a.getAttribute("width"),n=a.getAttribute("height"),r=o.attr("callout-location-data").split(", "),o.attr("points",k(r,a,t,n,e)))})}function E(){var e,r,i,o="Chrome"===Je.browser&&!!Je.oscpu.match(/Windows|Mac OS X/);ge=v.get("textBoxes"),e=[v.get("width"),v.get("height")],r=[Ve,ke],i=function(i){var a,s,l,u=r[i-1];u.selectAll("g.textBoxWrapper").remove(),s=ge.filter(function(e){return e.layer===i}),l=u.selectAll("g.textBoxWrapper").data(s),a=l.enter().append("svg:g").attr("class","textBoxWrapper"),a.filter(function(e){return e.calloutPoint}).append("polygon").attr({points:"0,0 0,0 0,0",style:function(e){var t=e.backgroundColor,n=e.strokeWidthEms*oe,r=e.strokeOpacity,i=e.strokeColor;return"fill:"+t+";opacity:1.0;fill-opacity:1;stroke:"+i+";stroke-width:"+2*n+";stroke-opacity:"+r},"callout-location-data":function(e){var t=A(e);return t[4]+", "+t[5]}}),a.filter(function(e){return e.frame}).append("rect").attr({class:function(e,t){return"textBoxFrame text-"+t},id:function(e,t){return"text-"+t},transform:function(e){var t=e.rotate,n=A(e);return"rotate("+t+" "+n[0]+" "+n[1]+")"},style:function(e){var t=e.backgroundColor,n=e.strokeWidthEms*oe,r=e.strokeOpacity,i=e.strokeColor;return o&&n<1&&(r*=n,n=1),"fill:"+t+";opacity:1.0;fill-opacity:1;stroke:"+i+";stroke-width:"+n+";stroke-opacity:"+r},width:0,height:0,rx:function(e){return"rounded rectangle"===e.frame?te(e.fontSize)/2.5:0},ry:function(e){return"rounded rectangle"===e.frame?te(e.fontSize)/2:0},x:function(e){return A(e)[2]},y:function(e){return A(e)[3]}}),a.filter(function(e){return e.calloutPoint}).append("polygon").attr({points:"0,0 0,0 0,0",style:function(e){var t=e.backgroundColor;return"fill:"+t+";opacity:1.0;fill-opacity:1;stroke:#000000;stroke-width:0;"}}),a.append("text").attr({class:function(){return"textBox"+(AUTHORING?" draggable":"")},transform:function(e){var t=e.rotate,n=A(e);return"rotate("+t+" "+n[0]+" "+n[1]+")"},"x-data":function(e){return A(e)[0]},y:function(e){return A(e)[1]},"width-data":function(e){return e.width},"height-data":function(e){return e.height},width:te(e[0]),height:te(e[1]),"xml:space":"preserve","font-family":"'"+t.fontface+"', sans-serif","font-size":function(e){return te(e.fontSize)+"px"},fill:function(e){return e.color||"black"},"text-data":function(e){return e.text},"text-anchor":function(e){var t=e.textAlign||"left";return"center"===t&&(t="middle"),t},"has-host":function(e){return!!e.hostType},"pointer-events":function(e){return e.hostType?"none":"auto"}}).call(d3.behavior.drag().on("drag",D).on("dragend",function(e){n.log('"x": '+e.x+","),n.log('"y": '+e.y+",")})),l.exit().remove()},i(1),i(2),$(".textBox").each(function(){var e,t,n,r,i,o,a,s,l,u,d,p=this.getAttributeNS(null,"text-data"),f=this.getAttributeNS(null,"x-data"),h=this.getAttributeNS(null,"width-data"),m=this.getAttributeNS(null,"height-data"),g=parseFloat(this.getAttributeNS(null,"font-size")),v=this.getAttributeNS(null,"transform"),y=this.getAttributeNS(null,"has-host"),b=this.getAttributeNS(null,"text-anchor"),_=$(this.parentNode);for(a=1.2*g,e=1.5*+g,t=g/1.8,h=""===h?-1:te(h),m=""===m?-1:te(m);this.firstChild;)this.removeChild(this.firstChild);n=c(p,this,h,f,a),_.find("rect").length>0&&(o=_.find("rect")[0],r=n.width+e,o.setAttributeNS(null,"width",r),i=m>0?m:n.lines*a+t,o.setAttributeNS(null,"height",i)),u=_.find("polygon"),o&&u.length>0&&(d=u.attr("callout-location-data").split(", "),u.attr("points",k(d,o,r,i,g))),"middle"===b&&(s=n.width/2,l=m>0?m/2-1.5*t-(n.lines-1)*a/2:0,v=v+" translate("+s+","+l+")",$(this).attr("transform",v)),"true"===y&&0===u.length&&(s=n.width/-2-e/2,l=n.lines*a/-2-t/2,_.attr("transform","translate("+s+","+l+")"))})}function O(){se=v.get_obstacles(),Ee.selectAll("g.obstacle").remove(),se&&(We.length=se.x.length,ae=Ee.selectAll("g.obstacle").data(We),T())}function M(){if(le=v.get_shapes(),De.selectAll(".shape").remove(),Ae.selectAll(".shape").remove(),le){Ye=[],Xe=[];for(var e=0;e<le.x.length;e++)1===le.layer[e]?Ye.push({index:e,layerPosition:le.layerPosition[e]}):Xe.push({index:e,layerPosition:le.layerPosition[e]});Ye.sort(function(e,t){return e.layerPosition-t.layerPosition}),Xe.sort(function(e,t){return e.layerPosition-t.layerPosition}),ue=De.selectAll(".shape").data(Ye),ce=Ae.selectAll(".shape").data(Xe),S()}}function L(){de=v.get_lines(),Qe.length=de.x1.length,pe=Be.selectAll(".line").data(Qe),pe.exit().remove(),de&&(pe.enter().append("line"),pe.attr({class:"line",x1:function(e,t){return te(de.x1[t])},y1:function(e,t){return ne(de.y1[t])},x2:function(e,t){return te(de.x2[t])},y2:function(e,t){return ne(de.y2[t])},"stroke-width":function(e,t){return de.lineWeight[t]},"stroke-dasharray":function(e,t){return de.lineDashes[t]},stroke:function(e,t){return de.lineColor[t]},"marker-start":function(e,t){return y(t,de.beginStyle[t],!0)},"marker-end":function(e,t){return y(t,de.endStyle[t])},visibility:function(e,t){return de.visible[t]?"visible":"hidden"}}))}function N(){Ee.selectAll("path.atomTrace").remove(),xe="",ve=v.get("showAtomTrace"),ye=v.get("atomTraceId"),ve&&(_e=Ee.selectAll("path.atomTrace").data([X[ye]]),C())}function R(e){var t,n,r=Math.floor(100*te(e.x))/100,i=Math.floor(100*ne(e.y))/100;return xe?(xe+=r+","+i+" ",xe.length>4e3&&(t=xe.indexOf("L"),n=xe.indexOf(" "),xe="M"+xe.slice(t+1,n)+"L"+xe.slice(n+1)),xe):(xe="M"+r+","+i+"L","M "+r+","+i)}function I(){_e.attr({d:R})}function D(e){var t=te.invert(d3.event.dx),n=te.invert(d3.event.dy);AUTHORING&&v.isStopped()&&(e.x=e.x+t,e.y=e.y-n,P())}function B(){function t(t,n,r){if(t()){var i=e.$el.parent().find("#"+n);0===i.length&&(i=$("<div id='"+n+"' class='warning-pane'>"+r+"</div>"),i.on("click",function(){$(this).fadeOut()}),i.appendTo(e.$el.parent()));var o=e.pos();i.css({width:o.width-20,top:o.bottom-i.height()-10,left:o.left+10})}}var n=r.what_browser();t(function(){return"Firefox"===n.browser&&n.version>="18"&&n.version<"23"},"ff1823warning","<a href='http://blog.concord.org/serious-performance-regression-in-firefox-18-and-newer' class='opens-in-new-window' target='_blank'>Firefox v18-22 performance issue...</a>)"),t(function(){return"Firefox"===n.browser&&n.oscpu.indexOf("Windows")!==-1&&n.version>="27"&&n.version<"28"},"ff27warning","Because of a problem in Firefox 27 with certain types of graphics (SVG), you may see minor visual problems with some models. We recommend using another browser until Firefox 28 becomes available."),t(function(){return v.get("DNA")&&"Safari"===n.browser&&0===n.version.indexOf("6.1")},"saf61DNAwarning","This model may have visual problems on Safari 6. We recommend upgrading Safari, or using another browser.")}function V(){he=v.get("forceVectors").color,me=v.get("forceVectors").width,b(he,"force"),ie={},Ee.selectAll(".custom-arrow-head").remove(),be=v.get("atomTraceColor")}function j(){fe=v.properties.useQuantumDynamics,fe&&_(),x(),re=new u(e,v)}function F(e){var t,n=[],r=40,i=d3.svg.line().x(function(e){return te(.5/r*e.x)}).y(function(e){return te(.1*e.y)}),o=2*e.angularFrequency*Math.PI/r;for(t=0;t<r;t++)n.push({x:t-r/2,y:Math.sin(t*o)/(1+.01*(t-.5*r)*(t-.5*r))});return i(n)}function z(e){var t=e.angularFrequency;if(t<=h||t>=m)return"rgba(0,0,0,0.8)";var n=(m-h)/7,r=Math.floor((t-h)/n);if(6===r)return"rgb("+g[r].join(",")+")";var i=(t-h-r*n)/n,o=g[r][0],a=g[r+1][0],s=g[r][1],l=g[r+1][1],u=g[r][2],c=g[r+1][2];return"rgb("+Math.floor(o+i*(a-o))+","+Math.floor(s+i*(l-s))+","+Math.floor(u+i*(c-u))+")"}function G(e){var t=e.angularFrequency;return t<=h||t>=m?"4,2":null}function U(){var e=Ee.selectAll(".photon").data(v.getPhotons(),function(e){return e.id});e.enter().append("path").attr({class:"photon",d:F,stroke:z,"stroke-dasharray":G,"stroke-width":te(.011),"fill-opacity":0}),e.exit().remove(),e.attr("transform",function(e){return"translate("+te(e.x)+", "+ne(e.y)+") rotate("+e.angle+")"})}function q(){function t(t){return function(){t(),e.updateClickHandlers()}}function n(){qe.setup(),e.renderCanvas()}te=e.model2px,ne=e.model2pxInv,oe=e.getFontSizeInPixels(),X=v.getAtoms(),Q=v.getElectricField(),K=v.get_elements(),J=v.get("width"),Z=v.get("height"),ee=J/Z,j(),v.addPropertiesListener(["temperatureControl","keShading"],w),v.addPropertiesListener(["chargeShading","showChargeSymbols","useThreeLetterCode","showAtomTrace","atomTraceId","aminoAcidColorScheme","backgroundColor","markColor","forceVectorsDirectionOnly"],t(W)),v.addPropertiesListener(["electricFieldDensity","showElectricField","electricFieldColor"],n),v.addPropertiesListener(["showVelocityVectors","velocityVectors"],function(){$e.setup(),e.renderCanvas()}),v.addPropertiesListener(["showForceVectors","forceVectors","forceVectorsDirectionOnly"],function(){Ue.setup(),e.renderCanvas()}),v.addPropertiesListener(["showVDWLines","VDWLinesCutoff"],function(){Ge.setup(),e.renderCanvas()}),v.on("addAtom",t(function(){Fe.setup(),$e.setup(),Ue.setup(),qe.update(),e.renderCanvas()})),v.on("removeAtom",t(function(){Fe.setup(),$e.setup(),Ue.setup(),qe.update(),e.renderCanvas()})),v.on("addRadialBond",t(function(){ze.setup(),e.renderCanvas()})),v.on("removeRadialBond",t(function(){ze.setup(),e.renderCanvas()})),v.on("textBoxesChanged",t(E)),v.on("imagesChanged",t(He.setup)),v.on("addElectricField",n),v.on("removeElectricField",n),v.on("changeElectricField",n),B(),Te=!0}function H(e){v=e,Fe.bindModel(e),ze.bindModel(e),Ge.bindModel(e),He.bindModel(e),q()}function W(t,n){arguments.length&&(te=t,ne=n),oe=e.getFontSizeInPixels(),V(),O(),Fe.setup(),ze.setup(),Ge.setup(),M(),L(),re.setup(),$e.setup(),Ue.setup(),qe.setup(),N(),He.setup(),E(),w(),B(),fe&&U()}function Y(){n.time("view update"),se&&ae.attr("transform",function(e,t){return"translate("+te(se.x[t])+" "+ne(se.y[t]+se.height[t])+")"}),le&&(ue.attr("transform",function(e){return"translate("+te(le.x[e.index])+" "+ne(le.y[e.index]+le.height[e.index])+")"}),ce.attr("transform",function(e){return"translate("+te(le.x[e.index])+" "+ne(le.y[e.index]+le.height[e.index])+")"})),Fe.update(),ze.update(),Ge.update(),$e.update(),Ue.update(),qe.update(),ve&&I(),v.properties.images&&0!==v.properties.images.length&&He.update(),ge&&ge.length>0&&!Ke&&P(),fe&&U(),n.timeEnd("view update")}var X,Q,K,J,Z,ee,te,ne,re,ie,oe,ae,se,le,ue,ce,de,pe,fe,he,me,ge,ve,ye,be,_e,xe,we={},Ce=e.i18n,Te=!1,Se=e.appendViewport().classed("below-atoms",!0),Ae=Se.append("g").attr("class","shape-container-below"),ke=(Se.append("g").attr("class","image-container image-container-below"),Se.append("g").attr("class","text-container-below")),Pe=e.appendViewport().classed("atoms",!0),Ee=Pe.append("g").attr("class","atoms-container"),Oe=e.appendPixiViewport(),Me=e.appendPixiViewport(),Le=e.appendPixiViewport(),Ne=e.appendPixiViewport(),Re=e.appendPixiViewport(),Ie=e.appendViewport().classed("above-atoms",!0),De=Ie.append("g").attr("class","shape-container-top"),Be=Ie.append("g").attr("class","line-container-top"),Ve=(Ie.append("g").attr("class","image-container image-container-top"),Ie.append("g").attr("class","text-container-top")),je=e.foregroundContainer.append("g").attr("class","icon-container"),Fe=new i(e,v,Ne.pixiContainer,Ne.canvas),ze=new o(e,v,Le.pixiContainer,Fe),Ge=new l(e,v,Me.pixiContainer),$e=new a(Re.pixiContainer,{get show(){return v.get("showVelocityVectors")},get length(){return v.get("velocityVectors").length},get width(){return v.get("velocityVectors").width},get color(){return v.get("velocityVectors").color},get dirOnly(){return!1},get count(){return X.length},x:function(e){return X[e].x},y:function(e){return X[e].y},vx:function(e){return 100*X[e].vx},vy:function(e){return 100*X[e].vy},m2px:e.model2canvas,m2pxInv:e.model2canvasInv}),Ue=new a(Re.pixiContainer,{get show(){return v.get("showForceVectors")},get length(){return v.get("forceVectors").length},get width(){return v.get("forceVectors").width},get color(){return v.get("forceVectors").color},get dirOnly(){return v.get("forceVectorsDirectionOnly")},get count(){return X.length;
},x:function(e){return X[e].x},y:function(e){return X[e].y},vx:function(e){var t=X[e];return t.ax*t.mass*100},vy:function(e){var t=X[e];return t.ay*t.mass*100},m2px:e.model2canvas,m2pxInv:e.model2canvasInv}),qe=new s(Oe.pixiContainer,{get show(){return v.get("showElectricField")},get length(){return.8*v.get("width")/v.get("electricFieldDensity")},get color(){var e=v.get("electricFieldColor");return"auto"!==e?e:p(v.get("backgroundColor"))},get count(){return Q.length},x:function(e){return Q[e].x},y:function(e){return Q[e].y},vx:function(e){return Q[e].fx},vy:function(e){return Q[e].fy},alpha:function(e){var t=Q[e];return Math.min(1,.3*Math.pow(t.fx*t.fx+t.fy*t.fy,.2))},m2px:e.model2canvas,m2pxInv:e.model2canvasInv}),He=new f(e,v),We=[],Ye=[],Xe=[],Qe=[],Ke=!0,Je=r.what_browser(),Ze=Math.PI/2,et="MSIE"===Je.browser&&Number(Je.version)>=10;return we={setup:function(){Te||q()},update:function(){Te&&Y()},repaint:function(){Te&&W()},bindModel:H}}}),define("models/md2d/views/view",["require","common/views/svg-container","models/md2d/views/renderer"],function(e){var t=e("common/views/svg-container"),n=e("models/md2d/views/renderer");return function(e,r,i){return new t(e,r,n,{i18n:i})}}),define("models/md2d/views/dna-edit-dialog",[],function(){return function(e){var t,n,r,i,o,a=function(){n=$("<div></div>"),r=$('<input type="text" id="dna-sequence-input" size="55"></input>'),r.appendTo(n),i=$('<p class="error"></p>'),i.appendTo(n),n.dialog({dialogClass:"dna-edit-dialog",appendTo:".lab-responsive-content",title:"DNA Code on Sense Strand",autoOpen:!1,width:"35em",buttons:{Apply:function(){e.set({DNA:r.val()}),$(this).dialog("close")}}}),o=$(".dna-edit-dialog button:contains('Apply')"),r.on("input",function(){try{e.getPropertyValidateFunc("DNA")(r.val()),o.button("enable"),i.text("")}catch(e){o.button("disable"),i.text(e.message)}})};return t={open:function(){i.text(""),o.removeAttr("disabled"),r.val(e.get("DNA")),n.dialog("open")}},a(),t}}),define("models/md2d/controllers/scripting-api",["require","models/md2d/views/dna-edit-dialog"],function(e){var t=e("models/md2d/views/dna-edit-dialog");return function(e){function n(t){return function(n,r){try{e.model[t].call(e.model,n)}catch(e){if(!r||!r.silent)throw e}e.api.repaintIfReady()}}var r=null,i=0,o=function(){var t,n=arguments[0],r=arguments[1];Array.isArray(r)?(t=Array.prototype.slice.call(arguments,2,arguments.length),e.api.batch(function(){for(var e=0,i=r[0];e<r.length;i=r[++e])n.apply(null,Array.prototype.concat(i,t))})):(t=Array.prototype.slice.call(arguments,1,arguments.length),n.apply(null,t)),e.api.repaintIfReady()};return{getCurrentComputerTime:function(){return Date.now()},getNumberOfAtoms:function(t){return e.model.getNumberOfAtoms(t)},getNumberOfObstacles:function(){return e.model.getNumberOfObstacles()},getNumberOfElements:function(){return e.model.getNumberOfElements()},getNumberOfRadialBonds:function(){return e.model.getNumberOfRadialBonds()},getNumberOfAngularBonds:function(){return e.model.getNumberOfAngularBonds()},addAtom:function(t){return e.model.addAtom(t)},removeAtom:function(t,n){try{e.model.removeAtom(t,n)}catch(e){if(!n||!n.silent)throw e}},removeRadialBond:function(t,n){try{e.model.removeRadialBond(t)}catch(e){if(!n||!n.silent)throw e}e.api.repaintIfReady()},removeAngularBond:function(t,n){try{e.model.removeAngularBond(t)}catch(e){if(!n||!n.silent)throw e}e.api.repaintIfReady()},addRadialBond:function(t){e.model.addRadialBond(t),e.api.repaintIfReady()},addAngularBond:function(t){e.model.addAngularBond(t),e.api.repaintIfReady()},addRandomAtom:function(){return e.model.addRandomAtom.apply(e.model,arguments)},adjustTemperature:function(t){e.model.set({targetTemperature:t*e.model.get("targetTemperature")})},setTemperatureOfAllAtoms:function(t){for(var n=[],r=0;r<e.model.getNumberOfAtoms();r++)n.push(r);e.model.setTemperatureOfAtoms(n,t)},setTemperatureOfAtoms:function(t,n){e.model.setTemperatureOfAtoms(t,n)},addKEToAtoms:function(t,n){e.model.addKEToAtoms(t,n)},getTemperatureOfAllAtoms:function(){for(var t=[],n=0;n<e.model.getNumberOfAtoms();n++)t.push(n);return e.model.getTemperatureOfAtoms(t)},getTemperatureOfAtoms:function(t){return e.model.getTemperatureOfAtoms(t)},limitHighTemperature:function(t){e.model.get("targetTemperature")>t&&e.model.set({targetTemperature:t})},randomAtoms:function(t){var n=e.model.getNumberOfAtoms();if(null===t&&(t=1+e.api.randomInteger(n-1)),!e.api.isInteger(t))throw new Error("randomAtoms: number of atoms requested, "+t+", is not an integer.");if(t<0)throw new Error("randomAtoms: number of atoms requested, "+t+", was less be greater than zero.");return t>n&&(t=n),e.api.choose(t,n)},turnOnLightSource:function(){e.model.turnOnLightSource()},turnOffLightSource:function(){e.model.turnOffLightSource()},setLightSourceAngle:function(t){e.model.setLightSourceAngle(t)},setLightSourceFrequency:function(t){e.model.setLightSourceFrequency(t)},setLightSourcePeriod:function(t){e.model.setLightSourcePeriod(t)},setLightSourceNumber:function(t){e.model.setLightSourceNumber(t)},setBondEnergy:function(t,n){e.model.setBondEnergy(t,n)},setValenceElectrons:function(t,n){e.model.setValenceElectrons(t,n),e.api.repaintIfReady()},atomsWithinCircle:function(t,n,r,i){var o,a,s,l,u=[];for(s=0,l=e.model.getNumberOfAtoms();s<l;s++)o=e.model.getAtomProperties(s),"undefined"!=typeof i&&o.element!==i||(a=Math.sqrt(Math.pow(t-o.x,2)+Math.pow(n-o.y,2)),a<=r&&u.push(s));return u},atomsWithinRect:function(t,n,r,i,o){var a,s,l,u,c,d,p=[];for(c=0,d=e.model.getNumberOfAtoms();c<d;c++)a=e.model.getAtomProperties(c),"undefined"!=typeof o&&a.element!==o||("undefined"==typeof i?(s=Math.sqrt(Math.pow(t-a.x,2)+Math.pow(n-a.y,2)),s<=r&&p.push(c)):(l=a.x>=t&&a.x<=t+r,u=a.y>=n&&a.y<=n+i,l&&u&&p.push(c)));return p},atomsWithinTriangle:function(t,n,r,i,o,a,s){function l(e,s){var l=[o-t,a-n],u=[r-t,i-n],c=[e-t,s-n],d=l[0]*l[0]+l[1]*l[1],p=l[0]*u[0]+l[1]*u[1],f=l[0]*c[0]+l[1]*c[1],h=u[0]*u[0]+u[1]*u[1],m=u[0]*c[0]+u[1]*c[1],g=1/(d*h-p*p),v=(h*f-p*m)*g,y=(d*m-p*f)*g;return v>=0&&y>=0&&v+y<1}var u,c,d,p=[];for(c=0,d=e.model.getNumberOfAtoms();c<d;c++)u=e.model.getAtomProperties(c),"undefined"!=typeof s&&u.element!==s||l(u.x,u.y)&&p.push(c);return p},markAtoms:function(t){var n,r;if(0!==arguments.length){for(e.api.isArray(arguments[0])||(t=arguments),e.api.unmarkAllAtoms(),n=0,r=t.length;n<r;n++)e.model.setAtomProperties(t[n],{marked:1});e.api.repaintIfReady()}},unmarkAllAtoms:function(){for(var t=0,n=e.model.getNumberOfAtoms();t<n;t++)e.model.setAtomProperties(t,{marked:0});e.api.repaintIfReady()},traceAtom:function(t){null!==t&&(e.model.set({atomTraceId:t}),e.model.set({showAtomTrace:!0}))},untraceAtom:function(){e.model.set({showAtomTrace:!1})},setAtomProperties:function(t,n,r,i){o(e.model.setAtomProperties,t,n,r,i)},atomTransition:function(){return e.model.atomTransition()},getAtomProperties:function(t){return e.model.getAtomProperties(t)},getRadialBondsForAtom:function(t){return e.model.getRadialBondsForAtom(t)},getAngularBondsForAtom:function(t){return e.model.getAngularBondsForAtom(t)},getMoleculeAtoms:function(t){return e.model.getMoleculeAtoms(t)},setElementProperties:function(t,n){o(e.model.setElementProperties,t,n)},setPairwiseLJProperties:function(t,n,r){e.model.getPairwiseLJProperties().set(t,n,r)},removePairwiseLJProperties:function(t,n){e.model.getPairwiseLJProperties().remove(t,n)},getElementProperties:function(t){return e.model.getElementProperties(t)},addObstacle:n("addObstacle"),addShape:n("addShape"),addLine:n("addLine"),setObstacleProperties:function(t,n){o(e.model.setObstacleProperties,t,n)},getObstacleProperties:function(t){return e.model.getObstacleProperties(t)},removeObstacle:function(t,n){try{e.model.removeObstacle(t)}catch(e){if(!n||!n.silent)throw e}e.api.repaintIfReady()},setShapeProperties:function(t,n){o(e.model.setShapeProperties,t,n)},getShapeProperties:function(t){return e.model.getShapeProperties(t)},setLineProperties:function(t,n){o(e.model.setLineProperties,t,n)},getLineProperties:function(t){return e.model.getLineProperties(t)},addElectricField:function(t,n){try{e.model.addElectricField(t)}catch(e){if(!n||!n.silent)throw e}},removeElectricField:function(t,n){try{e.model.removeElectricField(t)}catch(e){if(!n||!n.silent)throw e}},setElectricFieldProperties:function(t,n){e.model.setElectricFieldProperties(t,n)},getElectricFieldProperties:function(t){return e.model.getElectricFieldProperties(t)},getAtomsWithinShape:function(t){var n=e.model.getShapeProperties(t);return this.atomsWithinRect(n.x,n.y,n.width,n.height)},removeShape:function(t,n){try{e.model.removeShape(t)}catch(e){if(!n||!n.silent)throw e}e.api.repaintIfReady()},removeLine:function(t,n){try{e.model.removeLine(t)}catch(e){if(!n||!n.silent)throw e}e.api.repaintIfReady()},setRadialBondProperties:function(t,n){e.model.setRadialBondProperties(t,n),e.api.repaintIfReady()},getRadialBondProperties:function(t){return e.model.getRadialBondProperties(t)},setAngularBondProperties:function(t,n){e.model.setAngularBondProperties(t,n),e.api.repaintIfReady()},getAngularBondProperties:function(t){return e.model.getAngularBondProperties(t)},openDNADialog:function(){null==r&&(r=new t(e.model)),r.open()},jumpToNextDNAState:function(){e.model.geneticEngine().jumpToNextState()},jumpToPrevDNAState:function(){e.model.geneticEngine().jumpToPrevState()},DNAStateBefore:function(t){return e.model.geneticEngine().stateBefore(t)},DNAStateAfter:function(t){return e.model.geneticEngine().stateAfter(t)},animateToNextDNAState:function(){e.model.geneticEngine().transitionToNextState()},animateToDNAState:function(t){e.model.geneticEngine().transitionTo(t)},stopDNAAnimation:function(){e.model.geneticEngine().stopTransition()},transcribeDNAStep:function(t){var n=e.model.geneticEngine();n.stateBefore("dna")||n.stateAfter("transcription-end")?(e.model.set("DNAState","dna"),n.transitionTo("transcription:0"),n.transcribeStep(t)):"transcription-end"!==e.model.get("DNAState")&&n.transcribeStep(t)},translateDNAStep:function(){var t=e.model.geneticEngine();t.stateBefore("translation:0")||t.stateAfter("translation-end")?(e.model.set("DNAState","translation:0"),t.transitionTo("translation:1")):"translation-end"!==e.model.get("DNAState")&&t.transitionToNextState()},generateRandomProtein:function(t){var n=e.model.geneticEngine().generateProtein(void 0,t);if(n!==t)throw new Error("Generated protein was truncated due to limited area of the parent.model. Only"+n+" amino acids were generated.")},setSolvent:function(t){e.model.setSolvent(t)},pe:function(){return e.model.get("potentialEnergy")},ke:function(){return e.model.get("kineticEnergy")},atomsKe:function(t){var n,r=0;for(n=0;n<t.length;n++)r+=e.model.getAtomKineticEnergy(t[n]);return r},minimizeEnergy:function(){e.model.minimizeEnergy(),e.api.repaintIfReady()},addTextBox:function(t){e.model.addTextBox(t)},removeTextBox:function(t){e.model.removeTextBox(t)},setTextBoxProperties:function(t,n){e.model.setTextBoxProperties(t,n)},getTextBoxProperties:function(t){return e.model.getTextBoxProperties(t)},getNumberOfTextBoxes:function(){return e.model.getNumberOfTextBoxes()},getNumberOfLines:function(){return e.model.getNumberOfLines()},getNumberOfShapes:function(){return e.model.getNumberOfShapes()},getImageProperties:function(t){return e.model.getImageProperties(t)},setImageProperties:function(t,n){o(e.model.setImageProperties,t,n)},repaintIfReady:function(){0===i&&e.api.repaint()},batch:function(t){++i,e.model.startBatch(),t(),e.model.endBatch(),--i,e.api.repaintIfReady()}}}}),define("models/md2d/benchmarks/benchmarks",["require","common/performance"],function(e){var t=e("common/performance"),n=5e3,r=1e3;return function(e){var i;return[{name:"atoms",numeric:!0,run:function(t){t(e.model.getNumberOfAtoms())}},{name:"temperature",numeric:!0,formatter:d3.format("5.1f"),run:function(t){t(e.model.get("temperature"))}},{name:"engine (ms)",numeric:!0,formatter:d3.format("5.1f"),run:function(o){e.model.start(),setTimeout(function(){e.model.stop(),t.collectData(!0),i=e.model.stepCounter(),setTimeout(function(){e.model.start(),setTimeout(function(){e.model.stop(),t.collectData(!1),o(t.getAvgTime("engine"))},n)},100)},r)}},{name:"JS rendering (ms)",numeric:!0,formatter:d3.format("5.1f"),run:function(e){e(t.getAvgTime("js-rendering"))}},{name:"tick (ms)",numeric:!0,formatter:d3.format("5.1f"),run:function(e){e(t.getAvgTime("tick"))}},{name:"gap b/w frames (ms)",numeric:!0,formatter:d3.format("5.1f"),run:function(e){e(t.getAvgTime("gap"))}},{name:"fps",numeric:!0,formatter:d3.format("5.1f"),run:function(t){t(1e3*(e.model.stepCounter()-i)/n)}}]}}),define("models/md2d/controllers/controller",["require","common/controllers/model-controller","models/md2d/models/modeler","models/md2d/views/view","models/md2d/controllers/scripting-api","models/md2d/benchmarks/benchmarks"],function(e){var t=e("common/controllers/model-controller"),n=e("models/md2d/models/modeler"),r=e("models/md2d/views/view"),i=e("models/md2d/controllers/scripting-api"),o=e("models/md2d/benchmarks/benchmarks");return function(e,a,s){return new t(e,a,s,n,r,i,o)}}),define("models/signal-generator/metadata",[],function(){return{mainProperties:{type:{defaultValue:"signal-generator",immutable:!0},frequency:{defaultValue:1,unitType:"frequency",propertyChangeInvalidates:!0},modelSampleRate:{defaultValue:60,propertyChangeInvalidates:!0},timeScale:{defaultValue:1,unitType:"time",propertyChangeInvalidates:!0},sampleBatchLength:{defaultValue:1,propertyChangeInvalidates:!1},useDuration:{defaultValue:"codap",storeInTickHistory:!1,validate:function(e){if(e===!0||e===!1||"codap"===e)return e;throw new Error("Invalid 'useDuration' value: "+e)}},requestedDuration:{defaultValue:null,storeInTickHistory:!1}},viewOptions:{showClock:{defaultValue:!0,propertyChangeInvalidates:!1},controlButtons:{defaultValue:"play_reset",propertyChangeInvalidates:!1},controlButtonStyle:{defaultValue:"video",propertyChangeInvalidates:!1,serialize:!1}}}}),define("models/signal-generator/modeler",["require","common/lab-modeler-mixin","models/signal-generator/metadata"],function(e){var t=e("common/lab-modeler-mixin"),n=e("models/signal-generator/metadata"),r={units:{time:{name:"second",pluralName:"seconds",symbol:"s"},frequency:{name:"Hertz",pluralName:"Hertz",symbol:"Hz"},angle:{name:"radian",pluralName:"radians",symbol:"rad"}}};return function(e){function i(e){return e-2*Math.PI*Math.floor(e/(2*Math.PI))}function o(e){return i(p+2*Math.PI*l.properties.frequency*e)}function a(e,t,n){return t<0?n:e[t]}var s,l,u={frequency:function(e){void 0!==s&&(p=i(p+2*Math.PI*(s-e)*l.properties.time)),s=e}},c=new t({metadata:n,setters:u,unitsDefinition:r,initialProperties:e}),d=c.dispatchSupport,p=0,f=[],h=0,m=-1;return l={tick:function(){var e=1e3/l.properties.modelSampleRate,t=a(f,f.length-1,0);if(f.push(t+.001*e*l.properties.timeScale),h++,h%l.properties.sampleBatchLength===0)for(;m<f.length-1;)m++,l.updateAllOutputProperties(),d.tick()},stepCounter:function(){return h},reset:function(){d.reset()}},d.addEventTypes("tick"),d.addEventTypes("reset"),c.mixInto(l),l.on("play.model",l.makeInvalidatingChange),l.on("stop.model",l.makeInvalidatingChange),l.defineOutput("isPlayable",{label:"Playable"},function(){return l.isReady&&l.isStopped()}),l.defineOutput("hasPlayed",{label:"has Played"},function(){return l.hasPlayed}),l.defineOutput("timePerTick",{label:"Model time per tick",unitType:"time",format:".2f"},function(){return 1/l.properties.modelSampleRate*l.properties.timeScale}),l.defineOutput("time",{label:"Time",unitType:"time",format:".2f"},function(){return a(f,m,0)}),l.defineOutput("displayTime",{label:"Time",unitType:"time",format:".2f"},function(){return a(f,m,0)}),l.defineOutput("signalValue",{label:"Signal Value",format:".2f"},function(){var e=a(f,m,0);return Math.cos(o(e))}),l.defineOutput("angle",{label:"Angle",unitType:"angle",format:".2f"},function(){var e=a(f,m,0);return o(e)}),l}}),define("common/views/null-model-view",[],function(){return function(){return{$el:$("<div id='model-container' class='container'/>"),getHeightForWidth:function(){return 0},resize:function(){},repaint:function(){},bindModel:function(){},setup:function(){},update:function(){}}}}),define("models/signal-generator/controller",["require","common/controllers/model-controller","models/signal-generator/modeler","common/views/null-model-view"],function(e){var t=e("common/controllers/model-controller"),n=e("models/signal-generator/modeler"),r=e("common/views/null-model-view"),i=function(){};return function(e,o,a){return new t(e,o,a,n,r,i)}}),define("models/iframe/metadata",[],function(){return{mainProperties:{type:{defaultValue:"iframe-model",immutable:!0},url:{immutable:!0}},viewOptions:{aspectRatio:{defaultValue:1.55},showClock:{defaultValue:!1,propertyChangeInvalidates:!1},controlButtons:{defaultValue:"reset",propertyChangeInvalidates:!1}}}}),define("models/iframe/modeler",["require","common/lab-modeler-mixin","models/iframe/metadata"],function(e){function t(e){var t=new r({metadata:i,initialProperties:e,usePlaybackSupport:!1});t.mixInto(this),this.set=n,this._phone=null,this._stopped=!0,this._initialProperties=e,this._propertySupport=t.propertySupport,this._dispatch=t.dispatchSupport,this._stepCounter=0,this._propertyUpdateComingFromIframe=!1,this._iframeOutputs={},this._dispatch.addEventTypes("tick","tickStart","tickEnd","play","stop","reset","stepForward","stepBack","log")}function n(e,t){var n=this;if("string"!=typeof e){var r=e;return void Object.keys(r).forEach(function(e){n.set(e,r[e])})}this.hasProperty(e)||this._propertySupport.defineProperty(e,{type:"mainProperty",writable:!0,set:function(t){n._propertyUpdateComingFromIframe||n._phone.post("set",{name:e,value:t})},includeInHistoryState:!1,beforeSetCallback:this._propertySupport.invalidatingChangePreHook,afterSetCallback:this._propertySupport.invalidatingChangePostHook}),this.properties[e]=t}var r=e("common/lab-modeler-mixin"),i=e("models/iframe/metadata");return t.prototype._defineModelSpecificProperties=function(){var e=this._initialProperties,t=this;Object.keys(e).forEach(function(n){i.mainProperties[n]||i.viewOptions[n]||t.set(n,e[n])})},t.prototype.start=function(){return this._phone.post({type:"play"}),this},t.prototype.stop=function(){return this._phone.post({type:"stop"}),this},t.prototype.restart=function(){return this.stop(),this.start(),this},t.prototype.isStopped=function(){return this._stopped},t.prototype.serialize=function(){return this._initialProperties},Object.defineProperty(t.prototype,"iframePhone",{set:function(e){this._phone=e,this._addListeners(),this._defineModelSpecificProperties()},get:function(){return this._phone}}),t.prototype.stepCounter=function(){return this._stepCounter},t.prototype.iframeOutput=function(e){return this._iframeOutputs[e]},t.prototype._updateOutputs=function(e){var t=this;this.makeInvalidatingChange(function(){Object.keys(e).forEach(function(n){t._iframeOutputs[n]=e[n]})})},t.prototype._updatePropertiesFromIframe=function(e){this._propertyUpdateComingFromIframe=!0,this.set(e),this._propertyUpdateComingFromIframe=!1},t.prototype._addListeners=function(){var e=this;this._phone.addListener("play.iframe-model",function(){e._stopped=!1,e._dispatch.play()}),this._phone.addListener("stop.iframe-model",function(){e._stopped=!0,e._dispatch.stop()}),this._phone.addListener("properties",function(t){e._updatePropertiesFromIframe(t)}),this._phone.addListener("outputs",function(t){e._updateOutputs(t)}),this._phone.addListener("tick",function(t){e._stepCounter++,t&&t.outputs&&e._updateOutputs(t.outputs),t&&t.properties&&e._updatePropertiesFromIframe(t.properties),e._dispatch.tick()}),this._phone.addListener("log",function(t){e._dispatch.log(t.action,t.data)})},t}),define("models/iframe/iframe-container",["require","iframe-phone"],function(e){var t=e("iframe-phone");return function(e){function n(e){i.find("#iframe-model").remove();var n=$("<iframe id='iframe-model' style='width:100%;height:100%' src='"+e.get("url")+"'></iframe>");i.append(n);var r=new t.ParentEndpoint(i.find("#iframe-model")[0]);n.on("destroyed",function(){r.disconnect()}),e.iframePhone=r}var r=e,i=$("<div id='model-container' class='container'></div>");return n(e),{$el:i,getHeightForWidth:function(e){return e/r.get("aspectRatio")},resize:function(){},bindModel:function(e){n(e),r=e},setup:function(){},update:function(){},repaint:function(){}}}}),define("models/iframe/scripting-api",[],function(){return function(e){var t=e.bindModel;return e.bindModel=function(){t.apply(e,arguments),e.model.iframePhone.addListener("registerScriptingAPIFunc",function(t){null==e.api[t]&&(e.api[t]=function(n){e.model.iframePhone.post(t,n)})})},{post:function(t,n){e.model.iframePhone.post(t,n)},iframeOutput:function(t){return e.model.iframeOutput(t)}}}}),define("models/iframe/controller",["require","common/controllers/model-controller","models/iframe/modeler","models/iframe/iframe-container","models/iframe/scripting-api"],function(e){var t=e("common/controllers/model-controller"),n=e("models/iframe/modeler"),r=e("models/iframe/iframe-container"),i=e("models/iframe/scripting-api");return function(e,o,a){return new t(e,o,a,n,r,i)}}),define("models/sensor/metadata",[],function(){return{mainProperties:{type:{defaultValue:"sensor",immutable:!0},sensorType:{defaultValue:null},samplesPerSecond:{readOnly:!0},collectionTime:{defaultValue:null},tareValue:{defaultValue:0}},viewOptions:{showClock:{defaultValue:!0,propertyChangeInvalidates:!1},controlButtons:{defaultValue:"play_reset",propertyChangeInvalidates:!1},controlButtonStyle:{defaultValue:"video",propertyChangeInvalidates:!1,serialize:!1}}}}),!function(e){"object"==typeof exports?module.exports=e():"function"==typeof define&&define.amd?define("sensor-applet",e):"undefined"!=typeof window?window.sensorAppletInterface=e():"undefined"!=typeof global?global.sensorAppletInterface=e():"undefined"!=typeof self&&(self.sensorAppletInterface=e())}(function(){return function e(t,n,r){function i(a,s){if(!n[a]){if(!t[a]){var l="function"==typeof require&&require;if(!s&&l)return l(a,!0);if(o)return o(a,!0);throw new Error("Cannot find module '"+a+"'")}var u=n[a]={exports:{}};t[a][0].call(u.exports,function(e){var n=t[a][1][e];return i(n?n:e)},u,u.exports,e,t,n,r)}return n[a].exports}for(var o="function"==typeof require&&require,a=0;a<r.length;a++)i(r[a]);return i}({1:[function(e,t,n){var r=e("./mini-class"),i=e("./sensor-applet");t.exports={GoIO:r.extendClass(i,{deviceType:"golink",deviceSpecificJars:["sensor-vernier","goio-jna"]}),LabQuest:r.extendClass(i,{deviceType:"labquest",deviceSpecificJars:["sensor-vernier","labquest-jna"]})}},{"./mini-class":4,"./sensor-applet":6}],2:[function(e,t,n){"use strict";function r(e){Error.call(this),Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor),this.name=this.constructor.name,this.message=e}function i(){r.apply(this,arguments)}function o(){r.apply(this,arguments)}function a(){r.apply(this,arguments)}function s(){r.apply(this,arguments)}var l=e("util");l.inherits(i,Error),l.inherits(o,Error),l.inherits(a,Error),l.inherits(s,Error),t.exports={JavaLoadError:i,AppletInitializationError:o,AlreadyReadingError:s,SensorConnectionError:a}},{util:11}],3:[function(e,t,n){t.exports="20140417.203729"},{}],4:[function(e,t,n){"use strict";function r(e,t){var n,r={}.hasOwnProperty;for(n in t)r.call(t,n)&&(e[n]=t[n])}function i(e,t){function n(){this.constructor=e}r(e,t),n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype}function o(e){function t(e){r(this,e)}return r(t.prototype,e),t}function a(e,t){function n(e){r(this,e)}return i(n,e),r(n.prototype,t),n}t.exports={defineClass:o,extendClass:a,mixin:r}},{}],5:[function(e,t,n){"use strict";t.exports={on:function(e,t){this._ee_listeners||(this._ee_listeners={}),this._ee_listeners[e]||(this._ee_listeners[e]=[]),this._ee_listeners[e].push(t)},emit:function(e){var t=arguments.length>1?[].slice.call(arguments,1):[];if(this._ee_listeners&&this._ee_listeners[e])for(var n=0,r=this._ee_listeners[e].length;n<r;n++)this._ee_listeners[e][n].apply(null,t)},removeListener:function(e,t){if(this._ee_listeners&&this._ee_listeners[e])for(var n=0,r=this._ee_listeners[e].length;n<r;n++)this._ee_listeners[e][n]===t&&this._ee_listeners[e].splice(n,1)},removeListeners:function(e){e?this._ee_listeners&&(this._ee_listeners[e]=[]):this._ee_listeners={}}}},{}],6:[function(e,t,n){"use strict";function r(){var e=null,t=null;this.handleCallback=function(){console.log("handling callback from applet"),setTimeout(function(){return null===e?void console.log("applet called callback after timer expired"):(window.clearInterval(e),e=null,void t.success())},5)},this.wait=function(n){var r=0,i=n.times;t=n,e=window.setInterval(function(){r++,r>i&&(window.clearInterval(e),e=null,n.fail())},n.interval)}}var i,o=e("./mini-class"),a=e("./mini-event-emitter"),s=e("./errors"),l=e("./jars-timestamp");i=o.defineClass({listenerPath:"",sensorDefinitions:null,codebase:"",deviceType:"",appletId:"sensor-applet",classNames:"applet sensor-applet",jars:["jna","sensor","sensor-applets"],deviceSpecificJarUrls:[],code:"org.concord.sensor.applet.SensorApplet",testAppletReadyInterval:100,getArchiveValue:function(e){for(var t=[],n=0;n<e.length;n++)t[n]=e[n]+".jar";return t.join(", ")},getHTML:function(){var e=this.jars.concat(this.deviceSpecificJars);return["<applet ",'id="',this.appletId,'" ','class="',this.classNames,'" ','archive="',this.getArchiveValue(e),'" ','code="',this.code,'" ','codebase="',this.codebase,"/",l,'" ','width="1px" ','height="1px" ','MAYSCRIPT="true" ',">",'<param name="MAYSCRIPT" value="true" />','<param name="evalOnInit" value="'+this.listenerPath+'.appletIsReadyCallback()" />','<param name="permissions" value="all-permissions" />','<param name="java_arguments" value="-Djnlp.packEnabled=true"/>',"</applet>"].join("")},getTestAppletHTML:function(){return["<applet ",'id="',this.appletId,'-test-applet" ','class="applet test-sensor-applet" ','code="org.concord.sensor.applet.DetectionApplet" ','archive="',this.getArchiveValue(["sensor-applets"]),'" ','codebase="',this.codebase,"/",l,'" ','width="150px" ','height="150px" ','style="position: absolute; ',"left: "+($("body").width()/2-75)+"px; ","top: "+($("body").height()/2-75)+'px;" ','MAYSCRIPT="true" ',">",'<param name="MAYSCRIPT" value="true" />','<param name="evalOnInit" value="'+this.listenerPath+'.testAppletIsReadyCallback()" />','<param name="permissions" value="all-permissions" />','<param name="java_arguments" value="-Djnlp.packEnabled=true"/>',"</applet>"].join("")},isSensorConnected:function(e){var t,n,r=this;setTimeout(function(){t=function(i){i?(t=function(){var t=JSON.parse(r.appletInstance.getCachedAttachedSensors());if(t)if(1===r.sensorDefinitions.length){for(var n=0;n<t.length;n++)if(r.appletInstance.getTypeConstantName(t[n].type)===r.sensorDefinitions[0].typeConstantName)return void e.call(r,!0);e.call(r,!1)}else e.call(r,!0);else e.call(r,!1)},n=r.registerCallback(t),r.appletInstance.getAttachedSensors(r.deviceType,""+n)):e.call(r,!1)},n=r.registerCallback(t),r.appletInstance.isInterfaceConnected(r.deviceType,""+n)})},_state:"not appended",getState:function(){return this._state},append:function(e,t){if("not appended"!==this.getState())throw new Error("Can't call append() when sensor applet has left 'not appended' state");console.log("appending test applet"),this.$testAppletContainer=this._appendHTML(this.appletId+"-test-applet-container",this.getTestAppletHTML(),e),this._state="test applet appended",this._waitForTestApplet(),this._appendCallback=t},_appendHTML:function(e,t,n){var r=$("#"+e);return r.length||(r=$("<div id='"+e+"'/>").appendTo(n)),r.html(t),r},_testAppletWaiter:new r,testAppletIsReadyCallback:function(){this._testAppletWaiter.handleCallback()},_waitForTestApplet:function(){var e=this;this._testAppletWaiter.wait({times:30,interval:1e3,success:function(){e.$appletContainer=e._appendHTML(e.appletId+"-container",e.getHTML(),$("body")),e._state="appended",e._waitForApplet()},fail:function(){e._appendCallback(new s.JavaLoadError("Timed out waiting for test applet to initialize."))}})},_appletWaiter:new r,appletIsReadyCallback:function(){this._appletWaiter.handleCallback()},_waitForApplet:function(){var e=this;this._appletWaiter.wait({times:30,interval:1e3,success:function(){var t=[];e.$testAppletContainer.html(""),"appended"===e.getState()&&(e._state="applet ready"),e.appletInstance=$("#"+e.appletId)[0];for(var n=0;n<e.sensorDefinitions.length;n++)t[n]=e.appletInstance.getSensorRequest(e.sensorDefinitions[n].measurementType);e.appletInstance.initSensorInterface(e.listenerPath,e.deviceType,t)},fail:function(){e._appendCallback(new s.AppletInitializationError("Timed out waiting for sensor applet to initialize."))}})},readSensor:function(e){var t=this;return"reading sensor"===this.getState()?(console.log("Already reading sensor in another thread..."),void e.call(this,new s.AlreadyReadingError("Already reading sensor in another thread"),null)):"stopped"!==this.getState()?void e.call(this,new Error("Tried to read the sensor value from non-stopped state '"+this.getState()+'"'),null):(this._state="reading sensor",void this.isSensorConnected(function(n){if(n){var r=function(n){t._state="stopped",n&&0!==n.length?e.call(t,null,n):e.call(t,new Error("readSensor: no sensor values to report"),null)},i=t.registerCallback(r);t.appletInstance.getConfiguredSensorsValues(t.deviceType,""+i)}else t._state="stopped",e.call(t,new s.SensorConnectionError("readSensor: sensor is not connected"),null)}))},start:function(e){var t=this;return"reading sensor"===this.getState()?(console.log("start called while waiting for a sensor reading"),void setTimeout(function(){t.start(e)},100)):"stopped"!==this.getState()?void(e&&setTimeout(function(){e.call(this,new Error("Tried to start the applet from non-stopped state '"+this.getState()+'"'),!1)},5)):(this._state="starting",void this.isSensorConnected(function(n){n?(t.appletInstance.startCollecting(),t._state="started",e&&e.call(t,null,!0)):(t._state="stopped",e&&e.call(t,new s.SensorConnectionError("Device reported the requested sensor type was not attached."),null))}))},stop:function(){"started"===this.getState()&&(this._state="stopped",this.appletInstance.stopCollecting())},remove:function(){"not appended"!==this.getState()&&(this.$appletContainer&&this.$appletContainer.html(""),this.$testAppletContainer&&this.$testAppletContainer.html(""),this._state="not appended")},initSensorInterfaceComplete:function(e){var t=this;setTimeout(function(){e?(t._state="stopped",t._appendCallback(null),t._appendCallback=null):t._appendCallback(new s.SensorConnectionError("Device reported the requested sensor type was not attached."))},5)},dataReceived:function(e,t,n){var r=this,i=[],o=this.sensorDefinitions.length;setTimeout(function(){n=n||[];for(var e=0;e<t;e++){for(var a=0;a<o;a++)i[a]=n[e*o+a];r.emit("data",i)}},5)},deviceUnplugged:function(){var e=this;window.setTimeout(function(){e.emit("deviceUnplugged")},5)},sensorUnplugged:function(){console.log("received sensorUnplugged message; deviceType = "+this.deviceType)},callbackTable:[],registerCallback:function(e){return this.callbackTable.push(e),this.callbackTable.length-1},handleCallback:function(e,t){var n,r=this;"string"==typeof e&&this[e]?n=this[e]:this.callbackTable[e]&&(n=this.callbackTable[e],this.callbackTable[e]=null),n&&(t=t||[],setTimeout(function(){n.apply(r,t)},5))}}),o.mixin(i.prototype,a),t.exports=i},{"./errors":2,"./jars-timestamp":3,"./mini-class":4,"./mini-event-emitter":5}],7:[function(e,t,n){t.exports={goMotion:{appletClass:"GoIO",measurementName:"Distance",measurementType:"distance",typeConstantName:"distance",sensorName:"GoMotion",deviceName:"GoMotion",samplesPerSecond:20,tareable:!0,minReading:-2,maxReading:2,precision:2,maxSeconds:20},goTemp:{appletClass:"GoIO",measurementName:"Temperature",measurementType:"temperature",typeConstantName:"temperature_wand",sensorName:"GoIO Temperature Sensor",deviceName:"GoIO",
samplesPerSecond:10,tareable:!1,minReading:0,maxReading:40,maxSeconds:20},goLinkTemperature:{appletClass:"GoIO",measurementName:"Temperature",measurementType:"temperature",typeConstantName:"temperature",sensorName:"GoIO Temperature Sensor",deviceName:"GoIO",samplesPerSecond:10,tareable:!1,minReading:0,maxReading:40,maxSeconds:20},goLinkLight:{appletClass:"GoIO",measurementName:"Light Intensity",measurementType:"light",typeConstantName:"light",sensorName:"GoIO Light Sensor",deviceName:"GoIO",samplesPerSecond:10,tareable:!1,minReading:0,maxReading:2e3,maxSeconds:20},goLinkForce:{appletClass:"GoIO",measurementName:"Force",measurementType:"force",typeConstantName:"force",sensorName:"GoIO Force Sensor",deviceName:"GoIO",samplesPerSecond:20,tareable:!0,minReading:-50,maxReading:50,precision:2,maxSeconds:10},goLinkPH:{appletClass:"GoIO",measurementName:"Acidity",measurementType:"ph",typeConstantName:"ph",sensorName:"GoIO pH Sensor",deviceName:"GoIO",samplesPerSecond:10,tareable:!1,minReading:0,maxReading:14,maxSeconds:60},goLinkCO2:{appletClass:"GoIO",measurementName:"CO₂ Concentration",measurementType:"co2",typeConstantName:"co2_gas",sensorName:"GoIO CO₂ sensor",deviceName:"GoIO",samplesPerSecond:1,tareable:!1,minReading:0,maxReading:5e3,maxSeconds:60},goLinkO2:{appletClass:"GoIO",measurementName:"O₂ Concentration",measurementType:"o2",typeConstantName:"oxygen_gas",sensorName:"GoIO O₂ sensor",deviceName:"GoIO",samplesPerSecond:1,tareable:!1,minReading:0,maxReading:100,maxSeconds:60},labQuestMotion:{appletClass:"LabQuest",measurementName:"Distance",measurementType:"distance",typeConstantName:"distance",sensorName:"LabQuest Motion Sensor",deviceName:"LabQuest",samplesPerSecond:20,tareable:!0,minReading:-2,maxReading:2,precision:2,maxSeconds:20},labQuestTemperature:{appletClass:"LabQuest",measurementName:"Temperature",measurementType:"temperature",typeConstantName:"temperature",sensorName:"LabQuest Temperature Sensor",deviceName:"LabQuest",samplesPerSecond:10,tareable:!1,minReading:0,maxReading:40,maxSeconds:20},labQuestLight:{appletClass:"LabQuest",measurementName:"Light Intensity",measurementType:"light",typeConstantName:"light",sensorName:"LabQuest Light Sensor",deviceName:"LabQuest",samplesPerSecond:10,tareable:!1,minReading:0,maxReading:2e3,maxSeconds:20},labQuestForce:{appletClass:"LabQuest",measurementName:"Force",measurementType:"force",typeConstantName:"force",sensorName:"LabQuest Force Sensor",deviceName:"LabQuest",samplesPerSecond:20,tareable:!0,minReading:-50,maxReading:50,precision:2,maxSeconds:10},labQuestPH:{appletClass:"LabQuest",measurementName:"Acidity",measurementType:"ph",typeConstantName:"ph",sensorName:"LabQuest pH Sensor",deviceName:"LabQuest",samplesPerSecond:10,tareable:!1,minReading:0,maxReading:14,maxSeconds:60},labQuestCO2:{appletClass:"LabQuest",measurementName:"CO₂ Concentration",measurementType:"co2",typeConstantName:"co2_gas",sensorName:"LabQuest CO₂ sensor",deviceName:"LabQuest",samplesPerSecond:1,tareable:!1,minReading:0,maxReading:5e3,maxSeconds:60},labQuestO2:{appletClass:"LabQuest",measurementName:"O₂ Concentration",measurementType:"o2",typeConstantName:"oxygen_gas",sensorName:"LabQuest O₂ sensor",deviceName:"LabQuest",samplesPerSecond:1,tareable:!1,minReading:0,maxReading:100,maxSeconds:60}}},{}],8:[function(e,t,n){t.exports={units:{time:{name:"second",pluralName:"seconds",symbol:"s"},distance:{name:"meter",pluralName:"meters",symbol:"m"},temperature:{name:"degree Celsius",pluaralName:"degrees Celsius",symbol:"°C"},light:{name:"lux",pluralName:"lux",symbol:"lux"},force:{name:"Newton",pluralName:"Newtons",symbol:"N"},ph:{name:"pH Unit",pluralName:"pH Units",symbol:"pH"},co2:{name:"part per million",pluralName:"parts per million",symbol:"ppm"},o2:{name:"part per million",pluralName:"parts per million",symbol:"ppm"}}}},{}],9:[function(e,t,n){var r=e("./lib/applet-classes"),i=e("./lib/errors");t.exports={GoIO:r.GoIO,LabQuest:r.LabQuest,sensorDefinitions:e("./lib/sensor-definitions"),unitsDefinition:e("./lib/units-definition"),JavaLoadError:i.JavaLoadError,AppletInitializationError:i.AppletInitializationError,SensorConnectionError:i.SensorConnectionError,AlreadyReadingError:i.AlreadyReadingError}},{"./lib/applet-classes":1,"./lib/errors":2,"./lib/sensor-definitions":7,"./lib/units-definition":8}],10:[function(e,t,n){function r(e){return"[object Array]"===u.call(e)}function i(e,t){var n;if(null===e)n={__proto__:null};else{if("object"!=typeof e)throw new TypeError("typeof prototype["+typeof e+"] != 'object'");var r=function(){};r.prototype=e,n=new r,n.__proto__=e}return"undefined"!=typeof t&&Object.defineProperties&&Object.defineProperties(n,t),n}function o(e){return"object"!=typeof e&&"function"!=typeof e||null===e}function a(e){if(o(e))throw new TypeError("Object.keys called on a non-object");var t=[];for(var n in e)c.call(e,n)&&t.push(n);return t}function s(e){if(o(e))throw new TypeError("Object.getOwnPropertyNames called on a non-object");var t=a(e);return n.isArray(e)&&n.indexOf(e,"length")===-1&&t.push("length"),t}function l(e,t){return{value:e[t]}}var u=Object.prototype.toString,c=Object.prototype.hasOwnProperty;n.isArray="function"==typeof Array.isArray?Array.isArray:r,n.indexOf=function(e,t){if(e.indexOf)return e.indexOf(t);for(var n=0;n<e.length;n++)if(t===e[n])return n;return-1},n.filter=function(e,t){if(e.filter)return e.filter(t);for(var n=[],r=0;r<e.length;r++)t(e[r],r,e)&&n.push(e[r]);return n},n.forEach=function(e,t,n){if(e.forEach)return e.forEach(t,n);for(var r=0;r<e.length;r++)t.call(n,e[r],r,e)},n.map=function(e,t){if(e.map)return e.map(t);for(var n=new Array(e.length),r=0;r<e.length;r++)n[r]=t(e[r],r,e);return n},n.reduce=function(e,t,n){if(e.reduce)return e.reduce(t,n);var r,i=!1;2<arguments.length&&(r=n,i=!0);for(var o=0,a=e.length;a>o;++o)e.hasOwnProperty(o)&&(i?r=t(r,e[o],o,e):(r=e[o],i=!0));return r},"b"!=="ab".substr(-1)?n.substr=function(e,t,n){return t<0&&(t=e.length+t),e.substr(t,n)}:n.substr=function(e,t,n){return e.substr(t,n)},n.trim=function(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")},n.bind=function(){var e=Array.prototype.slice.call(arguments),t=e.shift();if(t.bind)return t.bind.apply(t,e);var n=e.shift();return function(){t.apply(n,e.concat([Array.prototype.slice.call(arguments)]))}},n.create="function"==typeof Object.create?Object.create:i;var d="function"==typeof Object.keys?Object.keys:a,p="function"==typeof Object.getOwnPropertyNames?Object.getOwnPropertyNames:s;if((new Error).hasOwnProperty("description")){var f=function(e,t){return"[object Error]"===u.call(e)&&(t=n.filter(t,function(e){return"description"!==e&&"number"!==e&&"message"!==e})),t};n.keys=function(e){return f(e,d(e))},n.getOwnPropertyNames=function(e){return f(e,p(e))}}else n.keys=d,n.getOwnPropertyNames=p;if("function"==typeof Object.getOwnPropertyDescriptor)try{Object.getOwnPropertyDescriptor({a:1},"a"),n.getOwnPropertyDescriptor=Object.getOwnPropertyDescriptor}catch(e){n.getOwnPropertyDescriptor=function(e,t){try{return Object.getOwnPropertyDescriptor(e,t)}catch(n){return l(e,t)}}}else n.getOwnPropertyDescriptor=l},{}],11:[function(e,t,n){function r(e,t){var r={seen:[],stylize:o};return arguments.length>=3&&(r.depth=arguments[2]),arguments.length>=4&&(r.colors=arguments[3]),h(t)?r.showHidden=t:t&&n._extend(r,t),_(r.showHidden)&&(r.showHidden=!1),_(r.depth)&&(r.depth=2),_(r.colors)&&(r.colors=!1),_(r.customInspect)&&(r.customInspect=!0),r.colors&&(r.stylize=i),s(r,e,r.depth)}function i(e,t){var n=r.styles[t];return n?"["+r.colors[n][0]+"m"+e+"["+r.colors[n][1]+"m":e}function o(e,t){return e}function a(e){var t={};return L.forEach(e,function(e,n){t[e]=!0}),t}function s(e,t,r){if(e.customInspect&&t&&S(t.inspect)&&t.inspect!==n.inspect&&(!t.constructor||t.constructor.prototype!==t)){var i=t.inspect(r);return y(i)||(i=s(e,i,r)),i}var o=l(e,t);if(o)return o;var h=L.keys(t),m=a(h);if(e.showHidden&&(h=L.getOwnPropertyNames(t)),0===h.length){if(S(t)){var g=t.name?": "+t.name:"";return e.stylize("[Function"+g+"]","special")}if(x(t))return e.stylize(RegExp.prototype.toString.call(t),"regexp");if(C(t))return e.stylize(Date.prototype.toString.call(t),"date");if(T(t))return u(t)}var v="",b=!1,_=["{","}"];if(f(t)&&(b=!0,_=["[","]"]),S(t)){var w=t.name?": "+t.name:"";v=" [Function"+w+"]"}if(x(t)&&(v=" "+RegExp.prototype.toString.call(t)),C(t)&&(v=" "+Date.prototype.toUTCString.call(t)),T(t)&&(v=" "+u(t)),0===h.length&&(!b||0==t.length))return _[0]+v+_[1];if(r<0)return x(t)?e.stylize(RegExp.prototype.toString.call(t),"regexp"):e.stylize("[Object]","special");e.seen.push(t);var A;return A=b?c(e,t,r,m,h):h.map(function(n){return d(e,t,r,m,n,b)}),e.seen.pop(),p(A,v,_)}function l(e,t){if(_(t))return e.stylize("undefined","undefined");if(y(t)){var n="'"+JSON.stringify(t).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return e.stylize(n,"string")}return v(t)?e.stylize(""+t,"number"):h(t)?e.stylize(""+t,"boolean"):m(t)?e.stylize("null","null"):void 0}function u(e){return"["+Error.prototype.toString.call(e)+"]"}function c(e,t,n,r,i){for(var o=[],a=0,s=t.length;a<s;++a)M(t,String(a))?o.push(d(e,t,n,r,String(a),!0)):o.push("");return L.forEach(i,function(i){i.match(/^\d+$/)||o.push(d(e,t,n,r,i,!0))}),o}function d(e,t,n,r,i,o){var a,l,u;if(u=L.getOwnPropertyDescriptor(t,i)||{value:t[i]},u.get?l=u.set?e.stylize("[Getter/Setter]","special"):e.stylize("[Getter]","special"):u.set&&(l=e.stylize("[Setter]","special")),M(r,i)||(a="["+i+"]"),l||(L.indexOf(e.seen,u.value)<0?(l=m(n)?s(e,u.value,null):s(e,u.value,n-1),l.indexOf("\n")>-1&&(l=o?l.split("\n").map(function(e){return"  "+e}).join("\n").substr(2):"\n"+l.split("\n").map(function(e){return"   "+e}).join("\n"))):l=e.stylize("[Circular]","special")),_(a)){if(o&&i.match(/^\d+$/))return l;a=JSON.stringify(""+i),a.match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(a=a.substr(1,a.length-2),a=e.stylize(a,"name")):(a=a.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),a=e.stylize(a,"string"))}return a+": "+l}function p(e,t,n){var r=0,i=L.reduce(e,function(e,t){return r++,t.indexOf("\n")>=0&&r++,e+t.replace(/\u001b\[\d\d?m/g,"").length+1},0);return i>60?n[0]+(""===t?"":t+"\n ")+" "+e.join(",\n  ")+" "+n[1]:n[0]+t+" "+e.join(", ")+" "+n[1]}function f(e){return L.isArray(e)}function h(e){return"boolean"==typeof e}function m(e){return null===e}function g(e){return null==e}function v(e){return"number"==typeof e}function y(e){return"string"==typeof e}function b(e){return"symbol"==typeof e}function _(e){return void 0===e}function x(e){return w(e)&&"[object RegExp]"===P(e)}function w(e){return"object"==typeof e&&e}function C(e){return w(e)&&"[object Date]"===P(e)}function T(e){return w(e)&&"[object Error]"===P(e)}function S(e){return"function"==typeof e}function A(e){return null===e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||"symbol"==typeof e||"undefined"==typeof e}function k(e){return e&&"object"==typeof e&&"function"==typeof e.copy&&"function"==typeof e.fill&&"function"==typeof e.binarySlice}function P(e){return Object.prototype.toString.call(e)}function E(e){return e<10?"0"+e.toString(10):e.toString(10)}function O(){var e=new Date,t=[E(e.getHours()),E(e.getMinutes()),E(e.getSeconds())].join(":");return[e.getDate(),R[e.getMonth()],t].join(" ")}function M(e,t){return Object.prototype.hasOwnProperty.call(e,t)}var L=e("_shims"),N=/%[sdj%]/g;n.format=function(e){if(!y(e)){for(var t=[],n=0;n<arguments.length;n++)t.push(r(arguments[n]));return t.join(" ")}for(var n=1,i=arguments,o=i.length,a=String(e).replace(N,function(e){if("%%"===e)return"%";if(n>=o)return e;switch(e){case"%s":return String(i[n++]);case"%d":return Number(i[n++]);case"%j":try{return JSON.stringify(i[n++])}catch(e){return"[Circular]"}default:return e}}),s=i[n];n<o;s=i[++n])a+=m(s)||!w(s)?" "+s:" "+r(s);return a},n.inspect=r,r.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},r.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"},n.isArray=f,n.isBoolean=h,n.isNull=m,n.isNullOrUndefined=g,n.isNumber=v,n.isString=y,n.isSymbol=b,n.isUndefined=_,n.isRegExp=x,n.isObject=w,n.isDate=C,n.isError=T,n.isFunction=S,n.isPrimitive=A,n.isBuffer=k;var R=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];n.log=function(){console.log("%s - %s",O(),n.format.apply(n,arguments))},n.inherits=function(e,t){e.super_=t,e.prototype=L.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}})},n._extend=function(e,t){if(!t||!w(t))return e;for(var n=L.keys(t),r=n.length;r--;)e[n[r]]=t[n[r]];return e}},{_shims:10}]},{},[9])(9)});define("models/sensor-common/i18n-sensor-definitions",["require","sensor-applet"],function(e){var t=e("sensor-applet").sensorDefinitions;return function(e){return t.goMotion.measurementName=e.t("sensor.measurements.distance"),t.goMotion.sensorName=e.t("sensor.names.goMotion"),t.goTemp.measurementName=e.t("sensor.measurements.temperature"),t.goTemp.sensorName=e.t("sensor.names.goTemp"),t.goLinkTemperature.measurementName=e.t("sensor.measurements.temperature"),t.goLinkTemperature.sensorName=e.t("sensor.names.goLinkTemperature"),t.goLinkLight.measurementName=e.t("sensor.measurements.light_intensity"),t.goLinkLight.sensorName=e.t("sensor.names.goLinkLight"),t.goLinkForce.measurementName=e.t("sensor.measurements.force"),t.goLinkForce.sensorName=e.t("sensor.names.goLinkForce"),t.goLinkPH.measurementName=e.t("sensor.measurements.acidity"),t.goLinkPH.sensorName=e.t("sensor.names.goLinkPH"),t.goLinkCO2.measurementName=e.t("sensor.measurements.CO2_concentration"),t.goLinkCO2.sensorName=e.t("sensor.names.goLinkCO2"),t.goLinkO2.measurementName=e.t("sensor.measurements.O2_concentration"),t.goLinkO2.sensorName=e.t("sensor.names.goLinkO2"),t.labQuestMotion.measurementName=e.t("sensor.measurements.distance"),t.labQuestMotion.sensorName=e.t("sensor.names.labQuestMotion"),t.labQuestTemperature.measurementName=e.t("sensor.measurements.temperature"),t.labQuestTemperature.sensorName=e.t("sensor.names.labQuestTemperature"),t.labQuestLight.measurementName=e.t("sensor.measurements.light_intensity"),t.labQuestLight.sensorName=e.t("sensor.names.labQuestLight"),t.labQuestForce.measurementName=e.t("sensor.measurements.force"),t.labQuestForce.sensorName=e.t("sensor.names.labQuestForce"),t.labQuestPH.measurementName=e.t("sensor.measurements.acidity"),t.labQuestPH.sensorName=e.t("sensor.names.labQuestPH"),t.labQuestCO2.measurementName=e.t("sensor.measurements.CO2_concentration"),t.labQuestCO2.sensorName=e.t("sensor.names.labQuestCO2"),t.labQuestO2.measurementName=e.t("sensor.measurements.O2_concentration"),t.labQuestO2.sensorName=e.t("sensor.names.labQuestO2"),t}});define("models/sensor-common/notifier",["require","common/controllers/basic-dialog"],function(e){function t(e){this._i18n=e}var n=e("common/controllers/basic-dialog");return t.prototype.alert=function(e,t,r){var i=$.extend({width:"60%",buttons:t,closeOnEscape:!1},r),o=new n(i,this._i18n);o.setContent("<div>"+e+"</div>"),o.open()},t.prototype.status=function(e,t){var r=$.extend({width:"60%",closeOnEscape:!1,modal:!0},t),i=new n(r,this._i18n);return i.setContent("<div>"+e+"</div>"),i.open(),i},t}),define("models/sensor/modeler",["require","lab.config","common/lab-modeler-mixin","common/property-description","./metadata","sensor-applet","models/sensor-common/i18n-sensor-definitions","models/sensor-common/notifier","common/controllers/export-controller"],function(e){var t=e("lab.config"),n=e("common/lab-modeler-mixin"),r=e("common/property-description"),i=e("./metadata"),o=e("sensor-applet"),a=o.unitsDefinition,s=e("models/sensor-common/i18n-sensor-definitions"),l=e("models/sensor-common/notifier"),u=e("common/controllers/export-controller");return function(e,c){function d(e,t,n){var i,o;i=V.getPropertyDescription(e).getHash(),i.min=t,i.max=n,o=new r(a,i),T.setPropertyDescription(e,o)}function p(){null!=V.properties.collectionTime&&d("displayTime",0,V.properties.collectionTime)}function f(){P&&(P.removeListeners("data"),P.removeListeners("deviceUnplugged"),P.removeListeners("sensorUnplugged"),P.remove()),V.makeInvalidatingChange(function(){U=!1,q=!1})}function h(){V.makeInvalidatingChange(function(){q=!0}),setTimeout(function(){P.on("data",w),P.on("deviceUnplugged",function(){v("device")}),P.on("sensorUnplugged",function(){v("sensor")}),P.append($("body"),function(e){return e?(e instanceof o.JavaLoadError?g(j.t("sensor.messages.java_applet_error")):e instanceof o.AppletInitializationError?g(j.t("sensor.messages.java_applet_not_loading")):e instanceof o.SensorConnectionError?m():g(j.t("sensor.messages.unexpected_error")),void V.makeInvalidatingChange(function(){q=!1})):void V.makeInvalidatingChange(function(){U=!0,q=!1})})},10)}function m(){f();var e={};e[j.t("sensor.messages.try_again")]=function(){$(this).dialog("close"),h()},e[j.t("sensor.messages.cancel")]=function(){$(this).remove(),V.reload()},F.alert(j.t("sensor.messages.sensor_not_attached",{sensor_name:V.properties.sensorName}),e)}function g(e){f(),F.alert(e,{OK:function(){$(this).remove(),V.reload()}})}function v(e){f(),V.stop(),u.logAction("Unplugged"+V.properties[e+"Name"]);var t={};t[j.t("sensor.messages.try_again")]=function(){$(this).dialog("close"),h()},t[j.t("sensor.messages.cancel")]=function(){$(this).dialog("close")},F.alert(j.t("sensor.messages.sensor_or_device_unplugged",{sensor_or_device_name:V.properties[e+"Name"]}),t)}function y(){E&&clearInterval(E);var e=function(e,t){if(e)if(e instanceof o.AlreadyReadingError);else{if(!(e instanceof o.SensorConnectionError))throw clearInterval(E),e;clearInterval(E),m()}else V.makeInvalidatingChange(function(){L=t[0],I&&(V.properties.tareValue=L,I=!1)})};E=setInterval(function(){P.readSensor(e)},1e3/H)}function b(){E&&(clearInterval(E),E=null)}function _(){N=0,M=0,L=void 0,R=!1,D=!1,I=!1}function x(e){var n,i,s,l;k!==e&&(k&&(V.properties.tareValue=0),k=e,L=void 0,P&&f(),k?(i=Y[k],O=i.samplesPerSecond,l=i.measurementType,n=o[i.appletClass],D=i.tareable,P=window.Lab.sensor[k]=new n({listenerPath:"Lab.sensor."+k,sensorDefinitions:[i],appletId:k+"-sensor",codebase:t.rootUrl+"/jars/lab-sensor-applet-interface-dist"}),h(),s=new r(a,{label:i.measurementName,unitType:l,min:i.minReading,max:i.maxReading}),T.setPropertyDescription("sensorReading",s),null==V.properties.collectionTime&&(V.properties.collectionTime=i.maxSeconds)):V.properties.hasOwnProperty("sensorReading")&&(s=new r(a,W),T.setPropertyDescription("sensorReading",s)))}function w(e){N++,M+=1/O,window.__bizarreSafariFix=1,L=e[0],R||V.freeze("sensorType"),R=!0,V.updateAllOutputProperties(),S.tick()}var C,T,S,A,k,P,E,O,M,L,N,R,I,D,B,V,j=c.i18n,F=new l(j),z=!0,G=!1,U=!1,q=!1,H=1,W={label:j.t("sensor.measurements.sensor_reading"),unitAbbreviation:"-",format:".2f",min:0,max:1},Y=s(j);return V={on:function(e,t){S.on(e,t)},start:function(){V.properties.isPlayable&&P.start(function(e,t){e?e instanceof o.SensorConnectionError&&m():t&&(V.makeInvalidatingChange(function(){z=!1}),S.play())})},stop:function(){P&&P.stop(),V.makeInvalidatingChange(function(){z=!0}),S.stop()},tare:function(){if(!z)throw new Error("Sensor model: tare() called on a non-stopped model.");null!=E&&null!=L?V.properties.tareValue=L:V.makeInvalidatingChange(function(){I=!0})},willReset:function(){S.willReset()},reset:function(){V.stop(),f(),_(),V.properties.tareValue=B,V.unfreeze("sensorType"),V.properties.sensorType=A,S.reset()},reload:function(){V.stop(),V.makeInvalidatingChange(function(){G=!0})},isStopped:function(){return z},stepCounter:function(){return N},serialize:function(){return""}},_(),void 0===window.Lab&&(window.Lab={}),window.Lab.sensor={},C=new n({metadata:i,setters:{sensorType:x},unitsDefinition:a,initialProperties:e,usePlaybackSupport:!1}),C.mixInto(V),T=C.propertySupport,S=C.dispatchSupport,S.addEventTypes("tick","play","stop","tickStart","tickEnd"),A=V.properties.sensorType,B=V.properties.tareValue,V.defineOutput("time",{label:j.t("sensor.measurements.time"),unitType:"time",format:".2f"},function(){return M}),V.defineOutput("displayTime",{label:j.t("sensor.measurements.time"),unitType:"time",format:".2f"},function(){return M}),V.defineOutput("sensorReading",W,function(){return null==L?L:L-V.properties.tareValue}),V.defineOutput("sensorName",{label:"Sensor Name"},function(){return Y[k].sensorName}),V.defineOutput("deviceName",{label:"Sensor Interface Device Name"},function(){return Y[k].deviceName}),V.defineOutput("isStopped",{label:"Stopped?"},function(){return z}),V.defineOutput("isPlayable",{label:"Startable?"},function(){return U&&!R}),V.defineOutput("hasPlayed",{label:"Has successfully collected data?"},function(){return R}),V.defineOutput("shouldPollSensor",{label:"Polling Sensor?"},function(){return V.properties.isPlayable&&z}),V.defineOutput("isSensorInitializing",{label:"Loading Sensor?"},function(){return q}),V.defineOutput("isTaring",{label:"Waiting for a tare value?"},function(){return I}),V.defineOutput("canTare",{label:"Can set a tare value?"},function(){return z&&!R&&D&&!I}),V.defineOutput("needsReload",{label:"Needs Reload?"},function(){return G}),V.on("willReset.model",f),V.addObserver("shouldPollSensor",function(){V.properties.shouldPollSensor?y():b()}),V.addObserver("collectionTime",p),p(),x(V.properties.sensorType),V}}),define("models/sensor/view",["common/views/select-box-view","common/views/numeric-output-view","sensor-applet","common/views/view-state"],function(){var e=require("common/views/select-box-view"),t=require("common/views/numeric-output-view"),n=require("sensor-applet").sensorDefinitions,r=require("common/views/view-state");return function(i,o,a){function s(){i.properties.isTaring?p.$zeroButton.find("button").html(a.t("sensor.zeroing")):p.$zeroButton.find("button").html(a.t("sensor.zero"))}function l(){i.properties.canTare?r.enableView(p.$zeroButton):r.disableView(p.$zeroButton)}function u(){var e=i.getPropertyDescription("sensorType");e.getFrozen()?r.disableView(p.$selectBox):r.enableView(p.$selectBox)}function c(){i.addObserver("isTaring",s),s(),i.addObserver("canTare",l),l(),i.addPropertyDescriptionObserver("sensorType",u),u()}var d,p,f=new e({id:"sensor-type-view",options:[{value:null,text:a.t("sensor.select_sensor_type"),selected:null==i.properties.sensorType,disabled:!0}].concat(Object.keys(n).map(function(e){return{value:e,text:n[e].sensorName,selected:e===i.properties.sensorType,disabled:!1}})),onChange:function(e){i.properties.sensorType=e.value}}),h=d3.format(".2f");return p={$el:$("<div id='model-container' class='container sensor-model-container' />"),bindModel:function(e,t){o=t||o,i=e||i,c()},getHeightForWidth:function(){return"2.6em"},setup:function(){this.$el.empty(),d=new t({id:"sensor-value-view",label:a.t("sensor.reading"),units:i.getPropertyDescription("sensorReading").getUnitAbbreviation()});var e=f.render(this.$el),n=$("<div><button>"+a.t("sensor.zero")+"</button></div>"),r=d.render();e.addClass("interactive-pulldown component component-spacing"),n.addClass("interactive-button component component-spacing"),r.addClass("numeric-output component horizontal component-spacing"),this.$el.css("zIndex",4),this.$el.append(e),this.$el.append(r),this.$el.append(n),this.$zeroButton=n,this.$selectBox=e,d.resize(),c(),n.on("click","button",function(){i.tare()})},showInitializationProgress:function(){var e;this.$progressbarContainer||(e=$("<div/>").attr("id","sensor-progressbar"),this.$progressbarContainer=$("<div/>").attr("id","sensor-progressbar-container").css("bottom",$("body").height()/2+75+$(".lab-responsive-content").offset().top).append('<div class="label">'+a.t("sensor.loading_sensor")+"</div>").append(e).appendTo(".lab-responsive-content"),e.progressbar({value:!1})),this.$progressbarContainer.show()},hideInitializationProgress:function(){this.$progressbarContainer.hide()},resize:function(){d&&d.resize()},repaint:function(){},setFocus:function(){},updateUnits:function(e){d.updateUnits(e),null==i.properties.sensorReading&&d.hideUnits()},update:function(){null==i.properties.sensorReading?(d.update(""),d.hideUnits()):(d.update(h(i.properties.sensorReading)),d.showUnits())}}}}),define("models/sensor/scripting-api",[],function(){return function(e){return{resetModel:function(t){e.intController.resetModel(t)}}}}),define("models/sensor/controller",["require","common/controllers/model-controller","./modeler","./view","./scripting-api"],function(e){var t=e("common/controllers/model-controller"),n=e("./modeler"),r=e("./view"),i=e("./scripting-api");return function(e,o,a){function s(){var e=l.model;e.addObserver("isSensorInitializing",function(){var t=l.modelContainer;e.properties.isSensorInitializing?t.showInitializationProgress():t.hideInitializationProgress()}),e.addObserver("sensorReading",function(){e.isStopped()&&l.updateView()}),e.addObserver("needsReload",function(){e.properties.needsReload&&a.reloadModel()}),e.addPropertyDescriptionObserver("sensorReading",function(){var t=e.getPropertyDescription("sensorReading"),n=l.modelContainer;n.updateUnits(t.getUnitAbbreviation())})}var l=new t(e,o,a,n,r,i);return a.on("modelLoaded.sensor-model-controller",s),a.on("modelReset.sensor-model-controller",function(){l.model.set("isNewRunInProgress",!1)}),a.on("willResetModel",function(){l.model.set("isNewRunInProgress",!0)}),l}}),define("models/dual-sensor/metadata",[],function(){return{mainProperties:{type:{defaultValue:"dual-sensor",immutable:!0},sensorType:{defaultValue:null},sensorType2:{defaultValue:null},samplesPerSecond:{readOnly:!0},collectionTime:{defaultValue:null},tareValue:{defaultValue:0},tareValue2:{defaultValue:0},clientId:{defaultValue:null},useRandomClientId:{defaultValue:!1}},viewOptions:{showClock:{defaultValue:!0,propertyChangeInvalidates:!1},controlButtons:{defaultValue:"play_reset",propertyChangeInvalidates:!1},controlButtonStyle:{defaultValue:"video",propertyChangeInvalidates:!1,serialize:!1}}}}),define("models/dual-sensor/modeler",["require","common/property-support","common/property-description","cs!common/filters/running-average-filter","common/validator","./metadata","sensor-applet","models/sensor-common/i18n-sensor-definitions","lab.config","models/sensor-common/notifier","common/controllers/export-controller"],function(e){var t=e("common/property-support"),n=e("common/property-description"),r=e("cs!common/filters/running-average-filter"),i=e("common/validator"),o=e("./metadata"),a=e("sensor-applet"),s=a.unitsDefinition,l=e("models/sensor-common/i18n-sensor-definitions"),u=e("lab.config"),c=e("models/sensor-common/notifier"),d=e("common/controllers/export-controller");return function(e,p){function f(e,t,r){var a,l,u,c;if("mainProperty"===t)a=o.mainProperties;else{if("viewOption"!==t)throw new Error(t+" is not a supported built-in property type");a=o.viewOptions}u=i.propertyChangeInvalidates(a[e]),l={type:t,writable:i.propertyIsWritable(a[e]),set:r,includeInHistoryState:!!a[e].storeInTickHistory,validate:function(t){return i.validateSingleProperty(a[e],e,t,!1)},beforeSetCallback:u?h:void 0,afterSetCallback:u?m:void 0},c=a[e].unitType,c?l.description=new n(s,{unitType:c}):l.description=new n(null,{label:a.label||e}),Z.defineProperty(e,l)}function h(){0===ue&&(Z.storeComputedProperties(),Z.deleteComputedPropertyCachedValues(),Z.enableCaching=!1),ue++}function m(){ue--,v(),0===ue&&(Z.enableCaching=!0,Z.notifyChangedComputedProperties())}function g(e){h(),e(),m()}function v(){ce.forEach(function(e){e.addSample()})}function y(e,t,r){var i,o;i=J.getPropertyDescription(e).getHash(),i.min=t,i.max=r,o=new n(s,i),Z.setPropertyDescription(e,o)}function b(){null!=J.properties.collectionTime&&y("displayTime",0,J.properties.collectionTime)}function _(){V&&(V.removeListeners("data"),V.removeListeners("deviceUnplugged"),V.removeListeners("sensorUnplugged"),V.remove()),g(function(){oe=!1,ae=!1})}function x(){g(function(){ae=!0}),setTimeout(function(){V.on("data",L),V.on("deviceUnplugged",function(){T("device")}),V.on("sensorUnplugged",function(){T("sensor")}),V.append($("body"),function(e){return e?(e instanceof a.JavaLoadError?C(ee.t("sensor.messages.java_applet_error")):e instanceof a.AppletInitializationError?C(ee.t("sensor.messages.java_applet_not_loading")):e instanceof a.SensorConnectionError?w():C(ee.t("sensor.messages.unexpected_error")),void g(function(){ae=!1})):void g(function(){oe=!0,ae=!1})})},10)}function w(){_();var e={};e[ee.t("sensor.messages.try_again")]=function(){$(this).dialog("close"),x()},e[ee.t("sensor.messages.cancel")]=function(){$(this).remove(),J.reload()},te.alert(ee.t("sensor.messages.sensor_not_attached",{sensor_name:J.properties.sensorName}),e)}function C(e){_(),te.alert(e,{OK:function(){$(this).remove(),J.reload()}})}function T(e){_(),J.stop(),d.logAction("Unplugged"+J.properties[e+"Name"]);var t={};t[ee.t("sensor.messages.try_again")]=function(){$(this).dialog("close"),x()},t[ee.t("sensor.messages.cancel")]=function(){$(this).dialog("close")},te.alert(ee.t("sensor.messages.sensor_or_device_unplugged",{sensor_or_device_name:J.properties[e+"Name"]}),t)}function S(){j&&clearInterval(j);var e=function(e,t){if(e)if(e instanceof a.AlreadyReadingError);else{if(!(e instanceof a.SensorConnectionError))throw clearInterval(j),e;clearInterval(j),w()}else g(function(){z=t[0],G=t[1],H&&(J.properties.tareValue=z,H=!1),W&&(J.properties.tareValue2=G,W=!1)})};j=setInterval(function(){V.readSensor(e)},1e3/se)}function A(){j&&(clearInterval(j),j=null)}function k(){U=0,F=0,z=void 0,G=void 0,q=!1,Y=!1,X=!1,H=!1,W=!1}function P(){if(D&&B){var e=pe[D],t=pe[B],n=a[e.appletClass];V=window.Lab.sensor[D+B]=new n({listenerPath:"Lab.sensor."+D+B,sensorDefinitions:[e,t],appletId:D+B+"-sensor",codebase:u.rootUrl+"/jars/lab-sensor-applet-interface-dist"}),x()}}function E(){if(D&&B){var e=pe[D],t=pe[B];le=Math.max(e.samplesPerSecond,t.samplesPerSecond)}}function O(e){var t,r,i;D!==e&&(D&&(J.properties.tareValue=0),D=e,z=void 0,V&&_(),D?(t=pe[D],i=t.measurementType,Y=t.tareable,E(),P(),r=new n(s,{label:t.measurementName,unitType:i,min:t.minReading,max:t.maxReading}),Z.setPropertyDescription("sensorReading",r),null==J.properties.collectionTime&&(J.properties.collectionTime=t.maxSeconds)):J.properties.hasOwnProperty("sensorReading")&&(r=new n(s,de),Z.setPropertyDescription("sensorReading",r)))}function M(e){var t,r,i;B!==e&&(B&&(J.properties.tareValue2=0),B=e,G=void 0,V&&_(),B?(t=pe[B],i=t.measurementType,X=t.tareable,E(),P(),r=new n(s,{label:t.measurementName,unitType:i,min:t.minReading,max:t.maxReading}),Z.setPropertyDescription("sensorReading2",r),null==J.properties.collectionTime&&(J.properties.collectionTime=t.maxSeconds)):J.properties.hasOwnProperty("sensorReading2")&&(r=new n(s,de),Z.setPropertyDescription("sensorReading2",r)))}function L(e){U++,F+=1/le,window.__bizarreSafariFix=1,z=e[0],G=e[1],q||(J.freeze("sensorType"),J.freeze("sensorType2")),q=!0,Z.deleteComputedPropertyCachedValues(),Z.notifyAllComputedProperties(),v(),ie.tick()}var N,R,I,D,B,V,j,F,z,G,U,q,H,W,Y,X,Q,K,J,Z=new t({types:["mainProperty","viewOption","parameter","output"]}),ee=p.i18n,te=new c(ee),ne=!0,re=!1,ie=d3.dispatch("play","stop","tick","tickStart","willReset","reset","stepForward","stepBack","seek","invalidation"),oe=!1,ae=!1,se=1,le=10,ue=0,ce=[],de={label:ee.t("sensor.measurements.sensor_reading"),unitAbbreviation:"-",format:".2f",min:0,max:1},pe=l(ee);return J={on:function(e,t){ie.on(e,t)},start:function(){J.properties.isPlayable&&V.start(function(e,t){e?e instanceof a.SensorConnectionError&&w():t&&(g(function(){ne=!1}),ie.play())})},stop:function(){V&&V.stop(),g(function(){ne=!0}),ie.stop()},tare:function(){if(!ne)throw new Error("Sensor model: tare() called on a non-stopped model.");null!=j&&null!=z?J.properties.tareValue=z:g(function(){H=!0})},tare2:function(){if(!ne)throw new Error("Sensor model: tare() called on a non-stopped model.");null!=j&&null!=G?J.properties.tareValue2=G:g(function(){
W=!0})},willReset:function(){ie.willReset()},reset:function(){J.stop(),_(),k(),J.unfreeze("sensorType"),J.unfreeze("sensorType2"),J.properties.sensorType=I,J.properties.sensorType2=I,ie.reset()},reload:function(){J.stop(),g(function(){re=!0})},isStopped:function(){return ne},stepCounter:function(){return U},addPropertiesListener:function(e,t){"string"==typeof e?J.addObserver(e,t):e.forEach(function(e){J.addObserver(e,t)})},defineParameter:function(e,t,r){var i={type:"parameter",includeInHistoryState:!0,invokeSetterAfterBulkRestore:!1,description:new n(s,t),beforeSetCallback:h,afterSetCallback:m};r&&(i.set=function(e){r.call(J,e)}),Z.defineProperty(e,i)},defineOutput:function(e,t,r){Z.defineProperty(e,{type:"output",writable:!1,get:r,includeInHistoryState:!1,description:new n(s,t)})},defineFilteredOutput:function(e,t,n,i,o){var a,s;if("RunningAverage"!==i)throw new Error("FilteredOutput: unknown filter type "+i+".");if(a=new r(o),s=J.properties[e],void 0===s||isNaN(Number(s)))throw new Error("FilteredOutput: property is not a valid numeric value or it is undefined.");a.addSample(J.properties.time,s),ce.push({addSample:function(){a.addSample(J.properties.time,J.properties[n])}}),t.property=n,t.type=i,t.period=o,J.defineOutput(e,t,function(){return a.calculate()})},serialize:function(){return""}},k(),void 0===window.Lab&&(window.Lab={}),window.Lab.sensor={},Z.mixInto(J),K={sensorType:O,sensorType2:M},R=i.validateCompleteness(o.mainProperties,e),Object.keys(R).forEach(function(e){f(e,"mainProperty",K[e])}),Z.setRawValues(R),I=J.properties.sensorType,Q=J.properties.tareValue,N=i.validateCompleteness(o.viewOptions,e.viewOptions||{}),Object.keys(N).forEach(function(e){f(e,"viewOption")}),Z.setRawValues(N),J.defineOutput("time",{label:ee.t("sensor.measurements.time"),unitType:"time",format:".2f"},function(){return F}),J.defineOutput("displayTime",{label:ee.t("sensor.measurements.time"),unitType:"time",format:".2f"},function(){return F}),J.defineOutput("sensorReading",de,function(){return null==z?z:z-J.properties.tareValue}),J.defineOutput("sensorReading2",de,function(){return null==G?G:G-J.properties.tareValue2}),J.defineOutput("sensorName",{label:"Sensor Name"},function(){return pe[D].sensorName}),J.defineOutput("sensorName2",{label:"Sensor Name"},function(){return pe[B].sensorName}),J.defineOutput("deviceName",{label:"Sensor Interface Device Name"},function(){return pe[D].deviceName}),J.defineOutput("deviceName2",{label:"Sensor Interface Device Name"},function(){return pe[B].deviceName}),J.defineOutput("isStopped",{label:"Stopped?"},function(){return ne}),J.defineOutput("isPlayable",{label:"Startable?"},function(){return oe&&!q}),J.defineOutput("hasPlayed",{label:"Has successfully collected data?"},function(){return q}),J.defineOutput("shouldPollSensor",{label:"Polling Sensor?"},function(){return J.properties.isPlayable&&ne}),J.defineOutput("isSensorInitializing",{label:"Loading Sensor?"},function(){return ae}),J.defineOutput("isTaring",{label:"Waiting for a tare value?"},function(){return H}),J.defineOutput("isTaring2",{label:"Waiting for a tare value?"},function(){return W}),J.defineOutput("canTare",{label:"Can set a tare value?"},function(){return ne&&!q&&Y&&!H}),J.defineOutput("canTare2",{label:"Can set a tare value?"},function(){return ne&&!q&&X&&!W}),J.defineOutput("needsReload",{label:"Needs Reload?"},function(){return re}),J.on("willReset.model",_),J.addObserver("shouldPollSensor",function(){J.properties.shouldPollSensor?S():A()}),J.addObserver("collectionTime",b),b(),O(J.properties.sensorType),M(J.properties.sensorType2),J}}),define("models/dual-sensor/view",["common/views/select-box-view","common/views/numeric-output-view","sensor-applet","common/views/view-state"],function(){var e=require("common/views/select-box-view"),t=require("common/views/numeric-output-view"),n=require("sensor-applet").sensorDefinitions,r=require("common/views/view-state");return function(i,o,a){function s(){i.properties.isTaring?g.$zeroButton.find("button").html(a.t("sensor.zeroing")):g.$zeroButton.find("button").html(a.t("sensor.zero"))}function l(){i.properties.canTare?r.enableView(g.$zeroButton):r.disableView(g.$zeroButton)}function u(){i.properties.isTaring2?g.$zeroButton2.find("button").html(a.t("sensor.zeroing")):g.$zeroButton2.find("button").html(a.t("sensor.zero"))}function c(){i.properties.canTare2?r.enableView(g.$zeroButton2):r.disableView(g.$zeroButton2)}function d(){var e=i.getPropertyDescription("sensorType");e.getFrozen()?r.disableView(g.$selectBox):r.enableView(g.$selectBox)}function p(){var e=i.getPropertyDescription("sensorType2");e.getFrozen()?r.disableView(g.$selectBox2):r.enableView(g.$selectBox2)}function f(){i.addObserver("isTaring",s),i.addObserver("isTaring2",u),s(),u(),i.addObserver("canTare",l),i.addObserver("canTare2",c),l(),c(),i.addPropertyDescriptionObserver("sensorType",d),d(),i.addPropertyDescriptionObserver("sensorType2",p),p()}var h,m,g,v=new e({id:"sensor-type-view",options:[{value:null,text:a.t("sensor.select_sensor_type"),selected:null==i.properties.sensorType,disabled:!0}].concat(Object.keys(n).filter(function(e){return"LabQuest"===n[e].appletClass}).map(function(e){return{value:e,text:n[e].sensorName,selected:e===i.properties.sensorType,disabled:!1}})),onChange:function(e){i.properties.sensorType=e.value}}),y=new e({id:"sensor-type2-view",options:[{value:null,text:a.t("sensor.select_sensor_type"),selected:null==i.properties.sensorType2,disabled:!0}].concat(Object.keys(n).filter(function(e){return"LabQuest"===n[e].appletClass}).map(function(e){return{value:e,text:n[e].sensorName,selected:e===i.properties.sensorType2,disabled:!1}})),onChange:function(e){i.properties.sensorType2=e.value}}),b=d3.format(".2f");return g={$el:$("<div id='model-container' class='container sensor-model-container' />"),bindModel:function(e,t){o=t||o,i=e||i,f()},getHeightForWidth:function(){return"4.8em"},setup:function(){this.$el.empty(),h=new t({id:"sensor-value-view",label:a.t("sensor.reading"),units:i.getPropertyDescription("sensorReading").getUnitAbbreviation()}),m=new t({id:"sensor-value-2-view",label:a.t("sensor.reading"),units:i.getPropertyDescription("sensorReading2").getUnitAbbreviation()});var e=$("<div></div>"),n=$("<div></div>"),r=v.render(this.$el),o=y.render(this.$el),s=$("<div><button>"+a.t("sensor.zero")+"</button></div>"),l=$("<div><button>"+a.t("sensor.zero")+"</button></div>"),u=h.render(),c=m.render();r.addClass("interactive-pulldown component component-spacing"),o.addClass("interactive-pulldown component component-spacing"),s.addClass("interactive-button component component-spacing"),l.addClass("interactive-button component component-spacing"),u.addClass("numeric-output component horizontal component-spacing"),c.addClass("numeric-output component horizontal component-spacing"),this.$el.css("zIndex",4),this.$el.append(e),this.$el.append(n),e.append(r),e.append(u),e.append(s),n.append(o),n.append(c),n.append(l),this.$zeroButton=s,this.$zeroButton2=l,this.$selectBox=r,this.$selectBox2=o,h.resize(),m.resize(),f(),s.on("click","button",function(){i.tare()}),l.on("click","button",function(){i.tare2()})},showInitializationProgress:function(){var e;this.$progressbarContainer||(e=$("<div/>").attr("id","sensor-progressbar"),this.$progressbarContainer=$("<div/>").attr("id","sensor-progressbar-container").css("bottom",$("body").height()/2+75+$(".lab-responsive-content").offset().top).append('<div class="label">'+a.t("sensor.loading_sensor")+"</div>").append(e).appendTo(".lab-responsive-content"),e.progressbar({value:!1})),this.$progressbarContainer.show()},hideInitializationProgress:function(){this.$progressbarContainer.hide()},resize:function(){h&&h.resize(),m&&m.resize()},repaint:function(){},setFocus:function(){},updateUnits:function(e){h.updateUnits(e),null==i.properties.sensorReading&&h.hideUnits()},updateUnits2:function(e){m.updateUnits(e),null==i.properties.sensorReading2&&m.hideUnits()},update:function(){null==i.properties.sensorReading?(h.update(""),h.hideUnits()):(h.update(b(i.properties.sensorReading)),h.showUnits()),null==i.properties.sensorReading2?(m.update(""),m.hideUnits()):(m.update(b(i.properties.sensorReading2)),m.showUnits())}}}}),define("models/dual-sensor/scripting-api",[],function(){return function(e){return{resetModel:function(t){e.intController.resetModel(t)}}}}),define("models/dual-sensor/controller",["require","common/controllers/model-controller","models/dual-sensor/modeler","models/dual-sensor/view","models/dual-sensor/scripting-api"],function(e){var t=e("common/controllers/model-controller"),n=e("models/dual-sensor/modeler"),r=e("models/dual-sensor/view"),i=e("models/dual-sensor/scripting-api");return function(e,o,a){function s(){var e=l.model;e.addObserver("isSensorInitializing",function(){var t=l.modelContainer;e.properties.isSensorInitializing?t.showInitializationProgress():t.hideInitializationProgress()}),e.addObserver("sensorReading",function(){e.isStopped()&&l.updateView()}),e.addObserver("sensorReading2",function(){e.isStopped()&&l.updateView()}),e.addObserver("needsReload",function(){e.properties.needsReload&&a.reloadModel()}),e.addPropertyDescriptionObserver("sensorReading",function(){var t=e.getPropertyDescription("sensorReading"),n=l.modelContainer;n.updateUnits(t.getUnitAbbreviation())}),e.addPropertyDescriptionObserver("sensorReading2",function(){var t=e.getPropertyDescription("sensorReading2"),n=l.modelContainer;n.updateUnits2(t.getUnitAbbreviation())})}var l=new t(e,o,a,n,r,i);return a.on("modelLoaded.dual-sensor-model-controller",s),a.on("modelReset.dual-sensor-model-controller",function(){l.model.set("isNewRunInProgress",!1)}),a.on("willResetModel",function(){l.model.set("isNewRunInProgress",!0)}),l}}),define("models/dual-sensor-connector/metadata",[],function(){return{mainProperties:{type:{defaultValue:"dual-sensor-connector",immutable:!0},tareValue:{defaultValue:0},tareValue2:{defaultValue:0},clientId:{defaultValue:null},clientName:{defaultValue:null},useRandomClientId:{defaultValue:!1},useDuration:{defaultValue:"codap",storeInTickHistory:!1,validate:function(e){if(e===!0||e===!1||"codap"===e)return e;throw new Error("Invalid 'useDuration' value: "+e)}},requestedDuration:{defaultValue:10,storeInTickHistory:!1}},viewOptions:{showClock:{defaultValue:!0,propertyChangeInvalidates:!1},controlButtons:{defaultValue:"play_reset",propertyChangeInvalidates:!1},controlButtonStyle:{defaultValue:"video",propertyChangeInvalidates:!1,serialize:!1}}}}),define("common/state-machine",[],function(){function e(e){var t=this;this.states=e,this.currentState=null,Object.keys(e).forEach(function(n){var r=e[n];if(void 0!==r.name&&r.name!==n)throw new Error("State "+n+" already has a 'name' property. The 'name' property is reserved.");if(r.name=n,void 0!==r.gotoState)throw new Error("State "+n+" already has a 'gotoState' property. The 'gotoState' property is reserved.");r.gotoState=function(e){if(this!==t.currentState)throw new Error("gotoState was called on state "+this.name+" but the current state is ",t.getCurrentStateName());t.gotoState(e)}})}return e.prototype.getCurrentStateName=function(){return this.currentState?this.currentState.name:"<no state>"},e.prototype.gotoState=function(e){var t=this.states[e];if(!t)throw new Error("gotoState was called with state name "+e+" but no such state exists.");this.currentState&&"function"==typeof this.currentState.leaveState&&this.currentState.leaveState(),this.currentState=t,"function"==typeof this.currentState.enterState&&this.currentState.enterState()},e.prototype.handleEvent=function(e){var t=Array.prototype.slice.call(arguments,1);return"function"==typeof this.currentState[e]&&(this.currentState[e].apply(this.currentState,t),!0)},e}),!function(e){"object"==typeof exports?module.exports=e():"function"==typeof define&&define.amd?define("sensor-connector-interface",e):"undefined"!=typeof window?window.sensorConnectorInterface=e():"undefined"!=typeof global?global.sensorConnectorInterface=e():"undefined"!=typeof self&&(self.sensorConnectorInterface=e())}(function(){var e;return function e(t,n,r){function i(a,s){if(!n[a]){if(!t[a]){var l="function"==typeof require&&require;if(!s&&l)return l(a,!0);if(o)return o(a,!0);throw new Error("Cannot find module '"+a+"'")}var u=n[a]={exports:{}};t[a][0].call(u.exports,function(e){var n=t[a][1][e];return i(n?n:e)},u,u.exports,e,t,n,r)}return n[a].exports}for(var o="function"==typeof require&&require,a=0;a<r.length;a++)i(r[a]);return i}({1:[function(e,t,n){"use strict";function r(){return{stateMachine:new u,startPolling:function(e,t,n){this.stateMachine.setHosts(e),this.stateMachine.setParam("client",t),this.stateMachine.setParam("clientName",n),this.stateMachine.transition("connecting")},stopPolling:function(){this.stateMachine.transition("disconnected")},requestStart:function(){return this.stateMachine.promisifyRequest("/control/start")},requestStop:function(){return this.stateMachine.promisifyRequest("/control/stop")},on:function(){l.on.apply(l,arguments)},off:function(){l.off.apply(l,arguments)},get clientId(){return this.stateMachine.getParam("client")},set clientId(e){this.stateMachine.setParam("client",e)},get clientName(){return this.stateMachine.getParam("clientName")},set clientName(e){this.stateMachine.setParam("clientName",e)},get hasAttachedInterface(){return"interfaceMissing"!==this.stateMachine.state},get datasets(){return this.stateMachine.datasets},get isConnected(){return["polling","collecting","controlDisabled","interfaceMissing"].indexOf(this.stateMachine.state)!==-1},get isCollecting(){return"collecting"===this.stateMachine.state},get inControl(){return"controlDisabled"!==this.stateMachine.state},get launchTimedOut(){return"launchTimedOut"===this.stateMachine.state},get canControl(){return"controlDisabled"!==this.stateMachine.state}}}var i=e("rsvp"),o=e("lodash"),a=e("machina"),s=e("eventemitter2").EventEmitter2,l=new s({wildcard:!0}),u=a.Fsm.extend({urlQueryParams:"",urlPrefix:"",datasets:null,_TIME_LIMIT_IN_MS:5e3,_LAUNCH_TIME_LIMIT_IN_MS:2e4,_POLLING_DELAY:500,_COLLECTING_DELAY:100,_timer:null,_hostCycler:null,_rawQueryParams:{},_statusIntervalId:0,_lastStatusTimeStamp:0,_datasetsById:{},_columnsById:{},_sessionChangedEmitted:!1,_currentSessionID:void 0,_launchFrame:null,initialize:function(){var e=this;this._timer={timerId:0,start:function(t){this._timerId=setTimeout(function(){e.handle("timeout")},t)},reset:function(){this.stop(),this.start()},stop:function(){clearTimeout(this._timerId)}},this._hostCycler={get moreHosts(){return e._currentHostIdx+1<e._availableHosts.length},nextHost:function(){e._currentHostIdx++,e.urlPrefix=e._availableHosts[e._currentHostIdx]},reset:function(){e._currentHostIdx=0,e.urlPrefix=e._availableHosts[e._currentHostIdx]}},this._initializeSession()},initialState:"disconnected",states:{disconnected:{_onEnter:function(){this._currentSessionID=void 0,null!==this._launchFrame&&(document.body.removeChild(this._launchFrame),this._launchFrame=null)}},connecting:{_onEnter:function(){this._hostCycler.reset(),this._requestStatus(),this._timer.start(this._TIME_LIMIT_IN_MS)},statusReceived:function(){this._timer.stop(),this.transition("polling")},statusErrored:function(){this._hostCycler.moreHosts?(this._hostCycler.nextHost(),this._requestStatus()):(this._hostCycler.reset(),this._timer.stop(),this.transition("launching"))},timeout:function(){this.transition("launching")}},launching:{_onEnter:function(){this._injectCcscFrame(),this._timer.start(this._LAUNCH_TIME_LIMIT_IN_MS),this._requestStatus()},statusReceived:function(){this._timer.stop(),this.transition("polling")},statusErrored:function(){this._hostCycler.moreHosts?(this._hostCycler.nextHost(),this._requestStatus()):(this._hostCycler.reset(),setTimeout(function(){this._requestStatus()}.bind(this),this._POLLING_DELAY))},timeout:function(){this.transition("launchTimedOut")}},polling:{_onEnter:function(){this._requestStatus()},_onExit:function(){this._timer.stop()},statusReceived:function(e){if(this._timer.stop(),this._processStatus(e),e.collection.isCollecting)return void this.transition("collecting");if(!e.collection.canControl)return void this.transition("controlDisabled");var t="undefined"==typeof e.currentInterface||null===e.currentInterface||"None Found"!==e.currentInterface;return t?(setTimeout(function(){this._requestStatus()}.bind(this),this._POLLING_DELAY),void this._timer.start(this._TIME_LIMIT_IN_MS)):void this.transition("interfaceMissing")},statusErrored:function(){this._timer.stop(),this.transition("errored")},timeout:function(){this.transition("errored")}},collecting:{_onEnter:function(){l.emit("collectionStarted"),this._requestStatus(),this._timer.start(this._TIME_LIMIT_IN_MS)},_onExit:function(){l.emit("collectionStopped")},statusReceived:function(e){if(this._timer.stop(),this._processStatus(e),!e.collection.isCollecting)return void this.transition("polling");if(!e.collection.canControl)return void this.transition("controlDisabled");var t="undefined"==typeof e.currentInterface||null===e.currentInterface||"None Found"!==e.currentInterface;return t?(setTimeout(function(){this._requestStatus()}.bind(this),this._COLLECTING_DELAY),void this._timer.start(this._TIME_LIMIT_IN_MS)):void this.transition("interfaceMissing")},columnData:function(e,t,n){var r=this._columnsById[e];n>r.receivedValuesTimeStamp&&(r.data.length=0,[].push.apply(r.data,t),r.receivedValuesTimeStamp=n,l.emit("data",e))},statusErrored:function(){this._timer.stop(),this.transition("errored")},timeout:function(){this.transition("errored")}},controlDisabled:{_onEnter:function(){l.emit("controlDisabled"),this._requestStatus(),this._timer.start(this._TIME_LIMIT_IN_MS)},_onExit:function(){l.emit("controlEnabled")},statusReceived:function(e){if(this._timer.stop(),this._processStatus(e),e.collection.canControl)return void this.transition("polling");var t="undefined"==typeof e.currentInterface||null===e.currentInterface||"None Found"!==e.currentInterface;return t?(setTimeout(function(){this._requestStatus()}.bind(this),this._POLLING_DELAY),void this._timer.start(this._TIME_LIMIT_IN_MS)):void this.transition("interfaceMissing")},statusErrored:function(){this._timer.stop(),this.transition("errored")},timeout:function(){this.transition("errored")}},interfaceMissing:{_onEnter:function(){l.emit("interfaceRemoved"),this._requestStatus(),this._timer.start(this._TIME_LIMIT_IN_MS)},_onExit:function(){l.emit("interfaceConnected")},statusReceived:function(e){this._timer.stop(),this._processStatus(e);var t="undefined"==typeof e.currentInterface||null===e.currentInterface||"None Found"!==e.currentInterface;return t?void(e.collection.canControl?this.transition("polling"):this.transition("controlDisabled")):(setTimeout(function(){this._requestStatus()}.bind(this),this._POLLING_DELAY),void this._timer.start(this._TIME_LIMIT_IN_MS))},statusErrored:function(){this._timer.stop(),this.transition("errored")},timeout:function(){this.transition("errored")}},errored:{_onEnter:function(){l.emit("statusErrored")}},launchTimedOut:{_onEnter:function(){l.emit("launchTimedOut")}},unsupported:{_onEnter:function(){l.emit("statusErrored")}}},setHosts:function(e){this._availableHosts=o.isArray(e)?e:[e],this._hostCycler.reset()},getParam:function(e){return this._rawQueryParams[e]},setParam:function(e,t){this._setRawQueryParams(e,t),this._updateQueryParams()},_setRawQueryParams:function(e,t){null==t?delete this._rawQueryParams[e]:this._rawQueryParams[e]=t},_updateQueryParams:function(){var e;Object.keys(this._rawQueryParams).forEach(function(t,n){e=this._rawQueryParams[t],0===n?this.urlQueryParams="?"+t+"="+e:this.urlQueryParams+="&"+t+"="+e}.bind(this))},_requestStatus:function(){var e=this._createCORSRequest("GET","/status"),t=this;return e?(e.onerror=function(){t.handle("statusErrored")},e.onload=function(){var e=this.response||JSON.parse(this.responseText);"string"==typeof e&&(e=JSON.parse(e)),t.handle("statusReceived",e)},void e.send()):void this.transition("unsupported")},_initializeSession:function(){this.datasets=[],this._datasetsById=Object.create(null),this._columnsById=Object.create(null),this._sessionChangedEmitted=!1},_processStatus:function(e){if(e.requestTimeStamp<this._lastStatusTimeStamp)return!1;if(this._lastStatusTimeStamp=e.requestTimeStamp,this._currentSessionID){if(this._currentSessionID!==e.sessionID)return this._sessionChangedEmitted||(l.emit("sessionChanged"),this._sessionChangedEmitted=!0),!1}else this._currentSessionID=e.sessionID,this._initializeSession();return this._processDatasets(e.sets),this._processColumns(e.columns),this.inControl=e.collection.inControl,l.emit("statusReceived"),!0},_processDatasets:function(e){Object.keys(e).forEach(function(t){this._datasetsById[t]||(l.emit("datasetAdded",t),this._datasetsById[t]={columns:[],id:t},this.datasets.unshift(this._datasetsById[t])),this._datasetsById[t].columns.length=e[t].colIDs.length}.bind(this)),this.datasets.sort(function(e,t){return t.setId-e.setId})},_processColumns:function(e){var t=[];Object.keys(e).forEach(function(n){var r=e[n],i=this._datasetsById[r.setID],o=this._columnsById[n];o?o!==i.columns[r.position]&&t.push(["columnMoved",n]):(t.push(["columnAdded",n]),o=this._columnsById[n]={id:null,name:null,units:null,receivedValuesTimeStamp:0,requestedValuesTimeStamp:0,liveValueTimeStamp:0,liveValue:null,data:[]}),i.columns[r.position]=o,null!==o.units&&o.units!==r.units&&t.push(["columnTypeChanged",n]),o.units=r.units,o.name=r.name,o.id=n,o.liveValue=parseFloat(r.liveValue||0),o.liveValueTimeStamp=r.liveValueTimeStamp,o.requestedValuesTimeStamp<r.valuesTimeStamp&&(this._requestData(n,r.valuesTimeStamp),o.requestedValuesTimeStamp=r.valuesTimeStamp)}.bind(this)),Object.keys(this._columnsById).forEach(function(n){e[n]||(t.push(["columnRemoved",n]),delete this._columnsById[n])}.bind(this)),t.forEach(function(e){l.emit(e[0],e[1])})},_requestData:function(e,t){var n=this._createCORSRequest("GET","/columns/"+e),r=this;n.send(),n.onload=function(){var n=this.response||JSON.parse(this.responseText);"string"==typeof n&&(n=JSON.parse(n));var i=n.values;r.handle("columnData",e,i,t)}},_createCORSRequest:function(e,t){var n=this.urlPrefix+t+this.urlQueryParams,r=new XMLHttpRequest;if("withCredentials"in r)r.open(e,n,!0),r.responseType="json",r.setRequestHeader("Accept","application/json");else{if("undefined"==typeof XDomainRequest)return null;r=new XDomainRequest,r.open(e,n)}return r},promisifyRequest:function(e){var t=this;return new i.Promise(function(n,r){var i=t._createCORSRequest("GET",e);i||r(new Error("This browser does not appear to support Cross-Origin Resource Sharing")),i.send(),i.onerror=function(){r(this)},i.onload=n})},_injectCcscFrame:function(){null!==this._launchFrame&&document.body.removeChild(this._launchFrame);var e=document.createElement("div");e.id="sensor-connector-launch-frame-parent",e.innerHTML='<iframe id="sensor-connector-launch-frame" src="ccsc://sensorconnector.concord.org/"></iframe>',document.body.appendChild(e),this._launchFrame=document.getElementById("sensor-connector-launch-frame-parent")}});t.exports=r},{eventemitter2:3,lodash:4,machina:5,rsvp:7}],2:[function(e,t,n){var r=t.exports={};r.nextTick=function(){var e="undefined"!=typeof window&&window.setImmediate,t="undefined"!=typeof window&&window.postMessage&&window.addEventListener;if(e)return function(e){return window.setImmediate(e)};if(t){var n=[];return window.addEventListener("message",function(e){var t=e.source;if((t===window||null===t)&&"process-tick"===e.data&&(e.stopPropagation(),n.length>0)){var r=n.shift();r()}},!0),function(e){n.push(e),window.postMessage("process-tick","*")}}return function(e){setTimeout(e,0)}}(),r.title="browser",r.browser=!0,r.env={},r.argv=[],r.binding=function(e){throw new Error("process.binding is not supported")},r.cwd=function(){return"/"},r.chdir=function(e){throw new Error("process.chdir is not supported")}},{}],3:[function(t,n,r){!function(t){function n(){this._events={},this._conf&&i.call(this,this._conf)}function i(e){e&&(this._conf=e,e.delimiter&&(this.delimiter=e.delimiter),e.maxListeners&&(this._events.maxListeners=e.maxListeners),e.wildcard&&(this.wildcard=e.wildcard),e.newListener&&(this.newListener=e.newListener),this.wildcard&&(this.listenerTree={}))}function o(e){this._events={},this.newListener=!1,i.call(this,e)}function a(e,t,n,r){if(!n)return[];var i,o,s,l,u,c,d,p=[],f=t.length,h=t[r],m=t[r+1];if(r===f&&n._listeners){if("function"==typeof n._listeners)return e&&e.push(n._listeners),[n];for(i=0,o=n._listeners.length;i<o;i++)e&&e.push(n._listeners[i]);return[n]}if("*"===h||"**"===h||n[h]){if("*"===h){for(s in n)"_listeners"!==s&&n.hasOwnProperty(s)&&(p=p.concat(a(e,t,n[s],r+1)));return p}if("**"===h){d=r+1===f||r+2===f&&"*"===m,d&&n._listeners&&(p=p.concat(a(e,t,n,f)));for(s in n)"_listeners"!==s&&n.hasOwnProperty(s)&&("*"===s||"**"===s?(n[s]._listeners&&!d&&(p=p.concat(a(e,t,n[s],f))),p=p.concat(a(e,t,n[s],r))):p=s===m?p.concat(a(e,t,n[s],r+2)):p.concat(a(e,t,n[s],r)));return p}p=p.concat(a(e,t,n[h],r+1))}if(l=n["*"],l&&a(e,t,l,r+1),u=n["**"])if(r<f){u._listeners&&a(e,t,u,f);for(s in u)"_listeners"!==s&&u.hasOwnProperty(s)&&(s===m?a(e,t,u[s],r+2):s===h?a(e,t,u[s],r+1):(c={},c[s]=u[s],a(e,t,{"**":c},r+1)))}else u._listeners?a(e,t,u,f):u["*"]&&u["*"]._listeners&&a(e,t,u["*"],f);return p}function s(e,t){e="string"==typeof e?e.split(this.delimiter):e.slice();for(var n=0,r=e.length;n+1<r;n++)if("**"===e[n]&&"**"===e[n+1])return;for(var i=this.listenerTree,o=e.shift();o;){if(i[o]||(i[o]={}),i=i[o],0===e.length){if(i._listeners){if("function"==typeof i._listeners)i._listeners=[i._listeners,t];else if(l(i._listeners)&&(i._listeners.push(t),!i._listeners.warned)){var a=u;"undefined"!=typeof this._events.maxListeners&&(a=this._events.maxListeners),a>0&&i._listeners.length>a&&(i._listeners.warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",i._listeners.length),console.trace())}}else i._listeners=t;return!0}o=e.shift()}return!0}var l=Array.isArray?Array.isArray:function(e){return"[object Array]"===Object.prototype.toString.call(e)},u=10;o.prototype.delimiter=".",o.prototype.setMaxListeners=function(e){this._events||n.call(this),this._events.maxListeners=e,this._conf||(this._conf={}),this._conf.maxListeners=e},o.prototype.event="",o.prototype.once=function(e,t){return this.many(e,1,t),this},o.prototype.many=function(e,t,n){function r(){0===--t&&i.off(e,r),n.apply(this,arguments)}var i=this;if("function"!=typeof n)throw new Error("many only accepts instances of Function");return r._origin=n,this.on(e,r),i},o.prototype.emit=function(){this._events||n.call(this);var e=arguments[0];if("newListener"===e&&!this.newListener&&!this._events.newListener)return!1;if(this._all){for(var t=arguments.length,r=new Array(t-1),i=1;i<t;i++)r[i-1]=arguments[i];for(i=0,t=this._all.length;i<t;i++)this.event=e,this._all[i].apply(this,r)}if("error"===e&&!(this._all||this._events.error||this.wildcard&&this.listenerTree.error))throw arguments[1]instanceof Error?arguments[1]:new Error("Uncaught, unspecified 'error' event.");var o;if(this.wildcard){o=[];var s="string"==typeof e?e.split(this.delimiter):e.slice();a.call(this,o,s,this.listenerTree,0)}else o=this._events[e];if("function"==typeof o){if(this.event=e,1===arguments.length)o.call(this);else if(arguments.length>1)switch(arguments.length){case 2:o.call(this,arguments[1]);break;case 3:o.call(this,arguments[1],arguments[2]);break;default:for(var t=arguments.length,r=new Array(t-1),i=1;i<t;i++)r[i-1]=arguments[i];o.apply(this,r)}return!0}if(o){for(var t=arguments.length,r=new Array(t-1),i=1;i<t;i++)r[i-1]=arguments[i];for(var l=o.slice(),i=0,t=l.length;i<t;i++)this.event=e,l[i].apply(this,r);return l.length>0||!!this._all}return!!this._all},o.prototype.on=function(e,t){if("function"==typeof e)return this.onAny(e),this;if("function"!=typeof t)throw new Error("on only accepts instances of Function");if(this._events||n.call(this),this.emit("newListener",e,t),this.wildcard)return s.call(this,e,t),this;if(this._events[e]){if("function"==typeof this._events[e])this._events[e]=[this._events[e],t];else if(l(this._events[e])&&(this._events[e].push(t),!this._events[e].warned)){var r=u;"undefined"!=typeof this._events.maxListeners&&(r=this._events.maxListeners),r>0&&this._events[e].length>r&&(this._events[e].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[e].length),console.trace())}}else this._events[e]=t;return this},o.prototype.onAny=function(e){if("function"!=typeof e)throw new Error("onAny only accepts instances of Function");return this._all||(this._all=[]),this._all.push(e),this},o.prototype.addListener=o.prototype.on,o.prototype.off=function(e,t){if("function"!=typeof t)throw new Error("removeListener only takes instances of Function");var n,r=[];if(this.wildcard){var i="string"==typeof e?e.split(this.delimiter):e.slice();r=a.call(this,null,i,this.listenerTree,0)}else{if(!this._events[e])return this;n=this._events[e],r.push({_listeners:n})}for(var o=0;o<r.length;o++){var s=r[o];if(n=s._listeners,l(n)){for(var u=-1,c=0,d=n.length;c<d;c++)if(n[c]===t||n[c].listener&&n[c].listener===t||n[c]._origin&&n[c]._origin===t){u=c;break}if(u<0)continue;return this.wildcard?s._listeners.splice(u,1):this._events[e].splice(u,1),0===n.length&&(this.wildcard?delete s._listeners:delete this._events[e]),this}(n===t||n.listener&&n.listener===t||n._origin&&n._origin===t)&&(this.wildcard?delete s._listeners:delete this._events[e])}return this},o.prototype.offAny=function(e){var t,n=0,r=0;if(e&&this._all&&this._all.length>0){for(t=this._all,n=0,r=t.length;n<r;n++)if(e===t[n])return t.splice(n,1),this}else this._all=[];return this},o.prototype.removeListener=o.prototype.off,o.prototype.removeAllListeners=function(e){if(0===arguments.length)return!this._events||n.call(this),this;if(this.wildcard)for(var t="string"==typeof e?e.split(this.delimiter):e.slice(),r=a.call(this,null,t,this.listenerTree,0),i=0;i<r.length;i++){var o=r[i];o._listeners=null}else{if(!this._events[e])return this;this._events[e]=null}return this},o.prototype.listeners=function(e){if(this.wildcard){var t=[],r="string"==typeof e?e.split(this.delimiter):e.slice();return a.call(this,t,r,this.listenerTree,0),t}return this._events||n.call(this),this._events[e]||(this._events[e]=[]),l(this._events[e])||(this._events[e]=[this._events[e]]),this._events[e]},o.prototype.listenersAny=function(){return this._all?this._all:[]},"function"==typeof e&&e.amd?e(function(){return o}):"object"==typeof r?r.EventEmitter2=o:window.EventEmitter2=o}()},{}],4:[function(t,n,r){var i="undefined"!=typeof self?self:"undefined"!=typeof window?window:{};(function(){function t(e,t){if(e!==t){var n=null===e,r=e===A,i=e===e,o=null===t,a=t===A,s=t===t;if(e>t&&!o||!i||n&&!a&&s||r&&s)return 1;if(e<t&&!n||!s||o&&!r&&i||a&&i)return-1}return 0}function o(e,t,n){for(var r=e.length,i=n?r:-1;n?i--:++i<r;)if(t(e[i],i,e))return i;return-1}function a(e,t,n){if(t!==t)return v(e,n);for(var r=n-1,i=e.length;++r<i;)if(e[r]===t)return r;return-1}function s(e){return"function"==typeof e||!1}function l(e){return null==e?"":e+""}function u(e,t){for(var n=-1,r=e.length;++n<r&&t.indexOf(e.charAt(n))>-1;);return n}function c(e,t){for(var n=e.length;n--&&t.indexOf(e.charAt(n))>-1;);return n}function d(e,n){return t(e.criteria,n.criteria)||e.index-n.index}function p(e,n,r){for(var i=-1,o=e.criteria,a=n.criteria,s=o.length,l=r.length;++i<s;){var u=t(o[i],a[i]);if(u){if(i>=l)return u;var c=r[i];return u*("asc"===c||c===!0?1:-1)}}return e.index-n.index}function f(e){return qe[e]}function h(e){return He[e]}function m(e,t,n){return t?e=Xe[e]:n&&(e=Qe[e]),"\\"+e}function g(e){return"\\"+Qe[e]}function v(e,t,n){for(var r=e.length,i=t+(n?0:-1);n?i--:++i<r;){var o=e[i];if(o!==o)return i}return-1}function y(e){return!!e&&"object"==typeof e;
}function b(e){return e<=160&&e>=9&&e<=13||32==e||160==e||5760==e||6158==e||e>=8192&&(e<=8202||8232==e||8233==e||8239==e||8287==e||12288==e||65279==e)}function _(e,t){for(var n=-1,r=e.length,i=-1,o=[];++n<r;)e[n]===t&&(e[n]=q,o[++i]=n);return o}function x(e,t){for(var n,r=-1,i=e.length,o=-1,a=[];++r<i;){var s=e[r],l=t?t(s,r,e):s;r&&n===l||(n=l,a[++o]=s)}return a}function w(e){for(var t=-1,n=e.length;++t<n&&b(e.charCodeAt(t)););return t}function C(e){for(var t=e.length;t--&&b(e.charCodeAt(t)););return t}function T(e){return We[e]}function S(e){function n(e){if(y(e)&&!Es(e)&&!(e instanceof b)){if(e instanceof i)return e;if(ta.call(e,"__chain__")&&ta.call(e,"__wrapped__"))return fr(e)}return new i(e)}function r(){}function i(e,t,n){this.__wrapped__=e,this.__actions__=n||[],this.__chain__=!!t}function b(e){this.__wrapped__=e,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=Pa,this.__views__=[]}function J(){var e=new b(this.__wrapped__);return e.__actions__=et(this.__actions__),e.__dir__=this.__dir__,e.__filtered__=this.__filtered__,e.__iteratees__=et(this.__iteratees__),e.__takeCount__=this.__takeCount__,e.__views__=et(this.__views__),e}function ne(){if(this.__filtered__){var e=new b(this);e.__dir__=-1,e.__filtered__=!0}else e=this.clone(),e.__dir__*=-1;return e}function ie(){var e=this.__wrapped__.value(),t=this.__dir__,n=Es(e),r=t<0,i=n?e.length:0,o=Hn(0,i,this.__views__),a=o.start,s=o.end,l=s-a,u=r?s:a-1,c=this.__iteratees__,d=c.length,p=0,f=Ca(l,this.__takeCount__);if(!n||i<z||i==l&&f==l)return nn(r&&n?e.reverse():e,this.__actions__);var h=[];e:for(;l--&&p<f;){u+=t;for(var m=-1,g=e[u];++m<d;){var v=c[m],y=v.iteratee,b=v.type,_=y(g);if(b==$)g=_;else if(!_){if(b==G)continue e;break e}}h[p++]=g}return h}function qe(){this.__data__={}}function He(e){return this.has(e)&&delete this.__data__[e]}function We(e){return"__proto__"==e?A:this.__data__[e]}function Ye(e){return"__proto__"!=e&&ta.call(this.__data__,e)}function Xe(e,t){return"__proto__"!=e&&(this.__data__[e]=t),this}function Qe(e){var t=e?e.length:0;for(this.data={hash:va(null),set:new da};t--;)this.push(e[t])}function Ke(e,t){var n=e.data,r="string"==typeof t||Ri(t)?n.set.has(t):n.hash[t];return r?0:-1}function Je(e){var t=this.data;"string"==typeof e||Ri(e)?t.set.add(e):t.hash[e]=!0}function Ze(e,t){for(var n=-1,r=e.length,i=-1,o=t.length,a=zo(r+o);++n<r;)a[n]=e[n];for(;++i<o;)a[n++]=t[i];return a}function et(e,t){var n=-1,r=e.length;for(t||(t=zo(r));++n<r;)t[n]=e[n];return t}function tt(e,t){for(var n=-1,r=e.length;++n<r&&t(e[n],n,e)!==!1;);return e}function nt(e,t){for(var n=e.length;n--&&t(e[n],n,e)!==!1;);return e}function ot(e,t){for(var n=-1,r=e.length;++n<r;)if(!t(e[n],n,e))return!1;return!0}function at(e,t,n,r){for(var i=-1,o=e.length,a=r,s=a;++i<o;){var l=e[i],u=+t(l);n(u,a)&&(a=u,s=l)}return s}function st(e,t){for(var n=-1,r=e.length,i=-1,o=[];++n<r;){var a=e[n];t(a,n,e)&&(o[++i]=a)}return o}function lt(e,t){for(var n=-1,r=e.length,i=zo(r);++n<r;)i[n]=t(e[n],n,e);return i}function ut(e,t){for(var n=-1,r=t.length,i=e.length;++n<r;)e[i+n]=t[n];return e}function ct(e,t,n,r){var i=-1,o=e.length;for(r&&o&&(n=e[++i]);++i<o;)n=t(n,e[i],i,e);return n}function dt(e,t,n,r){var i=e.length;for(r&&i&&(n=e[--i]);i--;)n=t(n,e[i],i,e);return n}function pt(e,t){for(var n=-1,r=e.length;++n<r;)if(t(e[n],n,e))return!0;return!1}function ft(e,t){for(var n=e.length,r=0;n--;)r+=+t(e[n])||0;return r}function ht(e,t){return e===A?t:e}function mt(e,t,n,r){return e!==A&&ta.call(r,n)?e:t}function gt(e,t,n){for(var r=-1,i=Fs(t),o=i.length;++r<o;){var a=i[r],s=e[a],l=n(s,t[a],a,e,t);(l===l?l===s:s!==s)&&(s!==A||a in e)||(e[a]=l)}return e}function vt(e,t){return null==t?e:bt(t,Fs(t),e)}function yt(e,t){for(var n=-1,r=null==e,i=!r&&Kn(e),o=i?e.length:0,a=t.length,s=zo(a);++n<a;){var l=t[n];i?s[n]=Jn(l,o)?e[l]:A:s[n]=r?A:e[l]}return s}function bt(e,t,n){n||(n={});for(var r=-1,i=t.length;++r<i;){var o=t[r];n[o]=e[o]}return n}function _t(e,t,n){var r=typeof e;return"function"==r?t===A?e:an(e,t,n):null==e?Po:"object"==r?jt(e):t===A?Ro(e):Ft(e,t)}function xt(e,t,n,r,i,o,a){var s;if(n&&(s=i?n(e,r,i):n(e)),s!==A)return s;if(!Ri(e))return e;var l=Es(e);if(l){if(s=Wn(e),!t)return et(e,s)}else{var u=ra.call(e),c=u==K;if(u!=ee&&u!=H&&(!c||i))return Ue[u]?Xn(e,u,t):i?e:{};if(s=Yn(c?{}:e),!t)return vt(s,e)}o||(o=[]),a||(a=[]);for(var d=o.length;d--;)if(o[d]==e)return a[d];return o.push(e),a.push(s),(l?tt:Mt)(e,function(r,i){s[i]=xt(r,t,n,i,e,o,a)}),s}function wt(e,t,n){if("function"!=typeof e)throw new Qo(U);return pa(function(){e.apply(A,n)},t)}function Ct(e,t){var n=e?e.length:0,r=[];if(!n)return r;var i=-1,o=$n(),s=o==a,l=s&&t.length>=z?mn(t):null,u=t.length;l&&(o=Ke,s=!1,t=l);e:for(;++i<n;){var c=e[i];if(s&&c===c){for(var d=u;d--;)if(t[d]===c)continue e;r.push(c)}else o(t,c,0)<0&&r.push(c)}return r}function Tt(e,t){var n=!0;return Da(e,function(e,r,i){return n=!!t(e,r,i)}),n}function St(e,t,n,r){var i=r,o=i;return Da(e,function(e,a,s){var l=+t(e,a,s);(n(l,i)||l===r&&l===o)&&(i=l,o=e)}),o}function At(e,t,n,r){var i=e.length;for(n=null==n?0:+n||0,n<0&&(n=-n>i?0:i+n),r=r===A||r>i?i:+r||0,r<0&&(r+=i),i=n>r?0:r>>>0,n>>>=0;n<i;)e[n++]=t;return e}function kt(e,t){var n=[];return Da(e,function(e,r,i){t(e,r,i)&&n.push(e)}),n}function Pt(e,t,n,r){var i;return n(e,function(e,n,o){if(t(e,n,o))return i=r?n:e,!1}),i}function Et(e,t,n,r){r||(r=[]);for(var i=-1,o=e.length;++i<o;){var a=e[i];y(a)&&Kn(a)&&(n||Es(a)||Si(a))?t?Et(a,t,n,r):ut(r,a):n||(r[r.length]=a)}return r}function Ot(e,t){return Va(e,t,eo)}function Mt(e,t){return Va(e,t,Fs)}function Lt(e,t){return ja(e,t,Fs)}function Nt(e,t){for(var n=-1,r=t.length,i=-1,o=[];++n<r;){var a=t[n];Ni(e[a])&&(o[++i]=a)}return o}function Rt(e,t,n){if(null!=e){n!==A&&n in dr(e)&&(t=[n]);for(var r=0,i=t.length;null!=e&&r<i;)e=e[t[r++]];return r&&r==i?e:A}}function It(e,t,n,r,i,o){return e===t||(null==e||null==t||!Ri(e)&&!y(t)?e!==e&&t!==t:Dt(e,t,It,n,r,i,o))}function Dt(e,t,n,r,i,o,a){var s=Es(e),l=Es(t),u=W,c=W;s||(u=ra.call(e),u==H?u=ee:u!=ee&&(s=$i(e))),l||(c=ra.call(t),c==H?c=ee:c!=ee&&(l=$i(t)));var d=u==ee,p=c==ee,f=u==c;if(f&&!s&&!d)return jn(e,t,u);if(!i){var h=d&&ta.call(e,"__wrapped__"),m=p&&ta.call(t,"__wrapped__");if(h||m)return n(h?e.value():e,m?t.value():t,r,i,o,a)}if(!f)return!1;o||(o=[]),a||(a=[]);for(var g=o.length;g--;)if(o[g]==e)return a[g]==t;o.push(e),a.push(t);var v=(s?Vn:Fn)(e,t,n,r,i,o,a);return o.pop(),a.pop(),v}function Bt(e,t,n){var r=t.length,i=r,o=!n;if(null==e)return!i;for(e=dr(e);r--;){var a=t[r];if(o&&a[2]?a[1]!==e[a[0]]:!(a[0]in e))return!1}for(;++r<i;){a=t[r];var s=a[0],l=e[s],u=a[1];if(o&&a[2]){if(l===A&&!(s in e))return!1}else{var c=n?n(l,u,s):A;if(!(c===A?It(u,l,n,!0):c))return!1}}return!0}function Vt(e,t){var n=-1,r=Kn(e)?zo(e.length):[];return Da(e,function(e,i,o){r[++n]=t(e,i,o)}),r}function jt(e){var t=Un(e);if(1==t.length&&t[0][2]){var n=t[0][0],r=t[0][1];return function(e){return null!=e&&(e[n]===r&&(r!==A||n in dr(e)))}}return function(e){return Bt(e,t)}}function Ft(e,t){var n=Es(e),r=er(e)&&rr(t),i=e+"";return e=pr(e),function(o){if(null==o)return!1;var a=i;if(o=dr(o),(n||!r)&&!(a in o)){if(o=1==e.length?o:Rt(o,Yt(e,0,-1)),null==o)return!1;a=Ar(e),o=dr(o)}return o[a]===t?t!==A||a in o:It(t,o[a],A,!0)}}function zt(e,t,n,r,i){if(!Ri(e))return e;var o=Kn(t)&&(Es(t)||$i(t)),a=o?A:Fs(t);return tt(a||t,function(s,l){if(a&&(l=s,s=t[l]),y(s))r||(r=[]),i||(i=[]),Gt(e,t,l,zt,n,r,i);else{var u=e[l],c=n?n(u,s,l,e,t):A,d=c===A;d&&(c=s),c===A&&(!o||l in e)||!d&&(c===c?c===u:u!==u)||(e[l]=c)}}),e}function Gt(e,t,n,r,i,o,a){for(var s=o.length,l=t[n];s--;)if(o[s]==l)return void(e[n]=a[s]);var u=e[n],c=i?i(u,l,n,e,t):A,d=c===A;d&&(c=l,Kn(l)&&(Es(l)||$i(l))?c=Es(u)?u:Kn(u)?et(u):[]:Fi(l)||Si(l)?c=Si(u)?Yi(u):Fi(u)?u:{}:d=!1),o.push(l),a.push(c),d?e[n]=r(c,l,i,o,a):(c===c?c!==u:u===u)&&(e[n]=c)}function $t(e){return function(t){return null==t?A:t[e]}}function Ut(e){var t=e+"";return e=pr(e),function(n){return Rt(n,e,t)}}function qt(e,t){for(var n=e?t.length:0;n--;){var r=t[n];if(r!=i&&Jn(r)){var i=r;fa.call(e,r,1)}}return e}function Ht(e,t){return e+ya(Aa()*(t-e+1))}function Wt(e,t,n,r,i){return i(e,function(e,i,o){n=r?(r=!1,e):t(n,e,i,o)}),n}function Yt(e,t,n){var r=-1,i=e.length;t=null==t?0:+t||0,t<0&&(t=-t>i?0:i+t),n=n===A||n>i?i:+n||0,n<0&&(n+=i),i=t>n?0:n-t>>>0,t>>>=0;for(var o=zo(i);++r<i;)o[r]=e[r+t];return o}function Xt(e,t){var n;return Da(e,function(e,r,i){return n=t(e,r,i),!n}),!!n}function Qt(e,t){var n=e.length;for(e.sort(t);n--;)e[n]=e[n].value;return e}function Kt(e,t,n){var r=zn(),i=-1;t=lt(t,function(e){return r(e)});var o=Vt(e,function(e){var n=lt(t,function(t){return t(e)});return{criteria:n,index:++i,value:e}});return Qt(o,function(e,t){return p(e,t,n)})}function Jt(e,t){var n=0;return Da(e,function(e,r,i){n+=+t(e,r,i)||0}),n}function Zt(e,t){var n=-1,r=$n(),i=e.length,o=r==a,s=o&&i>=z,l=s?mn():null,u=[];l?(r=Ke,o=!1):(s=!1,l=t?[]:u);e:for(;++n<i;){var c=e[n],d=t?t(c,n,e):c;if(o&&c===c){for(var p=l.length;p--;)if(l[p]===d)continue e;t&&l.push(d),u.push(c)}else r(l,d,0)<0&&((t||s)&&l.push(d),u.push(c))}return u}function en(e,t){for(var n=-1,r=t.length,i=zo(r);++n<r;)i[n]=e[t[n]];return i}function tn(e,t,n,r){for(var i=e.length,o=r?i:-1;(r?o--:++o<i)&&t(e[o],o,e););return n?Yt(e,r?0:o,r?o+1:i):Yt(e,r?o+1:0,r?i:o)}function nn(e,t){var n=e;n instanceof b&&(n=n.value());for(var r=-1,i=t.length;++r<i;){var o=t[r];n=o.func.apply(o.thisArg,ut([n],o.args))}return n}function rn(e,t,n){var r=0,i=e?e.length:r;if("number"==typeof t&&t===t&&i<=Ma){for(;r<i;){var o=r+i>>>1,a=e[o];(n?a<=t:a<t)&&null!==a?r=o+1:i=o}return i}return on(e,t,Po,n)}function on(e,t,n,r){t=n(t);for(var i=0,o=e?e.length:0,a=t!==t,s=null===t,l=t===A;i<o;){var u=ya((i+o)/2),c=n(e[u]),d=c!==A,p=c===c;if(a)var f=p||r;else f=s?p&&d&&(r||null!=c):l?p&&(r||d):null!=c&&(r?c<=t:c<t);f?i=u+1:o=u}return Ca(o,Oa)}function an(e,t,n){if("function"!=typeof e)return Po;if(t===A)return e;switch(n){case 1:return function(n){return e.call(t,n)};case 3:return function(n,r,i){return e.call(t,n,r,i)};case 4:return function(n,r,i,o){return e.call(t,n,r,i,o)};case 5:return function(n,r,i,o,a){return e.call(t,n,r,i,o,a)}}return function(){return e.apply(t,arguments)}}function sn(e){var t=new aa(e.byteLength),n=new ha(t);return n.set(new ha(e)),t}function ln(e,t,n){for(var r=n.length,i=-1,o=wa(e.length-r,0),a=-1,s=t.length,l=zo(s+o);++a<s;)l[a]=t[a];for(;++i<r;)l[n[i]]=e[i];for(;o--;)l[a++]=e[i++];return l}function un(e,t,n){for(var r=-1,i=n.length,o=-1,a=wa(e.length-i,0),s=-1,l=t.length,u=zo(a+l);++o<a;)u[o]=e[o];for(var c=o;++s<l;)u[c+s]=t[s];for(;++r<i;)u[c+n[r]]=e[o++];return u}function cn(e,t){return function(n,r,i){var o=t?t():{};if(r=zn(r,i,3),Es(n))for(var a=-1,s=n.length;++a<s;){var l=n[a];e(o,l,r(l,a,n),n)}else Da(n,function(t,n,i){e(o,t,r(t,n,i),i)});return o}}function dn(e){return vi(function(t,n){var r=-1,i=null==t?0:n.length,o=i>2?n[i-2]:A,a=i>2?n[2]:A,s=i>1?n[i-1]:A;for("function"==typeof o?(o=an(o,s,5),i-=2):(o="function"==typeof s?s:A,i-=o?1:0),a&&Zn(n[0],n[1],a)&&(o=i<3?A:o,i=1);++r<i;){var l=n[r];l&&e(t,l,o)}return t})}function pn(e,t){return function(n,r){var i=n?Ga(n):0;if(!nr(i))return e(n,r);for(var o=t?i:-1,a=dr(n);(t?o--:++o<i)&&r(a[o],o,a)!==!1;);return n}}function fn(e){return function(t,n,r){for(var i=dr(t),o=r(t),a=o.length,s=e?a:-1;e?s--:++s<a;){var l=o[s];if(n(i[l],l,i)===!1)break}return t}}function hn(e,t){function n(){var i=this&&this!==rt&&this instanceof n?r:e;return i.apply(t,arguments)}var r=vn(e);return n}function mn(e){return va&&da?new Qe(e):null}function gn(e){return function(t){for(var n=-1,r=So(co(t)),i=r.length,o="";++n<i;)o=e(o,r[n],n);return o}}function vn(e){return function(){var t=arguments;switch(t.length){case 0:return new e;case 1:return new e(t[0]);case 2:return new e(t[0],t[1]);case 3:return new e(t[0],t[1],t[2]);case 4:return new e(t[0],t[1],t[2],t[3]);case 5:return new e(t[0],t[1],t[2],t[3],t[4]);case 6:return new e(t[0],t[1],t[2],t[3],t[4],t[5]);case 7:return new e(t[0],t[1],t[2],t[3],t[4],t[5],t[6])}var n=Ia(e.prototype),r=e.apply(n,t);return Ri(r)?r:n}}function yn(e){function t(n,r,i){i&&Zn(n,r,i)&&(r=A);var o=Bn(n,e,A,A,A,A,A,r);return o.placeholder=t.placeholder,o}return t}function bn(e,t){return vi(function(n){var r=n[0];return null==r?r:(n.push(t),e.apply(A,n))})}function _n(e,t){return function(n,r,i){if(i&&Zn(n,r,i)&&(r=A),r=zn(r,i,3),1==r.length){n=Es(n)?n:cr(n);var o=at(n,r,e,t);if(!n.length||o!==t)return o}return St(n,r,e,t)}}function xn(e,t){return function(n,r,i){if(r=zn(r,i,3),Es(n)){var a=o(n,r,t);return a>-1?n[a]:A}return Pt(n,r,e)}}function wn(e){return function(t,n,r){return t&&t.length?(n=zn(n,r,3),o(t,n,e)):-1}}function Cn(e){return function(t,n,r){return n=zn(n,r,3),Pt(t,n,e,!0)}}function Tn(e){return function(){for(var t,n=arguments.length,r=e?n:-1,o=0,a=zo(n);e?r--:++r<n;){var s=a[o++]=arguments[r];if("function"!=typeof s)throw new Qo(U);!t&&i.prototype.thru&&"wrapper"==Gn(s)&&(t=new i([],!0))}for(r=t?-1:n;++r<n;){s=a[r];var l=Gn(s),u="wrapper"==l?za(s):A;t=u&&tr(u[0])&&u[1]==(I|M|N|D)&&!u[4].length&&1==u[9]?t[Gn(u[0])].apply(t,u[3]):1==s.length&&tr(s)?t[l]():t.thru(s)}return function(){var e=arguments,r=e[0];if(t&&1==e.length&&Es(r)&&r.length>=z)return t.plant(r).value();for(var i=0,o=n?a[i].apply(this,e):r;++i<n;)o=a[i].call(this,o);return o}}}function Sn(e,t){return function(n,r,i){return"function"==typeof r&&i===A&&Es(n)?e(n,r):t(n,an(r,i,3))}}function An(e){return function(t,n,r){return"function"==typeof n&&r===A||(n=an(n,r,3)),e(t,n,eo)}}function kn(e){return function(t,n,r){return"function"==typeof n&&r===A||(n=an(n,r,3)),e(t,n)}}function Pn(e){return function(t,n,r){var i={};return n=zn(n,r,3),Mt(t,function(t,r,o){var a=n(t,r,o);r=e?a:r,t=e?t:a,i[r]=t}),i}}function En(e){return function(t,n,r){return t=l(t),(e?t:"")+Nn(t,n,r)+(e?"":t)}}function On(e){var t=vi(function(n,r){var i=_(r,t.placeholder);return Bn(n,e,A,r,i)});return t}function Mn(e,t){return function(n,r,i,o){var a=arguments.length<3;return"function"==typeof r&&o===A&&Es(n)?e(n,r,i,a):Wt(n,zn(r,o,4),i,a,t)}}function Ln(e,t,n,r,i,o,a,s,l,u){function c(){for(var y=arguments.length,b=y,x=zo(y);b--;)x[b]=arguments[b];if(r&&(x=ln(x,r,i)),o&&(x=un(x,o,a)),h||g){var w=c.placeholder,C=_(x,w);if(y-=C.length,y<u){var T=s?et(s):A,S=wa(u-y,0),k=h?C:A,O=h?A:C,M=h?x:A,L=h?A:x;t|=h?N:R,t&=~(h?R:N),m||(t&=~(P|E));var I=[e,t,n,M,k,L,O,T,l,S],D=Ln.apply(A,I);return tr(e)&&$a(D,I),D.placeholder=w,D}}var B=p?n:this,V=f?B[e]:e;return s&&(x=lr(x,s)),d&&l<x.length&&(x.length=l),this&&this!==rt&&this instanceof c&&(V=v||vn(e)),V.apply(B,x)}var d=t&I,p=t&P,f=t&E,h=t&M,m=t&O,g=t&L,v=f?A:vn(e);return c}function Nn(e,t,n){var r=e.length;if(t=+t,r>=t||!_a(t))return"";var i=t-r;return n=null==n?" ":n+"",vo(n,ga(i/n.length)).slice(0,i)}function Rn(e,t,n,r){function i(){for(var t=-1,s=arguments.length,l=-1,u=r.length,c=zo(u+s);++l<u;)c[l]=r[l];for(;s--;)c[l++]=arguments[++t];var d=this&&this!==rt&&this instanceof i?a:e;return d.apply(o?n:this,c)}var o=t&P,a=vn(e);return i}function In(e){var t=qo[e];return function(e,n){return n=n===A?0:+n||0,n?(n=ua(10,n),t(e*n)/n):t(e)}}function Dn(e){return function(t,n,r,i){var o=zn(r);return null==r&&o===_t?rn(t,n,e):on(t,n,o(r,i,1),e)}}function Bn(e,t,n,r,i,o,a,s){var l=t&E;if(!l&&"function"!=typeof e)throw new Qo(U);var u=r?r.length:0;if(u||(t&=~(N|R),r=i=A),u-=i?i.length:0,t&R){var c=r,d=i;r=i=A}var p=l?A:za(e),f=[e,t,n,r,i,c,d,o,a,s];if(p&&(ir(f,p),t=f[1],s=f[9]),f[9]=null==s?l?0:e.length:wa(s-u,0)||0,t==P)var h=hn(f[0],f[2]);else h=t!=N&&t!=(P|N)||f[4].length?Ln.apply(A,f):Rn.apply(A,f);var m=p?Fa:$a;return m(h,f)}function Vn(e,t,n,r,i,o,a){var s=-1,l=e.length,u=t.length;if(l!=u&&!(i&&u>l))return!1;for(;++s<l;){var c=e[s],d=t[s],p=r?r(i?d:c,i?c:d,s):A;if(p!==A){if(p)continue;return!1}if(i){if(!pt(t,function(e){return c===e||n(c,e,r,i,o,a)}))return!1}else if(c!==d&&!n(c,d,r,i,o,a))return!1}return!0}function jn(e,t,n){switch(n){case Y:case X:return+e==+t;case Q:return e.name==t.name&&e.message==t.message;case Z:return e!=+e?t!=+t:e==+t;case te:case re:return e==t+""}return!1}function Fn(e,t,n,r,i,o,a){var s=Fs(e),l=s.length,u=Fs(t),c=u.length;if(l!=c&&!i)return!1;for(var d=l;d--;){var p=s[d];if(!(i?p in t:ta.call(t,p)))return!1}for(var f=i;++d<l;){p=s[d];var h=e[p],m=t[p],g=r?r(i?m:h,i?h:m,p):A;if(!(g===A?n(h,m,r,i,o,a):g))return!1;f||(f="constructor"==p)}if(!f){var v=e.constructor,y=t.constructor;if(v!=y&&"constructor"in e&&"constructor"in t&&!("function"==typeof v&&v instanceof v&&"function"==typeof y&&y instanceof y))return!1}return!0}function zn(e,t,r){var i=n.callback||Ao;return i=i===Ao?_t:i,r?i(e,t,r):i}function Gn(e){for(var t=e.name,n=Ra[t],r=n?n.length:0;r--;){var i=n[r],o=i.func;if(null==o||o==e)return i.name}return t}function $n(e,t,r){var i=n.indexOf||Tr;return i=i===Tr?a:i,e?i(e,t,r):i}function Un(e){for(var t=to(e),n=t.length;n--;)t[n][2]=rr(t[n][1]);return t}function qn(e,t){var n=null==e?A:e[t];return Bi(n)?n:A}function Hn(e,t,n){for(var r=-1,i=n.length;++r<i;){var o=n[r],a=o.size;switch(o.type){case"drop":e+=a;break;case"dropRight":t-=a;break;case"take":t=Ca(t,e+a);break;case"takeRight":e=wa(e,t-a)}}return{start:e,end:t}}function Wn(e){var t=e.length,n=new e.constructor(t);return t&&"string"==typeof e[0]&&ta.call(e,"index")&&(n.index=e.index,n.input=e.input),n}function Yn(e){var t=e.constructor;return"function"==typeof t&&t instanceof t||(t=Wo),new t}function Xn(e,t,n){var r=e.constructor;switch(t){case oe:return sn(e);case Y:case X:return new r(+e);case ae:case se:case le:case ue:case ce:case de:case pe:case fe:case he:var i=e.buffer;return new r(n?sn(i):i,e.byteOffset,e.length);case Z:case re:return new r(e);case te:var o=new r(e.source,Ne.exec(e));o.lastIndex=e.lastIndex}return o}function Qn(e,t,n){null==e||er(t,e)||(t=pr(t),e=1==t.length?e:Rt(e,Yt(t,0,-1)),t=Ar(t));var r=null==e?e:e[t];return null==r?A:r.apply(e,n)}function Kn(e){return null!=e&&nr(Ga(e))}function Jn(e,t){return e="number"==typeof e||De.test(e)?+e:-1,t=null==t?La:t,e>-1&&e%1==0&&e<t}function Zn(e,t,n){if(!Ri(n))return!1;var r=typeof t;if("number"==r?Kn(n)&&Jn(t,n.length):"string"==r&&t in n){var i=n[t];return e===e?e===i:i!==i}return!1}function er(e,t){var n=typeof e;if("string"==n&&Ae.test(e)||"number"==n)return!0;if(Es(e))return!1;var r=!Se.test(e);return r||null!=t&&e in dr(t)}function tr(e){var t=Gn(e);if(!(t in b.prototype))return!1;var r=n[t];if(e===r)return!0;var i=za(r);return!!i&&e===i[0]}function nr(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=La}function rr(e){return e===e&&!Ri(e)}function ir(e,t){var n=e[1],r=t[1],i=n|r,o=i<I,a=r==I&&n==M||r==I&&n==D&&e[7].length<=t[8]||r==(I|D)&&n==M;if(!o&&!a)return e;r&P&&(e[2]=t[2],i|=n&P?0:O);var s=t[3];if(s){var l=e[3];e[3]=l?ln(l,s,t[4]):et(s),e[4]=l?_(e[3],q):et(t[4])}return s=t[5],s&&(l=e[5],e[5]=l?un(l,s,t[6]):et(s),e[6]=l?_(e[5],q):et(t[6])),s=t[7],s&&(e[7]=et(s)),r&I&&(e[8]=null==e[8]?t[8]:Ca(e[8],t[8])),null==e[9]&&(e[9]=t[9]),e[0]=t[0],e[1]=i,e}function or(e,t){return e===A?t:Os(e,t,or)}function ar(e,t){e=dr(e);for(var n=-1,r=t.length,i={};++n<r;){var o=t[n];o in e&&(i[o]=e[o])}return i}function sr(e,t){var n={};return Ot(e,function(e,r,i){t(e,r,i)&&(n[r]=e)}),n}function lr(e,t){for(var n=e.length,r=Ca(t.length,n),i=et(e);r--;){var o=t[r];e[r]=Jn(o,n)?i[o]:A}return e}function ur(e){for(var t=eo(e),n=t.length,r=n&&e.length,i=!!r&&nr(r)&&(Es(e)||Si(e)),o=-1,a=[];++o<n;){var s=t[o];(i&&Jn(s,r)||ta.call(e,s))&&a.push(s)}return a}function cr(e){return null==e?[]:Kn(e)?Ri(e)?e:Wo(e):oo(e)}function dr(e){return Ri(e)?e:Wo(e)}function pr(e){if(Es(e))return e;var t=[];return l(e).replace(ke,function(e,n,r,i){t.push(r?i.replace(Me,"$1"):n||e)}),t}function fr(e){return e instanceof b?e.clone():new i(e.__wrapped__,e.__chain__,et(e.__actions__))}function hr(e,t,n){t=(n?Zn(e,t,n):null==t)?1:wa(ya(t)||1,1);for(var r=0,i=e?e.length:0,o=-1,a=zo(ga(i/t));r<i;)a[++o]=Yt(e,r,r+=t);return a}function mr(e){for(var t=-1,n=e?e.length:0,r=-1,i=[];++t<n;){var o=e[t];o&&(i[++r]=o)}return i}function gr(e,t,n){var r=e?e.length:0;return r?((n?Zn(e,t,n):null==t)&&(t=1),Yt(e,t<0?0:t)):[]}function vr(e,t,n){var r=e?e.length:0;return r?((n?Zn(e,t,n):null==t)&&(t=1),t=r-(+t||0),Yt(e,0,t<0?0:t)):[]}function yr(e,t,n){return e&&e.length?tn(e,zn(t,n,3),!0,!0):[]}function br(e,t,n){return e&&e.length?tn(e,zn(t,n,3),!0):[]}function _r(e,t,n,r){var i=e?e.length:0;return i?(n&&"number"!=typeof n&&Zn(e,t,n)&&(n=0,r=i),At(e,t,n,r)):[]}function xr(e){return e?e[0]:A}function wr(e,t,n){var r=e?e.length:0;return n&&Zn(e,t,n)&&(t=!1),r?Et(e,t):[]}function Cr(e){var t=e?e.length:0;return t?Et(e,!0):[]}function Tr(e,t,n){var r=e?e.length:0;if(!r)return-1;if("number"==typeof n)n=n<0?wa(r+n,0):n;else if(n){var i=rn(e,t);return i<r&&(t===t?t===e[i]:e[i]!==e[i])?i:-1}return a(e,t,n||0)}function Sr(e){return vr(e,1)}function Ar(e){var t=e?e.length:0;return t?e[t-1]:A}function kr(e,t,n){var r=e?e.length:0;if(!r)return-1;var i=r;if("number"==typeof n)i=(n<0?wa(r+n,0):Ca(n||0,r-1))+1;else if(n){i=rn(e,t,!0)-1;var o=e[i];return(t===t?t===o:o!==o)?i:-1}if(t!==t)return v(e,i,!0);for(;i--;)if(e[i]===t)return i;return-1}function Pr(){var e=arguments,t=e[0];if(!t||!t.length)return t;for(var n=0,r=$n(),i=e.length;++n<i;)for(var o=0,a=e[n];(o=r(t,a,o))>-1;)fa.call(t,o,1);return t}function Er(e,t,n){var r=[];if(!e||!e.length)return r;var i=-1,o=[],a=e.length;for(t=zn(t,n,3);++i<a;){var s=e[i];t(s,i,e)&&(r.push(s),o.push(i))}return qt(e,o),r}function Or(e){return gr(e,1)}function Mr(e,t,n){var r=e?e.length:0;return r?(n&&"number"!=typeof n&&Zn(e,t,n)&&(t=0,n=r),Yt(e,t,n)):[]}function Lr(e,t,n){var r=e?e.length:0;return r?((n?Zn(e,t,n):null==t)&&(t=1),Yt(e,0,t<0?0:t)):[]}function Nr(e,t,n){var r=e?e.length:0;return r?((n?Zn(e,t,n):null==t)&&(t=1),t=r-(+t||0),Yt(e,t<0?0:t)):[]}function Rr(e,t,n){return e&&e.length?tn(e,zn(t,n,3),!1,!0):[]}function Ir(e,t,n){return e&&e.length?tn(e,zn(t,n,3)):[]}function Dr(e,t,n,r){var i=e?e.length:0;if(!i)return[];null!=t&&"boolean"!=typeof t&&(r=n,n=Zn(e,t,r)?A:t,t=!1);var o=zn();return null==n&&o===_t||(n=o(n,r,3)),t&&$n()==a?x(e,n):Zt(e,n)}function Br(e){if(!e||!e.length)return[];var t=-1,n=0;e=st(e,function(e){if(Kn(e))return n=wa(e.length,n),!0});for(var r=zo(n);++t<n;)r[t]=lt(e,$t(t));return r}function Vr(e,t,n){var r=e?e.length:0;if(!r)return[];var i=Br(e);return null==t?i:(t=an(t,n,4),lt(i,function(e){return ct(e,t,A,!0)}))}function jr(){for(var e=-1,t=arguments.length;++e<t;){var n=arguments[e];if(Kn(n))var r=r?ut(Ct(r,n),Ct(n,r)):n}return r?Zt(r):[]}function Fr(e,t){var n=-1,r=e?e.length:0,i={};for(!r||t||Es(e[0])||(t=[]);++n<r;){var o=e[n];t?i[o]=t[n]:o&&(i[o[0]]=o[1])}return i}function zr(e){var t=n(e);return t.__chain__=!0,t}function Gr(e,t,n){return t.call(n,e),e}function $r(e,t,n){return t.call(n,e)}function Ur(){return zr(this)}function qr(){return new i(this.value(),this.__chain__)}function Hr(e){for(var t,n=this;n instanceof r;){var i=fr(n);t?o.__wrapped__=i:t=i;var o=i;n=n.__wrapped__}return o.__wrapped__=e,t}function Wr(){var e=this.__wrapped__,t=function(e){return n&&n.__dir__<0?e:e.reverse()};if(e instanceof b){var n=e;return this.__actions__.length&&(n=new b(this)),n=n.reverse(),n.__actions__.push({func:$r,args:[t],thisArg:A}),new i(n,this.__chain__)}return this.thru(t)}function Yr(){return this.value()+""}function Xr(){return nn(this.__wrapped__,this.__actions__)}function Qr(e,t,n){var r=Es(e)?ot:Tt;return n&&Zn(e,t,n)&&(t=A),"function"==typeof t&&n===A||(t=zn(t,n,3)),r(e,t)}function Kr(e,t,n){var r=Es(e)?st:kt;return t=zn(t,n,3),r(e,t)}function Jr(e,t){return is(e,jt(t))}function Zr(e,t,n,r){var i=e?Ga(e):0;return nr(i)||(e=oo(e),i=e.length),n="number"!=typeof n||r&&Zn(t,n,r)?0:n<0?wa(i+n,0):n||0,"string"==typeof e||!Es(e)&&Gi(e)?n<=i&&e.indexOf(t,n)>-1:!!i&&$n(e,t,n)>-1}function ei(e,t,n){var r=Es(e)?lt:Vt;return t=zn(t,n,3),r(e,t)}function ti(e,t){return ei(e,Ro(t))}function ni(e,t,n){var r=Es(e)?st:kt;return t=zn(t,n,3),r(e,function(e,n,r){return!t(e,n,r)})}function ri(e,t,n){if(n?Zn(e,t,n):null==t){e=cr(e);var r=e.length;return r>0?e[Ht(0,r-1)]:A}var i=-1,o=Wi(e),r=o.length,a=r-1;for(t=Ca(t<0?0:+t||0,r);++i<t;){var s=Ht(i,a),l=o[s];o[s]=o[i],o[i]=l}return o.length=t,o}function ii(e){return ri(e,Pa)}function oi(e){var t=e?Ga(e):0;return nr(t)?t:Fs(e).length}function ai(e,t,n){var r=Es(e)?pt:Xt;return n&&Zn(e,t,n)&&(t=A),"function"==typeof t&&n===A||(t=zn(t,n,3)),r(e,t)}function si(e,t,n){if(null==e)return[];n&&Zn(e,t,n)&&(t=A);var r=-1;t=zn(t,n,3);var i=Vt(e,function(e,n,i){return{criteria:t(e,n,i),index:++r,value:e}});return Qt(i,d)}function li(e,t,n,r){return null==e?[]:(r&&Zn(t,n,r)&&(n=A),Es(t)||(t=null==t?[]:[t]),Es(n)||(n=null==n?[]:[n]),Kt(e,t,n))}function ui(e,t){return Kr(e,jt(t))}function ci(e,t){if("function"!=typeof t){if("function"!=typeof e)throw new Qo(U);var n=e;e=t,t=n}return e=_a(e=+e)?e:0,function(){if(--e<1)return t.apply(this,arguments)}}function di(e,t,n){return n&&Zn(e,t,n)&&(t=A),t=e&&null==t?e.length:wa(+t||0,0),Bn(e,I,A,A,A,A,t)}function pi(e,t){var n;if("function"!=typeof t){if("function"!=typeof e)throw new Qo(U);var r=e;e=t,t=r}return function(){return--e>0&&(n=t.apply(this,arguments)),e<=1&&(t=A),n}}function fi(e,t,n){function r(){f&&sa(f),u&&sa(u),m=0,u=f=h=A}function i(t,n){n&&sa(n),u=f=h=A,t&&(m=ms(),c=e.apply(p,l),f||u||(l=p=A))}function o(){var e=t-(ms()-d);e<=0||e>t?i(h,u):f=pa(o,e)}function a(){i(v,f)}function s(){if(l=arguments,d=ms(),p=this,h=v&&(f||!y),g===!1)var n=y&&!f;else{u||y||(m=d);var r=g-(d-m),i=r<=0||r>g;i?(u&&(u=sa(u)),m=d,c=e.apply(p,l)):u||(u=pa(a,r))}return i&&f?f=sa(f):f||t===g||(f=pa(o,t)),n&&(i=!0,c=e.apply(p,l)),!i||f||u||(l=p=A),c}var l,u,c,d,p,f,h,m=0,g=!1,v=!0;if("function"!=typeof e)throw new Qo(U);if(t=t<0?0:+t||0,n===!0){var y=!0;v=!1}else Ri(n)&&(y=!!n.leading,g="maxWait"in n&&wa(+n.maxWait||0,t),v="trailing"in n?!!n.trailing:v);return s.cancel=r,s}function hi(e,t){if("function"!=typeof e||t&&"function"!=typeof t)throw new Qo(U);var n=function(){var r=arguments,i=t?t.apply(this,r):r[0],o=n.cache;if(o.has(i))return o.get(i);var a=e.apply(this,r);return n.cache=o.set(i,a),a};return n.cache=new hi.Cache,n}function mi(e){if("function"!=typeof e)throw new Qo(U);return function(){return!e.apply(this,arguments)}}function gi(e){return pi(2,e)}function vi(e,t){if("function"!=typeof e)throw new Qo(U);return t=wa(t===A?e.length-1:+t||0,0),function(){for(var n=arguments,r=-1,i=wa(n.length-t,0),o=zo(i);++r<i;)o[r]=n[t+r];switch(t){case 0:return e.call(this,o);case 1:return e.call(this,n[0],o);case 2:return e.call(this,n[0],n[1],o)}var a=zo(t+1);for(r=-1;++r<t;)a[r]=n[r];return a[t]=o,e.apply(this,a)}}function yi(e){if("function"!=typeof e)throw new Qo(U);return function(t){return e.apply(this,t)}}function bi(e,t,n){var r=!0,i=!0;if("function"!=typeof e)throw new Qo(U);return n===!1?r=!1:Ri(n)&&(r="leading"in n?!!n.leading:r,i="trailing"in n?!!n.trailing:i),fi(e,t,{leading:r,maxWait:+t,trailing:i})}function _i(e,t){return t=null==t?Po:t,Bn(t,N,A,[e],[])}function xi(e,t,n,r){return t&&"boolean"!=typeof t&&Zn(e,t,n)?t=!1:"function"==typeof t&&(r=n,n=t,t=!1),"function"==typeof n?xt(e,t,an(n,r,1)):xt(e,t)}function wi(e,t,n){return"function"==typeof t?xt(e,!0,an(t,n,1)):xt(e,!0)}function Ci(e,t){return e>t}function Ti(e,t){return e>=t}function Si(e){return y(e)&&Kn(e)&&ta.call(e,"callee")&&!ca.call(e,"callee")}function Ai(e){return e===!0||e===!1||y(e)&&ra.call(e)==Y}function ki(e){return y(e)&&ra.call(e)==X}function Pi(e){return!!e&&1===e.nodeType&&y(e)&&!Fi(e)}function Ei(e){return null==e||(Kn(e)&&(Es(e)||Gi(e)||Si(e)||y(e)&&Ni(e.splice))?!e.length:!Fs(e).length)}function Oi(e,t,n,r){n="function"==typeof n?an(n,r,3):A;var i=n?n(e,t):A;return i===A?It(e,t,n):!!i}function Mi(e){return y(e)&&"string"==typeof e.message&&ra.call(e)==Q}function Li(e){return"number"==typeof e&&_a(e)}function Ni(e){return Ri(e)&&ra.call(e)==K}function Ri(e){var t=typeof e;return!!e&&("object"==t||"function"==t)}function Ii(e,t,n,r){return n="function"==typeof n?an(n,r,3):A,Bt(e,Un(t),n)}function Di(e){return ji(e)&&e!=+e}function Bi(e){return null!=e&&(Ni(e)?oa.test(ea.call(e)):y(e)&&Ie.test(e))}function Vi(e){return null===e}function ji(e){return"number"==typeof e||y(e)&&ra.call(e)==Z}function Fi(e){var t;if(!y(e)||ra.call(e)!=ee||Si(e)||!ta.call(e,"constructor")&&(t=e.constructor,"function"==typeof t&&!(t instanceof t)))return!1;var n;return Ot(e,function(e,t){n=t}),n===A||ta.call(e,n)}function zi(e){return Ri(e)&&ra.call(e)==te}function Gi(e){return"string"==typeof e||y(e)&&ra.call(e)==re}function $i(e){return y(e)&&nr(e.length)&&!!$e[ra.call(e)]}function Ui(e){return e===A}function qi(e,t){return e<t}function Hi(e,t){return e<=t}function Wi(e){var t=e?Ga(e):0;return nr(t)?t?et(e):[]:oo(e)}function Yi(e){return bt(e,eo(e))}function Xi(e,t,n){var r=Ia(e);return n&&Zn(e,t,n)&&(t=A),t?vt(r,t):r}function Qi(e){return Nt(e,eo(e))}function Ki(e,t,n){var r=null==e?A:Rt(e,pr(t),t+"");return r===A?n:r}function Ji(e,t){if(null==e)return!1;var n=ta.call(e,t);if(!n&&!er(t)){if(t=pr(t),e=1==t.length?e:Rt(e,Yt(t,0,-1)),null==e)return!1;t=Ar(t),n=ta.call(e,t)}return n||nr(e.length)&&Jn(t,e.length)&&(Es(e)||Si(e))}function Zi(e,t,n){n&&Zn(e,t,n)&&(t=A);for(var r=-1,i=Fs(e),o=i.length,a={};++r<o;){var s=i[r],l=e[s];t?ta.call(a,l)?a[l].push(s):a[l]=[s]:a[l]=s}return a}function eo(e){if(null==e)return[];Ri(e)||(e=Wo(e));var t=e.length;t=t&&nr(t)&&(Es(e)||Si(e))&&t||0;for(var n=e.constructor,r=-1,i="function"==typeof n&&n.prototype===e,o=zo(t),a=t>0;++r<t;)o[r]=r+"";for(var s in e)a&&Jn(s,t)||"constructor"==s&&(i||!ta.call(e,s))||o.push(s);return o}function to(e){e=dr(e);for(var t=-1,n=Fs(e),r=n.length,i=zo(r);++t<r;){var o=n[t];i[t]=[o,e[o]]}return i}function no(e,t,n){var r=null==e?A:e[t];return r===A&&(null==e||er(t,e)||(t=pr(t),e=1==t.length?e:Rt(e,Yt(t,0,-1)),r=null==e?A:e[Ar(t)]),r=r===A?n:r),Ni(r)?r.call(e):r}function ro(e,t,n){if(null==e)return e;var r=t+"";t=null!=e[r]||er(t,e)?[r]:pr(t);for(var i=-1,o=t.length,a=o-1,s=e;null!=s&&++i<o;){var l=t[i];Ri(s)&&(i==a?s[l]=n:null==s[l]&&(s[l]=Jn(t[i+1])?[]:{})),s=s[l]}return e}function io(e,t,n,r){var i=Es(e)||$i(e);if(t=zn(t,r,4),null==n)if(i||Ri(e)){var o=e.constructor;n=i?Es(e)?new o:[]:Ia(Ni(o)?o.prototype:A)}else n={};return(i?tt:Mt)(e,function(e,r,i){return t(n,e,r,i)}),n}function oo(e){return en(e,Fs(e))}function ao(e){return en(e,eo(e))}function so(e,t,n){return t=+t||0,n===A?(n=t,t=0):n=+n||0,e>=Ca(t,n)&&e<wa(t,n)}function lo(e,t,n){n&&Zn(e,t,n)&&(t=n=A);var r=null==e,i=null==t;if(null==n&&(i&&"boolean"==typeof e?(n=e,e=1):"boolean"==typeof t&&(n=t,i=!0)),r&&i&&(t=1,i=!1),e=+e||0,i?(t=e,e=0):t=+t||0,n||e%1||t%1){var o=Aa();return Ca(e+o*(t-e+la("1e-"+((o+"").length-1))),t)}return Ht(e,t)}function uo(e){return e=l(e),e&&e.charAt(0).toUpperCase()+e.slice(1)}function co(e){return e=l(e),e&&e.replace(Be,f).replace(Oe,"")}function po(e,t,n){e=l(e),t+="";var r=e.length;return n=n===A?r:Ca(n<0?0:+n||0,r),n-=t.length,n>=0&&e.indexOf(t,n)==n}function fo(e){return e=l(e),e&&xe.test(e)?e.replace(be,h):e}function ho(e){return e=l(e),e&&Ee.test(e)?e.replace(Pe,m):e||"(?:)"}function mo(e,t,n){e=l(e),t=+t;var r=e.length;if(r>=t||!_a(t))return e;var i=(t-r)/2,o=ya(i),a=ga(i);return n=Nn("",a,n),n.slice(0,o)+e+n}function go(e,t,n){return(n?Zn(e,t,n):null==t)?t=0:t&&(t=+t),e=_o(e),Sa(e,t||(Re.test(e)?16:10))}function vo(e,t){var n="";if(e=l(e),t=+t,t<1||!e||!_a(t))return n;do t%2&&(n+=e),t=ya(t/2),e+=e;while(t);return n}function yo(e,t,n){return e=l(e),n=null==n?0:Ca(n<0?0:+n||0,e.length),e.lastIndexOf(t,n)==n}function bo(e,t,r){var i=n.templateSettings;r&&Zn(e,t,r)&&(t=r=A),e=l(e),t=gt(vt({},r||t),i,mt);var o,a,s=gt(vt({},t.imports),i.imports,mt),u=Fs(s),c=en(s,u),d=0,p=t.interpolate||Ve,f="__p += '",h=Yo((t.escape||Ve).source+"|"+p.source+"|"+(p===Te?Le:Ve).source+"|"+(t.evaluate||Ve).source+"|$","g"),m="//# sourceURL="+("sourceURL"in t?t.sourceURL:"lodash.templateSources["+ ++Ge+"]")+"\n";e.replace(h,function(t,n,r,i,s,l){return r||(r=i),f+=e.slice(d,l).replace(je,g),
n&&(o=!0,f+="' +\n__e("+n+") +\n'"),s&&(a=!0,f+="';\n"+s+";\n__p += '"),r&&(f+="' +\n((__t = ("+r+")) == null ? '' : __t) +\n'"),d=l+t.length,t}),f+="';\n";var v=t.variable;v||(f="with (obj) {\n"+f+"\n}\n"),f=(a?f.replace(me,""):f).replace(ge,"$1").replace(ve,"$1;"),f="function("+(v||"obj")+") {\n"+(v?"":"obj || (obj = {});\n")+"var __t, __p = ''"+(o?", __e = _.escape":"")+(a?", __j = Array.prototype.join;\nfunction print() { __p += __j.call(arguments, '') }\n":";\n")+f+"return __p\n}";var y=Ks(function(){return Uo(u,m+"return "+f).apply(A,c)});if(y.source=f,Mi(y))throw y;return y}function _o(e,t,n){var r=e;return(e=l(e))?(n?Zn(r,t,n):null==t)?e.slice(w(e),C(e)+1):(t+="",e.slice(u(e,t),c(e,t)+1)):e}function xo(e,t,n){var r=e;return e=l(e),e?(n?Zn(r,t,n):null==t)?e.slice(w(e)):e.slice(u(e,t+"")):e}function wo(e,t,n){var r=e;return e=l(e),e?(n?Zn(r,t,n):null==t)?e.slice(0,C(e)+1):e.slice(0,c(e,t+"")+1):e}function Co(e,t,n){n&&Zn(e,t,n)&&(t=A);var r=B,i=V;if(null!=t)if(Ri(t)){var o="separator"in t?t.separator:o;r="length"in t?+t.length||0:r,i="omission"in t?l(t.omission):i}else r=+t||0;if(e=l(e),r>=e.length)return e;var a=r-i.length;if(a<1)return i;var s=e.slice(0,a);if(null==o)return s+i;if(zi(o)){if(e.slice(a).search(o)){var u,c,d=e.slice(0,a);for(o.global||(o=Yo(o.source,(Ne.exec(o)||"")+"g")),o.lastIndex=0;u=o.exec(d);)c=u.index;s=s.slice(0,null==c?a:c)}}else if(e.indexOf(o,a)!=a){var p=s.lastIndexOf(o);p>-1&&(s=s.slice(0,p))}return s+i}function To(e){return e=l(e),e&&_e.test(e)?e.replace(ye,T):e}function So(e,t,n){return n&&Zn(e,t,n)&&(t=A),e=l(e),e.match(t||Fe)||[]}function Ao(e,t,n){return n&&Zn(e,t,n)&&(t=A),y(e)?Eo(e):_t(e,t)}function ko(e){return function(){return e}}function Po(e){return e}function Eo(e){return jt(xt(e,!0))}function Oo(e,t){return Ft(e,xt(t,!0))}function Mo(e,t,n){if(null==n){var r=Ri(t),i=r?Fs(t):A,o=i&&i.length?Nt(t,i):A;(o?o.length:r)||(o=!1,n=t,t=e,e=this)}o||(o=Nt(t,Fs(t)));var a=!0,s=-1,l=Ni(e),u=o.length;n===!1?a=!1:Ri(n)&&"chain"in n&&(a=n.chain);for(;++s<u;){var c=o[s],d=t[c];e[c]=d,l&&(e.prototype[c]=function(t){return function(){var n=this.__chain__;if(a||n){var r=e(this.__wrapped__),i=r.__actions__=et(this.__actions__);return i.push({func:t,args:arguments,thisArg:e}),r.__chain__=n,r}return t.apply(e,ut([this.value()],arguments))}}(d))}return e}function Lo(){return rt._=ia,this}function No(){}function Ro(e){return er(e)?$t(e):Ut(e)}function Io(e){return function(t){return Rt(e,pr(t),t+"")}}function Do(e,t,n){n&&Zn(e,t,n)&&(t=n=A),e=+e||0,n=null==n?1:+n||0,null==t?(t=e,e=0):t=+t||0;for(var r=-1,i=wa(ga((t-e)/(n||1)),0),o=zo(i);++r<i;)o[r]=e,e+=n;return o}function Bo(e,t,n){if(e=ya(e),e<1||!_a(e))return[];var r=-1,i=zo(Ca(e,Ea));for(t=an(t,n,1);++r<e;)r<Ea?i[r]=t(r):t(r);return i}function Vo(e){var t=++na;return l(e)+t}function jo(e,t){return(+e||0)+(+t||0)}function Fo(e,t,n){return n&&Zn(e,t,n)&&(t=A),t=zn(t,n,3),1==t.length?ft(Es(e)?e:cr(e),t):Jt(e,t)}e=e?it.defaults(rt.Object(),e,it.pick(rt,ze)):rt;var zo=e.Array,Go=e.Date,$o=e.Error,Uo=e.Function,qo=e.Math,Ho=e.Number,Wo=e.Object,Yo=e.RegExp,Xo=e.String,Qo=e.TypeError,Ko=zo.prototype,Jo=Wo.prototype,Zo=Xo.prototype,ea=Uo.prototype.toString,ta=Jo.hasOwnProperty,na=0,ra=Jo.toString,ia=rt._,oa=Yo("^"+ea.call(ta).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),aa=e.ArrayBuffer,sa=e.clearTimeout,la=e.parseFloat,ua=qo.pow,ca=Jo.propertyIsEnumerable,da=qn(e,"Set"),pa=e.setTimeout,fa=Ko.splice,ha=e.Uint8Array,ma=qn(e,"WeakMap"),ga=qo.ceil,va=qn(Wo,"create"),ya=qo.floor,ba=qn(zo,"isArray"),_a=e.isFinite,xa=qn(Wo,"keys"),wa=qo.max,Ca=qo.min,Ta=qn(Go,"now"),Sa=e.parseInt,Aa=qo.random,ka=Ho.NEGATIVE_INFINITY,Pa=Ho.POSITIVE_INFINITY,Ea=4294967295,Oa=Ea-1,Ma=Ea>>>1,La=9007199254740991,Na=ma&&new ma,Ra={};n.support={};n.templateSettings={escape:we,evaluate:Ce,interpolate:Te,variable:"",imports:{_:n}};var Ia=function(){function e(){}return function(t){if(Ri(t)){e.prototype=t;var n=new e;e.prototype=A}return n||{}}}(),Da=pn(Mt),Ba=pn(Lt,!0),Va=fn(),ja=fn(!0),Fa=Na?function(e,t){return Na.set(e,t),e}:Po,za=Na?function(e){return Na.get(e)}:No,Ga=$t("length"),$a=function(){var e=0,t=0;return function(n,r){var i=ms(),o=F-(i-t);if(t=i,o>0){if(++e>=j)return n}else e=0;return Fa(n,r)}}(),Ua=vi(function(e,t){return y(e)&&Kn(e)?Ct(e,Et(t,!1,!0)):[]}),qa=wn(),Ha=wn(!0),Wa=vi(function(e){for(var t=e.length,n=t,r=zo(d),i=$n(),o=i==a,s=[];n--;){var l=e[n]=Kn(l=e[n])?l:[];r[n]=o&&l.length>=120?mn(n&&l):null}var u=e[0],c=-1,d=u?u.length:0,p=r[0];e:for(;++c<d;)if(l=u[c],(p?Ke(p,l):i(s,l,0))<0){for(var n=t;--n;){var f=r[n];if((f?Ke(f,l):i(e[n],l,0))<0)continue e}p&&p.push(l),s.push(l)}return s}),Ya=vi(function(e,n){n=Et(n);var r=yt(e,n);return qt(e,n.sort(t)),r}),Xa=Dn(),Qa=Dn(!0),Ka=vi(function(e){return Zt(Et(e,!1,!0))}),Ja=vi(function(e,t){return Kn(e)?Ct(e,t):[]}),Za=vi(Br),es=vi(function(e){var t=e.length,n=t>2?e[t-2]:A,r=t>1?e[t-1]:A;return t>2&&"function"==typeof n?t-=2:(n=t>1&&"function"==typeof r?(--t,r):A,r=A),e.length=t,Vr(e,n,r)}),ts=vi(function(e){return e=Et(e),this.thru(function(t){return Ze(Es(t)?t:[dr(t)],e)})}),ns=vi(function(e,t){return yt(e,Et(t))}),rs=cn(function(e,t,n){ta.call(e,n)?++e[n]:e[n]=1}),is=xn(Da),os=xn(Ba,!0),as=Sn(tt,Da),ss=Sn(nt,Ba),ls=cn(function(e,t,n){ta.call(e,n)?e[n].push(t):e[n]=[t]}),us=cn(function(e,t,n){e[n]=t}),cs=vi(function(e,t,n){var r=-1,i="function"==typeof t,o=er(t),a=Kn(e)?zo(e.length):[];return Da(e,function(e){var s=i?t:o&&null!=e?e[t]:A;a[++r]=s?s.apply(e,n):Qn(e,t,n)}),a}),ds=cn(function(e,t,n){e[n?0:1].push(t)},function(){return[[],[]]}),ps=Mn(ct,Da),fs=Mn(dt,Ba),hs=vi(function(e,t){if(null==e)return[];var n=t[2];return n&&Zn(t[0],t[1],n)&&(t.length=1),Kt(e,Et(t),[])}),ms=Ta||function(){return(new Go).getTime()},gs=vi(function(e,t,n){var r=P;if(n.length){var i=_(n,gs.placeholder);r|=N}return Bn(e,r,t,n,i)}),vs=vi(function(e,t){t=t.length?Et(t):Qi(e);for(var n=-1,r=t.length;++n<r;){var i=t[n];e[i]=Bn(e[i],P,e)}return e}),ys=vi(function(e,t,n){var r=P|E;if(n.length){var i=_(n,ys.placeholder);r|=N}return Bn(t,r,e,n,i)}),bs=yn(M),_s=yn(L),xs=vi(function(e,t){return wt(e,1,t)}),ws=vi(function(e,t,n){return wt(e,t,n)}),Cs=Tn(),Ts=Tn(!0),Ss=vi(function(e,t){if(t=Et(t),"function"!=typeof e||!ot(t,s))throw new Qo(U);var n=t.length;return vi(function(r){for(var i=Ca(r.length,n);i--;)r[i]=t[i](r[i]);return e.apply(this,r)})}),As=On(N),ks=On(R),Ps=vi(function(e,t){return Bn(e,D,A,A,A,Et(t))}),Es=ba||function(e){return y(e)&&nr(e.length)&&ra.call(e)==W},Os=dn(zt),Ms=dn(function(e,t,n){return n?gt(e,t,n):vt(e,t)}),Ls=bn(Ms,ht),Ns=bn(Os,or),Rs=Cn(Mt),Is=Cn(Lt),Ds=An(Va),Bs=An(ja),Vs=kn(Mt),js=kn(Lt),Fs=xa?function(e){var t=null==e?A:e.constructor;return"function"==typeof t&&t.prototype===e||"function"!=typeof e&&Kn(e)?ur(e):Ri(e)?xa(e):[]}:ur,zs=Pn(!0),Gs=Pn(),$s=vi(function(e,t){if(null==e)return{};if("function"!=typeof t[0]){var t=lt(Et(t),Xo);return ar(e,Ct(eo(e),t))}var n=an(t[0],t[1],3);return sr(e,function(e,t,r){return!n(e,t,r)})}),Us=vi(function(e,t){return null==e?{}:"function"==typeof t[0]?sr(e,an(t[0],t[1],3)):ar(e,Et(t))}),qs=gn(function(e,t,n){return t=t.toLowerCase(),e+(n?t.charAt(0).toUpperCase()+t.slice(1):t)}),Hs=gn(function(e,t,n){return e+(n?"-":"")+t.toLowerCase()}),Ws=En(),Ys=En(!0),Xs=gn(function(e,t,n){return e+(n?"_":"")+t.toLowerCase()}),Qs=gn(function(e,t,n){return e+(n?" ":"")+(t.charAt(0).toUpperCase()+t.slice(1))}),Ks=vi(function(e,t){try{return e.apply(A,t)}catch(e){return Mi(e)?e:new $o(e)}}),Js=vi(function(e,t){return function(n){return Qn(n,e,t)}}),Zs=vi(function(e,t){return function(n){return Qn(e,n,t)}}),el=In("ceil"),tl=In("floor"),nl=_n(Ci,ka),rl=_n(qi,Pa),il=In("round");return n.prototype=r.prototype,i.prototype=Ia(r.prototype),i.prototype.constructor=i,b.prototype=Ia(r.prototype),b.prototype.constructor=b,qe.prototype.delete=He,qe.prototype.get=We,qe.prototype.has=Ye,qe.prototype.set=Xe,Qe.prototype.push=Je,hi.Cache=qe,n.after=ci,n.ary=di,n.assign=Ms,n.at=ns,n.before=pi,n.bind=gs,n.bindAll=vs,n.bindKey=ys,n.callback=Ao,n.chain=zr,n.chunk=hr,n.compact=mr,n.constant=ko,n.countBy=rs,n.create=Xi,n.curry=bs,n.curryRight=_s,n.debounce=fi,n.defaults=Ls,n.defaultsDeep=Ns,n.defer=xs,n.delay=ws,n.difference=Ua,n.drop=gr,n.dropRight=vr,n.dropRightWhile=yr,n.dropWhile=br,n.fill=_r,n.filter=Kr,n.flatten=wr,n.flattenDeep=Cr,n.flow=Cs,n.flowRight=Ts,n.forEach=as,n.forEachRight=ss,n.forIn=Ds,n.forInRight=Bs,n.forOwn=Vs,n.forOwnRight=js,n.functions=Qi,n.groupBy=ls,n.indexBy=us,n.initial=Sr,n.intersection=Wa,n.invert=Zi,n.invoke=cs,n.keys=Fs,n.keysIn=eo,n.map=ei,n.mapKeys=zs,n.mapValues=Gs,n.matches=Eo,n.matchesProperty=Oo,n.memoize=hi,n.merge=Os,n.method=Js,n.methodOf=Zs,n.mixin=Mo,n.modArgs=Ss,n.negate=mi,n.omit=$s,n.once=gi,n.pairs=to,n.partial=As,n.partialRight=ks,n.partition=ds,n.pick=Us,n.pluck=ti,n.property=Ro,n.propertyOf=Io,n.pull=Pr,n.pullAt=Ya,n.range=Do,n.rearg=Ps,n.reject=ni,n.remove=Er,n.rest=Or,n.restParam=vi,n.set=ro,n.shuffle=ii,n.slice=Mr,n.sortBy=si,n.sortByAll=hs,n.sortByOrder=li,n.spread=yi,n.take=Lr,n.takeRight=Nr,n.takeRightWhile=Rr,n.takeWhile=Ir,n.tap=Gr,n.throttle=bi,n.thru=$r,n.times=Bo,n.toArray=Wi,n.toPlainObject=Yi,n.transform=io,n.union=Ka,n.uniq=Dr,n.unzip=Br,n.unzipWith=Vr,n.values=oo,n.valuesIn=ao,n.where=ui,n.without=Ja,n.wrap=_i,n.xor=jr,n.zip=Za,n.zipObject=Fr,n.zipWith=es,n.backflow=Ts,n.collect=ei,n.compose=Ts,n.each=as,n.eachRight=ss,n.extend=Ms,n.iteratee=Ao,n.methods=Qi,n.object=Fr,n.select=Kr,n.tail=Or,n.unique=Dr,Mo(n,n),n.add=jo,n.attempt=Ks,n.camelCase=qs,n.capitalize=uo,n.ceil=el,n.clone=xi,n.cloneDeep=wi,n.deburr=co,n.endsWith=po,n.escape=fo,n.escapeRegExp=ho,n.every=Qr,n.find=is,n.findIndex=qa,n.findKey=Rs,n.findLast=os,n.findLastIndex=Ha,n.findLastKey=Is,n.findWhere=Jr,n.first=xr,n.floor=tl,n.get=Ki,n.gt=Ci,n.gte=Ti,n.has=Ji,n.identity=Po,n.includes=Zr,n.indexOf=Tr,n.inRange=so,n.isArguments=Si,n.isArray=Es,n.isBoolean=Ai,n.isDate=ki,n.isElement=Pi,n.isEmpty=Ei,n.isEqual=Oi,n.isError=Mi,n.isFinite=Li,n.isFunction=Ni,n.isMatch=Ii,n.isNaN=Di,n.isNative=Bi,n.isNull=Vi,n.isNumber=ji,n.isObject=Ri,n.isPlainObject=Fi,n.isRegExp=zi,n.isString=Gi,n.isTypedArray=$i,n.isUndefined=Ui,n.kebabCase=Hs,n.last=Ar,n.lastIndexOf=kr,n.lt=qi,n.lte=Hi,n.max=nl,n.min=rl,n.noConflict=Lo,n.noop=No,n.now=ms,n.pad=mo,n.padLeft=Ws,n.padRight=Ys,n.parseInt=go,n.random=lo,n.reduce=ps,n.reduceRight=fs,n.repeat=vo,n.result=no,n.round=il,n.runInContext=S,n.size=oi,n.snakeCase=Xs,n.some=ai,n.sortedIndex=Xa,n.sortedLastIndex=Qa,n.startCase=Qs,n.startsWith=yo,n.sum=Fo,n.template=bo,n.trim=_o,n.trimLeft=xo,n.trimRight=wo,n.trunc=Co,n.unescape=To,n.uniqueId=Vo,n.words=So,n.all=Qr,n.any=ai,n.contains=Zr,n.eq=Oi,n.detect=is,n.foldl=ps,n.foldr=fs,n.head=xr,n.include=Zr,n.inject=ps,Mo(n,function(){var e={};return Mt(n,function(t,r){n.prototype[r]||(e[r]=t)}),e}(),!1),n.sample=ri,n.prototype.sample=function(e){return this.__chain__||null!=e?this.thru(function(t){return ri(t,e)}):ri(this.value())},n.VERSION=k,tt(["bind","bindKey","curry","curryRight","partial","partialRight"],function(e){n[e].placeholder=n}),tt(["drop","take"],function(e,t){b.prototype[e]=function(n){var r=this.__filtered__;if(r&&!t)return new b(this);n=null==n?1:wa(ya(n)||0,0);var i=this.clone();return r?i.__takeCount__=Ca(i.__takeCount__,n):i.__views__.push({size:n,type:e+(i.__dir__<0?"Right":"")}),i},b.prototype[e+"Right"]=function(t){return this.reverse()[e](t).reverse()}}),tt(["filter","map","takeWhile"],function(e,t){var n=t+1,r=n!=$;b.prototype[e]=function(e,t){var i=this.clone();return i.__iteratees__.push({iteratee:zn(e,t,1),type:n}),i.__filtered__=i.__filtered__||r,i}}),tt(["first","last"],function(e,t){var n="take"+(t?"Right":"");b.prototype[e]=function(){return this[n](1).value()[0]}}),tt(["initial","rest"],function(e,t){var n="drop"+(t?"":"Right");b.prototype[e]=function(){return this.__filtered__?new b(this):this[n](1)}}),tt(["pluck","where"],function(e,t){var n=t?"filter":"map",r=t?jt:Ro;b.prototype[e]=function(e){return this[n](r(e))}}),b.prototype.compact=function(){return this.filter(Po)},b.prototype.reject=function(e,t){return e=zn(e,t,1),this.filter(function(t){return!e(t)})},b.prototype.slice=function(e,t){e=null==e?0:+e||0;var n=this;return n.__filtered__&&(e>0||t<0)?new b(n):(e<0?n=n.takeRight(-e):e&&(n=n.drop(e)),t!==A&&(t=+t||0,n=t<0?n.dropRight(-t):n.take(t-e)),n)},b.prototype.takeRightWhile=function(e,t){return this.reverse().takeWhile(e,t).reverse()},b.prototype.toArray=function(){return this.take(Pa)},Mt(b.prototype,function(e,t){var r=/^(?:filter|map|reject)|While$/.test(t),o=/^(?:first|last)$/.test(t),a=n[o?"take"+("last"==t?"Right":""):t];a&&(n.prototype[t]=function(){var t=o?[1]:arguments,n=this.__chain__,s=this.__wrapped__,l=!!this.__actions__.length,u=s instanceof b,c=t[0],d=u||Es(s);d&&r&&"function"==typeof c&&1!=c.length&&(u=d=!1);var p=function(e){return o&&n?a(e,1)[0]:a.apply(A,ut([e],t))},f={func:$r,args:[p],thisArg:A},h=u&&!l;if(o&&!n)return h?(s=s.clone(),s.__actions__.push(f),e.call(s)):a.call(A,this.value())[0];if(!o&&d){s=h?s:new b(this);var m=e.apply(s,t);return m.__actions__.push(f),new i(m,n)}return this.thru(p)})}),tt(["join","pop","push","replace","shift","sort","splice","split","unshift"],function(e){var t=(/^(?:replace|split)$/.test(e)?Zo:Ko)[e],r=/^(?:push|sort|unshift)$/.test(e)?"tap":"thru",i=/^(?:join|pop|replace|shift)$/.test(e);n.prototype[e]=function(){var e=arguments;return i&&!this.__chain__?t.apply(this.value(),e):this[r](function(n){return t.apply(n,e)})}}),Mt(b.prototype,function(e,t){var r=n[t];if(r){var i=r.name,o=Ra[i]||(Ra[i]=[]);o.push({name:t,func:r})}}),Ra[Ln(A,E).name]=[{name:"wrapper",func:A}],b.prototype.clone=J,b.prototype.reverse=ne,b.prototype.value=ie,n.prototype.chain=Ur,n.prototype.commit=qr,n.prototype.concat=ts,n.prototype.plant=Hr,n.prototype.reverse=Wr,n.prototype.toString=Yr,n.prototype.run=n.prototype.toJSON=n.prototype.valueOf=n.prototype.value=Xr,n.prototype.collect=n.prototype.map,n.prototype.head=n.prototype.first,n.prototype.select=n.prototype.filter,n.prototype.tail=n.prototype.rest,n}var A,k="3.10.0",P=1,E=2,O=4,M=8,L=16,N=32,R=64,I=128,D=256,B=30,V="...",j=150,F=16,z=200,G=1,$=2,U="Expected a function",q="__lodash_placeholder__",H="[object Arguments]",W="[object Array]",Y="[object Boolean]",X="[object Date]",Q="[object Error]",K="[object Function]",J="[object Map]",Z="[object Number]",ee="[object Object]",te="[object RegExp]",ne="[object Set]",re="[object String]",ie="[object WeakMap]",oe="[object ArrayBuffer]",ae="[object Float32Array]",se="[object Float64Array]",le="[object Int8Array]",ue="[object Int16Array]",ce="[object Int32Array]",de="[object Uint8Array]",pe="[object Uint8ClampedArray]",fe="[object Uint16Array]",he="[object Uint32Array]",me=/\b__p \+= '';/g,ge=/\b(__p \+=) '' \+/g,ve=/(__e\(.*?\)|\b__t\)) \+\n'';/g,ye=/&(?:amp|lt|gt|quot|#39|#96);/g,be=/[&<>"'`]/g,_e=RegExp(ye.source),xe=RegExp(be.source),we=/<%-([\s\S]+?)%>/g,Ce=/<%([\s\S]+?)%>/g,Te=/<%=([\s\S]+?)%>/g,Se=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\n\\]|\\.)*?\1)\]/,Ae=/^\w*$/,ke=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\n\\]|\\.)*?)\2)\]/g,Pe=/^[:!,]|[\\^$.*+?()[\]{}|\/]|(^[0-9a-fA-Fnrtuvx])|([\n\r\u2028\u2029])/g,Ee=RegExp(Pe.source),Oe=/[\u0300-\u036f\ufe20-\ufe23]/g,Me=/\\(\\)?/g,Le=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,Ne=/\w*$/,Re=/^0[xX]/,Ie=/^\[object .+?Constructor\]$/,De=/^\d+$/,Be=/[\xc0-\xd6\xd8-\xde\xdf-\xf6\xf8-\xff]/g,Ve=/($^)/,je=/['\n\r\u2028\u2029\\]/g,Fe=function(){var e="[A-Z\\xc0-\\xd6\\xd8-\\xde]",t="[a-z\\xdf-\\xf6\\xf8-\\xff]+";return RegExp(e+"+(?="+e+t+")|"+e+"?"+t+"|"+e+"+|[0-9]+","g")}(),ze=["Array","ArrayBuffer","Date","Error","Float32Array","Float64Array","Function","Int8Array","Int16Array","Int32Array","Math","Number","Object","RegExp","Set","String","_","clearTimeout","isFinite","parseFloat","parseInt","setTimeout","TypeError","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","WeakMap"],Ge=-1,$e={};$e[ae]=$e[se]=$e[le]=$e[ue]=$e[ce]=$e[de]=$e[pe]=$e[fe]=$e[he]=!0,$e[H]=$e[W]=$e[oe]=$e[Y]=$e[X]=$e[Q]=$e[K]=$e[J]=$e[Z]=$e[ee]=$e[te]=$e[ne]=$e[re]=$e[ie]=!1;var Ue={};Ue[H]=Ue[W]=Ue[oe]=Ue[Y]=Ue[X]=Ue[ae]=Ue[se]=Ue[le]=Ue[ue]=Ue[ce]=Ue[Z]=Ue[ee]=Ue[te]=Ue[re]=Ue[de]=Ue[pe]=Ue[fe]=Ue[he]=!0,Ue[Q]=Ue[K]=Ue[J]=Ue[ne]=Ue[ie]=!1;var qe={"À":"A","Á":"A","Â":"A","Ã":"A","Ä":"A","Å":"A","à":"a","á":"a","â":"a","ã":"a","ä":"a","å":"a","Ç":"C","ç":"c","Ð":"D","ð":"d","È":"E","É":"E","Ê":"E","Ë":"E","è":"e","é":"e","ê":"e","ë":"e","Ì":"I","Í":"I","Î":"I","Ï":"I","ì":"i","í":"i","î":"i","ï":"i","Ñ":"N","ñ":"n","Ò":"O","Ó":"O","Ô":"O","Õ":"O","Ö":"O","Ø":"O","ò":"o","ó":"o","ô":"o","õ":"o","ö":"o","ø":"o","Ù":"U","Ú":"U","Û":"U","Ü":"U","ù":"u","ú":"u","û":"u","ü":"u","Ý":"Y","ý":"y","ÿ":"y","Æ":"Ae","æ":"ae","Þ":"Th","þ":"th","ß":"ss"},He={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","`":"&#96;"},We={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'","&#96;":"`"},Ye={function:!0,object:!0},Xe={0:"x30",1:"x31",2:"x32",3:"x33",4:"x34",5:"x35",6:"x36",7:"x37",8:"x38",9:"x39",A:"x41",B:"x42",C:"x43",D:"x44",E:"x45",F:"x46",a:"x61",b:"x62",c:"x63",d:"x64",e:"x65",f:"x66",n:"x6e",r:"x72",t:"x74",u:"x75",v:"x76",x:"x78"},Qe={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},Ke=Ye[typeof r]&&r&&!r.nodeType&&r,Je=Ye[typeof n]&&n&&!n.nodeType&&n,Ze=Ke&&Je&&"object"==typeof i&&i&&i.Object&&i,et=Ye[typeof self]&&self&&self.Object&&self,tt=Ye[typeof window]&&window&&window.Object&&window,nt=Je&&Je.exports===Ke&&Ke,rt=Ze||tt!==(this&&this.window)&&tt||et||this,it=S();"function"==typeof e&&"object"==typeof e.amd&&e.amd?(rt._=it,e(function(){return it})):Ke&&Je?nt?(Je.exports=it)._=it:Ke._=it:rt._=it}).call(this)},{}],5:[function(t,n,r){!function(r,i){"function"==typeof e&&e.amd?e(["lodash"],function(e){return i(e,r)}):"object"==typeof n&&n.exports?n.exports=i(t("lodash")):r.machina=i(r._,r)}(this,function(e,t,n){function r(){return{initialState:"uninitialized",eventListeners:{"*":[]},states:{},namespace:x.makeFsmNamespace(),useSafeEmit:!1,hierarchy:{},pendingDelegations:{}}}function i(){return{inputQueue:[],targetReplayState:"",state:n,priorState:n,priorAction:"",currentAction:"",currentActionArgs:n,inExitHandler:!1}}function o(e,t){for(var n=[],r=t||0;r<e.length;r++)n[r]=e[r];return n}function a(e){if(e){var t={};return"object"==typeof e?e.factory?t=e:t.factory=function(){return e}:"function"==typeof e&&(t.factory=e),t.instance=t.factory(),t}}function s(e,t){return t.on("*",function(t,n){switch(t){case"nohandler":n.ticket||n.delegated||n.namespace===e.namespace||(n.args[1].bubbling=!0),"_reset"!==n.inputType&&e.handle.apply(e,n.args);break;case"handling":var r=n.ticket;r&&e.pendingDelegations[r]&&delete e.pendingDelegations[r],e.emit(t,n);break;default:e.emit(t,n)}})}function l(){for(var e=[],t="0123456789abcdef",n=0;n<36;n++)e[n]=t.substr(Math.floor(16*Math.random()),1);return e[14]="4",e[19]=t.substr(3&e[19]|8,1),e[8]=e[13]=e[18]=e[23]="-",e.join("")}function u(t){e.extend(this,t),e.defaults(this,r()),this.initialize.apply(this,arguments),S.emit(y,this)}var c=[].slice,d="transition",p="handling",f="handled",h="nohandler",m="transition",g="invalidstate",v="deferred",y="newfsm",b=["states","initialState"],_=function(t,n){var r,i=this,o={},a=function(){};return r=t&&t.hasOwnProperty("constructor")?t.constructor:function(){var t=c.call(arguments,0);t[0]=t[0]||{};var n,r=t[0].states||{};n=e.merge(e.cloneDeep(o),{states:r}),n.initialState=t[0].initialState||this.initialState,e.extend(t[0],n),i.apply(this,t)},e.merge(r,i),a.prototype=i.prototype,r.prototype=new a,t&&(e.extend(r.prototype,t),e.merge(o,e.transform(t,function(e,t,n){b.indexOf(n)!==-1&&(e[n]=t)}))),n&&e.merge(r,n),r.prototype.constructor=r,r.__super__=i.prototype,r},x={makeFsmNamespace:function(){var e=0;return function(){return"fsm."+e++}}(),listenToChild:s,getLeaklessArgs:o,getDefaultOptions:r,getDefaultClientMeta:i,createUUID:l},w={emit:function(t){var n=o(arguments);this.eventListeners["*"]&&e.each(this.eventListeners["*"],function(e){if(this.useSafeEmit)try{e.apply(this,n)}catch(e){console&&"undefined"!=typeof console.log&&console.log(e.stack)}else e.apply(this,n)},this),this.eventListeners[t]&&e.each(this.eventListeners[t],function(e){if(this.useSafeEmit)try{e.apply(this,n.slice(1))}catch(e){console&&"undefined"!=typeof console.log&&console.log(e.stack)}else e.apply(this,n.slice(1))},this)},on:function(e,t){var n=this;return n.eventListeners=n.eventListeners||{"*":[]},n.eventListeners[e]||(n.eventListeners[e]=[]),n.eventListeners[e].push(t),{eventName:e,callback:t,off:function(){n.off(e,t)}}},off:function(t,n){this.eventListeners=this.eventListeners||{"*":[]},t?n?this.eventListeners[t]=e.without(this.eventListeners[t],n):this.eventListeners[t]=[]:this.eventListeners={}}},C="__machina__";e.extend(u.prototype,{initialize:function(){},initClient:function(e){var t=this.initialState;if(!t)throw new Error("You must specify an initial state for this FSM");if(!this.states[t])throw new Error("The initial state specified does not exist in the states object.");this.transition(e,t)},ensureClientMeta:function(t){if("object"!=typeof t)throw new Error("An FSM client must be an object.");return t[C]=t[C]||{},t[C][this.namespace]||(t[C][this.namespace]=e.cloneDeep(x.getDefaultClientMeta()),this.initClient(t)),t[C][this.namespace]},buildEventPayload:function(t,n){return e.isPlainObject(n)?e.extend(n,{client:t,namespace:this.namespace}):{client:t,data:n||null,namespace:this.namespace}},getHandlerArgs:function(e,t){var n=e.slice(0),r=n[1];return"object"==typeof r&&n.splice(1,1,r.inputType),t?n:[n[0]].concat(n.slice(2))},handle:function(t,r){var i=r;if("undefined"==typeof r)throw new Error("The input argument passed to the FSM's handle method is undefined. Did you forget to pass the input name?");"string"==typeof r&&(i={inputType:r,delegated:!1,ticket:n});var a=this.ensureClientMeta(t),s=o(arguments);"object"!=typeof r&&s.splice(1,1,i),a.currentActionArgs=s.slice(1);var l,u,c,d,m,g=a.state,v=this.states[g],y=!1;if(!a.inExitHandler)if(c=v._child&&v._child.instance,!c||this.pendingDelegations[i.ticket]||i.bubbling){i.ticket&&this.pendingDelegations[i.ticket]&&delete this.pendingDelegations[i.ticket],l=v[i.inputType]?i.inputType:"*",y="*"===l,u=v[l]||this[l]||this["*"],m=a.state+"."+l,a.currentAction=m;var b=this.buildEventPayload(t,{inputType:i.inputType,delegated:i.delegated,ticket:i.ticket});u?(this.emit(p,b),"function"==typeof u?d=u.apply(this,this.getHandlerArgs(s,y)):(d=u,this.transition(t,u)),this.emit(f,b)):this.emit(h,e.extend({args:s},b)),a.priorAction=a.currentAction,a.currentAction=""}else i.ticket=i.ticket||x.createUUID(),i.delegated=!0,this.pendingDelegations[i.ticket]={delegatedTo:c.namespace},d=c.handle.apply(c,s);return d},transition:function(e,t){var n,r=this.ensureClientMeta(e),i=r.state,o=this.states[i],s=this.states[t];if(!r.inExitHandler&&t!==i){if(s){s._child&&(s._child=a(s._child),n=s._child&&s._child.instance),o&&o._onExit&&(r.inExitHandler=!0,o._onExit.call(this,e),r.inExitHandler=!1),o&&o._child&&o._child.instance&&this.hierarchy[o._child.instance.namespace]&&this.hierarchy[o._child.instance.namespace].off(),r.targetReplayState=t,r.priorState=i,r.state=t,n&&(this.hierarchy[n.namespace]=x.listenToChild(this,n));var l=this.buildEventPayload(e,{fromState:r.priorState,action:r.currentAction,toState:t});return this.emit(m,l),s._onEnter&&s._onEnter.call(this,e),n&&n.handle(e,"_reset"),void(r.targetReplayState===t&&this.processQueue(e,d))}this.emit(g,this.buildEventPayload(e,{state:r.state,attemptedState:t}))}},deferUntilTransition:function(e,t){var n=this.ensureClientMeta(e);if(n.currentActionArgs){var r={type:d,untilState:t,args:n.currentActionArgs};n.inputQueue.push(r);var i=this.buildEventPayload(e,{state:n.state,queuedArgs:r});this.emit(v,i)}},deferAndTransition:function(e,t){this.deferUntilTransition(e,t),this.transition(e,t)},processQueue:function(t){var n=this.ensureClientMeta(t),r=function(e){return!e.untilState||e.untilState===n.state},i=e.filter(n.inputQueue,r);n.inputQueue=e.difference(n.inputQueue,i),e.each(i,function(e){this.handle.apply(this,[t].concat(e.args))},this)},clearQueue:function(t,n){var r=this.ensureClientMeta(t);if(n){var i=function(e){return!n||e.untilState!==n};r.inputQueue=e.filter(r.inputQueue,i)}else r.inputQueue=[]},compositeState:function(e){var t=this.ensureClientMeta(e),n=t.state,r=this.states[n]._child&&this.states[n]._child.instance;return r&&(n+="."+r.compositeState(e)),n}},w),u.extend=_;var T={constructor:function(){u.apply(this,arguments),this.ensureClientMeta()},initClient:function(){var e=this.initialState;if(!e)throw new Error("You must specify an initial state for this FSM");if(!this.states[e])throw new Error("The initial state specified does not exist in the states object.");this.transition(e)},ensureClientMeta:function(){return this._stamped||(this._stamped=!0,e.defaults(this,e.cloneDeep(i())),this.initClient()),this},ensureClientArg:function(e){var t=e;return"object"!=typeof t[0]||"inputType"in t[0]||t[0]===this?("object"!=typeof t[0]||"object"==typeof t[0]&&"inputType"in t[0])&&t.unshift(this):t.splice(0,1,this),t},getHandlerArgs:function(e,t){var n=e,r=n[1];return"object"==typeof inputType&&n.splice(1,1,r.inputType),t?n.slice(1):n.slice(2)},buildEventPayload:function(){var t=this.ensureClientArg(x.getLeaklessArgs(arguments)),n=t[1];return e.isPlainObject(n)?e.extend(n,{namespace:this.namespace}):{data:n||null,namespace:this.namespace}}};e.each(["handle","transition","deferUntilTransition","processQueue","clearQueue"],function(e){T[e]=function(){var t=this.ensureClientArg(x.getLeaklessArgs(arguments));return u.prototype[e].apply(this,t)}}),T=u.extend(T);var S=e.merge(w,{Fsm:T,BehavioralFsm:u,utils:x,eventListeners:{newFsm:[]}});return S})},{lodash:6}],6:[function(e,t,n){t.exports=e(4)},{}],7:[function(e,t,n){"use strict";function r(e,t){g.async(e,t)}function i(){g.on.apply(g,arguments)}function o(){g.off.apply(g,arguments)}var a=e("./rsvp/promise").default,s=e("./rsvp/events").default,l=e("./rsvp/node").default,u=e("./rsvp/all").default,c=e("./rsvp/all-settled").default,d=e("./rsvp/race").default,p=e("./rsvp/hash").default,f=e("./rsvp/hash-settled").default,h=e("./rsvp/rethrow").default,m=e("./rsvp/defer").default,g=e("./rsvp/config").config,v=e("./rsvp/config").configure,y=e("./rsvp/map").default,b=e("./rsvp/resolve").default,_=e("./rsvp/reject").default,x=e("./rsvp/filter").default,w=e("./rsvp/asap").default;if(g.async=w,"undefined"!=typeof window&&"object"==typeof window.__PROMISE_INSTRUMENTATION__){var C=window.__PROMISE_INSTRUMENTATION__;v("instrument",!0);for(var T in C)C.hasOwnProperty(T)&&i(T,C[T])}n.Promise=a,n.EventTarget=s,n.all=u,n.allSettled=c,n.race=d,n.hash=p,n.hashSettled=f,n.rethrow=h,n.defer=m,n.denodeify=l,n.configure=v,n.on=i,n.off=o,n.resolve=b,n.reject=_,n.async=r,n.map=y,n.filter=x},{"./rsvp/all":10,"./rsvp/all-settled":9,"./rsvp/asap":11,"./rsvp/config":12,"./rsvp/defer":13,"./rsvp/events":15,"./rsvp/filter":16,"./rsvp/hash":18,"./rsvp/hash-settled":17,"./rsvp/map":20,"./rsvp/node":21,"./rsvp/promise":23,"./rsvp/race":29,"./rsvp/reject":30,"./rsvp/resolve":31,"./rsvp/rethrow":32}],8:[function(e,t,n){"use strict";function r(){}function i(e){try{return e.then}catch(e){return A.error=e,A}}function o(e,t,n,r){try{e.call(t,n,r)}catch(e){return e}}function a(e,t,n){w.async(function(e){var r=!1,i=o(n,t,function(n){r||(r=!0,t!==n?u(e,n):d(e,n))},function(t){r||(r=!0,p(e,t))},"Settle: "+(e._label||" unknown promise"));!r&&i&&(r=!0,p(e,i))},e)}function s(e,t){e._onerror=null,t._state===T?d(e,t._result):e._state===S?p(e,t._result):f(t,void 0,function(n){t!==n?u(e,n):d(e,n)},function(t){p(e,t)})}function l(e,t){if(t instanceof e.constructor)s(e,t);else{var n=i(t);n===A?p(e,A.error):void 0===n?d(e,t):_(n)?a(e,t,n):d(e,t)}}function u(e,t){e===t?d(e,t):b(t)?l(e,t):d(e,t)}function c(e){e._onerror&&e._onerror(e._result),h(e)}function d(e,t){e._state===C&&(e._result=t,e._state=T,0===e._subscribers.length?w.instrument&&x("fulfilled",e):w.async(h,e))}function p(e,t){e._state===C&&(e._state=S,e._result=t,w.async(c,e))}function f(e,t,n,r){var i=e._subscribers,o=i.length;e._onerror=null,i[o]=t,i[o+T]=n,i[o+S]=r,0===o&&e._state&&w.async(h,e)}function h(e){var t=e._subscribers,n=e._state;if(w.instrument&&x(n===T?"fulfilled":"rejected",e),0!==t.length){for(var r,i,o=e._result,a=0;a<t.length;a+=3)r=t[a],i=t[a+n],r?v(n,r,i,o):i(o);e._subscribers.length=0}}function m(){this.error=null}function g(e,t){try{return e(t)}catch(e){return k.error=e,k}}function v(e,t,n,r){var i,o,a,s,l=_(n);if(l){if(i=g(n,r),i===k?(s=!0,o=i.error,i=null):a=!0,t===i)return void p(t,new TypeError("A promises callback cannot return that same promise."))}else i=r,a=!0;t._state!==C||(l&&a?u(t,i):s?p(t,o):e===T?d(t,i):e===S&&p(t,i))}function y(e,t){try{t(function(t){u(e,t)},function(t){p(e,t)})}catch(t){p(e,t)}}var b=e("./utils").objectOrFunction,_=e("./utils").isFunction,x=(e("./utils").now,e("./instrument").default),w=e("./config").config,C=void 0,T=1,S=2,A=new m,k=new m;n.noop=r,n.resolve=u,n.reject=p,n.fulfill=d,n.subscribe=f,n.publish=h,n.publishRejection=c,n.initializePromise=y,n.invokeCallback=v,n.FULFILLED=T,n.REJECTED=S},{"./config":12,"./instrument":19,"./utils":33}],9:[function(e,t,n){"use strict";function r(e,t,n){this._superConstructor(e,t,!1,n)}var i=e("./enumerator").default,o=e("./enumerator").makeSettledResult,a=e("./promise").default,s=e("./utils").o_create;r.prototype=s(i.prototype),r.prototype._superConstructor=i,r.prototype._makeResult=o,r.prototype._validationError=function(){return new Error("allSettled must be called with an array")},n.default=function(e,t){return new r(a,e,t).promise}},{"./enumerator":14,"./promise":23,"./utils":33}],10:[function(e,t,n){"use strict";var r=e("./promise").default;n.default=function(e,t){return r.all(e,t)}},{"./promise":23}],11:[function(e,t,n){function r(){return function(){l.nextTick(s)}}function i(){var e=0,t=new p(s),n=document.createTextNode("");return t.observe(n,{characterData:!0}),function(){n.data=e=++e%2}}function o(){var e=new MessageChannel;return e.port1.onmessage=s,function(){e.port2.postMessage(0)}}function a(){return function(){setTimeout(s,1)}}function s(){for(var e=0;e<u;e+=2){var t=h[e],n=h[e+1];t(n),h[e]=void 0,h[e+1]=void 0}u=0}var l=e("__browserify_process"),u=0;n.default=function(e,t){h[u]=e,h[u+1]=t,u+=2,2===u&&c()};var c,d="undefined"!=typeof window?window:{},p=d.MutationObserver||d.WebKitMutationObserver,f="undefined"!=typeof Uint8ClampedArray&&"undefined"!=typeof importScripts&&"undefined"!=typeof MessageChannel,h=new Array(1e3);c="undefined"!=typeof l&&"[object process]"==={}.toString.call(l)?r():p?i():f?o():a()},{__browserify_process:2}],12:[function(e,t,n){"use strict";function r(e,t){return"onerror"===e?void o.on("error",t):2!==arguments.length?o[e]:void(o[e]=t)}var i=e("./events").default,o={instrument:!1};i.mixin(o),n.config=o,n.configure=r},{"./events":15}],13:[function(e,t,n){"use strict";var r=e("./promise").default;n.default=function(e){var t={};return t.promise=new r(function(e,n){t.resolve=e,t.reject=n},e),t}},{"./promise":23}],14:[function(e,t,n){"use strict";function r(e,t,n){return e===d?{state:"fulfilled",value:n}:{state:"rejected",reason:n}}function i(e,t,n,r){this._instanceConstructor=e,this.promise=new e(s,r),this._abortOnReject=n,this._validateInput(t)?(this._input=t,this.length=t.length,this._remaining=t.length,this._init(),0===this.length?u(this.promise,this._result):(this.length=this.length||0,this._enumerate(),0===this._remaining&&u(this.promise,this._result))):l(this.promise,this._validationError())}var o=e("./utils").isArray,a=e("./utils").isMaybeThenable,s=e("./-internal").noop,l=e("./-internal").reject,u=e("./-internal").fulfill,c=e("./-internal").subscribe,d=e("./-internal").FULFILLED,p=e("./-internal").REJECTED,f=e("./-internal").PENDING,h=!0;n.ABORT_ON_REJECTION=h,n.makeSettledResult=r,i.prototype._validateInput=function(e){
return o(e)},i.prototype._validationError=function(){return new Error("Array Methods must be provided an Array")},i.prototype._init=function(){this._result=new Array(this.length)},n.default=i,i.prototype._enumerate=function(){for(var e=this.length,t=this.promise,n=this._input,r=0;t._state===f&&r<e;r++)this._eachEntry(n[r],r)},i.prototype._eachEntry=function(e,t){var n=this._instanceConstructor;a(e)?e.constructor===n&&e._state!==f?(e._onerror=null,this._settledAt(e._state,t,e._result)):this._willSettleAt(n.resolve(e),t):(this._remaining--,this._result[t]=this._makeResult(d,t,e))},i.prototype._settledAt=function(e,t,n){var r=this.promise;r._state===f&&(this._remaining--,this._abortOnReject&&e===p?l(r,n):this._result[t]=this._makeResult(e,t,n)),0===this._remaining&&u(r,this._result)},i.prototype._makeResult=function(e,t,n){return n},i.prototype._willSettleAt=function(e,t){var n=this;c(e,void 0,function(e){n._settledAt(d,t,e)},function(e){n._settledAt(p,t,e)})}},{"./-internal":8,"./utils":33}],15:[function(e,t,n){"use strict";function r(e,t){for(var n=0,r=e.length;n<r;n++)if(e[n]===t)return n;return-1}function i(e){var t=e._promiseCallbacks;return t||(t=e._promiseCallbacks={}),t}n.default={mixin:function(e){return e.on=this.on,e.off=this.off,e.trigger=this.trigger,e._promiseCallbacks=void 0,e},on:function(e,t){var n,o=i(this);n=o[e],n||(n=o[e]=[]),r(n,t)===-1&&n.push(t)},off:function(e,t){var n,o,a=i(this);return t?(n=a[e],o=r(n,t),void(o!==-1&&n.splice(o,1))):void(a[e]=[])},trigger:function(e,t){var n,r,o=i(this);if(n=o[e])for(var a=0;a<n.length;a++)(r=n[a])(t)}}},{}],16:[function(e,t,n){"use strict";var r=e("./promise").default,i=e("./utils").isFunction;e("./utils").isMaybeThenable;n.default=function(e,t,n){return r.all(e,n).then(function(e){if(!i(t))throw new TypeError("You must pass a function as filter's second argument.");for(var o=e.length,a=new Array(o),s=0;s<o;s++)a[s]=t(e[s]);return r.all(a,n).then(function(t){for(var n=new Array(o),r=0,i=0;i<o;i++)t[i]&&(n[r]=e[i],r++);return n.length=r,n})})}},{"./promise":23,"./utils":33}],17:[function(e,t,n){"use strict";function r(e,t,n){this._superConstructor(e,t,!1,n)}var i=e("./promise").default,o=e("./enumerator").makeSettledResult,a=e("./promise-hash").default,s=e("./enumerator").default,l=e("./utils").o_create;r.prototype=l(a.prototype),r.prototype._superConstructor=s,r.prototype._makeResult=o,r.prototype._validationError=function(){return new Error("hashSettled must be called with an object")},n.default=function(e,t){return new r(i,e,t).promise}},{"./enumerator":14,"./promise":23,"./promise-hash":22,"./utils":33}],18:[function(e,t,n){"use strict";var r=e("./promise").default,i=e("./promise-hash").default;e("./enumerator").ABORT_ON_REJECTION;n.default=function(e,t){return new i(r,e,t).promise}},{"./enumerator":14,"./promise":23,"./promise-hash":22}],19:[function(e,t,n){"use strict";var r=e("./config").config,i=e("./utils").now,o=[];n.default=function(e,t,n){1===o.push({name:e,payload:{guid:t._guidKey+t._id,eventName:e,detail:t._result,childGuid:n&&t._guidKey+n._id,label:t._label,timeStamp:i(),stack:new Error(t._label).stack}})&&setTimeout(function(){for(var e,t=0;t<o.length;t++)e=o[t],r.trigger(e.name,e.payload);o.length=0},50)}},{"./config":12,"./utils":33}],20:[function(e,t,n){"use strict";var r=e("./promise").default,i=(e("./utils").isArray,e("./utils").isFunction);n.default=function(e,t,n){return r.all(e,n).then(function(e){if(!i(t))throw new TypeError("You must pass a function as map's second argument.");for(var o=e.length,a=new Array(o),s=0;s<o;s++)a[s]=t(e[s]);return r.all(a,n)})}},{"./promise":23,"./utils":33}],21:[function(e,t,n){"use strict";var r=e("./promise").default,i=e("./utils").isArray;n.default=function(e,t){function n(){for(var n=arguments.length,i=new Array(n),s=0;s<n;s++)i[s]=arguments[s];var l;return o||a||!t?l=this:("object"==typeof console&&console.warn('Deprecation: RSVP.denodeify() doesn\'t allow setting the "this" binding anymore. Use yourFunction.bind(yourThis) instead.'),l=t),r.all(i).then(function(n){function i(r,i){function s(){for(var e=arguments.length,n=new Array(e),s=0;s<e;s++)n[s]=arguments[s];var l=n[0],u=n[1];if(l)i(l);else if(o)r(n.slice(1));else if(a){var c,d,p={},f=n.slice(1);for(d=0;d<t.length;d++)c=t[d],p[c]=f[d];r(p)}else r(u)}n.push(s),e.apply(l,n)}return new r(i)})}var o=t===!0,a=i(t);return n.__proto__=e,n}},{"./promise":23,"./utils":33}],22:[function(e,t,n){"use strict";function r(e,t,n){this._superConstructor(e,t,!0,n)}var i=e("./enumerator").default,o=e("./-internal").PENDING,a=(e("./-internal").FULFILLED,e("./utils").o_create);n.default=r,r.prototype=a(i.prototype),r.prototype._superConstructor=i,r.prototype._init=function(){this._result={}},r.prototype._validateInput=function(e){return e&&"object"==typeof e},r.prototype._validationError=function(){return new Error("Promise.hash must be called with an object")},r.prototype._enumerate=function(){var e=this.promise,t=this._input,n=[];for(var r in t)e._state===o&&t.hasOwnProperty(r)&&n.push({position:r,entry:t[r]});var i=n.length;this._remaining=i;for(var a,s=0;e._state===o&&s<i;s++)a=n[s],this._eachEntry(a.entry,a.position)}},{"./-internal":8,"./enumerator":14,"./utils":33}],23:[function(e,t,n){"use strict";function r(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}function i(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")}function o(e,t){this._id=w++,this._label=t,this._subscribers=[],a.instrument&&s("created",this),c!==e&&(l(e)||r(),this instanceof o||i(),p(this,e))}var a=e("./config").config,s=(e("./events").default,e("./instrument").default),l=(e("./utils").objectOrFunction,e("./utils").isFunction),u=e("./utils").now,c=e("./-internal").noop,d=(e("./-internal").resolve,e("./-internal").reject,e("./-internal").fulfill,e("./-internal").subscribe),p=e("./-internal").initializePromise,f=e("./-internal").invokeCallback,h=e("./-internal").FULFILLED,m=e("./-internal").REJECTED,g=e("./promise/cast").default,v=e("./promise/all").default,y=e("./promise/race").default,b=e("./promise/resolve").default,_=e("./promise/reject").default,x="rsvp_"+u()+"-",w=0;n.default=o,o.cast=g,o.all=v,o.race=y,o.resolve=b,o.reject=_,o.prototype={constructor:o,_id:void 0,_guidKey:x,_label:void 0,_state:void 0,_result:void 0,_subscribers:void 0,_onerror:function(e){a.trigger("error",e)},then:function(e,t,n){var r=this,i=r._state;if(i===h&&!e||i===m&&!t)return a.instrument&&s("chained",this,this),this;r._onerror=null;var o=new this.constructor(c,n),l=r._result;if(a.instrument&&s("chained",r,o),i){var u=arguments[i-1];a.async(function(){f(i,o,u,l)})}else d(r,o,e,t);return o},catch:function(e,t){return this.then(null,e,t)},finally:function(e,t){var n=this.constructor;return this.then(function(t){return n.resolve(e()).then(function(){return t})},function(t){return n.resolve(e()).then(function(){throw t})},t)}}},{"./-internal":8,"./config":12,"./events":15,"./instrument":19,"./promise/all":24,"./promise/cast":25,"./promise/race":26,"./promise/reject":27,"./promise/resolve":28,"./utils":33}],24:[function(e,t,n){"use strict";var r=e("../enumerator").default;n.default=function(e,t){return new r(this,e,!0,t).promise}},{"../enumerator":14}],25:[function(e,t,n){"use strict";var r=e("./resolve").default;n.default=r},{"./resolve":28}],26:[function(e,t,n){"use strict";var r=e("../utils").isArray,i=(e("../utils").isFunction,e("../utils").isMaybeThenable,e("../-internal").noop),o=e("../-internal").resolve,a=e("../-internal").reject,s=e("../-internal").subscribe,l=e("../-internal").PENDING;n.default=function(e,t){function n(e){o(d,e)}function u(e){a(d,e)}var c=this,d=new c(i,t);if(!r(e))return a(d,new TypeError("You must pass an array to race.")),d;for(var p=e.length,f=0;d._state===l&&f<p;f++)s(c.resolve(e[f]),void 0,n,u);return d}},{"../-internal":8,"../utils":33}],27:[function(e,t,n){"use strict";var r=e("../-internal").noop,i=e("../-internal").reject;n.default=function(e,t){var n=this,o=new n(r,t);return i(o,e),o}},{"../-internal":8}],28:[function(e,t,n){"use strict";var r=e("../-internal").noop,i=e("../-internal").resolve;n.default=function(e,t){var n=this;if(e&&"object"==typeof e&&e.constructor===n)return e;var o=new n(r,t);return i(o,e),o}},{"../-internal":8}],29:[function(e,t,n){"use strict";var r=e("./promise").default;n.default=function(e,t){return r.race(e,t)}},{"./promise":23}],30:[function(e,t,n){"use strict";var r=e("./promise").default;n.default=function(e,t){return r.reject(e,t)}},{"./promise":23}],31:[function(e,t,n){"use strict";var r=e("./promise").default;n.default=function(e,t){return r.resolve(e,t)}},{"./promise":23}],32:[function(e,t,n){"use strict";n.default=function(e){throw setTimeout(function(){throw e}),e}},{}],33:[function(e,t,n){"use strict";function r(e){return"function"==typeof e||"object"==typeof e&&null!==e}function i(e){return"function"==typeof e}function o(e){return"object"==typeof e&&null!==e}n.objectOrFunction=r,n.isFunction=i,n.isMaybeThenable=o;var a;a=Array.isArray?Array.isArray:function(e){return"[object Array]"===Object.prototype.toString.call(e)};var s=a;n.isArray=s;var l=Date.now||function(){return(new Date).getTime()};n.now=l;var u=Object.create||function(e){var t=function(){};return t.prototype=e,t};n.o_create=u},{}]},{},[1])(1)}),define("models/dual-sensor-connector/units-definition",[],function(){return{units:{time:{name:"second",pluralName:"seconds",symbol:"s"}}}}),define("models/sensor-common/i18n-sensor-definitions-connector",[],function(){return function(e){return{lux:{sensorName:e.t("sensor.names.light"),measurementName:e.t("sensor.measurements.light_level"),measurementType:"light level",tareable:!0,minReading:0,maxReading:2e3},m:{sensorName:e.t("sensor.names.motion"),measurementName:e.t("sensor.measurements.position"),measurementType:"position",tareable:!0,minReading:-2,maxReading:2},"m/s²":{sensorName:e.t("sensor.names.accelerometer"),measurementName:e.t("sensor.measurements.acceleration"),measurementType:"acceleration",tareable:!0,minReading:-50,maxReading:50},"m/s^2":{sensorName:e.t("sensor.names.accelerometer"),measurementName:e.t("sensor.measurements.acceleration"),measurementType:"acceleration",tareable:!0,minReading:-50,maxReading:50},g:{sensorName:e.t("sensor.names.accelerometer"),measurementName:e.t("sensor.measurements.acceleration"),measurementType:"acceleration",tareable:!0,minReading:-5,maxReading:5},"N/kg":{sensorName:e.t("sensor.names.accelerometer"),measurementName:e.t("sensor.measurements.acceleration"),measurementType:"acceleration",tareable:!0,minReading:-25,maxReading:25},"mg/L":{sensorName:e.t("sensor.names.dissolved_oxygen"),measurementName:e.t("sensor.measurements.dissolved_oxygen"),measurementType:"do",tareable:!0,minReading:0,maxReading:12},kPa:{sensorName:e.t("sensor.names.pressure"),measurementName:e.t("sensor.measurements.pressure"),measurementType:"pressure",tareable:!0,minReading:0,maxReading:220},"mm Hg":{sensorName:e.t("sensor.names.pressure"),measurementName:e.t("sensor.measurements.pressure"),measurementType:"pressure",tareable:!0,minReading:0,maxReading:2e3},"in Hg":{sensorName:e.t("sensor.names.pressure"),measurementName:e.t("sensor.measurements.pressure"),measurementType:"pressure",tareable:!0,minReading:0,maxReading:80},mbar:{sensorName:e.t("sensor.names.pressure"),measurementName:e.t("sensor.measurements.pressure"),measurementType:"pressure",tareable:!0,minReading:0,maxReading:2200},psi:{sensorName:e.t("sensor.names.pressure"),measurementName:e.t("sensor.measurements.pressure"),measurementType:"pressure",tareable:!0,minReading:0,maxReading:40},atm:{sensorName:e.t("sensor.names.pressure"),measurementName:e.t("sensor.measurements.pressure"),measurementType:"pressure",tareable:!0,minReading:0,maxReading:2.5},torr:{sensorName:e.t("sensor.names.pressure"),measurementName:e.t("sensor.measurements.pressure"),measurementType:"pressure",tareable:!0,minReading:0,maxReading:2e3},nC:{sensorName:e.t("sensor.names.charge_sensor"),measurementName:e.t("sensor.measurements.charge"),measurementType:"charge",tareable:!1,minReading:-20,maxReading:20},V:{sensorName:e.t("sensor.names.voltage"),measurementName:e.t("sensor.measurements.potential"),measurementType:"potential",tareable:!0,minReading:-30,maxReading:30},pH:{sensorName:e.t("sensor.names.pH"),measurementName:e.t("sensor.measurements.pH"),measurementType:"ph",tareable:!1,minReading:0,maxReading:14},ppm:{sensorName:e.t("sensor.names.CO2_gas"),measurementName:e.t("sensor.measurements.CO2"),measurementType:"co2",tareable:!1,minReading:0,maxReading:5e3},ppt:{sensorName:e.t("sensor.names.CO2_gas"),measurementName:e.t("sensor.measurements.CO2"),measurementType:"co2",tareable:!1,minReading:0,maxReading:5},"%":{sensorName:e.t("sensor.names.CO2_gas"),measurementName:e.t("sensor.measurements.CO2"),measurementType:"co2",tareable:!1,minReading:0,maxReading:.5},"%T":{sensorName:e.t("sensor.names.colorimeter"),measurementName:e.t("sensor.measurements.transmittance"),measurementType:"transmittance",tareable:!1,minReading:0,maxReading:100},"µS/cm":{sensorName:e.t("sensor.names.conductivity"),measurementName:e.t("sensor.measurements.conductivity"),measurementType:"conductivity",tareable:!0,minReading:0,maxReading:2e3},"dS/m":{sensorName:e.t("sensor.names.conductivity"),measurementName:e.t("sensor.measurements.conductivity"),measurementType:"conductivity",tareable:!0,minReading:0,maxReading:2},A:{sensorName:e.t("sensor.names.current"),measurementName:e.t("sensor.measurements.current"),measurementType:"current",tareable:!0,minReading:-1.2,maxReading:1.2},mA:{sensorName:e.t("sensor.names.current"),measurementName:e.t("sensor.measurements.current"),measurementType:"current",tareable:!0,minReading:0,maxReading:500},"°C":{sensorName:e.t("sensor.names.temperature"),measurementName:e.t("sensor.measurements.temperature"),measurementType:"temperature",tareable:!1,minReading:0,maxReading:40},degC:{sensorName:e.t("sensor.names.temperature"),measurementName:e.t("sensor.measurements.temperature"),measurementType:"temperature",tareable:!1,minReading:0,maxReading:40},"°F":{sensorName:e.t("sensor.names.temperature"),measurementName:e.t("sensor.measurements.temperature"),measurementType:"temperature",tareable:!1,minReading:30,maxReading:100},degF:{sensorName:e.t("sensor.names.temperature"),measurementName:e.t("sensor.measurements.temperature"),measurementType:"temperature",tareable:!1,minReading:30,maxReading:100},K:{sensorName:e.t("sensor.names.temperature"),measurementName:e.t("sensor.measurements.temperature"),measurementType:"temperature",tareable:!1,minReading:250,maxReading:400},N:{sensorName:e.t("sensor.names.force"),measurementName:e.t("sensor.measurements.force"),measurementType:"force",tareable:!0,minReading:-50,maxReading:50},lb:{sensorName:e.t("sensor.names.force"),measurementName:e.t("sensor.measurements.force"),measurementType:"force",tareable:!0,minReading:-12.5,maxReading:12.5},mV:{sensorName:null,measurementName:e.t("sensor.measurements.potential"),measurementType:"potential",tareable:!0,minReading:-500,maxReading:1100},"m/s":{sensorName:e.t("sensor.names.motion"),measurementName:e.t("sensor.measurements.velocity"),measurementType:"velocity",tareable:!0,minReading:-5,maxReading:5},"ft/s":{sensorName:e.t("sensor.names.anemometer"),measurementName:e.t("sensor.measurements.speed"),measurementType:"speed",tareable:!0,minReading:0,maxReading:100},ft:{sensorName:e.t("sensor.names.motion"),measurementName:e.t("sensor.measurements.position"),measurementType:"position",tareable:!0,minReading:0,maxReading:6},kg:{sensorName:e.t("sensor.names.hand_dynamometer"),measurementName:e.t("sensor.measurements.force"),measurementType:"force",tareable:!0,minReading:0,maxReading:50},v:{sensorName:e.t("sensor.names.heart_rate"),measurementName:e.t("sensor.measurements.signal"),measurementType:"signal",tareable:!1,minReading:0,maxReading:3},mT:{sensorName:e.t("sensor.names.magnetic_field"),measurementName:e.t("sensor.measurements.magnetic_field"),measurementType:"magnetic field",tareable:!0,minReading:-8,maxReading:8},G:{sensorName:e.t("sensor.names.magnetic_field"),measurementName:e.t("sensor.measurements.magnetic_field"),measurementType:"magnetic field",tareable:!0,minReading:-80,maxReading:80},rad:{sensorName:e.t("sensor.names.rotary_motion"),measurementName:e.t("sensor.measurements.angle"),measurementType:"angle",tareable:!0,minReading:-15,maxReading:15},"°":{sensorName:e.t("sensor.names.rotary_motion"),measurementName:e.t("sensor.measurements.angle"),measurementType:"angle",tareable:!0,minReading:-1e3,maxReading:1e3},cm:{sensorName:e.t("sensor.names.linear_position_sensor"),measurementName:e.t("sensor.measurements.position"),measurementType:"position",tareable:!0,minReading:0,maxReading:15},dB:{sensorName:e.t("sensor.names.sound_level"),measurementName:e.t("sensor.measurements.sound_level"),measurementType:"sound level",tareable:!0,minReading:40,maxReading:110},dbA:{sensorName:e.t("sensor.names.sound_level"),measurementName:e.t("sensor.measurements.sound_level"),measurementType:"sound level",tareable:!0,minReading:40,maxReading:110},rel:{sensorName:e.t("sensor.names.spectrophotometer"),measurementName:e.t("sensor.measurements.intensity"),measurementType:"intensity",tareable:!1,minReading:0,maxReading:1},Rel:{sensorName:e.t("sensor.names.spectrophotometer"),measurementName:e.t("sensor.measurements.fluorescence_405_nm"),measurementType:"fluorescence 405 nm",tareable:!1,minReading:0,maxReading:1},"Rel.":{sensorName:e.t("sensor.names.spectrophotometer"),measurementName:e.t("sensor.measurements.fluorescence_500_nm"),measurementType:"fluorescence 500 nm",tareable:!1,minReading:0,maxReading:1},"L/s":{sensorName:e.t("sensor.names.spirometer"),measurementName:e.t("sensor.measurements.flow_rate"),measurementType:"flow rate",tareable:!0,minReading:-4,maxReading:4},"mL/s":{sensorName:e.t("sensor.names.spirometer"),measurementName:e.t("sensor.measurements.flow_rate"),measurementType:"flow rate",tareable:!0,minReading:-4e3,maxReading:4e3},NTU:{sensorName:e.t("sensor.names.turbidity"),measurementName:e.t("sensor.measurements.turbidity"),measurementType:"turbidity",tareable:!0,minReading:0,maxReading:50},"mW/m²":{sensorName:e.t("sensor.names.UV_sensor"),measurementName:e.t("sensor.measurements.UV_intensity"),measurementType:"uv intensity",tareable:!0,minReading:0,maxReading:2e4},mL:{sensorName:e.t("sensor.names.drop_counter"),measurementName:e.t("sensor.measurements.volume"),measurementType:"volume",tareable:!1,minReading:0,maxReading:3},f:{sensorName:e.t("sensor.names.altitude"),measurementName:e.t("sensor.measurements.altitude"),measurementType:"altitude",tareable:!0,minReading:-300,maxReading:300},mph:{sensorName:e.t("sensor.names.anemometer"),measurementName:e.t("sensor.measurements.speed"),measurementType:"speed",tareable:!0,minReading:0,maxReading:10},"km/h":{sensorName:e.t("sensor.names.anemometer"),measurementName:e.t("sensor.measurements.speed"),measurementType:"speed",tareable:!0,minReading:0,maxReading:20},knots:{sensorName:e.t("sensor.names.anemometer"),measurementName:e.t("sensor.measurements.speed"),measurementType:"speed",tareable:!0,minReading:0,maxReading:50}}}}),define("models/dual-sensor-connector/modeler",["require","common/lab-modeler-mixin","common/property-description","./metadata","common/state-machine","sensor-connector-interface","./units-definition","models/sensor-common/i18n-sensor-definitions-connector","models/sensor-common/notifier"],function(e){var t=e("common/lab-modeler-mixin"),n=e("common/property-description"),r=e("./metadata"),i=e("common/state-machine"),o=e("sensor-connector-interface"),a=e("./units-definition"),s=e("models/sensor-common/i18n-sensor-definitions-connector"),l=e("models/sensor-common/notifier");return function(e,u){function c(e,t,r){var i,o;i=ne.getPropertyDescription(e).getHash(),i.min=t,i.max=r,o=new n(a,i),S.setPropertyDescription(e,o)}function d(){null!==ne.properties.actualDuration&&ne.properties.actualDuration!==1/0&&c("displayTime",0,ne.properties.actualDuration)}function p(){var e,t;O?(e=ae[O.units],e?(t={label:e.measurementName,format:".2f",min:e.minReading,max:e.maxReading},a.units[e.measurementType]?t.unitType=e.measurementType:t.unitAbbreviation=O.units,Q=e.tareable,R=e.sensorName||O.units+" "+re.t("sensor.names.sensor")):(t={label:O.name||re.t("sensor.measurements.sensor_reading"),unitAbbreviation:O.units,format:".2f",min:0,max:10},Q=!0,R=O.units+" "+re.t("sensor.names.sensor"))):(t=oe,Q=!1,R=re.t("sensor.names.no_sensor")),S.setPropertyDescription("sensorReading",new n(a,t)),S.setPropertyDescription("liveSensorReading",new n(a,t))}function f(){var e,t;M?(e=ae[M.units],e?(t={label:e.measurementName,format:".2f",min:e.minReading,max:e.maxReading},a.units[e.measurementType]?t.unitType=e.measurementType:t.unitAbbreviation=M.units,K=e.tareable,I=e.sensorName||O.units+" "+re.t("sensor.names.sensor")):(t={label:M.name||re.t("sensor.measurements.sensor_reading"),unitAbbreviation:M.units,format:".2f",min:0,max:10},K=!0,I=M.units+" "+re.t("sensor.names.sensor"))):(t=oe,K=!1,I=re.t("sensor.names.no_sensor")),S.setPropertyDescription("sensorReading2",new n(a,t)),S.setPropertyDescription("liveSensorReading2",new n(a,t))}function h(){D=!0,Y=P.canControl,X=!1,"undefined"!=typeof L&&null!==L||(L={index:1}),"undefined"!=typeof N&&null!==N||(N={index:2}),U=0,V=0,ee=0,j=void 0,F=void 0,z=void 0,G=void 0,E=void 0,O=void 0,M=void 0}function m(e,t){var n=e.columns[t];return!(!n||n.units!==L.units)&&(L.index=t,!0)}function g(e,t){var n=e.columns[t];return!(!n||n.units!==N.units)&&(N.index=t,!0)}function v(e){return!(e.columns.length<2)&&!(2===e.columns.length&&!e.columns[1].name&&!e.columns[1].units)}function y(){var e,t,n,r=P.datasets[0];X=r.columns.length>2,E=r.columns[0],P.hasAttachedInterface?(v(r)&&X?(J=Y?re.t("sensor.messages.ready"):P.inControl.clientName?re.t("sensor.messages.ready_nocontrol",{controlling_client:P.inControl.clientName}):re.t("sensor.messages.ready_nocontrol_noname"),q=!0):(J=re.t("sensor.messages.no_sensors"),q=!1),n=L.index,n>=r.columns.length&&r.columns.length>1&&(n=r.columns.length-1),e=r.columns[n],e&&L.units&&e.units!==L.units&&(m(r,n+1)?e=r.columns[n+1]:n>1&&m(r,n-1)?e=r.columns[n-1]:(e=r.columns[1],L.index=1)),n=N.index,n>=r.columns.length&&r.columns.length>2&&(n=r.columns.length-1),t=r.columns[n],t&&N.units&&t.units!==N.units&&(g(r,n+1)?t=r.columns[n+1]:n>1&&g(r,n-1)?t=r.columns[n-1]:(t=r.columns[2],N.index=2))):(J=re.t("sensor.messages.no_devices"),q=!1),!e||e.name||e.units||(e=null),!t||t.name||t.units||(t=null),O=e,O&&(L.units=O.units),p(),M=t,M&&(N.units=M.units),f(),O||(z=void 0),M||(G=void 0)}function b(){if(E&&O&&M)for(var e=Math.min(Math.min(E.data.length,O.data.length),M.data.length);U<e;U++)V=E.data[U],V>ne.properties.actualDuration&&ne.stop(),j=O.data[U],F=M.data[U],ne.updateAllOutputProperties(),A.tick()}function _(e){return e.receivedValuesTimeStamp>=e.requestedValuesTimeStamp}function x(){return _(E)&&(!O||_(O))&&(!M||_(M))}function w(){var e,t=[],n=P.datasets[0];for(e=0;e<n.columns.length;e++)t.push({units:n.columns[e].units,name:n.columns[e].name});return t}function C(e){var t=Array.prototype.slice.call(arguments,0);ne.makeInvalidatingChange(function(){var n=k.handleEvent.apply(k,t);n||("connectionTimedOut"===e?k.gotoState("disconnected"):"sessionChanged"===e?(P.stopPolling(),k.gotoState("disconnected")):"statusErrored"===e&&k.gotoState("initialConnectionFailure"))})}var T,S,A,k,P,E,O,M,L,N,R,I,D,B,V,j,F,z,G,U,q,H,W,Y,X,Q,K,J,Z,ee,te,ne,re=u.i18n,ie=new l(re),oe={label:re.t("sensor.measurements.sensor_reading"),unitAbbreviation:"-",format:".2f",min:0,max:10},ae=s(re);return ne={on:function(e,t){A.on(e,t)},start:function(){C("start")},stop:function(){C("stop")},tare:function(){var e=q;q=!1,C("tare"),q=e},tare2:function(){var e=q;q=!1,C("tare2"),q=e},willReset:function(){A.willReset()},reset:function(){C("reset")},reload:function(){ne.stop(),ne.makeInvalidatingChange(function(){B=!0})},isStopped:function(){return D},stepCounter:function(){return U},connectedSensors:w,getSelectedSensor:function(){return L.index},getSelectedSensor2:function(){return N.index},setSelectedSensor:function(e){L.index!==e&&(L.index=e,L.units=null,ne.properties.tareValue=0,y())},setSelectedSensor2:function(e){N.index!==e&&(N.index=e,N.units=null,ne.properties.tareValue2=0,y())},serialize:function(){return""}},k=new i({notConnected:{enterState:function(){J=re.t("sensor.messages.not_connected"),ee=0,"https:"===location.protocol?P.startPolling(["https://localhost:11181","https://127.0.0.1:11181","https://localhost.ungerdesign.com:11181"],ne.properties.clientId,ne.properties.clientName):P.startPolling("http://127.0.0.1:11180",ne.properties.clientId,ne.properties.clientName),this.gotoState("connecting")}},connecting:{enterState:function(){J=re.t("sensor.messages.connecting"),P.isConnected?this.gotoState("connected"):Z=ie.status(re.t("sensor.messages.connection_in_progress"),{dialogClass:"interactive-dialog no-close"})},leaveState:function(){Z&&(Z.close(),Z=null)},statusErrored:function(){this.gotoState("initialConnectionFailure")},connectionTimedOut:function(){this.gotoState("initialConnectionFailure")},launchTimedOut:function(){this.gotoState("initialConnectionFailure")},statusReceived:function(){this.gotoState("connected")},sessionChanged:function(){P.stopPolling(),P.startPolling()}},initialConnectionFailure:{enterState:function(){P.stopPolling(),J=re.t("sensor.messages.connection_failed",{retry_link:""});var e="sensor.messages.connection_failed_alert";ie.alert(re.t(e,{click_here_link:"<a target='_blank' style='color: #222299;' href='http://sensorconnector.concord.org/'>"+re.t("sensor.messages.click_here")+"</a>"}),{"Try again":function(){$(this).dialog("close"),C("dismiss")}},{close:function(){C("closed")}})},statusErrored:function(){},connectionTimedOut:function(){},launchTimedOut:function(){},closed:function(){J=re.t("sensor.messages.connection_failed",{retry_link:"<a href='javascript:void(0);' class='retry-link'>"+re.t("sensor.messages.connection_failed_retry_link_text")+"</a>"});var e=function(){var t=$("a.retry-link");t[0]?t.click(function(){C("dismiss")}):setTimeout(e,50)};e()},dismiss:function(){this.gotoState("notConnected")}},connected:{enterState:function(){J=re.t("sensor.messages.connected"),H=!0,W=!0,q=!0,D=!0,y(),Y?this.controlEnabled():this.controlDisabled(),P.isCollecting&&this.gotoState("started")},leaveState:function(){H=!1,W=!1,q=!1},columnAdded:y,columnRemoved:y,columnTypeChanged:y,columnMoved:y,interfaceConnected:y,interfaceRemoved:y,tare:function(){O&&(ne.properties.tareValue=O.liveValue)},tare2:function(){M&&(ne.properties.tareValue2=M.liveValue)},start:function(){P.requestStart().catch(function(){C("startRequestFailed")}),this.gotoState("starting")},controlEnabled:function(){J=re.t("sensor.messages.connected")},controlDisabled:function(){J=P.inControl.clientName?re.t("sensor.messages.connected_start_sensorconnector",{controlling_client:P.inControl.clientName}):re.t("sensor.messages.connected_start_sensorconnector_noname")},sessionChanged:function(){P.stopPolling(),P.startPolling(),this.gotoState("connecting")},collectionStarted:function(){this.gotoState("started")}},starting:{enterState:function(){J=re.t("sensor.messages.starting_data_collection"),D=!1;var e=this;this._startTimerId=setTimeout(5e3,function(){e.gotoState("startRequestFailed")})},leaveState:function(){clearTimeout(this._startTimerId)},startRequestFailed:function(){this.gotoState("errorStarting")},collectionStarted:function(){this.gotoState("started")}},errorStarting:{enterState:function(){J=re.t("sensor.messages.error_starting_data_collection"),D=!0,ie.alert(re.t("sensor.messages.error_starting_data_collection_alert"),{OK:function(){$(this).dialog("close"),C("dismissErrorStarting")}})},collectionStarted:function(){this.gotoState("started")},dismissErrorStarting:function(){this.gotoState("connected")}},started:{enterState:function(){D=!1,y(),q=!1,J=Y?re.t("sensor.messages.collecting_data"):re.t("sensor.messages.collecting_data_stop_sensorconnector"),P.isCollecting||this.gotoState("stopped"),O&&M||this.gotoState("startedWithNoDataColumn")},data:b,controlEnabled:function(){J=re.t("sensor.messages.collecting_data")},controlDisabled:function(){J=re.t("sensor.messages.collecting_data_stop_sensorconnector")},stop:function(){P.requestStop().catch(function(){C("stopRequestFailed")}),this.gotoState("stopping")},collectionStopped:function(){this.gotoState("collectionStopped")}},startedWithNoDataColumn:{enterState:function(){J=re.t("sensor.messages.no_data"),P.requestStop(),ie.alert(re.t("sensor.messages.no_data_alert"),{OK:function(){$(this).dialog("close")}})},collectionStopped:function(){this.gotoState("stoppedWithNoDataColumn")}},stoppedWithNoDataColumn:{enterState:function(){x()&&this.gotoState("connected")},data:function(){x()&&this.gotoState("connected")}},stopping:{enterState:function(){J=re.t("sensor.messages.stopping_data_collection")},data:b,stopRequestFailed:function(){this.gotoState("errorStopping")},collectionStopped:function(){this.gotoState("collectionStopped")}},errorStopping:{enterState:function(){J=re.t("sensor.messages.error_stopping_data_collection"),ie.alert(re.t("sensor.messages.error_stopping_data_collection_alert"),{OK:function(){$(this).dialog("close"),C("dismissErrorStopping")}})},data:b,collectionStopped:function(){this.gotoState("collectionStopped")},dismissErrorStopping:function(){this.gotoState("started")}},collectionStopped:{enterState:function(){J=re.t("sensor.messages.data_collection_stopped"),x()&&this.gotoState("collectionComplete")},data:function(){b(),x()&&this.gotoState("collectionComplete")}},collectionComplete:{enterState:function(){J=re.t("sensor.messages.data_collection_complete"),D=!0,A.stop()},reset:function(){h(),p(),f(),this.gotoState("connecting"),A.reset()}},disconnected:{enterState:function(){J=re.t("sensor.messages.disconnected"),P.stopPolling();var e=this;setTimeout(function(){e.gotoState("notConnected")},2e3)}}}),P=new o,P.on("*",function(){var e=Array.prototype.slice.call(arguments,0);C.apply(null,[this.event].concat(e))}),P.on("statusReceived",function(){O&&ne.makeInvalidatingChange(function(){z=O.liveValue}),M&&ne.makeInvalidatingChange(function(){G=M.liveValue})}),P.on("controlEnabled",function(){Y=!0}),P.on("controlDisabled",function(){Y=!1}),T=new t({metadata:r,setters:{},unitsDefinition:a,initialProperties:e,usePlaybackSupport:!1}),S=T.propertySupport,A=T.dispatchSupport,A.addEventTypes("tick","play","stop","tickStart","tickEnd"),T.mixInto(ne),h(),ne.properties.useRandomClientId&&(ne.properties.clientId=Math.floor(4294967296*(1+Math.random())).toString(16)),ne.addObserver("clientName",function(){P.clientName=ne.properties.clientName}),ne.defineOutput("time",{label:re.t("sensor.measurements.time"),unitType:"time",format:".2f"},function(){return V}),ne.defineOutput("displayTime",{label:re.t("sensor.measurements.time"),unitType:"time",format:".2f"},function(){return V}),te=ne.getPropertyDescription("displayTime"),ne.defineOutput("sensorReading",oe,function(){return null==j?j:j-ne.properties.tareValue}),ne.defineOutput("sensorReading2",oe,function(){return null==F?F:F-ne.properties.tareValue2}),ne.defineOutput("durationOptions",{},function(){return[1,5,10,15,20,30,45,60]}),ne.formatTime=function(e){return te.format(e)},ne.defineOutput("actualUseDuration",{},T.computeActualUseDuration),ne.defineOutput("actualDuration",{label:"Experiment duration",unitType:"time",format:"f"},T.computeActualDuration),ne.defineOutput("liveSensorReading",oe,function(){return null==z?z:z-ne.properties.tareValue}),ne.defineOutput("liveSensorReading2",oe,function(){return null==G?G:G-ne.properties.tareValue2}),ne.defineOutput("sensorName",{label:"Sensor Name"},function(){return R}),ne.defineOutput("sensorName2",{label:"2nd Sensor Name"},function(){return I}),ne.defineOutput("isStopped",{
label:"Stopped?"},function(){return D}),ne.defineOutput("isPlayable",{label:"Startable?"},function(){return q}),ne.defineOutput("hasPlayed",{label:"Has successfully collected data?"},function(){return U>0}),ne.defineOutput("canTare",{label:"Can set a tare value?"},function(){return H&&Q}),ne.defineOutput("canTare2",{label:"Can set a tare value?"},function(){return W&&K}),ne.defineOutput("canControl",{label:"Can remotely start/stop the Sensor Connector?"},function(){return Y}),ne.defineOutput("hasMultipleSensors",{label:"Are multiple sensors connected to the Sensor Connector?"},function(){return X}),ne.defineOutput("needsReload",{label:"Needs Reload?"},function(){return B}),ne.defineOutput("message",{label:"User Message"},function(){return J}),ne.on("willReset.model",function(){P.stopPolling(),P.isCollecting&&P.requestStop()}),ne.addObserver("actualDuration",d),d(),ne.updateAllOutputProperties(),k.gotoState("notConnected"),ne}}),define("models/dual-sensor-connector/view",["require","common/views/numeric-output-view","common/controllers/basic-dialog","models/sensor-common/i18n-sensor-definitions-connector","common/views/view-state"],function(e){var t=e("common/views/numeric-output-view"),n=e("common/controllers/basic-dialog"),r=e("models/sensor-common/i18n-sensor-definitions-connector"),i=e("common/views/view-state");return function(e,o,a){function s(){e.properties.canTare?i.enableView(y.$zeroButton):i.disableView(y.$zeroButton)}function l(){e.properties.canTare2?i.enableView(y.$zeroButton2):i.disableView(y.$zeroButton2)}function u(){}function c(){e.properties.hasMultipleSensors&&e.properties.isPlayable?(i.enableView(y.$selectSensorButton),i.enableView(y.$selectSensorButton2)):(i.disableView(y.$selectSensorButton),i.disableView(y.$selectSensorButton2))}function d(){y.$message.html(e.properties.message)}function p(){e.addObserver("canTare",s),e.addObserver("canTare2",l),s(),l(),e.addObserver("canConnect",u),u(),e.addObserver("hasMultipleSensors",c),e.addObserver("isPlayable",c),c(),e.addObserver("message",d),d()}function f(){m(!1)}function h(){m(!0)}function m(t){t=t||!1;var r,i,o,s=new n({width:"60%",dialogClass:"interactive-dialog no-close",closeOnEscape:!1,title:a.t("sensor.choose_sensor_title"),buttons:{OK:function(){console.log("OK Clicked"),$(this).dialog("close"),t?e.setSelectedSensor2($(this).find("input:checked").val()):e.setSelectedSensor($(this).find("input:checked").val())},Cancel:function(){console.log("Cancel Clicked"),$(this).dialog("close")}}},a),l="",u="",c=e.connectedSensors(),d=!0,p=t?e.getSelectedSensor2():e.getSelectedSensor();for(r=0;r<c.length;r++)"s"!==c[r].units&&(i="",c[r].name?o={measurementName:c[r].name}:(o=_[c[r].units],o||(o={measurementName:"Unknown"})),u=o.measurementName+" ("+c[r].units+")",(p==r||d&&p==-1)&&(i="checked "),l+="<input type='radio' name='selected-sensor-index' value='"+r+"' "+i+"/>"+u+"<br/>",d=!1);s.setContent(l),s.open()}var g,v,y,b=d3.format(".2f"),_=r(a);return y={$el:$("<div id='model-container' class='container sensor-model-container' />"),remoteAddress:null,bindModel:function(t,n){o=n||o,e=t||e,p()},getHeightForWidth:function(){return"2.8em"},setup:function(){y.$el.empty(),y.$controlsContainer=$("<div></div>"),y.$statusContainer=$("<div></div>"),g=new t({id:"sensor-value-view",label:a.t("sensor.reading"),units:e.getPropertyDescription("sensorReading").getUnitAbbreviation()}),v=new t({id:"sensor-value-view-2",label:a.t("sensor.reading"),units:e.getPropertyDescription("sensorReading2").getUnitAbbreviation()}),y.$zeroButton=$("<div class='interactive-button'><button>"+a.t("sensor.zero")+"</button></div>"),y.$zeroButton2=$("<div class='interactive-button'><button>"+a.t("sensor.zero")+"</button></div>"),y.$selectSensorButton=$("<div class='interactive-button'><button>"+a.t("sensor.select_sensor")+"</button></div>"),y.$selectSensorButton2=$("<div class='interactive-button'><button>"+a.t("sensor.select_sensor")+"</button></div>"),y.$message=$("<div class='message'></div>"),y.$sensorReading=g.render().addClass("horizontal"),y.$sensorReading2=v.render().addClass("horizontal"),y.$controlsContainer.append(y.$sensorReading).append(y.$zeroButton).append(y.$selectSensorButton).append(y.$sensorReading2).append(y.$zeroButton2).append(y.$selectSensorButton2),y.$statusContainer.append(y.$message),y.$el.css("zIndex",4).append(y.$controlsContainer).append(y.$statusContainer),y.$controlsContainer.find("div").addClass("component component-spacing"),y.$statusContainer.find("div").addClass("component component-spacing"),g.resize(),v.resize(),p(),y.$zeroButton.on("click","button",e.tare),y.$zeroButton2.on("click","button",e.tare2),y.$selectSensorButton.on("click","button",f),y.$selectSensorButton2.on("click","button",h)},resize:function(){g&&g.resize(),v&&v.resize()},repaint:function(){},setFocus:function(){},updateUnits:function(t){g.updateUnits(t),null==e.properties.liveSensorReading&&g.hideUnits()},updateUnits2:function(t){v.updateUnits(t),null==e.properties.liveSensorReading2&&v.hideUnits()},update:function(){null==e.properties.liveSensorReading?(g.update(""),g.hideUnits()):(g.update(b(e.properties.liveSensorReading)),g.showUnits()),null==e.properties.liveSensorReading2?(v.update(""),v.hideUnits()):(v.update(b(e.properties.liveSensorReading2)),v.showUnits())}}}}),define("models/dual-sensor-connector/scripting-api",[],function(){return function(e){return{resetModel:function(t){e.intController.resetModel(t)}}}}),define("models/dual-sensor-connector/controller",["require","common/controllers/model-controller","./modeler","./view","./scripting-api"],function(e){var t=e("common/controllers/model-controller"),n=e("./modeler"),r=e("./view"),i=e("./scripting-api");return function(e,o,a){function s(){var e=l.model;e.addObserver("liveSensorReading",function(){l.updateView()}),e.addObserver("liveSensorReading2",function(){l.updateView()}),e.addObserver("needsReload",function(){e.properties.needsReload&&a.reloadModel()}),e.addPropertyDescriptionObserver("sensorReading",function(){var t=e.getPropertyDescription("sensorReading"),n=l.modelContainer;n.updateUnits(t.getUnitAbbreviation())}),e.addPropertyDescriptionObserver("sensorReading2",function(){var t=e.getPropertyDescription("sensorReading2"),n=l.modelContainer;n.updateUnits2(t.getUnitAbbreviation())})}var l=new t(e,o,a,n,r,i);return a.on("modelLoaded.dual-sensor-connector-model-controller",s),a.on("modelReset.dual-sensor-connector-model-controller",function(){l.model.set("isNewRunInProgress",!1)}),a.on("willResetModel",function(){l.model.set("isNewRunInProgress",!0),l.model.willReset()}),l}}),define("models/sensor-connector/metadata",[],function(){return{mainProperties:{type:{defaultValue:"sensor-connector",immutable:!0},sensorType:{defaultValue:null},tareValue:{defaultValue:0},clientId:{defaultValue:null},clientName:{defaultValue:null},useRandomClientId:{defaultValue:!1},useDuration:{defaultValue:"codap",storeInTickHistory:!1,validate:function(e){if(e===!0||e===!1||"codap"===e)return e;throw new Error("Invalid 'useDuration' value: "+e)}},requestedDuration:{defaultValue:10,storeInTickHistory:!1}},viewOptions:{showClock:{defaultValue:!0,propertyChangeInvalidates:!1},controlButtons:{defaultValue:"play_reset",propertyChangeInvalidates:!1},controlButtonStyle:{defaultValue:"video",propertyChangeInvalidates:!1,serialize:!1}}}}),define("models/sensor-connector/units-definition",[],function(){return{units:{time:{name:"second",pluralName:"seconds",symbol:"s"}}}}),define("models/sensor-connector/modeler",["require","common/lab-modeler-mixin","common/property-description","./metadata","common/state-machine","sensor-connector-interface","./units-definition","models/sensor-common/i18n-sensor-definitions-connector","models/sensor-common/notifier"],function(e){var t=e("common/lab-modeler-mixin"),n=e("common/property-description"),r=e("./metadata"),i=e("common/state-machine"),o=e("sensor-connector-interface"),a=e("./units-definition"),s=e("models/sensor-common/i18n-sensor-definitions-connector"),l=e("models/sensor-common/notifier");return function(e,u){function c(e,t,r){var i,o;i=W.getPropertyDescription(e).getHash(),i.min=t,i.max=r,o=new n(a,i),C.setPropertyDescription(e,o)}function d(){null!==W.properties.actualDuration&&W.properties.actualDuration!==1/0&&c("displayTime",0,W.properties.actualDuration)}function p(){var e,t;P?(e=K[P.units],e?(t={label:e.measurementName,format:".2f",min:e.minReading,max:e.maxReading},a.units[e.measurementType]?t.unitType=e.measurementType:t.unitAbbreviation=P.units,z=e.tareable,O=e.sensorName||P.units+" sensor"):(t={label:P.name||Y.t("sensor.measurements.sensor_reading"),unitAbbreviation:P.units,format:".2f",min:0,max:10},z=!0,O=P.units+" sensor")):(t=Q,z=!1,O="(no sensor)"),C.setPropertyDescription("sensorReading",new n(a,t)),C.setPropertyDescription("liveSensorReading",new n(a,t))}function f(){M=!0,j=A.canControl,F=!1,"undefined"!=typeof E&&null!==E||(E={index:1}),D=0,N=0,q=0,R=void 0,I=void 0,k=void 0,P=void 0}function h(e,t){var n=e.columns[t];return!(!n||n.units!==E.units)&&(E.index=t,!0)}function m(e){return!(e.columns.length<2)&&!(2===e.columns.length&&!e.columns[1].name&&!e.columns[1].units)}function g(){var e,t,n=A.datasets[0];F=n.columns.length>2,k=n.columns[0],A.hasAttachedInterface?(m(n)?(G=j?Y.t("sensor.messages.ready"):A.inControl.clientName?Y.t("sensor.messages.ready_nocontrol",{controlling_client:A.inControl.clientName}):Y.t("sensor.messages.ready_nocontrol_noname"),B=!0):(G=Y.t("sensor.messages.no_sensors"),B=!1),t=E.index,t>=n.columns.length&&n.columns.length>1&&(t=n.columns.length-1),e=n.columns[t],e&&E.units&&e.units!==E.units&&(h(n,t+1)?e=n.columns[t+1]:t>1&&h(n,t-1)?e=n.columns[t-1]:(e=n.columns[1],E.index=1))):(G=Y.t("sensor.messages.no_devices"),B=!1),!e||e.name||e.units||(e=null),P=e,P&&(E.units=P.units),p(),P||(I=void 0)}function v(){if(k&&P)for(var e=Math.min(k.data.length,P.data.length);D<e;D++)N=k.data[D],N>W.properties.actualDuration&&W.stop(),R=P.data[D],W.updateAllOutputProperties(),T.tick()}function y(e){return e.receivedValuesTimeStamp>=e.requestedValuesTimeStamp}function b(){return y(k)&&(!P||y(P))}function _(){var e,t=[],n=A.datasets[0];for(e=0;e<n.columns.length;e++)t.push({units:n.columns[e].units,name:n.columns[e].name});return t}function x(e){var t=Array.prototype.slice.call(arguments,0);W.makeInvalidatingChange(function(){var n=S.handleEvent.apply(S,t);n||("connectionTimedOut"===e?S.gotoState("disconnected"):"sessionChanged"===e?(A.stopPolling(),S.gotoState("disconnected")):"statusErrored"===e&&S.gotoState("initialConnectionFailure"))})}var w,C,T,S,A,k,P,E,O,M,L,N,R,I,D,B,V,j,F,z,G,U,q,H,W,Y=u.i18n,X=new l(Y),Q={label:Y.t("sensor.measurements.sensor_reading"),unitAbbreviation:"-",format:".2f",min:0,max:10},K=s(Y);return W={on:function(e,t){T.on(e,t)},start:function(){x("start")},stop:function(){x("stop")},tare:function(){var e=B;B=!1,x("tare"),B=e},willReset:function(){T.willReset()},reset:function(){x("reset")},reload:function(){W.stop(),W.makeInvalidatingChange(function(){L=!0})},isStopped:function(){return M},stepCounter:function(){return D},connectedSensors:_,getSelectedSensor:function(){return E.index},setSelectedSensor:function(e){E.index!=e&&(E.index=e,E.units=null,W.properties.tareValue=0,g())},serialize:function(){return""}},S=new i({notConnected:{enterState:function(){G=Y.t("sensor.messages.not_connected"),q=0,"https:"===location.protocol?A.startPolling(["https://localhost:11181","https://127.0.0.1:11181","https://localhost.ungerdesign.com:11181"],W.properties.clientId,W.properties.clientName):A.startPolling("http://127.0.0.1:11180",W.properties.clientId,W.properties.clientName),this.gotoState("connecting")}},connecting:{enterState:function(){G=Y.t("sensor.messages.connecting"),A.isConnected?this.gotoState("connected"):U=X.status(Y.t("sensor.messages.connection_in_progress"),{dialogClass:"interactive-dialog no-close"})},leaveState:function(){U&&(U.close(),U=null)},statusErrored:function(){this.gotoState("initialConnectionFailure")},connectionTimedOut:function(){this.gotoState("initialConnectionFailure")},launchTimedOut:function(){this.gotoState("initialConnectionFailure")},statusReceived:function(){this.gotoState("connected")},sessionChanged:function(){A.stopPolling(),A.startPolling()}},initialConnectionFailure:{enterState:function(){A.stopPolling(),G=Y.t("sensor.messages.connection_failed",{retry_link:""});var e="sensor.messages.connection_failed_alert";X.alert(Y.t(e,{click_here_link:"<a target='_blank' style='color: #222299;' href='http://sensorconnector.concord.org/'>"+Y.t("sensor.messages.click_here")+"</a>"}),{"Try again":function(){$(this).dialog("close"),x("dismiss")}},{close:function(){x("closed")}})},statusErrored:function(){},connectionTimedOut:function(){},launchTimedOut:function(){},closed:function(){G=Y.t("sensor.messages.connection_failed",{retry_link:"<a href='javascript:void(0);' class='retry-link'>"+Y.t("sensor.messages.connection_failed_retry_link_text")+"</a>"});var e=function(){var t=$("a.retry-link");t[0]?t.click(function(){x("dismiss")}):setTimeout(e,50)};e()},dismiss:function(){this.gotoState("notConnected")}},connected:{enterState:function(){G=Y.t("sensor.messages.connected"),V=!0,B=!0,M=!0,g(),j?this.controlEnabled():this.controlDisabled(),A.isCollecting&&this.gotoState("started")},leaveState:function(){V=!1,B=!1},columnAdded:g,columnRemoved:g,columnTypeChanged:g,columnMoved:g,interfaceConnected:g,interfaceRemoved:g,tare:function(){P&&(W.properties.tareValue=P.liveValue)},start:function(){A.requestStart().catch(function(){x("startRequestFailed")}),this.gotoState("starting")},controlEnabled:function(){G=Y.t("sensor.messages.connected")},controlDisabled:function(){G=A.inControl.clientName?Y.t("sensor.messages.connected_start_sensorconnector",{controlling_client:A.inControl.clientName}):Y.t("sensor.messages.connected_start_sensorconnector_noname")},sessionChanged:function(){A.stopPolling(),A.startPolling(),this.gotoState("connecting")},collectionStarted:function(){this.gotoState("started")}},starting:{enterState:function(){G=Y.t("sensor.messages.starting_data_collection"),M=!1;var e=this;this._startTimerId=setTimeout(5e3,function(){e.gotoState("startRequestFailed")})},leaveState:function(){clearTimeout(this._startTimerId)},startRequestFailed:function(){this.gotoState("errorStarting")},collectionStarted:function(){this.gotoState("started")}},errorStarting:{enterState:function(){G=Y.t("sensor.messages.error_starting_data_collection"),M=!0,X.alert(Y.t("sensor.messages.error_starting_data_collection_alert"),{OK:function(){$(this).dialog("close"),x("dismissErrorStarting")}})},collectionStarted:function(){this.gotoState("started")},dismissErrorStarting:function(){this.gotoState("connected")}},started:{enterState:function(){M=!1,g(),B=!1,G=j?Y.t("sensor.messages.collecting_data"):Y.t("sensor.messages.collecting_data_stop_sensorconnector"),A.isCollecting||this.gotoState("stopped"),P||this.gotoState("startedWithNoDataColumn")},data:v,controlEnabled:function(){G=Y.t("sensor.messages.collecting_data")},controlDisabled:function(){G=Y.t("sensor.messages.collecting_data_stop_sensorconnector")},stop:function(){A.requestStop().catch(function(){x("stopRequestFailed")}),this.gotoState("stopping")},collectionStopped:function(){this.gotoState("collectionStopped")}},startedWithNoDataColumn:{enterState:function(){G=Y.t("sensor.messages.no_data"),A.requestStop(),X.alert(Y.t("sensor.messages.no_data_alert"),{OK:function(){$(this).dialog("close")}})},collectionStopped:function(){this.gotoState("stoppedWithNoDataColumn")}},stoppedWithNoDataColumn:{enterState:function(){b()&&this.gotoState("connected")},data:function(){b()&&this.gotoState("connected")}},stopping:{enterState:function(){G=Y.t("sensor.messages.stopping_data_collection")},data:v,stopRequestFailed:function(){this.gotoState("errorStopping")},collectionStopped:function(){this.gotoState("collectionStopped")}},errorStopping:{enterState:function(){G=Y.t("sensor.messages.error_stopping_data_collection"),X.alert(Y.t("sensor.messages.error_stopping_data_collection_alert"),{OK:function(){$(this).dialog("close"),x("dismissErrorStopping")}})},data:v,collectionStopped:function(){this.gotoState("collectionStopped")},dismissErrorStopping:function(){this.gotoState("started")}},collectionStopped:{enterState:function(){G=Y.t("sensor.messages.data_collection_stopped"),b()&&this.gotoState("collectionComplete")},data:function(){v(),b()&&this.gotoState("collectionComplete")}},collectionComplete:{enterState:function(){G=Y.t("sensor.messages.data_collection_complete"),M=!0,T.stop()},reset:function(){f(),p(),this.gotoState("connecting"),T.reset()}},disconnected:{enterState:function(){G=Y.t("sensor.messages.disconnected"),A.stopPolling();var e=this;setTimeout(function(){e.gotoState("notConnected")},2e3)}}}),A=new o,A.on("*",function(){var e=Array.prototype.slice.call(arguments,0);x.apply(null,[this.event].concat(e))}),A.on("statusReceived",function(){P&&W.makeInvalidatingChange(function(){I=P.liveValue})}),A.on("controlEnabled",function(){j=!0}),A.on("controlDisabled",function(){j=!1}),w=new t({metadata:r,setters:{},unitsDefinition:a,initialProperties:e,usePlaybackSupport:!1}),C=w.propertySupport,T=w.dispatchSupport,T.addEventTypes("tick","play","stop","tickStart","tickEnd"),w.mixInto(W),f(),W.properties.useRandomClientId&&(W.properties.clientId=Math.floor(4294967296*(1+Math.random())).toString(16)),W.addObserver("clientName",function(){A.clientName=W.properties.clientName}),W.defineOutput("time",{label:Y.t("sensor.measurements.time"),unitType:"time",format:".2f"},function(){return N}),W.defineOutput("displayTime",{label:Y.t("sensor.measurements.time"),unitType:"time",format:".1f"},function(){return N}),H=W.getPropertyDescription("displayTime"),W.defineOutput("sensorReading",Q,function(){return null==R?R:R-W.properties.tareValue}),W.defineOutput("durationOptions",{},function(){return[1,5,10,15,20,30,45,60]}),W.formatTime=function(e){return H.format(e)},W.defineOutput("actualUseDuration",{},w.computeActualUseDuration),W.defineOutput("actualDuration",{label:"Experiment duration",unitType:"time",format:"f"},w.computeActualDuration),W.defineOutput("liveSensorReading",Q,function(){return null==I?I:I-W.properties.tareValue}),W.defineOutput("sensorName",{label:"Sensor Name"},function(){return O}),W.defineOutput("isStopped",{label:"Stopped?"},function(){return M}),W.defineOutput("isPlayable",{label:"Startable?"},function(){return B}),W.defineOutput("hasPlayed",{label:"Has successfully collected data?"},function(){return D>0}),W.defineOutput("canTare",{label:"Can set a tare value?"},function(){return V&&z}),W.defineOutput("canControl",{label:"Can remotely start/stop the Sensor Connector?"},function(){return j}),W.defineOutput("hasMultipleSensors",{label:"Are multiple sensors connected to the Sensor Connector?"},function(){return F}),W.defineOutput("needsReload",{label:"Needs Reload?"},function(){return L}),W.defineOutput("message",{label:"User Message"},function(){return G}),W.on("willReset.model",function(){A.stopPolling(),A.isCollecting&&A.requestStop()}),W.addObserver("actualDuration",d),d(),W.updateAllOutputProperties(),S.gotoState("notConnected"),W}}),define("models/sensor-connector/view",["require","common/views/numeric-output-view","common/controllers/basic-dialog","models/sensor-common/i18n-sensor-definitions-connector","common/views/view-state"],function(e){var t=e("common/views/numeric-output-view"),n=e("common/controllers/basic-dialog"),r=e("models/sensor-common/i18n-sensor-definitions-connector"),i=e("common/views/view-state");return function(e,o,a){function s(){e.properties.canTare?i.enableView(h.$zeroButton):i.disableView(h.$zeroButton)}function l(){}function u(){e.properties.hasMultipleSensors&&e.properties.isPlayable?i.enableView(h.$selectSensorButton):i.disableView(h.$selectSensorButton)}function c(){h.$message.html(e.properties.message)}function d(){e.addObserver("canTare",s),s(),e.addObserver("canConnect",l),l(),e.addObserver("hasMultipleSensors",u),e.addObserver("isPlayable",u),u(),e.addObserver("message",c),c()}function p(){var t,r,i,o=new n({width:"60%",dialogClass:"interactive-dialog no-close",closeOnEscape:!1,title:a.t("sensor.choose_sensor_title"),buttons:{OK:function(){console.log("OK Clicked"),$(this).dialog("close"),e.setSelectedSensor($(this).find("input:checked").val())},Cancel:function(){console.log("Cancel Clicked"),$(this).dialog("close")}}},a),s="",l="",u=e.connectedSensors(),c=!0,d=e.getSelectedSensor();for(t=0;t<u.length;t++)"s"!==u[t].units&&(r="",u[t].name?i={measurementName:u[t].name}:(i=g[u[t].units],i||(i={measurementName:"Unknown"})),l=i.measurementName+" ("+u[t].units+")",(d==t||c&&d==-1)&&(r="checked "),s+="<input type='radio' name='selected-sensor-index' value='"+t+"' "+r+"/>"+l+"<br/>",c=!1);o.setContent(s),o.open()}var f,h,m=d3.format(".2f"),g=r(a);return h={$el:$("<div id='model-container' class='container sensor-model-container' />"),remoteAddress:null,bindModel:function(t,n){o=n||o,e=t||e,d()},getHeightForWidth:function(){return"2.8em"},setup:function(){h.$el.empty(),h.$controlsContainer=$("<div></div>"),h.$statusContainer=$("<div></div>"),f=new t({id:"sensor-value-view",label:a.t("sensor.reading"),units:e.getPropertyDescription("sensorReading").getUnitAbbreviation()}),h.$zeroButton=$("<div class='interactive-button'><button>"+a.t("sensor.zero")+"</button></div>"),h.$selectSensorButton=$("<div class='interactive-button'><button>"+a.t("sensor.select_sensor")+"</button></div>"),h.$message=$("<div class='message'></div>"),h.$sensorReading=f.render().addClass("horizontal"),h.$controlsContainer.append(h.$sensorReading).append(h.$zeroButton).append(h.$selectSensorButton),h.$statusContainer.append(h.$message),h.$el.css("zIndex",4).append(h.$controlsContainer).append(h.$statusContainer),h.$controlsContainer.find("div").addClass("component component-spacing"),h.$statusContainer.find("div").addClass("component component-spacing"),f.resize(),d(),h.$zeroButton.on("click","button",e.tare),h.$selectSensorButton.on("click","button",p)},resize:function(){f&&f.resize()},repaint:function(){},setFocus:function(){},updateUnits:function(t){f.updateUnits(t),null==e.properties.liveSensorReading&&f.hideUnits()},update:function(){null==e.properties.liveSensorReading?(f.update(""),f.hideUnits()):(f.update(m(e.properties.liveSensorReading)),f.showUnits())}}}}),define("models/sensor-connector/scripting-api",[],function(){return function(e){return{resetModel:function(t){e.intController.resetModel(t)}}}}),define("models/sensor-connector/controller",["require","common/controllers/model-controller","./modeler","./view","./scripting-api"],function(e){var t=e("common/controllers/model-controller"),n=e("./modeler"),r=e("./view"),i=e("./scripting-api");return function(e,o,a){function s(){var e=l.model;e.addObserver("liveSensorReading",function(){l.updateView()}),e.addObserver("needsReload",function(){e.properties.needsReload&&a.reloadModel()}),e.addPropertyDescriptionObserver("sensorReading",function(){var t=e.getPropertyDescription("sensorReading"),n=l.modelContainer;n.updateUnits(t.getUnitAbbreviation())})}var l=new t(e,o,a,n,r,i);return a.on("modelLoaded.sensor-connector-model-controller",s),a.on("modelReset.sensor-connector-model-controller",function(){l.model.set("isNewRunInProgress",!1)}),a.on("willResetModel",function(){l.model.set("isNewRunInProgress",!0),l.model.willReset()}),l}}),define("models/labquest2/metadata",[],function(){return{mainProperties:{type:{defaultValue:"labquest2",immutable:!0},sensorType:{defaultValue:null},tareValue:{defaultValue:0}},viewOptions:{showClock:{defaultValue:!0,propertyChangeInvalidates:!1},controlButtons:{defaultValue:"play_reset",propertyChangeInvalidates:!1},controlButtonStyle:{defaultValue:"video",propertyChangeInvalidates:!1,serialize:!1}}}}),!function(e){"object"==typeof exports?module.exports=e():"function"==typeof define&&define.amd?define("labquest2-interface",e):"undefined"!=typeof window?window.sensorLabquest2Interface=e():"undefined"!=typeof global?global.sensorLabquest2Interface=e():"undefined"!=typeof self&&(self.sensorLabquest2Interface=e())}(function(){var e;return function e(t,n,r){function i(a,s){if(!n[a]){if(!t[a]){var l="function"==typeof require&&require;if(!s&&l)return l(a,!0);if(o)return o(a,!0);throw new Error("Cannot find module '"+a+"'")}var u=n[a]={exports:{}};t[a][0].call(u.exports,function(e){var n=t[a][1][e];return i(n?n:e)},u,u.exports,e,t,n,r)}return n[a].exports}for(var o="function"==typeof require&&require,a=0;a<r.length;a++)i(r[a]);return i}({1:[function(e,t,n){"use strict";function r(){f=[],h=Object.create(null),m=Object.create(null),g=!1}function i(e,t){var n=w+t,r=new XMLHttpRequest;if("withCredentials"in r)r.open(e,n,!0),r.responseType="json",r.setRequestHeader("Accept","application/json");else{if("undefined"==typeof XDomainRequest)return null;r=new XDomainRequest,r.open(e,n)}return r}function o(){x.emit("connectionTimedOut"),A=!1}function a(){var e=i("GET","/status");return e?(e.onerror=s,e.onload=l,void e.send()):void s()}function s(){x.emit("statusErrored")}function l(){var e=this.response||JSON.parse(this.responseText);if("string"==typeof e&&(e=JSON.parse(e)),T&&!(e.requestTimeStamp<S)){if(v){if(v!==e.sessionID)return void(g||(x.emit("sessionChanged"),g=!0))}else v=e.sessionID,r();S=e.requestTimeStamp,E.reset(),u(e.sets),c(e.columns),A=!0,x.emit("statusReceived"),k&&!e.collection.isCollecting?(k=!1,x.emit("collectionStopped")):!k&&e.collection.isCollecting&&(k=!0,x.emit("collectionStarted")),P&&!e.collection.canControl?(P=!1,x.emit("controlDisabled")):!P&&e.collection.canControl&&(P=!0,x.emit("controlEnabled"))}}function u(e){Object.keys(e).forEach(function(t){h[t]||(x.emit("datasetAdded",t),h[t]={columns:[],id:t},f.unshift(h[t])),h[t].columns.length=e[t].colIDs.length}),f.sort(function(e,t){return t.setId-e.setId})}function c(e){var t=[];Object.keys(e).forEach(function(n){var r=e[n],i=h[r.setID],o=m[n];o?o!==i.columns[r.position]&&t.push(["columnMoved",n]):(t.push(["columnAdded",n]),o=m[n]={id:null,units:null,receivedValuesTimeStamp:0,requestedValuesTimeStamp:0,liveValueTimeStamp:0,liveValue:null,data:[]}),i.columns[r.position]=o,null!==o.units&&o.units!==r.units&&t.push(["columnTypeChanged",n]),o.units=r.units,o.id=n,o.liveValue=parseFloat(r.liveValue||0),o.liveValueTimeStamp=r.liveValueTimeStamp,o.requestedValuesTimeStamp<r.valuesTimeStamp&&(d(n,r.valuesTimeStamp),o.requestedValuesTimeStamp=r.valuesTimeStamp)}),Object.keys(m).forEach(function(n){e[n]||(t.push(["columnRemoved",n]),delete m[n])}),t.forEach(function(e){x.emit(e[0],e[1])})}function d(e,t){var n=i("GET","/columns/"+e);n.send(),n.onload=function(){if(T){var n=this.response||JSON.parse(this.responseText);"string"==typeof n&&(n=JSON.parse(n));var r=n.values,i=m[e];t>i.receivedValuesTimeStamp&&(i.data.length=0,[].push.apply(i.data,r),i.receivedValuesTimeStamp=t,x.emit("data",e))}}}function p(e){return function(){return new b.Promise(function(t,n){var r=i("GET",e);r||n(new Error("This browser does not appear to support Cross-Origin Resource Sharing")),r.send(),r.onerror=function(){n(this)},r.onload=t})}}var f,h,m,g,v,y,b=e("rsvp"),_=e("eventemitter2").EventEmitter2,x=new _({wildcard:!0}),w="",C=1e4,T=!1,S=0,A=!1,k=!1,P=!0,E={start:function(){this.timerId=setTimeout(o,C)},reset:function(){this.stop(),this.start()},stop:function(){clearTimeout(this.timerId)}};t.exports={startPolling:function(e){w="http://"+e,a(),T=!0,A=!1,E.start(),y=setInterval(a,500)},stopPolling:function(){E.stop(),clearInterval(y),v=void 0,T=!1},requestStart:p("/control/start"),requestStop:p("/control/stop"),on:function(){x.on.apply(x,arguments)},off:function(){x.off.apply(x,arguments)},get datasets(){return f},get isConnected(){return T&&A},get isCollecting(){return T&&A&&k},get canControl(){return P}}},{eventemitter2:3,rsvp:4}],2:[function(e,t,n){var r=t.exports={};r.nextTick=function(){var e="undefined"!=typeof window&&window.setImmediate,t="undefined"!=typeof window&&window.postMessage&&window.addEventListener;if(e)return function(e){return window.setImmediate(e)};if(t){var n=[];return window.addEventListener("message",function(e){var t=e.source;if((t===window||null===t)&&"process-tick"===e.data&&(e.stopPropagation(),n.length>0)){var r=n.shift();r()}},!0),function(e){n.push(e),window.postMessage("process-tick","*")}}return function(e){setTimeout(e,0)}}(),r.title="browser",r.browser=!0,r.env={},r.argv=[],r.binding=function(e){throw new Error("process.binding is not supported")},r.cwd=function(){return"/"},r.chdir=function(e){throw new Error("process.chdir is not supported")}},{}],3:[function(t,n,r){var i=t("__browserify_process");!function(t,n){function r(){this._events={},this._conf&&i.call(this,this._conf)}function i(e){e&&(this._conf=e,e.delimiter&&(this.delimiter=e.delimiter),e.maxListeners&&(this._events.maxListeners=e.maxListeners),e.wildcard&&(this.wildcard=e.wildcard),e.newListener&&(this.newListener=e.newListener),this.wildcard&&(this.listenerTree={}))}function o(e){this._events={},this.newListener=!1,i.call(this,e)}function a(e,t,n,r){if(!n)return[];var i,o,s,l,u,c,d,p=[],f=t.length,h=t[r],m=t[r+1];if(r===f&&n._listeners){if("function"==typeof n._listeners)return e&&e.push(n._listeners),[n];for(i=0,o=n._listeners.length;i<o;i++)e&&e.push(n._listeners[i]);return[n]}if("*"===h||"**"===h||n[h]){if("*"===h){for(s in n)"_listeners"!==s&&n.hasOwnProperty(s)&&(p=p.concat(a(e,t,n[s],r+1)));return p}if("**"===h){d=r+1===f||r+2===f&&"*"===m,d&&n._listeners&&(p=p.concat(a(e,t,n,f)));for(s in n)"_listeners"!==s&&n.hasOwnProperty(s)&&("*"===s||"**"===s?(n[s]._listeners&&!d&&(p=p.concat(a(e,t,n[s],f))),p=p.concat(a(e,t,n[s],r))):p=s===m?p.concat(a(e,t,n[s],r+2)):p.concat(a(e,t,n[s],r)));return p}p=p.concat(a(e,t,n[h],r+1))}if(l=n["*"],l&&a(e,t,l,r+1),u=n["**"])if(r<f){u._listeners&&a(e,t,u,f);for(s in u)"_listeners"!==s&&u.hasOwnProperty(s)&&(s===m?a(e,t,u[s],r+2):s===h?a(e,t,u[s],r+1):(c={},c[s]=u[s],a(e,t,{"**":c},r+1)))}else u._listeners?a(e,t,u,f):u["*"]&&u["*"]._listeners&&a(e,t,u["*"],f);return p}function s(e,t){e="string"==typeof e?e.split(this.delimiter):e.slice();for(var n=0,r=e.length;n+1<r;n++)if("**"===e[n]&&"**"===e[n+1])return;for(var i=this.listenerTree,o=e.shift();o;){if(i[o]||(i[o]={}),i=i[o],0===e.length){if(i._listeners){if("function"==typeof i._listeners)i._listeners=[i._listeners,t];else if(l(i._listeners)&&(i._listeners.push(t),!i._listeners.warned)){var a=u;"undefined"!=typeof this._events.maxListeners&&(a=this._events.maxListeners),a>0&&i._listeners.length>a&&(i._listeners.warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",i._listeners.length),console.trace())}}else i._listeners=t;return!0}o=e.shift()}return!0}var l=Array.isArray?Array.isArray:function(e){return"[object Array]"===Object.prototype.toString.call(e)},u=10;o.prototype.delimiter=".",o.prototype.setMaxListeners=function(e){this._events||r.call(this),this._events.maxListeners=e,this._conf||(this._conf={}),this._conf.maxListeners=e},o.prototype.event="",o.prototype.once=function(e,t){return this.many(e,1,t),this},o.prototype.many=function(e,t,n){function r(){0===--t&&i.off(e,r),n.apply(this,arguments)}var i=this;if("function"!=typeof n)throw new Error("many only accepts instances of Function");return r._origin=n,this.on(e,r),i},o.prototype.emit=function(){this._events||r.call(this);var e=arguments[0];if("newListener"===e&&!this.newListener&&!this._events.newListener)return!1;if(this._all){for(var t=arguments.length,n=new Array(t-1),i=1;i<t;i++)n[i-1]=arguments[i];for(i=0,t=this._all.length;i<t;i++)this.event=e,this._all[i].apply(this,n)}if("error"===e&&!(this._all||this._events.error||this.wildcard&&this.listenerTree.error))throw arguments[1]instanceof Error?arguments[1]:new Error("Uncaught, unspecified 'error' event.");var o;if(this.wildcard){o=[];var s="string"==typeof e?e.split(this.delimiter):e.slice();a.call(this,o,s,this.listenerTree,0);
}else o=this._events[e];if("function"==typeof o){if(this.event=e,1===arguments.length)o.call(this);else if(arguments.length>1)switch(arguments.length){case 2:o.call(this,arguments[1]);break;case 3:o.call(this,arguments[1],arguments[2]);break;default:for(var t=arguments.length,n=new Array(t-1),i=1;i<t;i++)n[i-1]=arguments[i];o.apply(this,n)}return!0}if(o){for(var t=arguments.length,n=new Array(t-1),i=1;i<t;i++)n[i-1]=arguments[i];for(var l=o.slice(),i=0,t=l.length;i<t;i++)this.event=e,l[i].apply(this,n);return l.length>0||this._all}return this._all},o.prototype.on=function(e,t){if("function"==typeof e)return this.onAny(e),this;if("function"!=typeof t)throw new Error("on only accepts instances of Function");if(this._events||r.call(this),this.emit("newListener",e,t),this.wildcard)return s.call(this,e,t),this;if(this._events[e]){if("function"==typeof this._events[e])this._events[e]=[this._events[e],t];else if(l(this._events[e])&&(this._events[e].push(t),!this._events[e].warned)){var n=u;"undefined"!=typeof this._events.maxListeners&&(n=this._events.maxListeners),n>0&&this._events[e].length>n&&(this._events[e].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[e].length),console.trace())}}else this._events[e]=t;return this},o.prototype.onAny=function(e){if(this._all||(this._all=[]),"function"!=typeof e)throw new Error("onAny only accepts instances of Function");return this._all.push(e),this},o.prototype.addListener=o.prototype.on,o.prototype.off=function(e,t){if("function"!=typeof t)throw new Error("removeListener only takes instances of Function");var n,r=[];if(this.wildcard){var i="string"==typeof e?e.split(this.delimiter):e.slice();r=a.call(this,null,i,this.listenerTree,0)}else{if(!this._events[e])return this;n=this._events[e],r.push({_listeners:n})}for(var o=0;o<r.length;o++){var s=r[o];if(n=s._listeners,l(n)){for(var u=-1,c=0,d=n.length;c<d;c++)if(n[c]===t||n[c].listener&&n[c].listener===t||n[c]._origin&&n[c]._origin===t){u=c;break}if(u<0)continue;return this.wildcard?s._listeners.splice(u,1):this._events[e].splice(u,1),0===n.length&&(this.wildcard?delete s._listeners:delete this._events[e]),this}(n===t||n.listener&&n.listener===t||n._origin&&n._origin===t)&&(this.wildcard?delete s._listeners:delete this._events[e])}return this},o.prototype.offAny=function(e){var t,n=0,r=0;if(e&&this._all&&this._all.length>0){for(t=this._all,n=0,r=t.length;n<r;n++)if(e===t[n])return t.splice(n,1),this}else this._all=[];return this},o.prototype.removeListener=o.prototype.off,o.prototype.removeAllListeners=function(e){if(0===arguments.length)return!this._events||r.call(this),this;if(this.wildcard)for(var t="string"==typeof e?e.split(this.delimiter):e.slice(),n=a.call(this,null,t,this.listenerTree,0),i=0;i<n.length;i++){var o=n[i];o._listeners=null}else{if(!this._events[e])return this;this._events[e]=null}return this},o.prototype.listeners=function(e){if(this.wildcard){var t=[],n="string"==typeof e?e.split(this.delimiter):e.slice();return a.call(this,t,n,this.listenerTree,0),t}return this._events||r.call(this),this._events[e]||(this._events[e]=[]),l(this._events[e])||(this._events[e]=[this._events[e]]),this._events[e]},o.prototype.listenersAny=function(){return this._all?this._all:[]},"function"==typeof e&&e.amd?e(function(){return o}):t.EventEmitter2=o}("undefined"!=typeof i&&"undefined"!=typeof i.title&&"undefined"!=typeof r?r:window)},{__browserify_process:2}],4:[function(e,t,n){"use strict";function r(e,t){g.async(e,t)}function i(){g.on.apply(g,arguments)}function o(){g.off.apply(g,arguments)}var a=e("./rsvp/promise").default,s=e("./rsvp/events").default,l=e("./rsvp/node").default,u=e("./rsvp/all").default,c=e("./rsvp/all-settled").default,d=e("./rsvp/race").default,p=e("./rsvp/hash").default,f=e("./rsvp/hash-settled").default,h=e("./rsvp/rethrow").default,m=e("./rsvp/defer").default,g=e("./rsvp/config").config,v=e("./rsvp/config").configure,y=e("./rsvp/map").default,b=e("./rsvp/resolve").default,_=e("./rsvp/reject").default,x=e("./rsvp/filter").default,w=e("./rsvp/asap").default;if(g.async=w,"undefined"!=typeof window&&"object"==typeof window.__PROMISE_INSTRUMENTATION__){var C=window.__PROMISE_INSTRUMENTATION__;v("instrument",!0);for(var T in C)C.hasOwnProperty(T)&&i(T,C[T])}n.Promise=a,n.EventTarget=s,n.all=u,n.allSettled=c,n.race=d,n.hash=p,n.hashSettled=f,n.rethrow=h,n.defer=m,n.denodeify=l,n.configure=v,n.on=i,n.off=o,n.resolve=b,n.reject=_,n.async=r,n.map=y,n.filter=x},{"./rsvp/all":6,"./rsvp/all-settled":5,"./rsvp/asap":7,"./rsvp/config":8,"./rsvp/defer":9,"./rsvp/events":10,"./rsvp/filter":11,"./rsvp/hash":13,"./rsvp/hash-settled":12,"./rsvp/map":15,"./rsvp/node":16,"./rsvp/promise":17,"./rsvp/race":23,"./rsvp/reject":24,"./rsvp/resolve":25,"./rsvp/rethrow":26}],5:[function(e,t,n){"use strict";function r(e){return{state:"fulfilled",value:e}}function i(e){return{state:"rejected",reason:e}}var o=e("./promise").default,a=e("./utils").isArray,s=e("./utils").isNonThenable;n.default=function(e,t){return new o(function(t,n){function l(e){return function(t){c(e,r(t))}}function u(e){return function(t){c(e,i(t))}}function c(e,n){f[e]=n,0===--p&&t(f)}if(!a(e))throw new TypeError("You must pass an array to allSettled.");var d,p=e.length;if(0===p)return void t([]);for(var f=new Array(p),h=0;h<e.length;h++)d=e[h],s(d)?c(h,r(d)):o.resolve(d).then(l(h),u(h))},t)}},{"./promise":17,"./utils":27}],6:[function(e,t,n){"use strict";var r=e("./promise").default;n.default=function(e,t){return r.all(e,t)}},{"./promise":17}],7:[function(e,t,n){function r(){return function(){s.nextTick(a)}}function i(){var e=0,t=new c(a),n=document.createTextNode("");return t.observe(n,{characterData:!0}),function(){n.data=e=++e%2}}function o(){return function(){setTimeout(a,1)}}function a(){for(var e=0;e<d.length;e++){var t=d[e],n=t[0],r=t[1];n(r)}d.length=0}var s=e("__browserify_process");n.default=function(e,t){var n=d.push([e,t]);1===n&&l()};var l,u="undefined"!=typeof window?window:{},c=u.MutationObserver||u.WebKitMutationObserver,d=[];l="undefined"!=typeof s&&"[object process]"==={}.toString.call(s)?r():c?i():o()},{__browserify_process:2}],8:[function(e,t,n){"use strict";function r(e,t){return"onerror"===e?void o.on("error",t):2!==arguments.length?o[e]:void(o[e]=t)}var i=e("./events").default,o={instrument:!1};i.mixin(o),n.config=o,n.configure=r},{"./events":10}],9:[function(e,t,n){"use strict";var r=e("./promise").default;n.default=function(e){var t={};return t.promise=new r(function(e,n){t.resolve=e,t.reject=n},e),t}},{"./promise":17}],10:[function(e,t,n){"use strict";function r(e,t){for(var n=0,r=e.length;n<r;n++)if(e[n]===t)return n;return-1}function i(e){var t=e._promiseCallbacks;return t||(t=e._promiseCallbacks={}),t}n.default={mixin:function(e){return e.on=this.on,e.off=this.off,e.trigger=this.trigger,e._promiseCallbacks=void 0,e},on:function(e,t){var n,o=i(this);n=o[e],n||(n=o[e]=[]),r(n,t)===-1&&n.push(t)},off:function(e,t){var n,o,a=i(this);return t?(n=a[e],o=r(n,t),void(o!==-1&&n.splice(o,1))):void(a[e]=[])},trigger:function(e,t){var n,r,o=i(this);if(n=o[e])for(var a=0;a<n.length;a++)(r=n[a])(t)}}},{}],11:[function(e,t,n){"use strict";var r=e("./promise").default,i=e("./utils").isFunction;n.default=function(e,t,n){return r.all(e,n).then(function(e){if(!i(t))throw new TypeError("You must pass a function as filter's second argument.");for(var o=e.length,a=new Array(o),s=0;s<o;s++)a[s]=t(e[s]);return r.all(a,n).then(function(t){for(var n=new Array(o),r=0,i=0;i<o;i++)t[i]===!0&&(n[r]=e[i],r++);return n.length=r,n})})}},{"./promise":17,"./utils":27}],12:[function(e,t,n){"use strict";function r(e){return{state:"fulfilled",value:e}}function i(e){return{state:"rejected",reason:e}}var o=e("./promise").default,a=e("./utils").isNonThenable,s=e("./utils").keysOf;n.default=function(e,t){return new o(function(t,n){function l(e){return function(t){c(e,r(t))}}function u(e){return function(t){c(e,i(t))}}function c(e,n){f[e]=n,0===--m&&t(f)}var d,p,f={},h=s(e),m=h.length;if(0===m)return void t(f);for(var g=0;g<h.length;g++)p=h[g],d=e[p],a(d)?c(p,r(d)):o.resolve(d).then(l(p),u(p))})}},{"./promise":17,"./utils":27}],13:[function(e,t,n){"use strict";var r=e("./promise").default,i=e("./utils").isNonThenable,o=e("./utils").keysOf;n.default=function(e,t){return new r(function(t,n){function a(e){return function(n){c[e]=n,0===--p&&t(c)}}function s(e){p=0,n(e)}var l,u,c={},d=o(e),p=d.length;if(0===p)return void t(c);for(var f=0;f<d.length;f++)u=d[f],l=e[u],i(l)?(c[u]=l,0===--p&&t(c)):r.resolve(l).then(a(u),s)})}},{"./promise":17,"./utils":27}],14:[function(e,t,n){"use strict";var r=e("./config").config,i=e("./utils").now;n.default=function(e,t,n){try{r.trigger(e,{guid:t._guidKey+t._id,eventName:e,detail:t._detail,childGuid:n&&t._guidKey+n._id,label:t._label,timeStamp:i(),stack:new Error(t._label).stack})}catch(e){setTimeout(function(){throw e},0)}}},{"./config":8,"./utils":27}],15:[function(e,t,n){"use strict";var r=e("./promise").default,i=(e("./utils").isArray,e("./utils").isFunction);n.default=function(e,t,n){return r.all(e,n).then(function(e){if(!i(t))throw new TypeError("You must pass a function as map's second argument.");for(var o=e.length,a=new Array(o),s=0;s<o;s++)a[s]=t(e[s]);return r.all(a,n)})}},{"./promise":17,"./utils":27}],16:[function(e,t,n){"use strict";var r=e("./promise").default,i=e("./utils").isArray;n.default=function(e,t){function n(){for(var n=arguments.length,i=new Array(n),s=0;s<n;s++)i[s]=arguments[s];var l;return o||a||!t?l=this:(console.warn('Deprecation: RSVP.denodeify() doesn\'t allow setting the "this" binding anymore. Use yourFunction.bind(yourThis) instead.'),l=t),r.all(i).then(function(n){function i(r,i){function s(){for(var e=arguments.length,n=new Array(e),s=0;s<e;s++)n[s]=arguments[s];var l=n[0],u=n[1];if(l)i(l);else if(o)r(n.slice(1));else if(a){var c,d,p={},f=n.slice(1);for(d=0;d<t.length;d++)c=t[d],p[c]=f[d];r(p)}else r(u)}n.push(s),e.apply(l,n)}return new r(i)})}var o=t===!0,a=i(t);return n.__proto__=e,n}},{"./promise":17,"./utils":27}],17:[function(e,t,n){"use strict";function r(){}function i(e,t){if(!y(e))throw new TypeError("You must pass a resolver function as the first argument to the promise constructor");if(!(this instanceof i))throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.");this._id=A++,this._label=t,this._subscribers=[],m.instrument&&g("created",this),r!==e&&o(e,this)}function o(e,t){function n(e){c(t,e)}function r(e){p(t,e)}try{e(n,r)}catch(e){r(e)}}function a(e,t,n,r){var i=e._subscribers,o=i.length;i[o]=t,i[o+E]=n,i[o+O]=r}function s(e,t){var n,r,i=e._subscribers,o=e._detail;m.instrument&&g(t===E?"fulfilled":"rejected",e);for(var a=0;a<i.length;a+=3)n=i[a],r=i[a+t],l(t,n,r,o);e._subscribers=null}function l(e,t,n,r){var i,o,a,s,l=y(n);if(l)try{i=n(r),a=!0}catch(e){s=!0,o=e}else i=r,a=!0;u(t,i)||(l&&a?c(t,i):s?p(t,o):e===E?c(t,i):e===O&&p(t,i))}function u(e,t){var n,r=null;try{if(e===t)throw new TypeError("A promises callback cannot return that same promise.");if(v(t)&&(r=t.then,y(r)))return r.call(t,function(r){return!!n||(n=!0,void(t!==r?c(e,r):d(e,r)))},function(t){return!!n||(n=!0,void p(e,t))},"Settle: "+(e._label||" unknown promise")),!0}catch(t){return!!n||(p(e,t),!0)}return!1}function c(e,t){e===t?d(e,t):u(e,t)||d(e,t)}function d(e,t){e._state===k&&(e._state=P,e._detail=t,m.async(f,e))}function p(e,t){e._state===k&&(e._state=P,e._detail=t,m.async(h,e))}function f(e){s(e,e._state=E)}function h(e){e._onerror&&e._onerror(e._detail),s(e,e._state=O)}var m=e("./config").config,g=(e("./events").default,e("./instrument").default),v=e("./utils").objectOrFunction,y=e("./utils").isFunction,b=e("./utils").now,_=e("./promise/cast").default,x=e("./promise/all").default,w=e("./promise/race").default,C=e("./promise/resolve").default,T=e("./promise/reject").default,S="rsvp_"+b()+"-",A=0;n.default=i,i.cast=_,i.all=x,i.race=w,i.resolve=C,i.reject=T;var k=void 0,P=0,E=1,O=2;i.prototype={constructor:i,_id:void 0,_guidKey:S,_label:void 0,_state:void 0,_detail:void 0,_subscribers:void 0,_onerror:function(e){m.trigger("error",e)},then:function(e,t,n){var i=this;this._onerror=null;var o=new this.constructor(r,n);if(this._state){var s=arguments;m.async(function(){l(i._state,o,s[i._state-1],i._detail)})}else a(this,o,e,t);return m.instrument&&g("chained",i,o),o},catch:function(e,t){return this.then(null,e,t)},finally:function(e,t){var n=this.constructor;return this.then(function(t){return n.resolve(e()).then(function(){return t})},function(t){return n.resolve(e()).then(function(){throw t})},t)}}},{"./config":8,"./events":10,"./instrument":14,"./promise/all":18,"./promise/cast":19,"./promise/race":20,"./promise/reject":21,"./promise/resolve":22,"./utils":27}],18:[function(e,t,n){"use strict";var r=e("../utils").isArray,i=e("../utils").isNonThenable;n.default=function(e,t){var n=this;return new n(function(t,o){function a(e){return function(n){c[e]=n,0===--u&&t(c)}}function s(e){u=0,o(e)}if(!r(e))throw new TypeError("You must pass an array to all.");var l,u=e.length,c=new Array(u);if(0===u)return void t(c);for(var d=0;d<e.length;d++)l=e[d],i(l)?(c[d]=l,0===--u&&t(c)):n.resolve(l).then(a(d),s)},t)}},{"../utils":27}],19:[function(e,t,n){"use strict";n.default=function(e,t){var n=this;return e&&"object"==typeof e&&e.constructor===n?e:new n(function(t){t(e)},t)}},{}],20:[function(e,t,n){"use strict";var r=e("../utils").isArray,i=(e("../utils").isFunction,e("../utils").isNonThenable);n.default=function(e,t){var n,o=this;return new o(function(t,a){function s(e){u&&(u=!1,t(e))}function l(e){u&&(u=!1,a(e))}if(!r(e))throw new TypeError("You must pass an array to race.");for(var u=!0,c=0;c<e.length;c++){if(n=e[c],i(n))return u=!1,void t(n);o.resolve(n).then(s,l)}},t)}},{"../utils":27}],21:[function(e,t,n){"use strict";n.default=function(e,t){var n=this;return new n(function(t,n){n(e)},t)}},{}],22:[function(e,t,n){"use strict";n.default=function(e,t){var n=this;return e&&"object"==typeof e&&e.constructor===n?e:new n(function(t){t(e)},t)}},{}],23:[function(e,t,n){"use strict";var r=e("./promise").default;n.default=function(e,t){return r.race(e,t)}},{"./promise":17}],24:[function(e,t,n){"use strict";var r=e("./promise").default;n.default=function(e,t){return r.reject(e,t)}},{"./promise":17}],25:[function(e,t,n){"use strict";var r=e("./promise").default;n.default=function(e,t){return r.resolve(e,t)}},{"./promise":17}],26:[function(e,t,n){"use strict";n.default=function(e){throw setTimeout(function(){throw e}),e}},{}],27:[function(e,t,n){"use strict";function r(e){return"function"==typeof e||"object"==typeof e&&null!==e}function i(e){return"function"==typeof e}function o(e){return!r(e)}n.objectOrFunction=r,n.isFunction=i,n.isNonThenable=o;var a;a=Array.isArray?Array.isArray:function(e){return"[object Array]"===Object.prototype.toString.call(e)};var s=a;n.isArray=s;var l=Date.now||function(){return(new Date).getTime()};n.now=l;var u=Object.keys||function(e){var t=[];for(var n in e)t.push(n);return t};n.keysOf=u},{}]},{},[1])(1)}),define("models/labquest2/units-definition",[],function(){return{units:{time:{name:"second",pluralName:"seconds",symbol:"s"},distance:{name:"meter",pluralName:"meters",symbol:"m"},temperature:{name:"degree Celsius",pluaralName:"degrees Celsius",symbol:"°C"},light:{name:"lux",pluralName:"lux",symbol:"lux"},force:{name:"Newton",pluralName:"Newtons",symbol:"N"},ph:{name:"pH Unit",pluralName:"pH Units",symbol:"pH"},co2:{name:"part per million",pluralName:"parts per million",symbol:"ppm"},o2:{name:"part per million",pluralName:"parts per million",symbol:"ppm"}}}}),define("models/labquest2/modeler",["require","common/lab-modeler-mixin","common/property-description","./metadata","common/state-machine","labquest2-interface","./units-definition","models/sensor-common/i18n-sensor-definitions-connector","models/sensor-common/notifier","underscore"],function(e){var t=e("common/lab-modeler-mixin"),n=e("common/property-description"),r=e("./metadata"),i=e("common/state-machine"),o=e("labquest2-interface"),a=e("./units-definition"),s=e("models/sensor-common/i18n-sensor-definitions-connector"),l=e("models/sensor-common/notifier"),u=e("underscore");return function(e,c){function d(){var e,t;S?(e=X[S.units],e?(t={label:e.measurementName,format:".2f",min:e.minReading,max:e.maxReading},a.units[e.measurementType]?t.unitType=e.measurementType:t.unitAbbreviation=S.units,G=e.tareable,k=e.sensorName):(t={label:H.t("sensor.measurements.sensor_reading"),unitAbbreviation:S.units,format:".2f",min:0,max:10},G=!0,k=S.units+" sensor")):(t=Y,G=!1,k="(no sensor)"),x.setPropertyDescription("sensorReading",new n(a,t)),x.setPropertyDescription("liveSensorReading",new n(a,t))}function p(){P=!0,B=!1,F=o.canControl,z=!1,"undefined"!=typeof A&&null!==A||(A={index:-1}),I=0,O=0,M=void 0,L=void 0,N=0,R=0,T=void 0,S=void 0}function f(e,t){var n=e.columns[t];return!(!n||n.units!==A.units)&&(A.index=t,!0)}function h(){var e,t,n=o.datasets[0];z=n.columns.length>2,T=u.find(n.columns,function(e){return"s"===e.units}),t=A.index,t==-1&&(e=u.find(n.columns,function(e,n){return"s"!==e.units&&(A.index=n,A.units=e.units,t=n,!0)})),t>=n.columns.length&&n.columns.length>1&&(t=n.columns.length-1),e=n.columns[t],e&&A.units&&e.units!==A.units&&(e=f(n,t+1)?n.columns[t+1]:t>1&&f(n,t-1)?n.columns[t-1]:u.find(n.columns,function(e,n){return"s"!==e.units&&(A.index=n,A.units=e.units,t=n,!0)})),S=e,S&&(A.units=S.units),d(),S||(L=void 0)}function m(){if(T&&S)for(var e=Math.min(T.data.length,S.data.length);I<e;I++)O=T.data[I],M=S.data[I],q.updateAllOutputProperties(),w.tick()}function g(e){return e.receivedValuesTimeStamp>=e.requestedValuesTimeStamp}function v(){return g(T)&&(!S||g(S))}function y(){var e,t=[],n=o.datasets[0];for(e=0;e<n.columns.length;e++)t.push(n.columns[e].units);return t}function b(e){var t=Array.prototype.slice.call(arguments,0);q.makeInvalidatingChange(function(){var n=C.handleEvent.apply(C,t);n||"connectionTimedOut"!==e&&"sessionChanged"!==e||C.gotoState("disconnected")})}var _,x,w,C,T,S,A,k,P,E,O,M,L,N,R,I,D,B,V,j,F,z,G,U,q,H=c.i18n,W=new l(H),Y={label:H.t("sensor.measurements.sensor_reading"),unitAbbreviation:"-",format:".2f",min:0,max:10},X=s(H);return q={on:function(e,t){w.on(e,t)},connect:function(e){b("connect",e)},start:function(){b("start")},stop:function(){b("stop")},tare:function(){var e=D;D=!1,b("tare"),D=e},willReset:function(){w.willReset()},reset:function(){b("reset")},reload:function(){q.stop(),q.makeInvalidatingChange(function(){E=!0})},isStopped:function(){return P},stepCounter:function(){return I},connectedSensors:y,getSelectedSensor:function(){return A.index},setSelectedSensor:function(e){A.index!==e&&(A.index=e,A.units=null,q.properties.tareValue=0,h())},serialize:function(){return""}},C=new i({notConnected:{enterState:function(){U=H.t("sensor.messages.not_connected"),B=!0},leaveState:function(){B=!1},connect:function(e){o.startPolling(e),this.gotoState("connecting")}},connecting:{enterState:function(){U=H.t("sensor.messages.connecting"),o.isConnected&&this.gotoState("connected")},statusErrored:function(){this.gotoState("initialConnectionFailure")},connectionTimedOut:function(){this.gotoState("initialConnectionFailure")},statusReceived:function(){this.gotoState("connected")},sessionChanged:function(){o.stopPolling(),o.startPolling()}},initialConnectionFailure:{enterState:function(){o.stopPolling(),U=H.t("sensor.messages.connection_failed"),W.alert(H.t("sensor.messages.connection_failed_labquest2_alert"),{OK:function(){$(this).dialog("close"),b("dismiss")}})},dismiss:function(){this.gotoState("notConnected")}},connected:{enterState:function(){U=H.t("sensor.messages.connected"),V=!0,D=!0,P=!0,h(),F?this.controlEnabled():this.controlDisabled(),o.isCollecting&&this.gotoState("started")},leaveState:function(){V=!1,D=!1},columnAdded:h,columnRemoved:h,columnTypeChanged:h,columnMoved:h,tare:function(){S&&(j?q.properties.tareValue=S.liveValue:(V=!1,W.alert(H.t("sensor.messages.tare_labquest2_alert"),{OK:function(){$(this).dialog("close"),V=!0}})))},start:function(){o.requestStart().catch(function(){b("startRequestFailed")}),this.gotoState("starting")},controlEnabled:function(){U=H.t("sensor.messages.connected")},controlDisabled:function(){U=H.t("sensor.messages.connected_start_labquest2")},sessionChanged:function(){o.stopPolling(),o.startPolling(),this.gotoState("connecting")},collectionStarted:function(){this.gotoState("started")}},starting:{enterState:function(){U=H.t("sensor.messages.starting_data_collection"),P=!1;var e=this;this._startTimerId=setTimeout(3e3,function(){e.gotoState("startRequestFailed")})},leaveState:function(){clearTimeout(this._startTimerId)},startRequestFailed:function(){this.gotoState("errorStarting")},stop:function(){this.gotoState("canceling")},collectionStarted:function(){this.gotoState("started")}},errorStarting:{enterState:function(){U=H.t("sensor.messages.error_starting_data_collection"),P=!0,W.alert(H.t("sensor.messages.error_starting_data_collection_alert"),{OK:function(){$(this).dialog("close"),b("dismissErrorStarting")}})},collectionStarted:function(){this.gotoState("started")},dismissErrorStarting:function(){this.gotoState("connected")}},started:{enterState:function(){U=F?H.t("sensor.messages.collecting_data"):H.t("sensor.messages.collecting_data_stop_labquest2"),P=!1,h(),o.isCollecting||this.gotoState("stopped"),S||this.gotoState("startedWithNoDataColumn")},data:m,controlEnabled:function(){U=H.t("sensor.messages.collecting_data")},controlDisabled:function(){U=H.t("sensor.messages.collecting_data_stop_labquest2")},stop:function(){o.requestStop().catch(function(){b("stopRequestFailed")}),this.gotoState("stopping")},collectionStopped:function(){this.gotoState("collectionStopped")}},startedWithNoDataColumn:{enterState:function(){U=H.t("sensor.messages.no_data"),o.requestStop(),W.alert(H.t("sensor.messages.no_data_labquest2_alert"),{OK:function(){$(this).dialog("close")}})},collectionStopped:function(){this.gotoState("stoppedWithNoDataColumn")}},stoppedWithNoDataColumn:{enterState:function(){v()&&this.gotoState("connected")},data:function(){v()&&this.gotoState("connected")}},canceling:{enterState:function(){U=H.t("sensor.messages.canceling_data_collection"),P=!0},data:m,cancelRequestFailed:function(){this.gotoState("errorCanceling")},collectionStarted:function(){o.requestStop().catch(function(){b("cancelRequestFailed")})},collectionStopped:function(){this.gotoState("collectionStopped")}},errorCanceling:{enterState:function(){U=H.t("sensor.messages.error_canceling_data_collection"),W.alert(H.t("sensor.messages.error_canceling_data_collection_alert"),{OK:function(){$(this).dialog("close"),b("dismissErrorStopping")}})},data:m,collectionStopped:function(){this.gotoState("collectionStopped")},dismissErrorStopping:function(){this.gotoState("started")}},stopping:{enterState:function(){U=H.t("sensor.messages.stopping_data_collection")},data:m,stopRequestFailed:function(){this.gotoState("errorStopping")},collectionStopped:function(){this.gotoState("collectionStopped")}},errorStopping:{enterState:function(){U=H.t("sensor.messages.error_stopping_data_collection"),W.alert(H.t("sensor.messages.error_stopping_data_collection_alert"),{OK:function(){$(this).dialog("close"),b("dismissErrorStopping")}})},data:m,collectionStopped:function(){this.gotoState("collectionStopped")},dismissErrorStopping:function(){this.gotoState("started")}},collectionStopped:{enterState:function(){U=H.t("sensor.messages.data_collection_stopped"),v()&&this.gotoState("collectionComplete")},data:function(){m(),v()&&this.gotoState("collectionComplete")}},collectionComplete:{enterState:function(){U=H.t("sensor.messages.data_collection_complete"),P=!0},reset:function(){p(),d(),this.gotoState("connecting"),w.reset()}},disconnected:{enterState:function(){U=H.t("sensor.messages.disconnected"),B=!0,o.stopPolling()},leaveState:function(){B=!1},connect:function(e){o.startPolling(e),this.gotoState("connecting")}}}),o.on("*",function(){var e=Array.prototype.slice.call(arguments,0);b.apply(null,[this.event].concat(e))}),o.on("statusReceived",function(){S&&q.makeInvalidatingChange(function(){var e=new Date;S.liveValueTimeStamp-N>0?(j=!0,N=S.liveValueTimeStamp,R=e):j=e-R<2e3,L=S.liveValue})}),o.on("controlEnabled",function(){F=!0}),o.on("controlDisabled",function(){F=!1}),_=new t({metadata:r,setters:{},unitsDefinition:a,initialProperties:e,usePlaybackSupport:!1}),_.mixInto(q),x=_.propertySupport,w=_.dispatchSupport,w.addEventTypes("tick","play","stop","tickStart","tickEnd"),p(),q.defineOutput("time",{label:H.t("sensor.measurements.time"),unitType:"time",format:".2f"},function(){return O}),q.defineOutput("displayTime",{label:H.t("sensor.measurements.time"),unitType:"time",format:".2f"},function(){return O}),q.defineOutput("sensorReading",Y,function(){return null==M?M:M-q.properties.tareValue}),q.defineOutput("liveSensorReading",Y,function(){return null==L?L:L-q.properties.tareValue}),q.defineOutput("sensorName",{label:"Sensor Name"},function(){return k}),q.defineOutput("isStopped",{label:"Stopped?"},function(){return P}),q.defineOutput("isPlayable",{label:"Startable?"},function(){return D}),q.defineOutput("hasPlayed",{label:"Has successfully collected data?"},function(){return I>0}),q.defineOutput("canTare",{label:"Can set a tare value?"},function(){return V&&G}),q.defineOutput("canConnect",{label:"Can begin connecting to the LabQuest2?"},function(){return B}),q.defineOutput("canControl",{label:"Can remotely start/stop the LabQuest2?"},function(){return F}),q.defineOutput("hasMultipleSensors",{label:"Are multiple sensors connected to the LabQuest2?"},function(){return z}),q.defineOutput("needsReload",{label:"Needs Reload?"},function(){return E}),q.defineOutput("message",{label:"User Message"},function(){return U}),q.on("willReset.model",function(){o.stopPolling(),o.requestStop()}),q.updateAllOutputProperties(),C.gotoState("notConnected"),q}}),define("models/labquest2/view",["require","common/views/numeric-output-view","common/controllers/basic-dialog","models/sensor-common/i18n-sensor-definitions-connector","common/views/view-state"],function(e){var t=e("common/views/numeric-output-view"),n=e("common/controllers/basic-dialog"),r=e("models/sensor-common/i18n-sensor-definitions-connector"),i=e("common/views/view-state");return function(e,o,a){function s(){e.properties.canTare?i.enableView(h.$zeroButton):i.disableView(h.$zeroButton)}function l(){e.properties.canConnect?i.enableView(h.$connectButton):i.disableView(h.$connectButton)}function u(){e.properties.hasMultipleSensors&&e.properties.isPlayable?i.enableView(h.$selectSensorButton):i.disableView(h.$selectSensorButton)}function c(){h.$message.text(e.properties.message)}function d(){e.addObserver("canTare",s),s(),e.addObserver("canConnect",l),l(),e.addObserver("hasMultipleSensors",u),e.addObserver("isPlayable",u),u(),e.addObserver("message",c),c()}function p(){var t,r,i,o=new n({width:"60%",dialogClass:"interactive-dialog no-close",closeOnEscape:!1,title:a.t("sensor.choose_sensor_title"),buttons:{OK:function(){console.log("OK Clicked"),$(this).dialog("close"),e.setSelectedSensor($(this).find("input:checked").val())},Cancel:function(){console.log("Cancel Clicked"),$(this).dialog("close")}}},a),s="",l="",u=e.connectedSensors(),c=!0,d=e.getSelectedSensor();for(t=0;t<u.length;t++)"s"!==u[t]&&(r="",i=g[u[t]],i||(i={measurementName:"Unknown"}),l=i.measurementName+" ("+u[t]+")",(d==t||c&&d==-1)&&(r="checked "),s+="<input type='radio' name='selected-sensor-index' value='"+t+"' "+r+"/>"+l+"<br/>",c=!1);o.setContent(s),o.open()}var f,h,m=d3.format(".2f"),g=r(a);return h={$el:$("<div id='model-container' class='container sensor-model-container' />"),remoteAddress:null,bindModel:function(t,n){o=n||o,e=t||e,d()},getHeightForWidth:function(){return"2.8em"},setup:function(){h.$el.empty(),h.$controlsContainer=$("<div></div>"),h.$statusContainer=$("<div></div>"),h.$addressInput=$("<div class='address-input'><input type='text' name='address-input' placeholder='"+a.t("sensor.address_labquest2")+"'></input></div>"),f=new t({id:"sensor-value-view",label:a.t("sensor.reading"),units:e.getPropertyDescription("sensorReading").getUnitAbbreviation()}),h.$connectButton=$("<div class='interactive-button'><button>"+a.t("sensor.connect")+"</button></div>"),h.$zeroButton=$("<div class='interactive-button'><button>"+a.t("sensor.zero")+"</button></div>"),h.$selectSensorButton=$("<div class='interactive-button'><button>"+a.t("sensor.select_sensor")+"</button></div>"),h.$message=$("<div class='message'></div>"),h.$sensorReading=f.render().addClass("horizontal"),h.$controlsContainer.append(h.$addressInput).append(h.$connectButton).append(h.$sensorReading).append(h.$zeroButton).append(h.$selectSensorButton),h.$statusContainer.append(h.$message),h.$el.css("zIndex",4).append(h.$controlsContainer).append(h.$statusContainer),h.$controlsContainer.find("div").addClass("component component-spacing"),h.$statusContainer.find("div").addClass("component component-spacing"),f.resize(),d(),"string"==typeof h.remoteAddress&&h.$addressInput.find("input").val(h.remoteAddress),h.$addressInput.find("input").on("change",function(){h.remoteAddress=$(this).val()}),h.$addressInput.find("input").on("keypress",function(t){var n=t.keyCode||t.which||0;13==n&&e.properties.canConnect&&(e.connect(h.$addressInput.find("input").val()),t.preventDefault())}),h.$connectButton.on("click","button",function(){e.connect(h.$addressInput.find("input").val())}),h.$zeroButton.on("click","button",e.tare),h.$selectSensorButton.on("click","button",p)},resize:function(){f&&f.resize()},repaint:function(){},setFocus:function(){},updateUnits:function(t){f.updateUnits(t),null==e.properties.liveSensorReading&&f.hideUnits()},update:function(){null==e.properties.liveSensorReading?(f.update(""),f.hideUnits()):(f.update(m(e.properties.liveSensorReading)),f.showUnits())}}}}),define("models/labquest2/scripting-api",[],function(){return function(e){return{resetModel:function(t){e.intController.resetModel(t)}}}}),define("models/labquest2/controller",["require","common/controllers/model-controller","./modeler","./view","./scripting-api"],function(e){var t=e("common/controllers/model-controller"),n=e("./modeler"),r=e("./view"),i=e("./scripting-api");return function(e,o,a){function s(){var e=l.model;e.addObserver("liveSensorReading",function(){l.updateView()}),e.addObserver("needsReload",function(){e.properties.needsReload&&a.reloadModel()}),e.addPropertyDescriptionObserver("sensorReading",function(){var t=e.getPropertyDescription("sensorReading"),n=l.modelContainer;n.updateUnits(t.getUnitAbbreviation())})}var l=new t(e,o,a,n,r,i);return a.on("modelLoaded.labquest2-model-controller",s),a.on("modelReset.labquest2-model-controller",function(){l.model.set("isNewRunInProgress",!1)}),a.on("willResetModel",function(){l.model.set("isNewRunInProgress",!0),l.model.willReset()}),l}}),define("models/energy2d/models/constants",["require","exports","module"],function(e,t,n){"use strict";t.AIR_THERMAL_CONDUCTIVITY=.025,t.AIR_SPECIFIC_HEAT=1012,t.AIR_DENSITY=1.204,t.AIR_VISCOSITY=1568e-8,t.STEFAN_CONSTANT=5.67e-8}),define("models/energy2d/metadata",["require","models/energy2d/models/constants"],function(e){var t=e("models/energy2d/models/constants");return{mainProperties:{type:{defaultValue:"energy2d",immutable:!0},use_WebGL:{defaultValue:!1},grid_width:{defaultValue:100,immutable:!0},grid_height:{defaultValue:100,immutable:!0},model_width:{defaultValue:10,immutable:!0},model_height:{defaultValue:10,immutable:!0},timeStep:{defaultValue:1},timeStepsPerTick:{defaultValue:4},ticksPerGPUSync:{defaultValue:30},convective:{defaultValue:!0},background_temperature:{defaultValue:0},background_conductivity:{defaultValue:t.AIR_THERMAL_CONDUCTIVITY},background_specific_heat:{defaultValue:t.AIR_SPECIFIC_HEAT},background_density:{defaultValue:t.AIR_DENSITY
},background_viscosity:{defaultValue:t.AIR_VISCOSITY},thermal_buoyancy:{defaultValue:25e-5},buoyancy_approximation:{defaultValue:1},boundary:{defaultValue:{type:"temperature",upper:0,lower:0,left:0,right:0}},sunny:{defaultValue:!1},sun_angle:{defaultValue:1.5707964},solar_power_density:{defaultValue:2e3},solar_ray_count:{defaultValue:24},solar_ray_speed:{defaultValue:.1},photon_emission_interval:{defaultValue:20}},viewOptions:{showClock:{defaultValue:!0,propertyChangeInvalidates:!1},controlButtons:{defaultValue:"play_reset",propertyChangeInvalidates:!1},color_palette_type:{defaultValue:0},velocity:{defaultValue:!1},minimum_temperature:{defaultValue:0},maximum_temperature:{defaultValue:40},enableKeyboardHandlers:{defaultValue:!0}},part:{shapeType:{required:!0,immutable:!0},x:{defaultValue:0},y:{defaultValue:0},width:{},height:{},a:{},b:{},inner:{},outer:{},vertices:{},raw_x_coords:{serialize:!1},raw_y_coords:{serialize:!1},thermal_conductivity:{defaultValue:1},specific_heat:{defaultValue:1300},density:{defaultValue:25},transmission:{defaultValue:0},reflection:{defaultValue:0},absorption:{defaultValue:1},emissivity:{defaultValue:0},temperature:{defaultValue:0},constant_temperature:{defaultValue:!1},power:{defaultValue:0},wind_speed:{defaultValue:0},wind_angle:{defaultValue:0},visible:{defaultValue:!0},filled:{defaultValue:!0},color:{defaultValue:"auto"},label:{defaultValue:""},texture:{defaultValue:!1},draggable:{defaultValue:!0}},sensor:{type:{required:!0,immutable:!0},x:{required:!0,unitType:"length"},y:{required:!0,unitType:"length"},angle:{immutable:!0},label:{defaultValue:""},value:{readOnly:!0,serialize:!1}}}}),define("models/energy2d/models/physics-solvers/heat-solver",["require","exports","module","arrays"],function(e,t){"use strict";var n=e("arrays"),r=5;t.makeHeatSolver=function(e){var t=e.getModelOptions(),i=t.grid_width,o=t.grid_height,a=r,s=e.getConductivityArray(),l=e.getCapacityArray(),u=e.getDensityArray(),c=e.getUVelocityArray(),d=e.getVVelocityArray(),p=e.getBoundaryTemperatureArray(),f=e.getFluidityArray(),h=n.create(i*o,0,e.getArrayType()),m=i-1,g=o-1,v=i-2,y=o-2,b=t.model_width/t.grid_width,_=t.model_height/t.grid_height,x=function(e){var n,r,a,l,u=t.boundary,c=u.upper,d=u.lower,p=u.left,f=u.right;if("temperature"===u.type){for(n=0;n<i;n+=1)a=n*i,e[a]=c,e[a+g]=d;for(r=0;r<o;r+=1)e[r]=p,e[m*i+r]=f}else if("flux"===u.type){for(n=0;n<i;n+=1)a=n*i,l=a+g,e[a]=e[a+1]+c*_/s[a],e[l]=e[a+y]-d*_/s[l];for(r=0;r<o;r+=1)e[r]=e[i+r]-p*b/s[r],e[m*i+r]=e[v*i+r]+f*b/s[m*i+r]}},w=function(e){var n,r,o,a,s,l,u,p,v=t.timeStep,y=.5*v/b,w=.5*v/_;for(n=1;n<m;n+=1)for(o=n*i,r=1;r<g;r+=1)a=o+r,l=a-i,s=a+i,p=a-1,u=a+1,f[a]&&(h[a]=e[a]-y*(c[s]*e[s]-c[l]*e[l])-w*(d[u]*e[u]-d[p]*e[p]));for(x(h),n=1;n<m;n+=1)for(o=n*i,r=1;r<g;r+=1)a=o+r,f[a]&&(l=a-i,s=a+i,p=a-1,u=a+1,e[a]=.5*(e[a]+h[a])-.5*y*c[a]*(h[s]-h[l])-.5*w*d[a]*(h[u]-h[p]));x(e)};return{solve:function(e,r,o){var c,d,f,v,y,C,T,S,A,k,P,E,O,M,L,N=t.timeStep,R=.5/(b*b),I=.5/(_*_),D=1/N;for(n.copy(r,h),T=0;T<a;T+=1){for(S=1;S<m;S+=1)for(k=S*i,A=1;A<g;A+=1)P=k+A,isNaN(p[P])?(O=P-i,E=P+i,L=P-1,M=P+1,d=l[P]*u[P]*D,c=s[P],f=R*(c+s[O]),v=R*(c+s[E]),y=I*(c+s[L]),C=I*(c+s[M]),r[P]=(h[P]*d+o[P]+f*r[O]+v*r[E]+y*r[L]+C*r[M])/(d+f+v+y+C)):r[P]=p[P];x(r)}e&&w(r)}}}}),define("models/energy2d/gpu/context",[],function(){"use strict";var e;return{getWebGLContext:function(){if(!e){var t=document.createElement("canvas");try{e=t.getContext("webgl")||t.getContext("experimental-webgl")}catch(e){}if(!e)throw new Error("GL: WebGL not supported.")}return e},get error(){if(!e)return"WebGL unavailable";var t=e.getError();return t===e.NO_ERROR?void 0:t}}}),define("models/energy2d/gpu/shader",["require","common/console","models/energy2d/gpu/context"],function(e){"use strict";var t,n,r=e("common/console"),i=e("models/energy2d/gpu/context"),o=function(e,t,n){for(var r;null!==(r=e.exec(t));)n(r)},a=function(e){var t=Object.prototype.toString.call(e);return"[object Array]"===t||"[object Float32Array]"===t},s=function(e){var t=Object.prototype.toString.call(e);return"[object Number]"===t||"[object Boolean]"===t};return n=function(e,n){function r(e,n){var r=t.createShader(e);if(t.shaderSource(r,n),t.compileShader(r),!t.getShaderParameter(r,t.COMPILE_STATUS))throw new Error("Shader: compile error.\n"+t.getShaderInfoLog(r)+"\nSource:\n"+n);return r}var a="      attribute vec4 gl_Vertex;      attribute vec4 gl_TexCoord;      attribute vec3 gl_Normal;      attribute vec4 gl_Color;      ",s="      precision highp float;      ",l=function(e,t){var n,r={};return n=/^((\s*\/\/.*\n|\s*#extension.*\n)+)[^]*$/.exec(t),t=n?n[1]+e+t.substr(n[1].length):e+t,o(/\bgl_\w+\b/g,e,function(e){void 0===r[e]&&(t=t.replace(new RegExp("\\b"+e+"\\b","g"),"_"+e),r[e]=!0)}),t},u={};if(t=i.getWebGLContext(),e=l(a,e),n=l(s,n),this.program=t.createProgram(),t.attachShader(this.program,r(t.VERTEX_SHADER,e)),t.attachShader(this.program,r(t.FRAGMENT_SHADER,n)),t.linkProgram(this.program),!t.getProgramParameter(this.program,t.LINK_STATUS))throw new Error("Shader: link error.\n"+t.getProgramInfoLog(this.program)+"\nSource:\n"+e+"\n\n"+n);this.attributes={},this.uniformLocations={},o(/uniform\s+sampler(1D|2D|3D|Cube)\s+(\w+)\s*;/g,e+n,function(e){u[e[2]]=1}),this.isSampler=u},n.prototype.uniforms=function(e){var n,i,o;t.useProgram(this.program);for(n in e)if(e.hasOwnProperty(n)){if(void 0===this.uniformLocations[n]&&(this.uniformLocations[n]=t.getUniformLocation(this.program,n)),i=this.uniformLocations[n],null===i){r.warn("Shader: name "+n+" does not correspond to an active uniform variable.");continue}if(o=e[n],a(o))switch(o.length){case 1:t.uniform1fv(i,new Float32Array(o));break;case 2:t.uniform2fv(i,new Float32Array(o));break;case 3:t.uniform3fv(i,new Float32Array(o));break;case 4:t.uniform4fv(i,new Float32Array(o));break;case 9:t.uniformMatrix3fv(i,!1,new Float32Array([o[0],o[3],o[6],o[1],o[4],o[7],o[2],o[5],o[8]]));break;case 16:t.uniformMatrix4fv(i,!1,new Float32Array([o[0],o[4],o[8],o[12],o[1],o[5],o[9],o[13],o[2],o[6],o[10],o[14],o[3],o[7],o[11],o[15]]));break;default:throw new Error("Shader: don't know how to load uniform \""+n+'" of length '+o.length)}else{if(!s(o))throw new Error('Shader: attempted to set uniform "'+n+'" to invalid value '+o);(this.isSampler[n]?t.uniform1i:t.uniform1f).call(t,i,o)}}return this},n.prototype.draw=function(e,n){t.useProgram(this.program),this.drawBuffers(e.vertexBuffers,e.indexBuffers[n===t.LINES?"lines":"triangles"],arguments.length<2?t.TRIANGLES:n)},n.prototype.drawBuffers=function(e,n,r){var i,o,a,s=0;for(i in e)if(e.hasOwnProperty(i)){if(o=e[i],void 0===this.attributes[i]&&(this.attributes[i]=t.getAttribLocation(this.program,i.replace(/^gl_/,"_gl_"))),a=this.attributes[i],a===-1||!o.buffer)continue;t.bindBuffer(t.ARRAY_BUFFER,o.buffer),t.enableVertexAttribArray(a),t.vertexAttribPointer(a,o.buffer.spacing,t.FLOAT,!1,0,0),s=o.buffer.length/o.buffer.spacing}for(i in this.attributes)this.attributes.hasOwnProperty(i)&&void 0===e[i]&&t.disableVertexAttribArray(this.attributes[i]);!s||n&&!n.buffer||(n?(t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,n.buffer),t.drawElements(r,n.buffer.length,t.UNSIGNED_SHORT,0)):t.drawArrays(r,0,s))},n}),define("models/energy2d/gpu/texture",["require","models/energy2d/gpu/context"],function(e){"use strict";var t,n,r=e("models/energy2d/gpu/context");return n=function(e,n,i){t=r.getWebGLContext(),i=i||{},this.id=t.createTexture(),this.width=e,this.height=n,this.format=i.format||t.RGBA,this.type=i.type||t.UNSIGNED_BYTE,this.tex_unit=null,this.fbo=null,t.bindTexture(t.TEXTURE_2D,this.id),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,i.mag_filter||i.filter||t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,i.min_filter||i.filter||t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,i.wrap||i.wrap_s||t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,i.wrap||i.wrap_t||t.CLAMP_TO_EDGE),t.texImage2D(t.TEXTURE_2D,0,this.format,e,n,0,this.format,this.type,null)},n.prototype.setAsRenderTarget=function(){null===this.fbo?(this.fbo=t.createFramebuffer(),t.bindFramebuffer(t.FRAMEBUFFER,this.fbo),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,this.id,0),t.viewport(0,0,this.width,this.height)):(t.bindFramebuffer(t.FRAMEBUFFER,this.fbo),t.viewport(0,0,this.width,this.height))},n.prototype.bind=function(e){this.tex_unit=e||0,t.activeTexture(t.TEXTURE0+this.tex_unit),t.bindTexture(t.TEXTURE_2D,this.id)},n.prototype.unbind=function(e){null!==this.tex_unit&&(t.activeTexture(t.TEXTURE0+this.tex_unit),t.bindTexture(t.TEXTURE_2D,null),this.tex_unit=null)},n.prototype.drawTo=function(e){if(null===this.fbo)throw new Error("Texture: call setupAsRenderTarget() method first.");t.bindFramebuffer(t.FRAMEBUFFER,this.fbo),t.viewport(0,0,this.width,this.height),e(),t.bindFramebuffer(t.FRAMEBUFFER,null)},n.prototype.swapWith=function(e){var t;t=e.id,e.id=this.id,this.id=t,t=e.tex_unit,e.tex_unit=this.tex_unit,this.tex_unit=t,t=e.fbo,e.fbo=this.fbo,this.fbo=t},n}),define("models/energy2d/gpu/mesh",["require","models/energy2d/gpu/context"],function(e){"use strict";var t,n,r,i=e("models/energy2d/gpu/context");return n=function(e,n){t=i.getWebGLContext(),this.buffer=null,this.target=e,this.type=n,this.data=[]},n.prototype.compile=function(e){var n,r,i,o=[];for(n=0,r=1e4;n<this.data.length;n+=r)o=Array.prototype.concat.apply(o,this.data.slice(n,n+r));if(i=this.data.length?o.length/this.data.length:0,i!==Math.round(i))throw new Error("Mesh: buffer elements not of consistent size, average size is "+i);this.buffer=this.buffer||t.createBuffer(),this.buffer.length=o.length,this.buffer.spacing=i,t.bindBuffer(this.target,this.buffer),t.bufferData(this.target,new this.type(o),e||t.STATIC_DRAW)},r=function(e){t=i.getWebGLContext(),e=e||{},this.vertexBuffers={},this.indexBuffers={},this.addVertexBuffer("vertices","gl_Vertex"),e.coords&&this.addVertexBuffer("coords","gl_TexCoord"),e.normals&&this.addVertexBuffer("normals","gl_Normal"),e.colors&&this.addVertexBuffer("colors","gl_Color"),(void 0===e.lines||e.triangles)&&this.addIndexBuffer("triangles"),e.lines&&this.addIndexBuffer("lines")},r.prototype.addVertexBuffer=function(e,r){var i=this.vertexBuffers[r]=new n(t.ARRAY_BUFFER,Float32Array);i.name=e,this[e]=[]},r.prototype.addIndexBuffer=function(e){this.indexBuffers[e]=new n(t.ELEMENT_ARRAY_BUFFER,Uint16Array);this[e]=[]},r.prototype.compile=function(){var e,t,n;for(e in this.vertexBuffers)this.vertexBuffers.hasOwnProperty(e)&&(n=this.vertexBuffers[e],n.data=this[n.name],n.compile());for(t in this.indexBuffers)this.indexBuffers.hasOwnProperty(t)&&(n=this.indexBuffers[t],n.data=this[t],n.compile())},r.plane=function(e){var t,n,i,o,a,s,l,u;for(e=e||{},t=new r(e),n=e.detailX||e.detail||1,i=e.detailY||e.detail||1,a=0;a<=i;a+=1)for(s=a/i,o=0;o<=n;o+=1)l=o/n,t.vertices.push([2*l-1,2*s-1,0]),t.coords&&t.coords.push([l,s]),t.normals&&t.normals.push([0,0,1]),o<n&&a<i&&(u=o+a*(n+1),t.triangles.push([u,u+1,u+n+1]),t.triangles.push([u+n+1,u+1,u+n+2]));return t.compile(),t},r}),define("models/energy2d/gpu/gpgpu",["require","models/energy2d/gpu/context","models/energy2d/gpu/texture","models/energy2d/gpu/shader","models/energy2d/gpu/mesh"],function(e){"use strict";var t,n,r,i,o,a,s,l,u,c=e("models/energy2d/gpu/context"),d=e("models/energy2d/gpu/texture"),p=e("models/energy2d/gpu/shader"),f=e("models/energy2d/gpu/mesh"),h=!1,m=!1,g="    varying vec2 coord;    void main() {      coord = gl_Vertex.xy * 0.5 + 0.5;      gl_Position = vec4(gl_Vertex.xyz, 1.0);    }",v="    uniform sampler2D texture;    uniform float channel;    varying vec2 coord;    float shift_right(float v, float amt) {      v = floor(v) + 0.5;      return floor(v / exp2(amt));    }    float shift_left(float v, float amt) {      return floor(v * exp2(amt) + 0.5);    }        float mask_last(float v, float bits) {      return mod(v, shift_left(1.0, bits));    }    float extract_bits(float num, float from, float to) {      from = floor(from + 0.5);      to = floor(to + 0.5);      return mask_last(shift_right(num, from), to - from);    }    vec4 encode_float(float val) {      if (val == 0.0)        return vec4(0, 0, 0, 0);      float sign = val > 0.0 ? 0.0 : 1.0;      val = abs(val);      float exponent = floor(log2(val));      float biased_exponent = exponent + 127.0;      float fraction = ((val / exp2(exponent)) - 1.0) * 8388608.0;            float t = biased_exponent / 2.0;      float last_bit_of_biased_exponent = fract(t) * 2.0;      float remaining_bits_of_biased_exponent = floor(t);            float byte4 = extract_bits(fraction, 0.0, 8.0) / 255.0;      float byte3 = extract_bits(fraction, 8.0, 16.0) / 255.0;      float byte2 = (last_bit_of_biased_exponent * 128.0 + extract_bits(fraction, 16.0, 23.0)) / 255.0;      float byte1 = (sign * 128.0 + remaining_bits_of_biased_exponent) / 255.0;      return vec4(byte4, byte3, byte2, byte1);    }    void main() {      vec4 data = texture2D(texture, coord);      if (channel == 0.0)        gl_FragColor = encode_float(data.r);      else if (channel == 1.0)        gl_FragColor = encode_float(data.g);      else if (channel == 2.0)        gl_FragColor = encode_float(data.b);      else        gl_FragColor = encode_float(data.a);    }",y="    uniform sampler2D texture;    varying vec2 coord;    void main() {      gl_FragColor = texture2D(texture, coord);    }",b="GPGPU: call init(grid_width, grid_height) with proper dimensions first!",_={WebGLContext:{required:!0,available:!1},OES_texture_float:{required:!0,available:!1},"FLOAT texture as render target":{required:!0,available:!1},OES_texture_float_linear:{required:!1,available:!1}},x=function(){if(t=c.getWebGLContext(),!t)throw _.WebGLContext.available=!1,new Error("GPGPU: WebGL is not supported!");if(_.WebGLContext.available=!0,!t.getExtension("OES_texture_float"))throw _.OES_texture_float.available=!1,new Error("GPGPU: OES_texture_float is not supported!");if(_.OES_texture_float.available=!0,t.getExtension("OES_texture_float_linear")?_.OES_texture_float_linear.available=!0:(_.OES_texture_float_linear.available=!1,console.warn("GPGPU: OES_texture_float_linear is not supported. Renering quality will be affected.")),i=new d(1,1,{type:t.FLOAT,format:t.RGBA,filter:_.OES_texture_float_linear.available?t.LINEAR:t.NEAREST}),i.setAsRenderTarget(),t.checkFramebufferStatus(t.FRAMEBUFFER)!==t.FRAMEBUFFER_COMPLETE)throw t.bindFramebuffer(t.FRAMEBUFFER,null),_["FLOAT texture as render target"].available=!1,new Error("GPGPU: FLOAT texture as render target is not supported!");_["FLOAT texture as render target"].available=!0,t.bindFramebuffer(t.FRAMEBUFFER,null),t.disable(t.DEPTH_TEST),s=f.plane(),l=new p(g,v),u=new p(g,y),m=!0},w=function(e,t,n,r,i){var o,a,s;if(e.length!==t.length||e.length!==n.length||e.length!==r.length||i.length!==4*e.length)throw new Error("GPGPU: Invalid input data length.");for(o=0,s=e.length;o<s;o+=1)a=4*o,i[a]=e[o],i[a+1]=t[o],i[a+2]=n[o],i[a+3]=r[o]};return{init:function(e,s){var l;m||x(),n=e,r=s,l=_.OES_texture_float_linear.available?t.LINEAR:t.NEAREST,i=new d(n,r,{type:t.FLOAT,format:t.RGBA,filter:l}),o=new d(n,r,{type:t.UNSIGNED_BYTE,format:t.RGBA,filter:l}),a=new Float32Array(n*r*4)},get featuresInfo(){if(!m)try{x()}catch(e){}return _},getWebGLContext:function(){return void 0===t&&x(),t},createTexture:function(){return n&&r?new d(n,r,{type:t.FLOAT,format:t.RGBA,filter:_.OES_texture_float_linear.available?t.LINEAR:t.NEAREST}):new Error(b)},convertToRGBA:function(e,t,i){var o,a,s,l;if(e.length!==n*r)throw new Error("GPGPU: Invalid input data length.");for(o=void 0===i?new Float32Array(4*e.length):i,void 0===t&&(t=0),a=0,s=e.length;a<s;a+=1)l=4*a,o[l]=o[l+1]=o[l+2]=o[l+3]=0,o[l+t]=e[a];return o},writeTexture:function(e,n){var r=this.convertToRGBA(n,0,a);t.bindTexture(t.TEXTURE_2D,e.id),t.texImage2D(t.TEXTURE_2D,0,e.format,e.width,e.height,0,e.format,e.type,r)},writeRGBATexture:function(e,n,r,i,o){w(n,r,i,o,a),t.bindTexture(t.TEXTURE_2D,e.id),t.texImage2D(t.TEXTURE_2D,0,e.format,e.width,e.height,0,e.format,e.type,a)},readTexture:function(e,i,a){var u;return t&&e.width===n&&e.height===r?(void 0===a&&(a=0),u=new Uint8Array(i.buffer),e.bind(),o.setAsRenderTarget(),l.uniforms({channel:a}),l.draw(s),void t.readPixels(0,0,o.width,o.height,o.format,o.type,u)):new Error(b)},copyTexture:function(e,t){e.bind(),t.setAsRenderTarget(),u.draw(s)},executeProgram:function(e,t,n){var r,o;for(r=0,o=t.length;r<o;r+=1)t[r].bind(r);for(i.setAsRenderTarget(),e.draw(s),r=0,o=t.length;r<o;r+=1)t[r].unbind(r);n.swapWith(i)},setSynchronizationAllowed:function(e){h=e},tryFinish:function(){h&&t.finish()}}}),define("text!models/energy2d/models/physics-solvers-gpu/heat-solver-glsl/basic.vs.glsl",[],function(){return"varying vec2 coord;\n\nvoid main() {\n  coord = gl_Vertex.xy * 0.5 + 0.5;\n  gl_Position = vec4(gl_Vertex.xy, 0.0, 1.0);\n}\n"}),define("text!models/energy2d/models/physics-solvers-gpu/heat-solver-glsl/solver.fs.glsl",[],function(){return'// texture 0:\n// - R: t\n// - G: t0\n// - B: tb\n// - A: conductivity\nuniform sampler2D data0_tex;\n// texture 1:\n// - R: q\n// - G: capacity\n// - B: density\n// - A: fluidity\nuniform sampler2D data1_tex;\n\nuniform vec2 grid;\nuniform float hx;\nuniform float hy;\nuniform float inv_timeStep;\n\n// Boundary conditions uniforms\nuniform float enforce_temp;\nuniform float vN;\nuniform float vS;\nuniform float vW;\nuniform float vE;\n\nvarying vec2 coord;\n\nvoid main() {\n  vec4 data0 = texture2D(data0_tex, coord);\n  if (coord.x > grid.x && coord.x < 1.0 - grid.x &&\n      coord.y > grid.y && coord.y < 1.0 - grid.y) {\n    vec2 dx = vec2(grid.x, 0.0);\n    vec2 dy = vec2(0.0, grid.y);\n    float tb = data0.b;\n    // Check if tb is NaN. isnan() function is not available\n    // in OpenGL ES GLSL, so use some tricks. IEEE 754 spec defines\n    // that NaN != NaN, however this seems to not work on Windows.\n    // So, also check if the value is outside [-3.4e38, 3.4e38] (3.4e38\n    // is close to 32Float max value), as such values are not expected.\n    if (tb != tb || tb < -3.4e38 || tb > 3.4e38) {\n      vec4 data1 = texture2D(data1_tex, coord);\n      vec4 data0_m_dy = texture2D(data0_tex, coord - dy);\n      vec4 data0_p_dy = texture2D(data0_tex, coord + dy);\n      vec4 data0_m_dx = texture2D(data0_tex, coord - dx);\n      vec4 data0_p_dx = texture2D(data0_tex, coord + dx);\n      float sij = data1.g * data1.b * inv_timeStep;\n      float rij = data0.a;\n      float axij = hx * (rij + data0_m_dy.a);\n      float bxij = hx * (rij + data0_p_dy.a);\n      float ayij = hy * (rij + data0_m_dx.a);\n      float byij = hy * (rij + data0_p_dx.a);\n      data0.r = (data0.g * sij + data1.r\n                 + axij * data0_m_dy.r\n                 + bxij * data0_p_dy.r\n                 + ayij * data0_m_dx.r\n                 + byij * data0_p_dx.r)\n                 / (sij + axij + bxij + ayij + byij);\n    } else {\n      data0.r = tb;\n    }\n  } else if (enforce_temp == 1.0) {\n    // "temperature at border" boundary conditions are\n    // integrated into this shader.\n    if (coord.x < grid.x) {\n      data0.r = vN;\n    } else if (coord.x > 1.0 - grid.x) {\n      data0.r = vS;\n    } else if (coord.y < grid.y) {\n      data0.r = vW;\n    } else if (coord.y > 1.0 - grid.y) {\n      data0.r = vE;\n    }\n  }\n  gl_FragColor = data0;\n}\n'}),define("text!models/energy2d/models/physics-solvers-gpu/heat-solver-glsl/force-flux-t.fs.glsl",[],function(){return"// texture 0: \n// - R: t\n// - G: t0\n// - B: tb\n// - A: conductivity\nuniform sampler2D data0_tex;\n\nuniform vec2 grid;\nuniform float vN;\nuniform float vS;\nuniform float vW;\nuniform float vE;\nuniform float delta_x;\nuniform float delta_y;\n\nvarying vec2 coord;\n\nvoid main() {\n  vec4 data0 = texture2D(data0_tex, coord);\n  vec2 dx = vec2(grid.x, 0.0);\n  vec2 dy = vec2(0.0, grid.y);\n  if (coord.x < grid.x) {\n    data0.r = texture2D(data0_tex, coord + dx).r\n            + vN * delta_y / data0.a;\n  } else if (coord.x > 1.0 - grid.x) {\n    data0.r = texture2D(data0_tex, coord - dx).r\n            - vS * delta_y / data0.a;\n  } else if (coord.y < grid.y) {\n    data0.r = texture2D(data0_tex, coord + dy).r\n            - vW * delta_x / data0.a;\n  } else if (coord.y > 1.0 - grid.y) {\n    data0.r = texture2D(data0_tex, coord - dy).r\n            + vE * delta_x / data0.a;\n  }\n  gl_FragColor = data0;\n}\n"}),define("text!models/energy2d/models/physics-solvers-gpu/heat-solver-glsl/t-to-t0.fs.glsl",[],function(){return"// texture 0: \n// - R: t\n// - G: t0\n// - B: tb\n// - A: conductivity\nuniform sampler2D data0_tex;\n\nvarying vec2 coord;\n\nvoid main() {\n\tvec4 data0 = texture2D(data0_tex, coord);\n\tdata0.g = data0.r;\n\tgl_FragColor = data0;\n}\n"}),define("text!models/energy2d/models/physics-solvers-gpu/heat-solver-glsl/maccormack-step1.fs.glsl",[],function(){return'// texture 0: \n// - R: t\n// - G: t0\n// - B: tb\n// - A: conductivity\nuniform sampler2D data0_tex;\n// texture 1: \n// - R: q\n// - G: capacity\n// - B: density\n// - A: fluidity\nuniform sampler2D data1_tex;\n// texture 2: \n// - R: u\n// - G: v\n// - B: u0\n// - A: v0\nuniform sampler2D data2_tex;\n\nuniform vec2 grid;\nuniform float tx;\nuniform float ty;\n\n// Boundary conditions uniforms.\nuniform float enforce_temp;\nuniform float vN;\nuniform float vS;\nuniform float vW;\nuniform float vE;\n\nvarying vec2 coord;\n\nvoid main() {\n  vec4 data0 = texture2D(data0_tex, coord);\n  \n  if (coord.x > grid.x && coord.x < 1.0 - grid.x &&\n      coord.y > grid.y && coord.y < 1.0 - grid.y) {\n    \n    float fluidity = texture2D(data1_tex, coord).a;\n    if (fluidity == 1.0) {\n      vec2 dx = vec2(grid.x, 0.0);\n      vec2 dy = vec2(0.0, grid.y);\n\n      // Temperature.\n      float t_m_dy = texture2D(data0_tex, coord - dy).r;\n      float t_p_dy = texture2D(data0_tex, coord + dy).r;\n      float t_m_dx = texture2D(data0_tex, coord - dx).r;\n      float t_p_dx = texture2D(data0_tex, coord + dx).r;\n      // Velocity.\n      float u_m_dy = texture2D(data2_tex, coord - dy).r;\n      float u_p_dy = texture2D(data2_tex, coord + dy).r;\n      float v_m_dx = texture2D(data2_tex, coord - dx).g;\n      float v_p_dx = texture2D(data2_tex, coord + dx).g;\n      // Update T0.\n      data0.g = data0.r - tx * (u_p_dy * t_p_dy - u_m_dy * t_m_dy)\n                        - ty * (v_p_dx * t_p_dx - v_m_dx * t_m_dx);\n    }\n  } else if (enforce_temp == 1.0) {\n    // "temperature at border" boundary conditions are\n    // integrated into this shader.\n    if (coord.x < grid.x) {\n      data0.g = vN;\n    } else if (coord.x > 1.0 - grid.x) {\n      data0.g = vS;\n    } else if (coord.y < grid.y) {\n      data0.g = vW;\n    } else if (coord.y > 1.0 - grid.y) {\n      data0.g = vE;\n    }\n  }\n  gl_FragColor = data0;\n}\n'}),define("text!models/energy2d/models/physics-solvers-gpu/heat-solver-glsl/maccormack-step2.fs.glsl",[],function(){return'// texture 0: \n// - R: t\n// - G: t0\n// - B: tb\n// - A: conductivity\nuniform sampler2D data0_tex;\n// texture 1: \n// - R: q\n// - G: capacity\n// - B: density\n// - A: fluidity\nuniform sampler2D data1_tex;\n// texture 2: \n// - R: u\n// - G: v\n// - B: u0\n// - A: v0\nuniform sampler2D data2_tex;\n\nuniform vec2 grid;\nuniform float tx;\nuniform float ty;\n\n// Boundary conditions uniforms.\nuniform float enforce_temp;\nuniform float vN;\nuniform float vS;\nuniform float vW;\nuniform float vE;\n\nvarying vec2 coord;\n\nvoid main() {\n  vec4 data0 = texture2D(data0_tex, coord);\n  \n  if (coord.x > grid.x && coord.x < 1.0 - grid.x &&\n      coord.y > grid.y && coord.y < 1.0 - grid.y) {\n    \n    float fluidity = texture2D(data1_tex, coord).a;\n    if (fluidity == 1.0) {\n      vec2 dx = vec2(grid.x, 0.0);\n      vec2 dy = vec2(0.0, grid.y);\n\n      // Temperature t0.\n      float t0_m_dy = texture2D(data0_tex, coord - dy).g;\n      float t0_p_dy = texture2D(data0_tex, coord + dy).g;\n      float t0_m_dx = texture2D(data0_tex, coord - dx).g;\n      float t0_p_dx = texture2D(data0_tex, coord + dx).g;\n      // Velocity.\n      float u = texture2D(data2_tex, coord).r;\n      float v = texture2D(data2_tex, coord).g;\n      // Update T.\n      data0.r = 0.5 * (data0.r + data0.g)\n              - 0.5 * tx * u * (t0_p_dy - t0_m_dy)\n              - 0.5 * ty * v * (t0_p_dx - t0_m_dx);\n    }\n  } else if (enforce_temp == 1.0) {\n    // "temperature at border" boundary conditions are\n    // integrated into this shader.\n    if (coord.x < grid.x) {\n      data0.r = vN;\n    } else if (coord.x > 1.0 - grid.x) {\n      data0.r = vS;\n    } else if (coord.y < grid.y) {\n      data0.r = vW;\n    } else if (coord.y > 1.0 - grid.y) {\n      data0.r = vE;\n    }\n  }\n  gl_FragColor = data0;\n}\n'}),define("models/energy2d/models/physics-solvers-gpu/heat-solver-gpu",["require","exports","module","models/energy2d/gpu/shader","models/energy2d/gpu/gpgpu","text!models/energy2d/models/physics-solvers-gpu/heat-solver-glsl/basic.vs.glsl","text!models/energy2d/models/physics-solvers-gpu/heat-solver-glsl/solver.fs.glsl","text!models/energy2d/models/physics-solvers-gpu/heat-solver-glsl/force-flux-t.fs.glsl","text!models/energy2d/models/physics-solvers-gpu/heat-solver-glsl/force-flux-t.fs.glsl","text!models/energy2d/models/physics-solvers-gpu/heat-solver-glsl/t-to-t0.fs.glsl","text!models/energy2d/models/physics-solvers-gpu/heat-solver-glsl/maccormack-step1.fs.glsl","text!models/energy2d/models/physics-solvers-gpu/heat-solver-glsl/maccormack-step2.fs.glsl"],function(e,t){"use strict";var n=e("models/energy2d/gpu/shader"),r=e("models/energy2d/gpu/gpgpu"),i=e("text!models/energy2d/models/physics-solvers-gpu/heat-solver-glsl/basic.vs.glsl"),o=e("text!models/energy2d/models/physics-solvers-gpu/heat-solver-glsl/solver.fs.glsl"),a=e("text!models/energy2d/models/physics-solvers-gpu/heat-solver-glsl/force-flux-t.fs.glsl"),s=e("text!models/energy2d/models/physics-solvers-gpu/heat-solver-glsl/force-flux-t.fs.glsl"),l=e("text!models/energy2d/models/physics-solvers-gpu/heat-solver-glsl/t-to-t0.fs.glsl"),u=e("text!models/energy2d/models/physics-solvers-gpu/heat-solver-glsl/maccormack-step1.fs.glsl"),c=e("text!models/energy2d/models/physics-solvers-gpu/heat-solver-glsl/maccormack-step2.fs.glsl"),d=10;t.makeHeatSolverGPU=function(e){var t=new n(i,o),p=new n(i,a),f=new n(i,s),h=new n(i,l),m=new n(i,u),g=new n(i,c),v=e.getModelOptions(),y=v.grid_width,b=v.grid_height,_=v.timeStep,x=v.boundary,w=v.model_width/v.grid_width,C=v.model_height/v.grid_height,T=d,S=e.getSimulationTexture(0),A=e.getSimulationTexture(1),k=e.getSimulationTexture(2),P=[S,A,k],E=[S,A],O=[S],M=[1/b,1/y],L=function(){var e;e={data0_tex:0,data1_tex:1,grid:M,enforce_temp:0,hx:.5/(w*w),hy:.5/(C*C),inv_timeStep:1/_},t.uniforms(e),e={data0_tex:0,data1_tex:1,data2_tex:2,grid:M,enforce_temp:0,tx:.5*_/w,ty:.5*_/C},m.uniforms(e),g.uniforms(e),"temperature"===x.type?(e={enforce_temp:1,vN:x.upper,vS:x.lower,vW:x.left,vE:x.right},t.uniforms(e),m.uniforms(e),g.uniforms(e)):"flux"===x.type&&(e={data0_tex:0,grid:M,vN:x.upper,vS:x.lower,vW:x.left,vE:x.right,delta_x:w,delta_y:C},p.uniforms(e),f.uniforms(e))},N=function(){r.executeProgram(m,P,S),"flux"===x.type&&r.executeProgram(f,O,S),r.executeProgram(g,P,S),"flux"===x.type&&r.executeProgram(p,O,S)},R={solve:function(e){var n;for(r.executeProgram(h,O,S),n=0;n<T;n+=1)r.executeProgram(t,E,S),"flux"===x.type&&r.executeProgram(p,O,S);e&&N()}};return L(),R}}),define("models/energy2d/models/physics-solvers/fluid-solver",["require","exports","module","arrays"],function(e,t){"use strict";var n=e("arrays"),r=5,i=0,o=0,a=1;t.makeFluidSolver=function(e){var t=e.getModelOptions(),s=t.grid_width,l=t.grid_height,u=r,c=i,d=e.getTemperatureArray(),p=e.getFluidityArray(),f=e.getUWindArray(),h=e.getVWindArray(),m=e.getArrayType(),g=n.create(s*l,0,m),v=n.create(s*l,0,m),y=s-1,b=l-1,_=s-2,x=l-2,w=t.model_width/t.grid_width,C=t.model_height/t.grid_height,T=.5/w,S=.5/C,A=1/(w*w),k=1/(C*C),P=function(e,t){var n,r,i,o,a,l,u,c=1===e,d=2===e,p=y*s,f=_*s;for(n=1;n<y;n+=1)i=n*s,o=i+1,a=i+b,l=i+x,t[i]=d?-t[o]:t[o],t[a]=d?-t[l]:t[l];for(r=1;r<b;r+=1)u=s+r,t[r]=c?-t[u]:t[u],t[p+r]=c?-t[f+r]:t[f+r];t[0]=.5*(t[s]+t[1]),t[p]=.5*(t[f]+t[p+1]),t[b]=.5*(t[s+b]+t[x]),t[p+b]=.5*(t[f+b]+t[p+x])},E=function(e,t){var n,r,i,o,a,l,u,c,d,m,g=0;for(i=1;i<y;i+=1)for(a=i*s,o=1;o<b;o+=1)l=a+o,c=l-s,u=l+s,m=l-1,d=l+1,p[l]||(n=f[l],r=h[l],g=0,p[c]?(g+=1,e[l]=n-e[c],t[l]=r+t[c]):p[u]&&(g+=1,e[l]=n-e[u],t[l]=r+t[u]),p[m]?(g+=1,e[l]=n+e[m],t[l]=r-t[m]):p[d]&&(g+=1,e[l]=n+e[d],t[l]=r-t[d]),0===g&&(e[l]=n,t[l]=r))},O=function(e){var t,n,r,i,o,a,l,u;for(t=1;t<y;t+=1)for(r=t*s,n=1;n<b;n+=1)i=r+n,p[i]||(a=i-s,o=i+s,u=i-1,l=i+1,p[a]?e[i]=e[a]:p[o]&&(e[i]=e[o]),p[u]?e[i]=e[u]:p[l]&&(e[i]=e[l]))},M=function(e,t){var n,r,i=0,o=l,a=0;for(n=t-1;n>0;n-=1)if(r=e*s+n,!p[r]){i=n;break}for(n=t+1;n<l;n+=1)if(r=e*s+n,!p[r]){o=n;break}for(n=i;n<o;n+=1)r=e*s+n,a+=d[r];return a/(o-i)},L=function(e){var n,r,i,l,u,f=c*t.timeStep,h=t.thermal_buoyancy*t.timeStep;switch(t.buoyancy_approximation){case o:for(n=function(e){var t,n=0,r=e.length;for(t=0;t<r;t+=1)n+=e[t];return n/r}(d),r=1;r<y;r+=1)for(l=r*s,i=1;i<b;i+=1)u=l+i,p[u]&&(e[u]+=(f-h)*d[u]+h*n);break;case a:for(r=1;r<y;r+=1)for(l=r*s,i=1;i<b;i+=1)u=l+i,p[u]&&(n=M(r,i),e[u]+=(f-h)*d[u]+h*n)}},N=function(e,t,n,r){var i,o,a,l,c,d,f,h,m,g=.5/(A+k);for(o=1;o<y;o+=1)for(l=o*s,a=1;a<b;a+=1)c=l+a,p[c]&&(f=c-s,d=c+s,m=c-1,h=c+1,r[c]=(e[d]-e[f])*T+(t[h]-t[m])*S,n[c]=0);for(P(0,r),P(0,n),O(r),O(n),i=0;i<u;i+=1)for(o=1;o<y;o+=1)for(l=o*s,a=1;a<b;a+=1)c=l+a,p[c]&&(f=c-s,d=c+s,m=c-1,h=c+1,n[c]=g*((n[f]+n[d])*A+(n[m]+n[h])*k-r[c]));for(o=1;o<y;o+=1)for(l=o*s,a=1;a<b;a+=1)c=l+a,p[c]&&(f=c-s,d=c+s,m=c-1,h=c+1,e[c]-=(n[d]-n[f])*T,t[c]-=(n[h]-n[m])*S);P(1,e),P(2,t)},R=function(e,r,i){var o,a,l,c,d,f,h,m,g,v=t.timeStep,_=t.background_viscosity,x=v*_*A,w=v*_*k,C=1/(1+2*(x+w));for(n.copy(i,r),o=0;o<u;o+=1){for(a=1;a<y;a+=1)for(c=a*s,l=1;l<b;l+=1)d=c+l,p[d]&&(h=d-s,f=d+s,g=d-1,m=d+1,i[d]=(r[d]+x*(i[h]+i[f])+w*(i[g]+i[m]))*C);P(e,i)}},I=function(e,r,i){var o,a,l,u,c,d,f,h,m=t.timeStep,_=.5*m/w,x=.5*m/C;for(o=1;o<y;o+=1)for(l=o*s,a=1;a<b;a+=1)u=l+a,p[u]&&(d=u-s,c=u+s,h=u-1,f=u+1,i[u]=r[u]-_*(g[c]*r[c]-g[d]*r[d])-x*(v[f]*r[f]-v[h]*r[h]));for(P(e,i),o=1;o<y;o+=1)for(l=o*s,a=1;a<b;a+=1)u=l+a,p[u]&&(d=u-s,c=u+s,h=u-1,f=u+1,r[u]=.5*(r[u]+i[u])-.5*_*g[u]*(i[c]-i[d])-.5*x*v[u]*(i[f]-i[h]));n.copy(r,i),P(e,i)},D=function(e,t,n){I(e,t,n)};return{solve:function(e,r){0!==t.thermal_buoyancy&&L(r),E(e,r),t.background_viscosity>0&&(R(1,g,e),R(2,v,r),N(e,r,g,v),E(e,r)),n.copy(e,g),n.copy(r,v),D(1,g,e),D(2,v,r),N(e,r,g,v),E(e,r)}}}}),define("text!models/energy2d/models/physics-solvers-gpu/fluid-solver-glsl/basic.vs.glsl",[],function(){return"varying vec2 coord;\n\nvoid main() {\n  coord = gl_Vertex.xy * 0.5 + 0.5;\n  gl_Position = vec4(gl_Vertex.xy, 0.0, 1.0);\n}\n"}),define("text!models/energy2d/models/physics-solvers-gpu/fluid-solver-glsl/maccormack-step1.fs.glsl",[],function(){return"// texture 1: \n// - R: q\n// - G: capacity\n// - B: density\n// - A: fluidity\nuniform sampler2D data1_tex;\n// texture 2: \n// - R: u\n// - G: v\n// - B: u0\n// - A: v0\nuniform sampler2D data2_tex;\n\nuniform vec2 grid;\nuniform float tx;\nuniform float ty;\n\nvarying vec2 coord;\n\nvoid main() {\n  vec4 data2 = texture2D(data2_tex, coord);\n  float fluidity = texture2D(data1_tex, coord).a;\n  \n  if (coord.x > grid.x && coord.x < 1.0 - grid.x &&\n      coord.y > grid.y && coord.y < 1.0 - grid.y &&\n      fluidity == 1.0) {\n    \n    vec2 dx = vec2(grid.x, 0.0);\n    vec2 dy = vec2(0.0, grid.y);\n    \n    vec4 data2_m_dy = texture2D(data2_tex, coord - dy);\n    vec4 data2_p_dy = texture2D(data2_tex, coord + dy);\n    vec4 data2_m_dx = texture2D(data2_tex, coord - dx);\n    vec4 data2_p_dx = texture2D(data2_tex, coord + dx);\n    // Update velocity UV components.\n    data2.rg = data2.ba - tx * (data2_p_dy.bb * data2_p_dy.ba - data2_m_dy.bb * data2_m_dy.ba)\n              - ty * (data2_p_dx.aa * data2_p_dx.ba - data2_m_dx.aa * data2_m_dx.ba);\n  }\n\n  gl_FragColor = data2;\n}\n";
}),define("text!models/energy2d/models/physics-solvers-gpu/fluid-solver-glsl/maccormack-step2.fs.glsl",[],function(){return"// texture 1: \n// - R: q\n// - G: capacity\n// - B: density\n// - A: fluidity\nuniform sampler2D data1_tex;\n// texture 2: \n// - R: u\n// - G: v\n// - B: u0\n// - A: v0\nuniform sampler2D data2_tex;\n\nuniform vec2 grid;\nuniform float tx;\nuniform float ty;\n\nvarying vec2 coord;\n\nvoid main() {\n  vec4 data2 = texture2D(data2_tex, coord);\n  float fluidity = texture2D(data1_tex, coord).a;\n  \n  if (coord.x > grid.x && coord.x < 1.0 - grid.x &&\n      coord.y > grid.y && coord.y < 1.0 - grid.y &&\n      fluidity == 1.0) {\n    \n    vec2 dx = vec2(grid.x, 0.0);\n    vec2 dy = vec2(0.0, grid.y);\n    \n    vec4 data2_m_dy = texture2D(data2_tex, coord - dy);\n    vec4 data2_p_dy = texture2D(data2_tex, coord + dy);\n    vec4 data2_m_dx = texture2D(data2_tex, coord - dx);\n    vec4 data2_p_dx = texture2D(data2_tex, coord + dx);\n    // Update velocity UV components.\n    data2.rg = 0.5 * (data2.ba + data2.rg) \n            - 0.5 * tx * data2.bb * (data2_p_dy.rg - data2_m_dy.rg)\n            - 0.5 * ty * data2.aa * (data2_p_dx.rg - data2_m_dx.rg);\n  }\n\n  gl_FragColor = data2;\n}\n"}),define("text!models/energy2d/models/physics-solvers-gpu/fluid-solver-glsl/apply-uv-boundary.fs.glsl",[],function(){return"// texture 2: \n// - R: u\n// - G: v\n// - B: u0\n// - A: v0\nuniform sampler2D data2_tex;\n\nuniform vec2 grid;\n\nvarying vec2 coord;\n\nvoid main() {\n  vec4 data2 = texture2D(data2_tex, coord);\n  vec2 dx = vec2(grid.x, 0.0);\n  vec2 dy = vec2(0.0, grid.y);\n  // Process corners.\n  // TODO: values from previous step are used for corners.\n  if (coord.x < grid.x && coord.y < grid.y) {  \n    vec4 data2_p_dy = texture2D(data2_tex, coord + dy);\n    vec4 data2_p_dx = texture2D(data2_tex, coord + dx);\n    data2.rg = 0.5 * (data2_p_dy.rg + data2_p_dx.rg);\n  }\n  else if (coord.x > 1.0 - grid.x && coord.y < grid.y) {  \n    vec4 data2_p_dy = texture2D(data2_tex, coord + dy);\n    vec4 data2_m_dx = texture2D(data2_tex, coord - dx);\n    data2.rg = 0.5 * (data2_p_dy.rg + data2_m_dx.rg);\n  }\n  else if (coord.x > 1.0 - grid.x && coord.y > 1.0 - grid.y) {  \n    vec4 data2_m_dy = texture2D(data2_tex, coord - dy);\n    vec4 data2_m_dx = texture2D(data2_tex, coord - dx);\n    data2.rg = 0.5 * (data2_m_dy.rg + data2_m_dx.rg);\n  }\n  else if (coord.x < grid.x && coord.y > 1.0 - grid.y) {  \n    vec4 data2_m_dy = texture2D(data2_tex, coord - dy);\n    vec4 data2_p_dx = texture2D(data2_tex, coord + dx);\n    data2.rg = 0.5 * (data2_m_dy.rg + data2_p_dx.rg);\n  }\n  // Process boundaries.\n  // Left.\n  else if (coord.x < grid.x) {\n    vec4 data2_p_dx = texture2D(data2_tex, coord + dx);\n    data2.rg = vec2(data2_p_dx.r, -data2_p_dx.g);\n  }\n  // Right.\n  else if (coord.x > 1.0 - grid.x) {\n    vec4 data2_m_dx = texture2D(data2_tex, coord - dx);\n    data2.rg = vec2(data2_m_dx.r, -data2_m_dx.g);\n  }\n  // Down.\n  else if (coord.y < grid.y) {\n    vec4 data2_p_dy = texture2D(data2_tex, coord + dy);\n    data2.rg = vec2(-data2_p_dy.r, data2_p_dy.g);\n  }\n  // Up.\n  else if (coord.y > 1.0 - grid.y) {\n    vec4 data2_m_dy = texture2D(data2_tex, coord - dy);\n    data2.rg = vec2(-data2_m_dy.r, data2_m_dy.g);\n  }\n  \n  gl_FragColor = data2;\n}\n"}),define("text!models/energy2d/models/physics-solvers-gpu/fluid-solver-glsl/apply-u0v0-boundary.fs.glsl",[],function(){return"// texture 2: \n// - R: u\n// - G: v\n// - B: u0\n// - A: v0\nuniform sampler2D data2_tex;\n\nuniform vec2 grid;\n\nvarying vec2 coord;\n\nvoid main() {\n  vec4 data2 = texture2D(data2_tex, coord);\n  vec2 dx = vec2(grid.x, 0.0);\n  vec2 dy = vec2(0.0, grid.y);\n  // Process corners.\n  // TODO: values from previous step are used for corners.\n  if (coord.x < grid.x && coord.y < grid.y) {  \n    vec4 data2_p_dy = texture2D(data2_tex, coord + dy);\n    vec4 data2_p_dx = texture2D(data2_tex, coord + dx);\n    data2.ba = 0.5 * (data2_p_dy.ba + data2_p_dx.ba);\n  }\n  else if (coord.x > 1.0 - grid.x && coord.y < grid.y) {  \n    vec4 data2_p_dy = texture2D(data2_tex, coord + dy);\n    vec4 data2_m_dx = texture2D(data2_tex, coord - dx);\n    data2.ba = 0.5 * (data2_p_dy.ba + data2_m_dx.ba);\n  }\n  else if (coord.x > 1.0 - grid.x && coord.y > 1.0 - grid.y) {  \n    vec4 data2_m_dy = texture2D(data2_tex, coord - dy);\n    vec4 data2_m_dx = texture2D(data2_tex, coord - dx);\n    data2.ba = 0.5 * (data2_m_dy.ba + data2_m_dx.ba);\n  }\n  else if (coord.x < grid.x && coord.y > 1.0 - grid.y) {  \n    vec4 data2_m_dy = texture2D(data2_tex, coord - dy);\n    vec4 data2_p_dx = texture2D(data2_tex, coord + dx);\n    data2.ba = 0.5 * (data2_m_dy.ba + data2_p_dx.ba);\n  }\n  // Process boundaries.\n  // Left.\n  else if (coord.x < grid.x) {\n    data2.ba = texture2D(data2_tex, coord + dx).ba;\n  }\n  // Right.\n  else if (coord.x > 1.0 - grid.x) {\n    data2.ba = texture2D(data2_tex, coord - dx).ba;\n  }\n  // Down.\n  else if (coord.y < grid.y) {\n    data2.ba = texture2D(data2_tex, coord + dy).ba;\n  }\n  // Up.\n  else if (coord.y > 1.0 - grid.y) {\n    data2.ba = texture2D(data2_tex, coord - dy).ba;\n  }\n  \n  gl_FragColor = data2;\n}\n"}),define("text!models/energy2d/models/physics-solvers-gpu/fluid-solver-glsl/set-obstacle-boundary.fs.glsl",[],function(){return"// texture 1: \n// - R: q\n// - G: capacity\n// - B: density\n// - A: fluidity\nuniform sampler2D data1_tex;\n// texture 2: \n// - R: u\n// - G: v\n// - B: u0\n// - A: v0\nuniform sampler2D data2_tex;\n\nuniform vec2 grid;\n\nvarying vec2 coord;\n\nvoid main() {\n  vec4 data2 = texture2D(data2_tex, coord);\n  float fluidity = texture2D(data1_tex, coord).a;\n  \n  if (coord.x > grid.x && coord.x < 1.0 - grid.x &&\n      coord.y > grid.y && coord.y < 1.0 - grid.y &&\n      fluidity == 0.0) {\n    \n    vec2 dx = vec2(grid.x, 0.0);\n    vec2 dy = vec2(0.0, grid.y);\n\n    if (texture2D(data1_tex, coord - dy).a == 1.0) {\n      data2.ba = texture2D(data2_tex, coord - dy).ba;\n    } \n    else if (texture2D(data1_tex, coord + dy).a == 1.0) {\n      data2.ba = texture2D(data2_tex, coord + dy).ba;\n    } \n\n    if (texture2D(data1_tex, coord - dx).a == 1.0) {\n      data2.ba = texture2D(data2_tex, coord - dx).ba;\n    } \n    else if (texture2D(data1_tex, coord + dx).a == 1.0) {\n      data2.ba = texture2D(data2_tex, coord + dx).ba;\n    } \n  }\n\n  gl_FragColor = data2;\n}\n"}),define("text!models/energy2d/models/physics-solvers-gpu/fluid-solver-glsl/set-obstacle-velocity.fs.glsl",[],function(){return"// texture 1: \n// - R: q\n// - G: capacity\n// - B: density\n// - A: fluidity\nuniform sampler2D data1_tex;\n// texture 2: \n// - R: u\n// - G: v\n// - B: u0\n// - A: v0\nuniform sampler2D data2_tex;\n// texture 3: \n// - R: uWind\n// - G: vWind\n// - B: undefined\n// - A: undefined\nuniform sampler2D data3_tex;\n\nuniform vec2 grid;\n\nvarying vec2 coord;\n\nvoid main() {\n  vec4 data2 = texture2D(data2_tex, coord);\n  float fluidity = texture2D(data1_tex, coord).a;\n\n  if (coord.x > grid.x && coord.x < 1.0 - grid.x &&\n      coord.y > grid.y && coord.y < 1.0 - grid.y &&\n      fluidity == 0.0) {\n    \n    vec2 dx = vec2(grid.x, 0.0);\n    vec2 dy = vec2(0.0, grid.y);\n\n    int count = 0;\n\n    if (texture2D(data1_tex, coord - dy).a == 1.0) {\n      count += 1;\n      vec2 data2_m_dy = texture2D(data2_tex, coord - dy).rg;\n      data2.rg = texture2D(data3_tex, coord).rg + vec2(-data2_m_dy.r, data2_m_dy.g);\n    } \n    else if (texture2D(data1_tex, coord + dy).a == 1.0) {\n      count += 1;\n      vec2 data2_p_dy = texture2D(data2_tex, coord + dy).rg;\n      data2.rg = texture2D(data3_tex, coord).rg + vec2(-data2_p_dy.r, data2_p_dy.g);\n    } \n\n    if (texture2D(data1_tex, coord - dx).a == 1.0) {\n      count += 1;\n      vec2 data2_m_dx = texture2D(data2_tex, coord - dx).rg;\n      data2.rg = texture2D(data3_tex, coord).rg + vec2(data2_m_dx.r, -data2_m_dx.g);\n    } \n    else if (texture2D(data1_tex, coord + dx).a == 1.0) {\n      count += 1;\n      vec2 data2_p_dx = texture2D(data2_tex, coord + dx).rg;\n      data2.rg = texture2D(data3_tex, coord).rg + vec2(data2_p_dx.r, -data2_p_dx.g);\n    } \n\n    if (count == 0) {\n      data2.rg = texture2D(data3_tex, coord).rg;\n    }\n  }\n  \n  gl_FragColor = data2;\n}\n"}),define("text!models/energy2d/models/physics-solvers-gpu/fluid-solver-glsl/uv-to-u0v0.fs.glsl",[],function(){return"// texture 2: \n// - R: u\n// - G: v\n// - B: u0\n// - A: v0\nuniform sampler2D data2_tex;\n\nvarying vec2 coord;\n\nvoid main() {\n\tvec4 data2 = texture2D(data2_tex, coord);\n\tdata2.ba = data2.rg;\n\tgl_FragColor = data2;\n}\n"}),define("text!models/energy2d/models/physics-solvers-gpu/fluid-solver-glsl/conserve-step1.fs.glsl",[],function(){return"// texture 1: \n// - R: q\n// - G: capacity\n// - B: density\n// - A: fluidity\nuniform sampler2D data1_tex;\n// texture 2: \n// - R: u\n// - G: v\n// - B: u0\n// - A: v0\nuniform sampler2D data2_tex;\n\nuniform vec2 grid;\nuniform float i2dx;\nuniform float i2dy;\n\nvarying vec2 coord;\n\nvoid main() {\n  vec4 data2 = texture2D(data2_tex, coord);\n  float fluidity = texture2D(data1_tex, coord).a;\n  \n  if (coord.x > grid.x && coord.x < 1.0 - grid.x &&\n      coord.y > grid.y && coord.y < 1.0 - grid.y &&\n      fluidity == 1.0) {\n    \n    vec2 dx = vec2(grid.x, 0.0);\n    vec2 dy = vec2(0.0, grid.y);\n    \n    vec4 data2_m_dy = texture2D(data2_tex, coord - dy);\n    vec4 data2_p_dy = texture2D(data2_tex, coord + dy);\n    vec4 data2_m_dx = texture2D(data2_tex, coord - dx);\n    vec4 data2_p_dx = texture2D(data2_tex, coord + dx);\n    \n    // Phi.\n    data2.b = 0.0;\n    // Div.\n    data2.a = (data2_p_dy.r - data2_m_dy.r) * i2dx + (data2_p_dx.g - data2_m_dx.g) * i2dy;\n  }\n\n  gl_FragColor = data2;\n}\n"}),define("text!models/energy2d/models/physics-solvers-gpu/fluid-solver-glsl/conserve-step2.fs.glsl",[],function(){return"// texture 1: \n// - R: q\n// - G: capacity\n// - B: density\n// - A: fluidity\nuniform sampler2D data1_tex;\n// texture 2: \n// - R: u\n// - G: v\n// - B: u0\n// - A: v0\nuniform sampler2D data2_tex;\n\nuniform vec2 grid;\nuniform float s;\nuniform float idxsq;\nuniform float idysq;\n\nvarying vec2 coord;\n\nvoid main() {\n  vec4 data2 = texture2D(data2_tex, coord);\n  float fluidity = texture2D(data1_tex, coord).a;\n  \n  if (coord.x > grid.x && coord.x < 1.0 - grid.x &&\n      coord.y > grid.y && coord.y < 1.0 - grid.y &&\n      fluidity == 1.0) {\n    \n    vec2 dx = vec2(grid.x, 0.0);\n    vec2 dy = vec2(0.0, grid.y);\n    \n    vec4 data2_m_dy = texture2D(data2_tex, coord - dy);\n    vec4 data2_p_dy = texture2D(data2_tex, coord + dy);\n    vec4 data2_m_dx = texture2D(data2_tex, coord - dx);\n    vec4 data2_p_dx = texture2D(data2_tex, coord + dx);\n    \n    // Phi.\n    data2.b = s * ((data2_m_dy.b + data2_p_dy.b) * idxsq + (data2_m_dx.b + data2_p_dx.b) * idysq - data2.a);\n  }\n\n  gl_FragColor = data2;\n}\n"}),define("text!models/energy2d/models/physics-solvers-gpu/fluid-solver-glsl/conserve-step3.fs.glsl",[],function(){return"// texture 1: \n// - R: q\n// - G: capacity\n// - B: density\n// - A: fluidity\nuniform sampler2D data1_tex;\n// texture 2: \n// - R: u\n// - G: v\n// - B: u0\n// - A: v0\nuniform sampler2D data2_tex;\n\nuniform vec2 grid;\nuniform float i2dx;\nuniform float i2dy;\n\nvarying vec2 coord;\n\nvoid main() {\n  vec4 data2 = texture2D(data2_tex, coord);\n  float fluidity = texture2D(data1_tex, coord).a;\n  \n  if (coord.x > grid.x && coord.x < 1.0 - grid.x &&\n      coord.y > grid.y && coord.y < 1.0 - grid.y &&\n      fluidity == 1.0) {\n    \n    vec2 dx = vec2(grid.x, 0.0);\n    vec2 dy = vec2(0.0, grid.y);\n    \n    vec4 data2_m_dy = texture2D(data2_tex, coord - dy);\n    vec4 data2_p_dy = texture2D(data2_tex, coord + dy);\n    vec4 data2_m_dx = texture2D(data2_tex, coord - dx);\n    vec4 data2_p_dx = texture2D(data2_tex, coord + dx);\n    \n    // U.\n    data2.r -= (data2_p_dy.b - data2_m_dy.b) * i2dx;\n    // V.\n    data2.g -= (data2_p_dx.b - data2_m_dx.b) * i2dy;\n  }\n\n  gl_FragColor = data2;\n}\n"}),define("text!models/energy2d/models/physics-solvers-gpu/fluid-solver-glsl/diffuse.fs.glsl",[],function(){return"// texture 1: \n// - R: q\n// - G: capacity\n// - B: density\n// - A: fluidity\nuniform sampler2D data1_tex;\n// texture 2: \n// - R: u\n// - G: v\n// - B: u0\n// - A: v0\nuniform sampler2D data2_tex;\n\nuniform vec2 grid;\nuniform float hx;\nuniform float hy;\nuniform float dn;\n\nvarying vec2 coord;\n\nvoid main() {\n  vec4 data2 = texture2D(data2_tex, coord);\n  float fluidity = texture2D(data1_tex, coord).a;\n  \n  if (coord.x > grid.x && coord.x < 1.0 - grid.x &&\n      coord.y > grid.y && coord.y < 1.0 - grid.y &&\n      fluidity == 1.0) {\n    \n    vec2 dx = vec2(grid.x, 0.0);\n    vec2 dy = vec2(0.0, grid.y);\n    \n    vec4 data2_m_dy = texture2D(data2_tex, coord - dy);\n    vec4 data2_p_dy = texture2D(data2_tex, coord + dy);\n    vec4 data2_m_dx = texture2D(data2_tex, coord - dx);\n    vec4 data2_p_dx = texture2D(data2_tex, coord + dx);\n    // Update velocity UV components.\n    data2.rg = (data2.ba + hx * (data2_m_dy.rg + data2_p_dy.rg)\n                         + hy * (data2_m_dx.rg + data2_p_dx.rg)) * dn;\n  }\n\n  gl_FragColor = data2;\n}\n"}),define("text!models/energy2d/models/physics-solvers-gpu/fluid-solver-glsl/apply-buoyancy.fs.glsl",[],function(){return"// texture 0: \n// - R: t\n// - G: t0\n// - B: tb\n// - A: conductivity\nuniform sampler2D data0_tex;\n// texture 1: \n// - R: q\n// - G: capacity\n// - B: density\n// - A: fluidity\nuniform sampler2D data1_tex;\n// texture 2: \n// - R: u\n// - G: v\n// - B: u0\n// - A: v0\nuniform sampler2D data2_tex;\n\nuniform vec2 grid;\nuniform float g;\nuniform float b;\n\nvarying vec2 coord;\n\nvoid main() {\n  vec4 data2 = texture2D(data2_tex, coord);\n  float fluidity = texture2D(data1_tex, coord).a;\n  \n  if (coord.x > grid.x && coord.x < 1.0 - grid.x &&\n      coord.y > grid.y && coord.y < 1.0 - grid.y &&\n      fluidity == 1.0) {\n    \n    vec2 dx = vec2(grid.x, 0.0);\n    vec2 dy = vec2(0.0, grid.y);\n    \n    float t = texture2D(data0_tex, coord).r;\n    // Get average column temperature.\n\n    float avg_t = t;\n    float count = 1.0;\n    vec2 n_coord = coord - dx;\n    // Silly while(true) loop (almost).\n    // While loops are not allowed.\n    // For loops with non-constant expressions also.\n    for (int i = 1; i != 0; i++) {\n      if (n_coord.x > 0.0 && texture2D(data1_tex, n_coord).a == 1.0) {\n        avg_t += texture2D(data0_tex, n_coord).r;\n        count += 1.0;\n        n_coord -= dx;\n      } else {\n        break;\n      }\n    }\n    n_coord = coord + dx;\n    // Silly while(true) loop (almost).\n    // While loops are not allowed.\n    // For loops with non-constant expressions also.\n    for (int i = 1; i != 0; i++) {\n      if (n_coord.x < 1.0 && texture2D(data1_tex, n_coord).a == 1.0) {\n        avg_t += texture2D(data0_tex, n_coord).r;\n        count += 1.0;\n        n_coord += dx;\n      } else {\n        break;\n      }\n    }\n    avg_t /= count;\n\n    // Update velocity V component.\n    data2.g += (g - b) * t + b * avg_t;\n  }\n\n  gl_FragColor = data2;\n}\n"}),define("models/energy2d/models/physics-solvers-gpu/fluid-solver-gpu",["require","exports","module","models/energy2d/gpu/shader","models/energy2d/gpu/gpgpu","text!models/energy2d/models/physics-solvers-gpu/fluid-solver-glsl/basic.vs.glsl","text!models/energy2d/models/physics-solvers-gpu/fluid-solver-glsl/maccormack-step1.fs.glsl","text!models/energy2d/models/physics-solvers-gpu/fluid-solver-glsl/maccormack-step2.fs.glsl","text!models/energy2d/models/physics-solvers-gpu/fluid-solver-glsl/apply-uv-boundary.fs.glsl","text!models/energy2d/models/physics-solvers-gpu/fluid-solver-glsl/apply-u0v0-boundary.fs.glsl","text!models/energy2d/models/physics-solvers-gpu/fluid-solver-glsl/set-obstacle-boundary.fs.glsl","text!models/energy2d/models/physics-solvers-gpu/fluid-solver-glsl/set-obstacle-velocity.fs.glsl","text!models/energy2d/models/physics-solvers-gpu/fluid-solver-glsl/uv-to-u0v0.fs.glsl","text!models/energy2d/models/physics-solvers-gpu/fluid-solver-glsl/conserve-step1.fs.glsl","text!models/energy2d/models/physics-solvers-gpu/fluid-solver-glsl/conserve-step2.fs.glsl","text!models/energy2d/models/physics-solvers-gpu/fluid-solver-glsl/conserve-step3.fs.glsl","text!models/energy2d/models/physics-solvers-gpu/fluid-solver-glsl/diffuse.fs.glsl","text!models/energy2d/models/physics-solvers-gpu/fluid-solver-glsl/apply-buoyancy.fs.glsl"],function(e,t){"use strict";var n=e("models/energy2d/gpu/shader"),r=e("models/energy2d/gpu/gpgpu"),i=e("text!models/energy2d/models/physics-solvers-gpu/fluid-solver-glsl/basic.vs.glsl"),o=e("text!models/energy2d/models/physics-solvers-gpu/fluid-solver-glsl/maccormack-step1.fs.glsl"),a=e("text!models/energy2d/models/physics-solvers-gpu/fluid-solver-glsl/maccormack-step2.fs.glsl"),s=e("text!models/energy2d/models/physics-solvers-gpu/fluid-solver-glsl/apply-uv-boundary.fs.glsl"),l=e("text!models/energy2d/models/physics-solvers-gpu/fluid-solver-glsl/apply-u0v0-boundary.fs.glsl"),u=e("text!models/energy2d/models/physics-solvers-gpu/fluid-solver-glsl/set-obstacle-boundary.fs.glsl"),c=e("text!models/energy2d/models/physics-solvers-gpu/fluid-solver-glsl/set-obstacle-velocity.fs.glsl"),d=e("text!models/energy2d/models/physics-solvers-gpu/fluid-solver-glsl/uv-to-u0v0.fs.glsl"),p=e("text!models/energy2d/models/physics-solvers-gpu/fluid-solver-glsl/conserve-step1.fs.glsl"),f=e("text!models/energy2d/models/physics-solvers-gpu/fluid-solver-glsl/conserve-step2.fs.glsl"),h=e("text!models/energy2d/models/physics-solvers-gpu/fluid-solver-glsl/conserve-step3.fs.glsl"),m=e("text!models/energy2d/models/physics-solvers-gpu/fluid-solver-glsl/diffuse.fs.glsl"),g=e("text!models/energy2d/models/physics-solvers-gpu/fluid-solver-glsl/apply-buoyancy.fs.glsl"),v=10,y=0;t.makeFluidSolverGPU=function(e){var t=new n(i,o),b=new n(i,a),_=new n(i,s),x=new n(i,l),w=new n(i,u),C=new n(i,c),T=new n(i,d),S=new n(i,p),A=new n(i,f),k=new n(i,h),P=new n(i,m),E=new n(i,g),O=e.getSimulationTexture(0),M=e.getSimulationTexture(1),L=e.getSimulationTexture(2),N=e.getSimulationTexture(3),R=e.getModelOptions(),I=R.grid_width,D=R.grid_height,B=R.timeStep,V=R.thermal_buoyancy,j=R.background_viscosity,F=R.model_width/R.grid_width,z=R.model_height/R.grid_height,G=v,$=y,U=.5/F,q=.5/z,H=1/(F*F),W=1/(z*z),Y=.5/(H+W),X=B*j*H,Q=B*j*W,K=1/(1+2*(X+Q)),J=$*B,Z=V*B,ee=[1/D,1/I],te=[L],ne=[M,L],re=[O,M,L],ie=[M,L,N],oe=function(){var e;e={data1_tex:0,data2_tex:1,grid:ee,tx:.5*B/F,ty:.5*B/z},t.uniforms(e),b.uniforms(e),e={data2_tex:0,grid:ee},_.uniforms(e),x.uniforms(e),e={data1_tex:0,data2_tex:1,grid:ee},w.uniforms(e),e={data1_tex:0,data2_tex:1,data3_tex:2,grid:ee},C.uniforms(e),e={data1_tex:0,data2_tex:1,grid:ee,i2dx:U,i2dy:q},S.uniforms(e),k.uniforms(e),e={data1_tex:0,data2_tex:1,grid:ee,s:Y,idxsq:H,idysq:W},A.uniforms(e),e={data1_tex:0,data2_tex:1,grid:ee,hx:X,hy:Q,dn:K},P.uniforms(e),e={data0_tex:0,data1_tex:1,data2_tex:2,grid:ee,g:J,b:Z},E.uniforms(e)},ae=function(){r.executeProgram(E,re,L)},se=function(){r.executeProgram(t,ne,L),r.executeProgram(_,te,L),r.executeProgram(b,ne,L),r.executeProgram(_,te,L)},le=function(){var e;for(r.executeProgram(S,ne,L),r.executeProgram(x,te,L),r.executeProgram(w,ne,L),e=0;e<G;e+=1)r.executeProgram(A,ne,L);r.executeProgram(k,ne,L),r.executeProgram(_,te,L)},ue=function(){var e;for(r.executeProgram(T,te,L),e=0;e<G;e+=1)r.executeProgram(P,ne,L),r.executeProgram(_,te,L)},ce=function(){r.executeProgram(C,ie,L)},de=function(){r.executeProgram(T,te,L)},pe={solve:function(){0!==V&&ae(),ce(),j>0&&(ue(),le(),ce()),de(),se(),le(),ce()}};return oe(),pe}}),define("models/energy2d/models/helpers",["require","exports","module"],function(e,t,n){"use strict";t.hypot=function(e,t){var n;return e=Math.abs(e),t=Math.abs(t),n=Math.min(e,t),e=Math.max(e,t),0===e?0:(n/=e,e*Math.sqrt(1+n*n))}}),define("models/energy2d/models/shape",["require","exports","module"],function(e,t,n){"use strict";t.pointInsidePolygon=function(e,t,n,r,i){var o,a,s=0;for(o=0,a=e-1;o<e;a=o,o+=1)n[o]>i!=n[a]>i&&r<(t[a]-t[o])*(i-n[o])/(n[a]-n[o])+t[o]&&(s=!s);return!!s};var r=t.Line=function(e,t,n,r){this.x1=e,this.y1=t,this.x2=n,this.y2=r};r.prototype.intersectsLine=function(e){var t,n,r,i={x:this.x1,y:this.y1},o={x:this.x2,y:this.y2},a={x:e.x1,y:e.y1},s={x:e.x2,y:e.y2},l=(s.x-a.x)*(i.y-a.y)-(s.y-a.y)*(i.x-a.x),u=(o.x-i.x)*(i.y-a.y)-(o.y-i.y)*(i.x-a.x),c=(s.y-a.y)*(o.x-i.x)-(s.x-a.x)*(o.y-i.y);return 0!==c?(n=l/c,r=u/c,t=0<=n&&n<=1&&0<=r&&r<=1):t=0===l||0===u,t};var i=t.Polygon=function(e,t,n,r,i){this.count=e,this.raw_x_coords=t,this.raw_y_coords=n,this.x_coords=new Array(e),this.y_coords=new Array(e),this.x=r||0,this.y=i||0};Object.defineProperty(i.prototype,"x",{get:function(){return this._x},set:function(e){var t,n;for(t=0,n=this.count;t<n;t++)this.x_coords[t]=this.raw_x_coords[t]+e;this._x=e}}),Object.defineProperty(i.prototype,"y",{get:function(){return this._y},set:function(e){var t,n;for(t=0,n=this.count;t<n;t++)this.y_coords[t]=this.raw_y_coords[t]+e;this._y=e}}),i.prototype.polygonize=function(){return this},i.prototype.contains=function(e,t){var n,r,i=this.x_coords,o=this.y_coords,a=this.count,s=0;for(n=0,r=a-1;n<a;r=n,n+=1)o[n]>t!=o[r]>t&&e<(i[r]-i[n])*(t-o[n])/(o[r]-o[n])+i[n]&&(s=!s);return!!s};var o=t.Rectangle=function(e,t,n,r){this.x=e,this.y=t,this.width=n,this.height=r,this.polygon_cache=void 0};o.prototype.polygonize=function(){var e,t,n,r;return this.polygon_cache||(e=this.x,t=this.y,n=this.width,r=this.height,this.polygon_cache=new i(4,[e,e+n,e+n,e],[t,t,t+r,t+r])),this.polygon_cache},o.prototype.contains=function(e,t){return e>=this.x&&e<=this.x+this.width&&t>=this.y&&t<=this.y+this.height};var a=function(e,t,n,r,o){var a,s,l=new Array(o),u=new Array(o),c=2*Math.PI/o;for(s=0;s<o;s+=1)a=c*s,l[s]=e+n*Math.cos(a),u[s]=t+r*Math.sin(a);return new i(o,l,u)},s=t.Ellipse=function(e,t,n,r){this.x=e,this.y=t,this.a=n,this.b=r,this.polygon_cache=void 0};s.prototype.POLYGON_SEGMENTS=50,s.prototype.polygonize=function(){return this.polygon_cache||(this.polygon_cache=a(this.x,this.y,.5*this.a,.5*this.b,this.POLYGON_SEGMENTS)),this.polygon_cache},s.prototype.contains=function(e,t){var n=e-this.x,r=t-this.y,i=.5*this.a,o=.5*this.b;return n*n/(i*i)+r*r/(o*o)<=1};var l=t.Ring=function(e,t,n,r){this.x=e,this.y=t,this.inner=n,this.outer=r,this.polygon_cache=void 0};l.prototype.POLYGON_SEGMENTS=50,l.prototype.polygonize=function(){return this.polygon_cache||(this.polygon_cache=a(this.x,this.y,.5*this.outer,.5*this.outer,this.POLYGON_SEGMENTS)),this.polygon_cache},l.prototype.contains=function(e,t){var n=e-this.x,r=t-this.y,i=.5*this.outer,o=.5*this.outer,a=.5*this.inner,s=.5*this.inner;return n*n/(i*i)+r*r/(o*o)<=1&&n*n/(a*a)+r*r/(s*s)>=1}}),define("models/energy2d/models/photon",["require","exports","module","models/energy2d/models/helpers","models/energy2d/models/shape","models/energy2d/models/shape"],function(e,t,n){"use strict";var r=e("models/energy2d/models/helpers").hypot,i=e("models/energy2d/models/shape").Line,o=e("models/energy2d/models/shape").Rectangle,a=t.Photon=function(e,t,n,r,i){this.x=e,this.y=t,this.energy=n,this.c=r,void 0!==i&&(this.vx=Math.cos(i)*r,this.vy=Math.sin(i)*r)};a.prototype.isContained=function(e,t,n,r){return this.x>=e&&this.x<=t&&this.y>=n&&this.y<=r},a.prototype.move=function(e){this.x+=this.vx*e,this.y+=this.vy*e},a.prototype.reflectFromLine=function(e,t){var n,o,a,s,l,u=this.x,c=this.y,d=this.x-this.vx*t,p=this.y-this.vy*t,f=new i(u,c,d,p),h=this.vx,m=this.vy;return!!f.intersectsLine(e)&&(u=e.x1,c=e.y1,d=e.x2,p=e.y2,n=1/r(u-d,c-p),o=(p-c)*n,a=(d-u)*n,s=h*a+m*o,l=m*a-h*o,this.vx=s*a+l*o,this.vy=s*o-l*a,!0)},a.prototype.reflectFromRectangle=function(e,t){var n,r,i=e.x,o=e.y,a=e.x+e.width,s=e.y+e.height;n=this.vx*t,this.x-n<i?this.vx=-Math.abs(this.vx):this.x-n>a&&(this.vx=Math.abs(this.vx)),r=this.vy*t,this.y-r<o?this.vy=-Math.abs(this.vy):this.y-r>s&&(this.vy=Math.abs(this.vy))},a.prototype.reflectFromPolygon=function(e,t){var n,r,o=new i;for(n=0,r=e.count-1;n<r;n+=1)if(o.x1=e.x_coords[n],o.y1=e.y_coords[n],o.x2=e.x_coords[n+1],o.y2=e.y_coords[n+1],this.reflectFromLine(o,t))return;o.x1=e.x_coords[e.count-1],o.y1=e.y_coords[e.count-1],o.x2=e.x_coords[0],o.y2=e.y_coords[0],this.reflectFromLine(o,t)},a.prototype.reflect=function(e,t){return!!e.contains(this.x,this.y)&&(e instanceof o?this.reflectFromRectangle(e,t):this.reflectFromPolygon(e.polygonize(),t),!0)}}),define("models/energy2d/models/physics-solvers/ray-solver",["require","exports","module","models/energy2d/models/photon"],function(e,t){"use strict";var n=e("models/energy2d/models/photon").Photon;t.makeRaySolver=function(e){var t=e.getModelOptions(),r=e.getPowerArray(),i=e.getPartsArray(),o=e.getPhotonsArray(),a=t.model_width,s=t.model_height,l=t.grid_width,u=t.grid_height,c=l-1,d=u-1,p=t.model_width/t.grid_width,f=t.model_height/t.grid_height,h=function(){return Math.PI-t.sun_angle},m=function(){for(var e=0;e<o.length;)void 0===o[e]?o.splice(e,1):e+=1},g=function(){var e,t;for(e=0,t=o.length;e<t;e+=1)o[e].isContained(0,a,0,s)||(o[e]=void 0);m()},v=function(e,t){var n,r;for(n=0,r=i.length;n<r;n+=1)if(i[n].contains(e,t))return!0;return!1},y=function(e,r){var i,l,u,c=h(),d=t.solar_power_density,p=t.solar_ray_speed,f=Math.floor(a/e),m=Math.floor(s/r);if(c>=0&&c<.5*Math.PI){for(l=0,u=1;u<=f;u+=1)i=e*u,v(i,l)||o.push(new n(i,l,d,p,c));for(i=0,u=0;u<=m;u+=1)l=r*u,v(i,l)||o.push(new n(i,l,d,p,c))}else if(c<0&&c>=-.5*Math.PI){for(l=s,u=1;u<=f;u+=1)i=e*u,v(i,l)||o.push(new n(i,l,d,p,c));for(i=0,u=0;u<=m;u+=1)l=s-r*u,v(i,l)||o.push(new n(i,l,d,p,c))}else if(c<Math.PI+.001&&c>=.5*Math.PI){for(l=0,u=0;u<=f;u+=1)i=a-e*u,v(i,l)||o.push(new n(i,l,d,p,c));for(i=a,u=1;u<=m;u+=1)l=r*u,v(i,l)||o.push(new n(i,l,d,p,c))}else if(c>=-Math.PI&&c<-.5*Math.PI){for(l=s,u=0;u<=f;u+=1)i=a-e*u,v(i,l)||o.push(new n(i,l,d,p,c));for(i=a,u=1;u<=m;u+=1)l=s-r*u,v(i,l)||o.push(new n(i,l,d,p,c))}};return{solve:function(){var e,n,a,s,l,h,v,y,b=t.timeStep,_=t.photon_emission_interval,x=1/(b*_),w=1/p,C=1/f;for(l=0,v=o.length;l<v;l+=1)for(e=o[l],e.move(b),h=0,y=i.length;h<y&&(n=i[h],!n.reflect(e,b));h+=1)if(n.absorb(e)){a=Math.max(Math.min(Math.round(e.x*w),c),0),s=Math.max(Math.min(Math.round(e.y*C),d),0),r[a*u+s]=e.energy*x,o[l]=void 0;break}m(),g()},radiate:function(){var t,n,r;for(n=0,r=i.length;n<r;n+=1)t=i[n],t.emissivity>0&&t.radiate(e)},sunShine:function(){var e,n,r,i=h();i<0||(e=Math.abs(Math.sin(i)),n=Math.abs(Math.cos(i)),r=e*s<n*a?s/n:a/e,r/=t.solar_ray_count,y(r/e,r/n))}}}}),define("models/energy2d/models/part",["require","exports","module","models/energy2d/models/constants","models/energy2d/models/helpers","models/energy2d/models/photon","models/energy2d/models/shape","models/energy2d/models/shape","models/energy2d/models/shape","models/energy2d/models/shape","models/energy2d/models/shape","models/energy2d/models/shape"],function(e,t,n){"use strict";var r=e("models/energy2d/models/constants"),i=e("models/energy2d/models/helpers").hypot,o=e("models/energy2d/models/photon").Photon,a=e("models/energy2d/models/shape"),s=e("models/energy2d/models/shape").Line,l=e("models/energy2d/models/shape").Polygon,u=e("models/energy2d/models/shape").Rectangle,c=e("models/energy2d/models/shape").Ellipse,d=e("models/energy2d/models/shape").Ring,p=.5,f=20,h=100,m=Math.sin(Math.PI/6),g=Math.cos(Math.PI/6),v=Math.sin(Math.PI/3),y=Math.cos(Math.PI/3),b=t.Part=function(e){var t,n,r;if(this._options=e,"rectangle"===e.shapeType)this.shape=new u(e.x,e.y,e.width,e.height);else if("ellipse"===e.shapeType)this.shape=new c(e.x,e.y,e.a,e.b);else if("ring"===e.shapeType)this.shape=new d(e.x,e.y,e.inner,e.outer);else{if("polygon"!==e.shapeType)throw new Error("Part: shape not defined or not supported.");for(t=e.vertices.split(", "),this.x_coords=[],this.y_coords=[],r=0,n=.5*t.length;r<n;r+=1)this.x_coords[r]=Number(t[2*r]),this.y_coords[r]=Number(t[2*r+1]);this.shape=new l(n,this.x_coords,this.y_coords,e.x,e.y)}};Object.defineProperty(b.prototype,"shapeType",{get:function(){return this._options.shapeType}}),["x","y","width","height","inner","outer","a","b","raw_x_coords","raw_y_coords"].forEach(function(e){Object.defineProperty(b.prototype,e,{get:function(){return this.shape[e]},set:function(t){this.shape[e]=t,this.polygon_cache=void 0}})}),Object.defineProperty(b.prototype,"vertices",{get:function(){if("polygon"===this.shapeType){var e,t,n=this.shape.raw_x_coords,r=this.shape.raw_y_coords,i=[];for(e=0,t=n.length;e<t;e++)i.push(n[e]),i.push(r[e]);return i.join(", ")}}}),["thermal_conductivity","specific_heat","density","temperature","constant_temperature","power","wind_speed","wind_angle","transmission","reflection","absorption","emissivity","visible","filled","color","texture","label","draggable"].forEach(function(e){Object.defineProperty(b.prototype,e,{get:function(){return this._options[e]},set:function(t){this._options[e]=t}})}),b.prototype.getLabel=function(){function e(e,t){var n;return n=e>=100?e.toFixed():e>=10?e.toFixed(1):e.toFixed(2),n+t}var t,n=this.label;return"%temperature"===n?t=e(this.temperature," °C"):"%density"===n?t=e(this.density," kg/m³"):"%specific_heat"===n?t=e(this.specific_heat," J/(kg×°C)"):"%thermal_conductivity"===n?t=e(this.thermal_conductivity," W/(m×°C)"):"%power_density"===n?t=e(this.power," W/m³"):"%area"===n?"rectangle"===this.shapeType?t=e(this.width*this.height," m²"):"ellipse"===this.shapeType&&(t=e(this.a*this.b*.25*Math.PI," m²")):"%width"===n?"rectangle"===this.shapeType?t=e(this.width," m"):"ellipse"===this.shapeType&&(t=e(this.a," m")):"%height"===n?"rectangle"===this.shapeType?t=e(this.height," m"):"ellipse"===this.shapeType&&(t=e(this.b," m")):t=n,t},b.prototype.getGridCells=function(e,t,n,r){var i=e-1,o=t-1,s=e/n,l=t/r,u=function(e){var n,r,a,u,c,d,p,f=[];for(a=Math.min(Math.max(Math.ceil(e.x*s),0),i),u=Math.min(Math.max(Math.ceil(e.y*l),0),o),c=Math.min(Math.max(Math.floor((e.x+e.width)*s),0),i),d=Math.min(Math.max(Math.floor((e.y+e.height)*l),0),o),f=new Array((c-a+1)*(d-u+1)),p=0,n=a;n<=c;n+=1)for(r=u;r<=d;r+=1)f[p+=1]=n*t+r;return f},c=function(e){var n,r,a,u,c,d,p,f,h=e.x*s,m=e.y*l,g=.5*e.a*s,v=.5*e.b*l,y=[];for(a=Math.min(Math.max(Math.ceil(h-g),0),i),u=Math.min(Math.max(Math.floor(h+g),0),i),y=[],f=0,r=a;r<=u;r+=1)for(n=Math.sqrt(1-(r-h)*(r-h)/(g*g)),d=Math.min(Math.max(Math.ceil(m-v*n),0),o),p=Math.min(Math.max(Math.floor(m+v*n),0),o),c=d;c<=p;c+=1)y[f+=1]=r*t+c;return y},d=function(e){var n,r,a,u,c,d,p,f,h,m,g=e.x*s,v=e.y*l,y=.5*e.outer*s,b=.5*e.outer*l,_=.5*e.inner*s,x=.5*e.inner*l,w=[];for(r=Math.min(Math.max(Math.ceil(g-y),0),i),a=Math.min(Math.max(Math.floor(g+y),0),i),n=r;n<=a;n+=1)if(h=Math.sqrt(1-(n-g)*(n-g)/(y*y)),c=Math.min(Math.max(Math.ceil(v-b*h),0),o),f=Math.min(Math.max(Math.floor(v+b*h),0),o),Math.abs(n-g)<_){for(h=Math.sqrt(1-(n-g)*(n-g)/(_*_)),d=Math.min(Math.max(Math.ceil(v-x*h),0),o),p=Math.min(Math.max(Math.floor(v+x*h),0),o),u=c;u<=d;u+=1)w[m+=1]=n*t+u;for(u=p;u<=f;u+=1)w[m+=1]=n*t+u}else for(u=c;u<=f;u+=1)w[m+=1]=n*t+u;return w},p=function(e){var n,r,u,c,d,p,f,h=e.x_coords.length,m=new Array(h),g=new Array(h),v=Number.MAX_VALUE,y=Number.MIN_VALUE,b=Number.MAX_VALUE,_=Number.MIN_VALUE,x=[];for(n=0;n<h;n+=1)m[n]=e.x_coords[n]*s,g[n]=e.y_coords[n]*l,m[n]<v&&(v=m[n]),m[n]>y&&(y=m[n]),g[n]<b&&(b=g[n]),g[n]>_&&(_=g[n]);for(r=Math.min(Math.max(Math.round(v),0),i),d=Math.min(Math.max(Math.round(b),0),o),u=Math.min(Math.max(Math.round(y),0),i),p=Math.min(Math.max(Math.round(_),0),o),x=[],f=0,n=r;n<=u;n+=1)for(c=d;c<=p;c+=1)a.pointInsidePolygon(h,m,g,n,c)&&(x[f+=1]=n*t+c);return x};if("rectangle"===this.shapeType)return u(this.shape);if("ellipse"===this.shapeType)return c(this.shape);if("ring"===this.shapeType)return d(this.shape);if("polygon"===this.shapeType)return p(this.shape);throw new Error("Part: unknown shape.")},b.prototype.contains=function(e,t){return this.shape.contains(e,t)},b.prototype.reflect=function(e,t){
return Math.abs(this.reflection-1)<.001&&e.reflect(this.shape,t)},b.prototype.absorb=function(e){return Math.abs(this.absorption-1)<.001&&this.shape.contains(e.x,e.y)},b.prototype.getIrradiance=function(e){var t;return 0===this.emissivity?0:(t=273+e,t*=t,this.emissivity*r.STEFAN_CONSTANT*h*t*t)},b.prototype.radiate=function(e){var t,n,r=this.shape.polygonize(),i=new s;if(0!==this.emissivity){for(t=0,n=r.count-1;t<n;t+=1)i.x1=r.x_coords[t],i.y1=r.y_coords[t],i.x2=r.x_coords[t+1],i.y2=r.y_coords[t+1],this.radiateFromLine(e,i);i.x1=r.x_coords[r.count-1],i.y1=r.y_coords[r.count-1],i.x2=r.x_coords[0],i.y2=r.y_coords[0],this.radiateFromLine(e,i)}},b.prototype.radiateFromLine=function(e,t){var n,r,a,s,l,u,c,d,h,b,_,x,w,C,T,S,A;if(0!==this.emissivity)if(n=e.getModelOptions(),r=i(t.x1-t.x2,t.y1-t.y2),a=(t.x2-t.x1)/r,s=(t.y2-t.y1)/r,l=Math.max(1,Math.round(r/p)),b=n.solar_ray_speed*s,_=-n.solar_ray_speed*a,1===l)h=.5*r,u=t.x1+h*a,c=t.y1+h*s,h=e.getAverageTemperatureAt(u,c),h>f&&(h=e.getTemperatureAt(u,c),d=new o(u,c,this.getIrradiance(h),n.solar_ray_speed),d.vx=b,d.vy=_,e.addPhoton(d),this.constant_temperature||e.setTemperatureAt(u,c,h-d.energy/this.specific_heat));else for(x=new Array(4),w=new Array(4),x[0]=b*g-_*m,w[0]=b*m+_*g,x[1]=_*m+b*g,w[1]=_*g-b*m,x[2]=b*y-_*v,w[2]=b*v+_*y,x[3]=_*v+b*y,w[3]=_*y-b*v,C=1+x.length,S=0;S<l;S+=1)if(h=(S+.5)*p,u=t.x1+h*a,c=t.y1+h*s,h=e.getAverageTemperatureAt(u,c),T=this.getIrradiance(h)/C,h>f){for(d=new o(u,c,T,n.solar_ray_speed),d.vx=b,d.vy=_,e.addPhoton(d),A=0;A<C-1;A+=1)d=new o(u,c,T,n.solar_ray_speed),d.vx=x[A],d.vy=w[A],e.addPhoton(d);this.constant_temperature||e.changeAverageTemperatureAt(u,c,-T*C/this.specific_heat)}}}),define("models/energy2d/models/core-model",["require","exports","module","arrays","models/energy2d/models/physics-solvers/heat-solver","models/energy2d/models/physics-solvers-gpu/heat-solver-gpu","models/energy2d/models/physics-solvers/fluid-solver","models/energy2d/models/physics-solvers-gpu/fluid-solver-gpu","models/energy2d/models/physics-solvers/ray-solver","models/energy2d/models/part","models/energy2d/gpu/gpgpu","models/energy2d/models/helpers"],function(e,t){"use strict";var n=e("arrays"),r=e("models/energy2d/models/physics-solvers/heat-solver"),i=e("models/energy2d/models/physics-solvers-gpu/heat-solver-gpu"),o=e("models/energy2d/models/physics-solvers/fluid-solver"),a=e("models/energy2d/models/physics-solvers-gpu/fluid-solver-gpu"),s=e("models/energy2d/models/physics-solvers/ray-solver"),l=e("models/energy2d/models/part").Part,u=e("models/energy2d/gpu/gpgpu"),c=e("models/energy2d/models/helpers").hypot,d=function(){try{new Float32Array}catch(e){return"regular"}return"Float32Array"}();t.makeCoreModel=function(e,t){var p,f,h,m,g,v,y,b,_=e.grid_width,x=e.grid_height,w=_*x,C=e.model_width/_,T=e.model_height/x,S=0,A=!1,k={start:function(){},stop:function(){},startFPS:function(){},updateFPS:function(){},stopFPS:function(){}},P=n.create(w,e.background_temperature,d),E=n.create(w,NaN,d),O=n.create(w,0,d),M=n.create(w,0,d),L=n.create(w,0,d),N=n.create(w,0,d),R=n.create(w,0,d),I=n.create(w,e.background_conductivity,d),D=n.create(w,e.background_specific_heat,d),B=n.create(w,e.background_density,d),V=n.create(w,!0,d),j=[],F=[],z=function(){var e,r,i=[];if(t)for(n.isArray(t)||(t=[t]),i=new Array(t.length),e=0,r=t.length;e<r;e+=1)i[e]=new l(t[e]);return i}(),G=function(){if(A=!1,"undefined"==typeof window)throw new Error("Core model: WebGL GPGPU unavailable in the node.js environment.");u.init(x,_),F[0]=u.createTexture(),F[1]=u.createTexture(),F[2]=u.createTexture(),F[3]=u.createTexture(),$(),m=i.makeHeatSolverGPU(Q),g=a.makeFluidSolverGPU(Q),A=!0},$=function(){u.writeRGBATexture(F[0],P,P,E,I),u.writeRGBATexture(F[1],L,D,B,V),u.writeRGBATexture(F[2],O,M,O,M),u.writeRGBATexture(F[3],N,R,N,R)},U=function(){v=function(){var t,n;if(e.sunny)return!0;for(t=0,n=z.length;t<n;t+=1)if(z[t].emissivity>0)return!0;return!1}(),y=function(){var e,t;for(e=0,t=z.length;e<t;e+=1)if(z[e].power>0)return!0;return!1}()},q=function(t,n){var r,i,o,a,s=e.model_width,l=e.model_height;for(r=t.getGridCells(_,x,s,l),o=0,a=r.length;o<a;o+=1)i=r[o],n||(P[i]=t.temperature),V[i]=!1,I[i]=t.thermal_conductivity,D[i]=t.specific_heat,B[i]=t.density,0!==t.wind_speed&&(N[i]=t.wind_speed*Math.cos(t.wind_angle),R[i]=t.wind_speed*Math.sin(t.wind_angle)),t.constant_temperature&&(E[i]=t.temperature)},H=function(t){t||(n.fill(P,e.background_temperature),n.fill(O,0),n.fill(M,0)),n.fill(E,NaN),n.fill(L,0),n.fill(N,0),n.fill(R,0),n.fill(I,e.background_conductivity),n.fill(D,e.background_specific_heat),n.fill(B,e.background_density),n.fill(V,!0)},W=function(e){if(z&&0!==z.length){var t;for(t=z.length-1;t>=0;t-=1)q(z[t],e)}},Y=function(){var e,t,n,r,i,o,a,s,l;for(r=0;r<_;r+=1)for(t=r*C,i=r*x,o=0;o<x;o+=1)if(n=o*T,L[i+o]=0,l=0,y){for(a=0,s=z.length;a<s;a+=1)e=z[a],e.shape.contains(t,n)&&(L[i+o]+=e.power,l++);l>0&&(L[i+o]/=l)}},X=function(e,t){var n=(O[e*x+t+1]-O[e*x+t-1])/C,r=(M[(e+1)*x+t]-M[(e-1)*x+t])/T;return.5*(n-r)},Q={nextStep:function(){k.start("Core model step"),A?(e.convective&&(k.start("Fluid solver GPU"),g.solve(),k.stop("Fluid solver GPU")),k.start("Heat solver GPU"),m.solve(e.convective),k.stop("Heat solver GPU")):(v&&(k.start("Ray solver CPU"),S%e.photon_emission_interval===0&&(Y(),e.sunny&&h.sunShine(),h.radiate()),h.solve(),k.stop("Ray solver CPU")),e.convective&&(k.start("Fluid solver CPU"),f.solve(O,M),k.stop("Fluid solver CPU")),k.start("Heat solver CPU"),p.solve(e.convective,P,L),k.stop("Heat solver CPU")),S+=1,k.stop("Core model step")},setPerformanceTools:function(e){k=e},reset:function(){S=0,H(),U(),W(),Y(),A&&$()},partsChanged:function(e,t){H(!0),U(),W(!0),Y(),"temperature"===t&&q(e)},addPart:function(e){var t=new l(e);z.push(t),q(t)},removePart:function(e){z.splice(e,1),Q.partsChanged()},useWebGL:function(e){if(A!==e)return Q.isWebGLCompatible()?void(e?G():(Q.syncTemperature(),Q.syncVelocity(),A=!1)):void(A=!1)},isWebGLActive:function(){return A},isWebGLCompatible:function(){return!v},getWebGLError:function(){return b},syncTemperature:function(){A&&u.readTexture(F[0],P)},syncVelocity:function(){A&&(u.readTexture(F[2],O,0),u.readTexture(F[2],M,1))},getIndexOfStep:function(){return S},getModelOptions:function(){return e},getTemperatureAt:function(e,t){var n=Math.max(Math.min(_-1,Math.round(e/C)),0),r=Math.max(Math.min(x-1,Math.round(t/T)),0);return P[n*x+r]},setTemperatureAt:function(e,t,n){var r=Math.max(Math.min(_-1,Math.round(e/C)),0),i=Math.max(Math.min(x-1,Math.round(t/T)),0);P[r*x+i]=n},getAverageTemperatureAt:function(e,t){var n,r,i=0,o=_-1,a=x-1,s=Math.round(e/C),l=Math.round(t/T);return n=Math.max(Math.min(o,s),0),r=Math.max(Math.min(a,l),0),i+=P[n*x+r],n=Math.max(Math.min(o,s+1),0),r=Math.max(Math.min(a,l),0),i+=P[n*x+r],n=Math.max(Math.min(o,s-1),0),r=Math.max(Math.min(a,l),0),i+=P[n*x+r],n=Math.max(Math.min(o,s),0),r=Math.max(Math.min(a,l+1),0),i+=P[n*x+r],n=Math.max(Math.min(o,s),0),r=Math.max(Math.min(a,l-1),0),i+=P[n*x+r],.2*i},changeAverageTemperatureAt:function(e,t,n){var r,i,o=_-1,a=x-1,s=Math.round(e/C),l=Math.round(t/T);n*=.2,r=Math.min(o,s),i=Math.min(a,l),r>=0&&i>=0&&(P[r*x+i]+=n),r=Math.min(o,s+1),i=Math.min(a,l),r>=0&&i>=0&&(P[r*x+i]+=n),r=Math.min(o,s-1),i=Math.min(a,l),r>=0&&i>=0&&(P[r*x+i]+=n),r=Math.min(o,s),i=Math.min(a,l+1),r>=0&&i>=0&&(P[r*x+i]+=n),r=Math.min(o,s),i=Math.min(a,l-1),r>=0&&i>=0&&(P[r*x+i]+=n)},getVorticityAt:function(e,t){var n=Math.max(Math.min(_-1,Math.round(e/C)),0),r=Math.max(Math.min(x-1,Math.round(t/T)),0);return X(n,r)},getAverageVorticityAt:function(e,t){var n=Math.max(Math.min(_-1,Math.round(e/C)),0),r=Math.max(Math.min(x-1,Math.round(t/T)),0),i=X(n,r);return i+=X(n-1,r),i+=X(n+1,r),i+=X(n,r-1),i+=X(n,r+1),i+=X(n-1,r-1),i+=X(n-1,r+1),i+=X(n+1,r-1),i+=X(n+1,r+1),i/9},getSpeedAt:function(e,t){var n=Math.max(Math.min(_-1,Math.round(e/C)),0),r=Math.max(Math.min(x-1,Math.round(t/T)),0);return c(O[n*x+r],M[n*x+r])},getHeatFluxAt:function(e,t){var n=Math.max(Math.min(_-1,Math.round(e/C)),0),r=Math.max(Math.min(x-1,Math.round(t/T)),0),i=I[n*x+r]*(P[(n-1)*x+r]-P[(n+1)*x+r])/(2*C),o=I[n*x+r]*(P[n*x+r-1]-P[n*x+r+1])/(2*T);return[i,o]},addPhoton:function(e){j.push(e)},removePhoton:function(e){var t=j.indexOf(e);t!==-1&&j.splice(t,1)},getArrayType:function(){return d},getPerformanceModel:function(){return k},getTemperatureArray:function(){return P},getUVelocityArray:function(){return O},getVVelocityArray:function(){return M},getUWindArray:function(){return N},getVWindArray:function(){return R},getBoundaryTemperatureArray:function(){return E},getPowerArray:function(){return L},getConductivityArray:function(){return I},getCapacityArray:function(){return D},getDensityArray:function(){return B},getFluidityArray:function(){return V},getPhotonsArray:function(){return j},getPartsArray:function(){return z},getTemperatureTexture:function(){return F[0]},getVelocityTexture:function(){return F[2]},getSimulationTexture:function(e){return F[e]}};return U(),W(),Y(),p=r.makeHeatSolver(Q),f=o.makeFluidSolver(Q),h=s.makeRaySolver(Q),Q}}),define("models/energy2d/modeler",["require","common/alert","common/console","common/validator","common/serialize","common/performance","common/lab-modeler-mixin","models/energy2d/metadata","models/energy2d/models/core-model"],function(e){"use strict";var t=e("common/alert"),n=e("common/console"),r=e("common/validator"),i=e("common/serialize"),o=e("common/performance"),a=e("common/lab-modeler-mixin"),s=e("models/energy2d/metadata"),l=e("models/energy2d/models/core-model"),u={units:{time:{name:"second",pluralName:"seconds",symbol:"s"},temperature:{name:"degree Celsius",pluralName:"degrees Celsius",symbol:"°C"},length:{name:"meter",pluralName:"meters",symbol:"m"},velocity:{name:"meter per second",pluralName:"meters per second",symbol:"m/s"}}},c=0;return function(e){function d(e){try{y.useWebGL(e)}catch(e){n.warn("WebGL initialization failed. CPU solvers and rendering will be used."),n.warn(e.message)}}function p(){y.syncTemperature(),y.syncVelocity()}function f(){var e,t,n=v.getTemperatureArray();for(e=0,t=n.length;e<t;e++)if(isNaN(n[e])||Math.abs(n[e])>1e10)return v.stop(),y.reset(),!0;return!1}function h(e){var t=[];return e.forEach(function(e){t.push(r.validateCompleteness(s.part,e))}),t}function m(e){var t={thermometer:function(){return v.getTemperatureAt(this.x,this.y)},anemometer:function(){return this._rot},heatFlux:function(){var e=v.getHeatFluxAt(this.x,this.y);return e[0]*this._sin+e[1]*this._cos}},n={thermometer:{label:"Temperature",unitType:"temperature",format:".1f"},anemometer:{},heatFlux:{label:"Heat Flux",unitName:"Watt Per Square Meter",unitPluralName:"Watts Per Square Meter",unitAbbreviation:"W/m²",format:".1f"}};T=[],e.forEach(function(e,i){e=r.validateCompleteness(s.sensor,e),"anemometer"===e.type&&(e._rot=0,S.push(e)),"heatFlux"===e.type&&(e.angle=e.angle||0,e._sin=Math.sin(-e.angle*Math.PI/180),e._cos=Math.cos(e.angle*Math.PI/180)),Object.defineProperty(e,"value",{enumerable:!0,get:t[e.type]}),T.push(e),v.defineOutput("sensor-"+i,n[e.type],function(){return e.value})})}function g(){var e,t,n;for(t=0,n=S.length;t<n;t++)e=S[t],e._rot+=v.getSpeedAt(e.x,e.y)*(v.getVorticityAt(e.x,e.y)<0?-1:1)*v.properties.timeStep*700,e._rot=e._rot%360}var v,y,b="energy2dModel"+ ++c,_=new a({metadata:s,unitsDefinition:u,initialProperties:e,setters:{use_WebGL:function(e){y&&d(e),C=v.properties.ticksPerGPUSync},ticksPerGPUSync:function(e){y&&p(),C=Number(e)}}}),x=_.propertySupport,w=_.dispatchSupport,C=0,T=[],S=[],A={parts:[],sensors:[]},k=function(){function e(e){Object.defineProperty(this,"_rawPart",{enumerable:!1,get:function(){return e}})}return Object.keys(s.part).forEach(function(t){Object.defineProperty(e.prototype,t,{enumerable:!0,get:function(){return this._rawPart[t]},set:function(e){var n=v.properties.use_WebGL;v.properties.use_WebGL=!1,x.invalidatingChangePreHook(),this._rawPart[t]=r.validateSingleProperty(s.part[t],t,e),v.isStopped()?y.reset():y.partsChanged(this._rawPart,t),x.invalidatingChangePostHook(),v.properties.use_WebGL=n,w.partsChanged()}})}),e.prototype.computeLabel=function(){return this._rawPart.getLabel()},function(){var t,n,r=y.getPartsArray(),i=A.parts;for(i.length=0,t=0,n=r.length;t<n;t++)i.push(new e(r[t]))}}(),P=function(){function e(e){Object.defineProperty(this,"_rawObj",{enumerable:!1,get:function(){return e}})}var t={x:function(e){return Math.max(0,Math.min(v.properties.model_width,e))},y:function(e){return Math.max(0,Math.min(v.properties.model_height,e))}};return Object.keys(s.sensor).forEach(function(n){Object.defineProperty(e.prototype,n,{enumerable:!0,get:function(){return this._rawObj[n]},set:function(e){x.invalidatingChangePreHook(),e=t[n]?t[n](e):e,this._rawObj[n]=r.validateSingleProperty(s.sensor[n],n,e),x.invalidatingChangePostHook(),w.sensorsChanged()}})}),function(){var t,n,r=A.sensors;for(r.length=0,t=0,n=T.length;t<n;t++)r.push(new e(T[t]))}}();return v={namespace:b,tick:function(){var e,n,r;for(o.enterScope("engine"),e=0,n=v.properties.timeStepsPerTick;e<n;e++)y.nextStep();o.leaveScope("engine"),y.isWebGLActive()?C>0?C--:(p(),C=Number(v.properties.ticksPerGPUSync),r=f()):r=f(),g(),v.updateAllOutputProperties(),w.tick(),r&&t("The model has diverged and has been reset!\n\nTry changing its parameters (e.g. 'timeStep', positions of parts etc.) or reload it to restore the initial configuration.")},syncTemperature:function(){x.invalidatingChangePreHook(),y.syncTemperature(),x.invalidatingChangePostHook()},syncVelocity:function(){x.invalidatingChangePreHook(),y.syncVelocity(),x.invalidatingChangePostHook()},addPart:function(e){var t=v.properties.use_WebGL;v.properties.use_WebGL=!1,e=r.validateCompleteness(s.part,e),x.invalidatingChangePreHook(),y.addPart(e),k(),x.invalidatingChangePostHook(),v.properties.use_WebGL=t,w.partsChanged()},removePart:function(e){var t=v.properties.use_WebGL;v.properties.use_WebGL=!1,x.invalidatingChangePreHook(),y.removePart(e),k(),x.invalidatingChangePostHook(),v.properties.use_WebGL=t,w.partsChanged()},reset:function(){w.willReset(),x.invalidatingChangePreHook(),v.stop(),y.reset();var t;e.structure&&e.structure.part&&(t=h(e.structure.part)),y=l.makeCoreModel(v.properties,t),d(v.properties.use_WebGL),e.sensors&&m(e.sensors),k(),P(),x.invalidatingChangePostHook(),v.resetAllOutputProperties(),w.reset(),w.invalidation()},stepCounter:function(){return y.getIndexOfStep()},isNewStep:function(){return!0},stepBack:function(e){return y.getIndexOfStep()},stepForward:function(e){arguments.length||(e=1),this.isStopped()||this.stop();for(var t=-1;++t<e;)v.tick();return y.getIndexOfStep()},getTime:function(){return v.properties.timeStep*y.getIndexOfStep()},isWebGLActive:function(){return y.isWebGLActive()},isWebGLCompatible:function(){return y.isWebGLCompatible()},getWebGLError:function(){return y.getWebGLError()},getIndexOfStep:function(){return y.getIndexOfStep()},getTemperatureAt:function(e,t){return y.getTemperatureAt(e,t)},getAverageTemperatureAt:function(e,t){return y.getAverageTemperatureAt(e,t)},getVorticityAt:function(e,t){return y.getVorticityAt(e,t)},getHeatFluxAt:function(e,t){return y.getHeatFluxAt(e,t)},getAverageVorticityAt:function(e,t){return y.getAverageVorticityAt(e,t)},getSpeedAt:function(e,t){return y.getSpeedAt(e,t)},getTemperatureArray:function(){return y.getTemperatureArray()},getTemperatureTexture:function(){return y.getTemperatureTexture()},getUVelocityArray:function(){return y.getUVelocityArray()},getVVelocityArray:function(){return y.getVVelocityArray()},getVelocityTexture:function(){return y.getVelocityTexture()},getPhotonsArray:function(){return y.getPhotonsArray()},getPartsArray:function(){return A.parts},getSensorsArray:function(){return A.sensors},serialize:function(){var e={},t=x.rawValues;return e=i(s.mainProperties,t),e.viewOptions=i(s.viewOptions,t),e.structure={part:[]},A.parts.forEach(function(t){e.structure.part.push(i(s.part,t))}),e.sensors=[],A.sensors.forEach(function(t){e.sensors.push(i(s.sensor,t))}),e}},function(){function t(){x.invalidatingChangePreHook(),x.invalidatingChangePostHook()}var n;_.mixInto(v),w.addEventTypes("tick","partsChanged","sensorsChanged"),e.structure&&e.structure.part&&(n=h(e.structure.part)),y=l.makeCoreModel(v.properties,n),d(v.properties.use_WebGL),e.sensors&&m(e.sensors),k(),P(),v.on("play.model",t),v.on("stop.model",t),v.defineOutput("minX",{},function(){return 0}),v.defineOutput("minY",{},function(){return 0}),v.defineOutput("maxX",{},function(){return v.properties.model_width}),v.defineOutput("maxY",{},function(){return v.properties.model_height}),v.defineOutput("time",{label:"Time",unitType:"time",format:".2f"},function(){return v.getTime()}),v.defineOutput("displayTime",{label:"Time"},function(){var e=d3.format("02d");return function(){var t,n,r,i,o=v.getTime();return o=Math.floor(o),t=o%60,o=Math.floor(o/60),n=o%60,o=Math.floor(o/60),r=o%24,o=Math.floor(o/24),i=o,i+":"+e(r)+":"+e(n)+":"+e(t)}}())}(),v}}),define("models/energy2d/views/helpers",[],function(){"use strict";return{HSVToRGB:function(e,t,n){var r,i,o,a,s,l,u,c;if(e=Math.max(0,Math.min(360,e)),t=Math.max(0,Math.min(100,t)),n=Math.max(0,Math.min(100,n)),t/=100,n/=100,0===t)return r=i=o=n,[Math.round(255*r),Math.round(255*i),Math.round(255*o)];switch(e/=60,a=Math.floor(e),s=e-a,l=n*(1-t),u=n*(1-t*s),c=n*(1-t*(1-s)),a){case 0:r=n,i=c,o=l;break;case 1:r=u,i=n,o=l;break;case 2:r=l,i=n,o=c;break;case 3:r=l,i=u,o=n;break;case 4:r=c,i=l,o=n;break;default:r=n,i=l,o=u}return[Math.round(255*r),Math.round(255*i),Math.round(255*o)]}}}),define("models/energy2d/views/color-palette",["require","models/energy2d/views/helpers"],function(e){"use strict";var t,n,r=e("models/energy2d/views/helpers");return t={},t[0]=t.RAINBOW=[[0,0,128],[20,50,120],[20,100,200],[10,150,150],[120,180,50],[220,200,10],[240,160,36],[225,50,50],[230,85,110],[250,250,250],[255,255,255]],t[1]=t.IRON=[[40,20,100],[80,20,150],[150,20,150],[200,50,120],[220,80,80],[230,120,30],[240,200,20],[240,220,80],[255,255,125],[250,250,250],[255,255,255]],t[2]=t.GRAY=[[50,50,50],[75,75,75],[100,100,100],[125,125,125],[150,150,150],[175,175,175],[200,200,200],[225,225,225],[250,250,250],[255,255,255]],t[3]=t.RAINBOW2=function(){var e,t=(r.HSVToRGB,256),n=new Array(t);for(e=0;e<t;e+=1)n[e]=r.HSVToRGB(t-1-e,100,90);return n}(),n=function(e){void 0!==e&&"DEFAULT"!==e||(e="RAINBOW"),this.color_palette_id=e},n.prototype.getRGBArray=function(){if(void 0!==t[this.color_palette_id])return t[this.color_palette_id]},n}),define("models/energy2d/views/heatmap",["require","models/energy2d/views/color-palette"],function(e){"use strict";var t=e("models/energy2d/views/color-palette");return function(e){var n,r,i,o,a,s,l,u="energy2d-heatmap-view",c=0,d=50,p=function(){n=$("<canvas />"),n.attr("id",e||u),r=n[0].getContext("2d")},f={renderHeatmap:function(){var e,t,n,u,p,f,h,m,g,v,y,b;if(!a)throw new Error("Heatmap: bind heatmap before rendering.");for(r.clearRect(0,0,s,l),r.fillStyle="rgb(0,0,0)",e=o/Math.max(1,d-c),f=r.getImageData(0,0,s,l),h=f.data,y=0,b=4*s,m=0;m<s;m+=1)for(v=m*l,y=4*m,g=0;g<l;g+=1)n=e*(a[v+g]-c),t=Math.floor(n),n-=t,t<0?(t=0,n=0):t>o-1&&(t=o-1,n=1),u=i[t],p=i[t+1],h[y]=u[0]*(1-n)+p[0]*n,h[y+1]=u[1]*(1-n)+p[1]*n,h[y+2]=u[2]*(1-n)+p[2]*n,h[y+3]=255,y+=b;r.putImageData(f,0,0)},bindHeatmap:function(e,t,n){if(t*n!==e.length)throw new Error("Heatmap: provided heatmap has wrong dimensions.");a=e,s=t,l=n,this.setCanvasSize(s,l)},getHTMLElement:function(){return n},resize:function(){},setCanvasSize:function(e,t){n.attr("width",e),n.attr("height",t)},setMinTemperature:function(e){c=e},setMaxTemperature:function(e){d=e},setColorPalette:function(e){i=new t(e).getRGBArray(),o=i.length-1}};return f.setColorPalette("DEFAULT"),p(),f}}),define("text!models/energy2d/views/heatmap-webgl-glsl/basic.vs.glsl",[],function(){return"varying vec2 coord;\n\nvoid main() {\n  coord = gl_TexCoord.xy;\n  gl_Position = vec4(gl_Vertex.xyz, 1.0);\n}\n"}),define("text!models/energy2d/views/heatmap-webgl-glsl/temp-renderer.fs.glsl",[],function(){return"// Provided textur contains temperature data in R channel.\nuniform sampler2D heatmap_tex;\nuniform sampler2D palette_tex;\n\nuniform float max_temp;\nuniform float min_temp;\n\nvarying vec2 coord;\n\nvoid main() {\n  float temp = texture2D(heatmap_tex, coord).r;\n  float scaled_temp = (temp - min_temp) / max(1.0, max_temp - min_temp);\n  gl_FragColor = texture2D(palette_tex, vec2(scaled_temp, 0.5));\n}\n"}),define("models/energy2d/views/heatmap-webgl",["require","models/energy2d/gpu/context","models/energy2d/gpu/texture","models/energy2d/gpu/shader","models/energy2d/gpu/mesh","models/energy2d/views/color-palette","text!models/energy2d/views/heatmap-webgl-glsl/basic.vs.glsl","text!models/energy2d/views/heatmap-webgl-glsl/temp-renderer.fs.glsl"],function(e){"use strict";var t=e("models/energy2d/gpu/context"),n=e("models/energy2d/gpu/texture"),r=e("models/energy2d/gpu/shader"),i=e("models/energy2d/gpu/mesh"),o=e("models/energy2d/views/color-palette"),a=e("text!models/energy2d/views/heatmap-webgl-glsl/basic.vs.glsl"),s=e("text!models/energy2d/views/heatmap-webgl-glsl/temp-renderer.fs.glsl");return function(e){var l,u,c,d,p,f=t.getWebGLContext(),h=new r(a,s),m=i.plane({coords:!0}),g="energy2d-heatmap-webgl-view",v=0,y=50,b=function(){u=$(f.canvas),u.attr("id",e||g)},_=function(){f.bindFramebuffer(f.FRAMEBUFFER,null),f.viewport(0,0,c,d)},x={renderHeatmap:function(){if(!p)throw new Error("Heatmap: bind heatmap texture before rendering.");_(),f.clear(f.COLOR_BUFFER_BIT),p.bind(0),l.bind(1),h.draw(m),l.unbind(1),p.unbind(0)},resize:function(){c=u.width(),d=u.height(),u.attr("width",c),u.attr("height",d)},bindHeatmapTexture:function(e){p=e},getHTMLElement:function(){return u},setMinTemperature:function(e){v=e,h.uniforms({min_temp:v})},setMaxTemperature:function(e){y=e,h.uniforms({max_temp:y})},setColorPalette:function(e){var t,r,i,a,s;for(t=new o(e).getRGBArray(),r=t.length,i=new Uint8Array(4*r),a=0;a<r;a+=1)s=4*a,i[s]=t[a][0],i[s+1]=t[a][1],i[s+2]=t[a][2],i[s+3]=255;l=new n(r,1,{type:f.UNSIGNED_BYTE,format:f.RGBA,filter:f.LINEAR}),f.bindTexture(f.TEXTURE_2D,l.id),f.texImage2D(f.TEXTURE_2D,0,l.format,r,1,0,l.format,l.type,i)}};return x.setColorPalette("DEFAULT"),h.uniforms({heatmap_tex:0,palette_tex:1,min_temp:v,max_temp:y}),m.coords=[[1,0],[1,1],[0,0],[0,1]],m.compile(),b(),x}}),define("models/energy2d/views/webgl-status",["require","common/controllers/checkbox-controller","models/energy2d/gpu/gpgpu"],function(e){"use strict";var t=e("common/controllers/checkbox-controller"),n=e("models/energy2d/gpu/gpgpu"),r='<p><a href="http://get.webgl.org" target="_blank">Click to learn more about WebGL.</a></p>';return function(e,i){function o(){var t;u=$("<div />"),u.attr("id",e||v),d=$('<div id="status-wrapper"/>'),d.appendTo(u),p=$("<div />"),p.appendTo(d),t=$('<a id="hide-webgl-status" class="button"><i class="icon-remove"></i></a>'),t.on("click",s),t.appendTo(d),h.appendTo(d),c=$('<a id="show-webgl-status" class="button"><i class="icon-bolt"></i></a>'),c.on("click",a),c.appendTo(u),d.hide()}function a(){c.hide(),d.fadeIn()}function s(){c.fadeIn(),d.fadeOut()}function l(){f=new t({type:"checkbox",id:"webgl-status-checkbox",text:"WebGL-accelerated physics engine",property:"use_WebGL"},y),h=f.getViewContainer(),o()}var u,c,d,p,f,h,m,g,v="e2d-webgl-status",y={getModel:function(){return i},getScriptingAPI:function(){return function(){}},getNextTabIndex:function(){return function(){}}};return g={bindModel:function(e){m=e,y.getModel=function(){return e},f.modelLoadedCallback(y)},render:function(){var e,t=m.isWebGLCompatible(),i=n.featuresInfo,o=!0,s=!0,l=m.properties.use_WebGL&&!m.isWebGLActive();p.empty(),Object.keys(i).forEach(function(e){var t=i[e];t.required&&!t.available&&(o=!1),t.required||t.available||(s=!1)}),o&&s?p.append('<p>Your browser <span class="happy">supports</span> WebGL as well as all required and optional extensions!</p>'):o?(p.append('<p>Your browser <span class="happy">supports</span> WebGL and all required extensions! However some optional extensions are unavailable:</p>'),Object.keys(i).forEach(function(e){var t,n=i[e];n.required||(t=n.available?'<span class="happy"><i class="icon-ok"></i></span>':'<span class="sad"><i class="icon-remove"></i></span>',p.append('<p class="extension">'+t+" "+e+"</p>"))}),p.append("<p>WebGL rendering quality can be affected.</p>")):i.WebGL?(p.append('<p>Your browser <span class="happy">supports</span> WebGL, however not all required extensions are available:</p>'),Object.keys(i).forEach(function(e){var t,n=i[e];n.required&&(t=n.available?'<span class="happy"><i class="icon-ok"></i></span>':'<span class="sad"><i class="icon-remove"></i></span>',p.append('<p class="extension">'+t+" "+e+"</p>"))}),p.append(r)):(p.append('<p>Sorry, your browser <span class="sad">does not support</span> WebGL.'),p.append(r)),t?(e='This model is <span class="happy">compatible</span> with WebGL-accelerated physics engine',m.isWebGLActive()?e+=' and it is <span class="happy">active</span>.':(e+=', but it is <span class="sad">inactive</span>.',l?e+=' Unfortunately, its initialization <span class="sad">failed</span>. Check the browser console for details.':o&&(e+=" Enable it to speed up simulation:")),p.append("<p>"+e+"</p>")):p.append('<p>Unfortunately, some features used in this model are <span class="sad">incompatible</span> with WebGL-accelerated physics engine.</p>'),o&&t&&!l?h.show():h.hide(),l?(e="WebGL initialization failed.",c.removeClass("happy"),c.addClass("sad")):o&&t?m.isWebGLActive()?(e="WebGL available and active.",c.removeClass("sad"),c.addClass("happy")):(e="WebGL available, but inactive.",c.removeClass("happy"),c.removeClass("sad")):(e="WebGL unavailable.",c.removeClass("happy"),c.addClass("sad")),e+=" Click for detailed information.",c.attr("title",e),l&&a()},getHTMLElement:function(){return u}},l(),g}}),define("models/energy2d/views/vectormap",[],function(){"use strict";return function(e){var t,n,r,i,o,a,s,l,u,c="energy2d-vectormap-view",d=100,p=8,f=Math.cos(.523598776),h=Math.sin(.523598776),m=4,g="rgb(175,175,175)",v=!0,y=function(){t=$("<canvas />"),t.attr("id",e||c),n=t[0].getContext("2d")},b=function(e,t,r,i){var o=1/Math.sqrt(r*r+i*i),a=r*o,s=i*o,l=e+a*p+r*d,u=t+s*p+i*d,c=m*(a*f+s*h),g=m*(s*f-a*h);n.beginPath(),n.moveTo(e,t),n.lineTo(l,u),n.lineTo(l-c,u-g),n.moveTo(l,u),c=m*(a*f-s*h),g=m*(s*f+a*h),n.lineTo(l-c,u-g),n.stroke()},_={renderVectormap:function(){if(v){var e,t,c,d,p,f,h,m,y,_;if(!o||!a)throw new Error("Vectormap: bind vectormap before rendering.");for(e=r/s,t=i/l,n.clearRect(0,0,r,i),n.strokeStyle=g,n.lineWidth=1,h=1;h<s-1;h+=u)for(y=h*l,c=(h+.5)*e,m=1;m<l-1;m+=u)_=y+m,d=(m+.5)*t,p=o[_],f=a[_],p*p+f*f>1e-15&&b(c,d,p,f)}},clear:function(){n.clearRect(0,0,r,i)},get enabled(){return v},set enabled(e){v=e,v||_.clear()},bindVectormap:function(e,t,n,r,i){if(n*r!==e.length)throw new Error("Heatmap: provided U component of vectormap has wrong dimensions.");if(n*r!==t.length)throw new Error("Heatmap: provided V component of vectormap has wrong dimensions.");o=e,a=t,s=n,l=r,u=Math.round(n/i)},getHTMLElement:function(){return t},resize:function(){r=t.width(),i=t.height(),t.attr("width",r),t.attr("height",i)}};return y(),_}}),define("text!models/energy2d/views/vectormap-webgl-glsl/vectormap.vs.glsl",[],function(){return"// Provided texture contains vector data in RG channels.\nattribute vec2 origin;\n\nuniform sampler2D vectormap_tex;\nuniform float base_length;\nuniform float vector_scale;\nuniform vec2 scale;\n\nvoid main() {\n  // Read vector which should be visualized.\n  vec2 vec = texture2D(vectormap_tex, gl_TexCoord.xy).xy;\n  vec.y = -vec.y;\n\n  if (length(vec) < 1e-15) {\n    // Do not draw to small vectors.\n    // Set position outside [-1, 1] region, which is rendered.\n    gl_Position = vec4(2.0);\n    return;\n  }\n\n  // Test which part of the vector arrow is being processed. \n  if (gl_Vertex.x == 0.0 && gl_Vertex.y == 0.0) {\n    // Origin of the arrow is being processed.\n    // Just transform its coordinates.\n    gl_Position = vec4(origin, 0.0, 1.0);\n  } else {\n    // Other parts of arrow are being processed.\n    // Set proper length of the arrow, rotate it, scale\n    // and finally transform.\n\n    // Calculate arrow length.\n    vec2 new_pos = gl_Vertex.xy;\n    new_pos.x += base_length + vector_scale * length(vec);\n\n    // Calculate angle between reference arrow (horizontal).\n    vec = normalize(vec);\n    float angle = acos(dot(vec, vec2(1.0, 0.0)));\n    if (vec.y < 0.0) {\n      angle = -angle;\n    }\n    // Prepare rotation matrix.\n    // See: http://en.wikipedia.org/wiki/Rotation_matrix\n    mat2 rot_m = mat2(\n      cos(angle), sin(angle),\n     -sin(angle), cos(angle)\n    );\n    // Rotate.\n    new_pos = rot_m * new_pos;\n    // Scale.\n    new_pos = new_pos * scale;\n    // Transform.\n    gl_Position = vec4(new_pos + origin, 0.0, 1.0);\n  }\n}\n"}),define("text!models/energy2d/views/vectormap-webgl-glsl/vectormap.fs.glsl",[],function(){return"uniform vec4 color;\n\nvoid main() {\n  gl_FragColor = color;\n}\n"}),define("models/energy2d/views/vectormap-webgl",["require","models/energy2d/gpu/context","models/energy2d/gpu/shader","models/energy2d/gpu/mesh","text!models/energy2d/views/vectormap-webgl-glsl/vectormap.vs.glsl","text!models/energy2d/views/vectormap-webgl-glsl/vectormap.fs.glsl"],function(e){"use strict";var t=e("models/energy2d/gpu/context"),n=e("models/energy2d/gpu/shader"),r=e("models/energy2d/gpu/mesh"),i=e("text!models/energy2d/views/vectormap-webgl-glsl/vectormap.vs.glsl"),o=e("text!models/energy2d/views/vectormap-webgl-glsl/vectormap.fs.glsl");return function(e){var a,s,l,u,c,d,p,f=t.getWebGLContext(),h=new n(i,o),m=new r({coords:!0,lines:!0}),g="energy2d-vectormap-webgl-view",v=100,y=8,b=[.7,.7,.7,1],_=!0,x=function(){var e,t,n,r,i,o=2/c,a=2/d,s=1/c,l=1/d;for(m.addVertexBuffer("origins","origin"),m.vertices=[],m.origins=[],m.coords=[],m.lines=[],n=0,e=1;e<c-1;e+=p)for(t=1;t<d-1;t+=p)m.vertices.push([0,0,0],[.01,0,0],[-3,2,0],[-3,-2,0]),r=[-1+(e+.5)*o,1-(t+.5)*a,0],m.origins.push(r,r,r,r),i=[(t+.5)*l,(e+.5)*s],m.coords.push(i,i,i,i),m.lines.push([n,n+1],[n+1,n+2],[n+1,n+3]),n+=4;m.compile()},w=function(){a=$(f.canvas),a.attr("id",e||g)},C=function(){f.bindFramebuffer(f.FRAMEBUFFER,null),f.viewport(0,0,s,l)},T={renderVectormap:function(){if(_){if(!u)throw new Error("Vectormap: bind heatmap texture before rendering.");C(),u.bind(0),h.draw(m,f.LINES),u.unbind(0)}},get enabled(){return _},set enabled(e){_=e},resize:function(){s=a.width(),l=a.height(),a.attr("width",s),a.attr("height",l),h.uniforms({scale:[2/s,2/l]})},bindVectormapTexture:function(e,t,n,r){u=e,c=t,d=n,p=Math.round(c/r),x()},getHTMLElement:function(){return a}};return h.uniforms({vectormap_tex:0,base_length:y,vector_scale:v,color:b}),w(),T}}),define("models/energy2d/views/photons",[],function(){"use strict";return function(e){var t,n,r,i,o,a,s,l,u,c="energy2d-photons-view",d="energy2d-photons-view",p=10,f=function(){t=$("<canvas />"),t.attr("id",e||c),t.addClass(d),n=t[0].getContext("2d")},h=function(){n.strokeStyle="rgba(255,255,255,128)",n.lineWidth=.5},m={renderPhotons:function(){var e,t,l,u,c,d;if(!o)throw new Error("Photons view: bind parts array before rendering.");for(n.clearRect(0,0,r,i),c=0,d=o.length;c<d;c+=1)e=o[c],t=e.x*a,l=e.y*s,u=1/Math.sqrt(e.vx*e.vx+e.vy*e.vy),n.beginPath(),n.moveTo(t,l),n.lineTo(t+p*e.vx*u,l+p*e.vy*u),n.stroke()},bindPhotonsArray:function(e,t,n){o=e,l=t,u=n,a=r/l,s=i/u},getHTMLElement:function(){return t},resize:function(){r=t.width(),i=t.height(),a=r/l,s=i/u,t.attr("width",r),t.attr("height",i),h()}};return f(),h(),m}}),define("models/energy2d/views/parts",[],function(){var e=1,t=2;return function(n,r){function i(e){return"translate("+C(e.x||0)+","+T(e.y||0)+")"}function o(e){return C(e.width)+t}function a(e){return C(e.height)+t}function s(e){return C(.5*e.a)}function l(e){return C(.5*e.b)}function u(e){return e.visible?"visible":"hidden"}function c(e){return e.texture?"url(#texture-1)":"none";
}function d(e){return e.computeLabel()}function p(){return-this.getBBox().width/2}function f(e){if(!e.filled)return"rgba(0, 0, 0, 0)";var t;if("auto"===e.color)t=e.power>0?"#FFFF00":e.power<0?"#B0C4DE":e.constant_temperature?"rgba(0, 0, 0, 0)":"#999";else if(t=e.color,!isNaN(parseInt(t,16))){for(;t.length<6;)t="0"+t;t="#"+t}return t}function h(e){var t,n,r=[],i=e.raw_x_coords,o=e.raw_y_coords;for(t=0,n=i.length;t<n;t++)r.push(C(i[t])),r.push(T(o[t]));return"M"+r.join(",")+"Z"}function m(e){switch(e.shapeType){case"polygon":return h(e);case"ring":return A(e)}}function g(e){var t=e.shapeType;return"rectangle"===t||"polygon"===t?this.parentNode.firstElementChild.getBBox().width/2:0}function v(e){var t=e.shapeType;return"rectangle"===t||"polygon"===t?this.parentNode.firstElementChild.getBBox().height/2:0}function y(){var e=r.append("defs").append("pattern").attr("id","texture-1").attr("patternUnits","userSpaceOnUse").attr("x",0).attr("y",0).attr("width","0.7em").attr("height","0.7em").attr("viewBox","0 0 16 16");e.append("path").attr("class","e2d-texture-path-shadow").attr("d","M0,0 L16,16 M-1,15 L1,17 M15,-1 L17,1"),e.append("path").attr("class","e2d-texture-path").attr("d","M0,0 L16,16 M-1,15 L1,17 M15,-1 L17,1")}function b(t,n,r){switch(n=n.select(S[t]),n.append(t).attr("class","e2d-part-shape"),n.append(t).attr("class","e2d-part-shape-outline").attr("fill",c),r.select(".e2d-part-shape"),r.select(".e2d-part-shape-outline"),t){case"rect":r.selectAll("rect").attr("x",e).attr("y",e).attr("width",o).attr("height",a);break;case"ellipse":r.selectAll("ellipse").attr("rx",s).attr("ry",l);break;case"path":r.selectAll("path").attr("d",m)}}function _(e,t){e.append("text").attr("class","e2d-part-label-shadow").attr("dy",".35em"),e.append("text").attr("class","e2d-part-label").attr("dy",".35em"),t.select(".e2d-part-label"),t.select(".e2d-part-label-shadow"),t.selectAll(".e2d-part-label, .e2d-part-label-shadow").text(d).attr("dx",p).attr("x",g).attr("y",v)}var x,w,C=n.model2px,T=n.model2pxInv,S={rect:function(e){return"rectangle"===e.shapeType?this:null},ellipse:function(e){return"ellipse"===e.shapeType?this:null},path:function(e){return"polygon"===e.shapeType||"ring"===e.shapeType?this:null}},A=d3.svg.arc().innerRadius(function(e){return C(.5*e.inner)}).outerRadius(function(e){return C(.5*e.outer)}).startAngle(0).endAngle(2*Math.PI),k=function(){var e,t,n,r,i,o,a;return d3.behavior.drag().origin(function(e){return{x:C(e.x),y:T(e.y)}}).on("dragstart",function(s){var l,u;s.draggable&&(e=t=null,l=C.range(),u=T.range(),n=Math.min(l[0],l[1]),r=Math.max(l[0],l[1]),i=Math.min(u[0],u[1]),o=Math.max(u[0],u[1]),a=this.getBBox(),a.x0=a.x+10,a.y0=a.y+10,a.x1=a.x+a.width-10,a.y1=a.y+a.height-10,d3.select(this).style("opacity",.7))}).on("drag",function(s){s.draggable&&(e=d3.event.x,t=d3.event.y,e-=Math.max(0,a.x0+e-r)+Math.min(0,a.x1+e-n),t-=Math.max(0,a.y0+t-o)+Math.min(0,a.y1+t-i),d3.select(this).attr("transform","translate("+e+","+t+")"))}).on("dragend",function(n){n.draggable&&(d3.select(this).style("opacity",1),null!==e&&(n.x=C.invert(e),n.y=T.invert(t)))})}();return x={renderParts:function(){if(w){var e,t;e=r.selectAll(".e2d-part").data(w),t=e.enter().append("g").attr("class","e2d-part part"),b("rect",t,e),b("ellipse",t,e),b("path",t,e),_(t,e),t.call(k),e.attr("transform",i),e.select(".e2d-part-shape").attr("fill",f).style("visibility",u),e.exit().remove()}},bindPartsArray:function(e){w=e}},function(){y()}(),x}}),define("models/energy2d/views/sensors",[],function(){var e=2,t=4;return function(n,r){function i(e){return e+"%"}function o(e){return"translate("+T(e.x)+","+S(e.y)+")"}function a(){return-this.getBBox().width/2}function s(e){return e.label}function l(e){return e.value.toFixed(1)+" °C"}function u(e){return i(A(e.value))}function c(e){return"rotate("+e.value+")"}function d(e){return e.value.toFixed(1)+" W/m²"}function p(e){return"rotate("+e.angle+")"}function f(e){e=e.append("g").attr("class","e2d-measuring-point"),e.append("line").attr("x1",0).attr("y1","-0.8%").attr("x2",0).attr("y2","0.8%"),e.append("line").attr("x1","-0.8%").attr("y1",0).attr("x2","0.8%").attr("y2",0),e.append("circle").attr("r","0.8%")}function h(e,t){e.append("text").attr("class","e2d-sensor-reading-shadow"),e.append("text").attr("class","e2d-sensor-reading"),e.append("text").attr("class","e2d-sensor-label-shadow"),e.append("text").attr("class","e2d-sensor-label"),t.select(".e2d-sensor-label"),t.select(".e2d-sensor-label-shadow"),t.select(".e2d-sensor-reading"),t.select(".e2d-sensor-reading-shadow")}function m(n){var c=r.selectAll(".e2d-sensor.thermometer").data(n.filter(function(e){return"thermometer"===e.type})),d=c.enter().append("g").attr("class","e2d-sensor sensor thermometer").call(k);h(d,c),d.append("rect").attr("class","e2d-thermometer-fill"),d.append("rect").attr("class","e2d-thermometer-background"),d.call(f),c.attr("transform",o),c.select(".e2d-thermometer-fill").attr("x",i(-.5*e)).attr("y",i(-.5*t)).attr("width",i(e)).attr("height",i(t)),_=c.select(".e2d-thermometer-background").attr("x",i(-.5*e)).attr("y",i(-.5*t)).attr("width",i(e)).attr("height",u),x=c.selectAll(".e2d-sensor-reading, .e2d-sensor-reading-shadow").text(l).attr("y",i(-.5*t)).attr("dy","-.2em").attr("dx","-.7em"),c.selectAll(".e2d-sensor-label, .e2d-sensor-label-shadow").text(s).attr("dx",a).attr("dy","1em").attr("y",i(.5*t)),c.exit().remove()}function g(e){var t=r.selectAll(".e2d-sensor.anemometer").data(e.filter(function(e){return"anemometer"===e.type})),n=t.enter().append("g").attr("class","e2d-sensor sensor anemometer").call(k);h(n,t),n=n.append("svg").attr("class","e2d-anemometer-shape").attr("viewBox","-50 -50 100 100").attr("x","-3%").attr("y","-3%").attr("width","6%").attr("height","6%").append("g").attr("class","e2d-anemometer-rot"),n.append("path").attr("d","M-10,10 L0,50 L10,10 Z").attr("transform","rotate(0)"),n.append("path").attr("d","M-10,10 L0,50 L10,10 Z").attr("transform","rotate(120)"),n.append("path").attr("d","M-10,10 L0,50 L10,10 Z").attr("transform","rotate(240)"),n.append("circle").attr("r",12),t.attr("transform",o),w=t.select(".e2d-anemometer-rot").attr("transform",c),t.selectAll(".e2d-sensor-label, .e2d-sensor-label-shadow").text(s).attr("dx",a).attr("dy","0.7em").attr("y","3%"),t.exit().remove()}function v(e){var t=r.selectAll(".e2d-sensor.heatFlux").data(e.filter(function(e){return"heatFlux"===e.type})),n=t.enter().append("g").attr("class","e2d-sensor sensor heatFlux").call(k);n=n.append("g").attr("transform",p),n.append("rect").attr("class","e2d-heatflux-shape").attr("x","-3%").attr("y","-1%").attr("width","6%").attr("height","2%"),n.append("svg").attr("viewBox","0 0 6 1").attr("x","-3%").attr("y","-1%").attr("width","6%").attr("height","2%").append("path").attr("class","e2d-heatflux-pattern").attr("d","M0,0L1,1L2,0L3,1L4,0L5,1L6,0"),n.call(f),h(n,t),t.attr("transform",o),C=t.selectAll(".e2d-sensor-reading, .e2d-sensor-reading-shadow").text(d).attr("y","-1%").attr("dy","-.2em").attr("dx","-1.8em"),t.selectAll(".e2d-sensor-label, .e2d-sensor-label-shadow").text(s).attr("dx",a).attr("dy","0.9em").attr("y","1%"),t.exit().remove()}var y,b,_,x,w,C,T=n.model2px,S=n.model2pxInv,A=d3.scale.linear().clamp(!0).domain([0,50]).range([t,0]),k=d3.behavior.drag().origin(function(e){return{x:T(e.x),y:S(e.y)}}).on("drag",function(e){e.x=T.invert(d3.event.x),e.y=S.invert(d3.event.y)});return y={update:function(){_.attr("height",u),x.text(l),w.attr("transform",c),C.text(d)},renderSensors:function(){b&&(m(b),g(b),v(b))},bindSensorsArray:function(e){b=e},setMinMaxTemp:function(e,t){A.domain([e,t])}}}}),define("models/energy2d/views/renderer",["require","models/energy2d/views/heatmap","models/energy2d/views/heatmap-webgl","models/energy2d/views/webgl-status","models/energy2d/views/vectormap","models/energy2d/views/vectormap-webgl","models/energy2d/views/photons","models/energy2d/views/parts","models/energy2d/views/sensors"],function(e){var t=e("models/energy2d/views/heatmap"),n=e("models/energy2d/views/heatmap-webgl"),r=e("models/energy2d/views/webgl-status"),i=e("models/energy2d/views/vectormap"),o=e("models/energy2d/views/vectormap-webgl"),a=e("models/energy2d/views/photons"),s=e("models/energy2d/views/parts"),l=e("models/energy2d/views/sensors");return function(e,u){function c(e){var t=e.getHTMLElement();t.css("width","100%"),t.css("height","100%"),t.css("position","absolute"),t.css("top",0),t.css("left",0),t.css("z-index",w),w+=1,x.append(t)}function d(){var e=u.properties;x.empty(),w=0,u.isWebGLActive()?(h=new n,m=new o,c(m)):(h=new t,c(h),m=new i,c(m)),g=new a,c(g),h.resize(),m.resize(),g.resize(),u.isWebGLActive()?(h.bindHeatmapTexture(u.getTemperatureTexture()),m.bindVectormapTexture(u.getVelocityTexture(),e.grid_width,e.grid_height,25)):(h.bindHeatmap(u.getTemperatureArray(),e.grid_width,e.grid_height),m.bindVectormap(u.getUVelocityArray(),u.getVVelocityArray(),e.grid_width,e.grid_height,25)),g.bindPhotonsArray(u.getPhotonsArray(),e.model_width,e.model_height)}function p(){var e=u.properties;m.enabled=e.velocity,h.setMinTemperature(e.minimum_temperature),h.setMaxTemperature(e.maximum_temperature),h.setColorPalette(e.color_palette_type),y.setMinMaxTemp(e.minimum_temperature,e.maximum_temperature)}var f,h,m,g,v,y,b=new r(null,u),_=b.getHTMLElement(),x=$("<div id='e2d-canvas-views'>"),w=0,C=!1;return f={getHeightForWidth:function(e){return e*u.properties.grid_height/u.properties.grid_width},setup:function(e){C=!0,d(),v.bindPartsArray(e.getPartsArray()),y.bindSensorsArray(e.getSensorsArray()),b.bindModel(e),p(),v.renderParts(),y.renderSensors(),b.render(),f.update(),e.addPropertiesListener("use_WebGL",function(){d(),p(),b.render(),f.update()}),e.addPropertiesListener(["color_palette_type","velocity","minimum_temperature","maximum_temperature"],function(){p(),f.update()}),e.on("tick.view-update",f.update),e.on("partsChanged.view-update",function(){v.renderParts()}),e.on("sensorsChanged.view-update",function(){y.renderSensors()})},update:function(){C&&(h.renderHeatmap(),m.renderVectormap(),g.renderPhotons(),y.update())},resize:function(){C&&(h.resize(),m.resize(),g.resize(),v.renderParts(),y.renderSensors(),f.update())},reset:function(){},setFocus:function(){u.get("enableKeyboardHandlers")&&this.$el.focus()},bindModel:function(e){u=e}},function(){var t=e.appendViewport();v=new s(e,t.append("g")),y=new l(e,t.append("g")),e.$el.append(x),e.$el.append(_)}(),f}}),define("models/energy2d/views/view",["require","common/views/svg-container","models/energy2d/views/renderer"],function(e){var t=e("common/views/svg-container"),n=e("models/energy2d/views/renderer");return function(e,r){return new t(e,r,n,{origin:"top-left"})}}),define("models/energy2d/benchmarks/benchmarks",["common/performance"],function(){var e=require("common/performance"),t=5e3,n=1e3;return function(r){var i,o=[{name:"engine (ms)",numeric:!0,formatter:d3.format("5.1f"),run:function(o){r.model.start(),setTimeout(function(){r.model.stop(),r.model.properties.use_WebGL=!1,e.collectData(!0),i=r.model.get("time"),setTimeout(function(){r.model.start(),setTimeout(function(){r.model.stop(),e.collectData(!1),o(e.getAvgTime("engine"))},t)},100)},n)}},{name:"JS rendering (ms)",numeric:!0,formatter:d3.format("5.1f"),run:function(t){t(e.getAvgTime("js-rendering"))}},{name:"tick (ms)",numeric:!0,formatter:d3.format("5.1f"),run:function(t){t(e.getAvgTime("tick"))}},{name:"gap b/w frames (ms)",numeric:!0,formatter:d3.format("5.1f"),run:function(t){t(e.getAvgTime("gap"))}},{name:"fps",numeric:!0,formatter:d3.format("5.1f"),run:function(e){var n=r.model.get("time")-i;e(n/(r.model.get("timeStepsPerTick")*r.model.get("timeStep"))*1e3/t)}},{name:"engine WebGL (ms)",numeric:!0,formatter:d3.format("5.1f"),run:function(o){r.model.start(),setTimeout(function(){r.model.stop(),r.model.properties.use_WebGL=!0,e.collectData(!0),i=r.model.get("time"),setTimeout(function(){r.model.start(),setTimeout(function(){r.model.stop(),e.collectData(!1),o(e.getAvgTime("engine"))},t)},100)},n)}},{name:"JS rendering WebGL (ms)",numeric:!0,formatter:d3.format("5.1f"),run:function(t){t(e.getAvgTime("js-rendering"))}},{name:"tick WebGL (ms)",numeric:!0,formatter:d3.format("5.1f"),run:function(t){t(e.getAvgTime("tick"))}},{name:"gap b/w frames WebGL (ms)",numeric:!0,formatter:d3.format("5.1f"),run:function(t){t(e.getAvgTime("gap"))}},{name:"fps WebGL",numeric:!0,formatter:d3.format("5.1f"),run:function(e){var n=r.model.get("time")-i;e(n/(r.model.get("timeStepsPerTick")*r.model.get("timeStep"))*1e3/t)}}];return o}}),define("models/energy2d/controllers/scripting-api",[],function(){return function(e){return{getTemperatureAt:function(t,n){return e.model.getTemperatureAt(t,n)},getAverageTemperatureAt:function(t,n){return e.model.getAverageTemperatureAt(t,n)},getSensor:function(t){return e.model.getSensorsArray()[t]},getPart:function(t){return e.model.getPartsArray()[t]},addPart:function(t){e.model.addPart(t)},removePart:function(t){e.model.removePart(t)},getNumberOfParts:function(){return e.model.getPartsArray().length},syncTemperature:function(){e.model.syncTemperature()}}}}),define("models/energy2d/controllers/controller",["require","common/controllers/model-controller","models/energy2d/modeler","models/energy2d/views/view","models/energy2d/benchmarks/benchmarks","models/energy2d/controllers/scripting-api"],function(e){var t=e("common/controllers/model-controller"),n=e("models/energy2d/modeler"),r=e("models/energy2d/views/view"),i=e("models/energy2d/benchmarks/benchmarks"),o=e("models/energy2d/controllers/scripting-api");return function(e,a,s){return new t(e,a,s,n,r,o,i)}}),define("common/models/dataset",[],function(){var e=0;return function(t,n){function r(){s=0,l=[],o(),u=t.timeSeries.xProperty,c=t.timeSeries.properties,i()}function i(){var e,t=[];for(s++,t.push(n.get(u)),e=0;e<c.length;e++)t.push(n.get(c[e]));l.push(t)}function o(){n.on("tick."+d,function(){i()})}var a,s,l,u,c,d="dataset"+ ++e;return a={getData:function(e){function n(e){var t=[];return e.forEach(function(e){t.push(e)}),t}var r,i,o,a,s,u=[];if(void 0===e)return n(l);for(r=0;r<l.length;r++){for(i=l[r],s=[],a=0;a<e.length;a++)o=t.properties.indexOf(e[a]),s.push(i[o]);u.push(s)}return[u]},reset:function(){l=$.extend(!0,[],t.tableData),s=0},appendPropertyRow:i,serialize:function(){var e=$.extend(!0,{},t);return e.tableData=l,e}},r(),a}}),define("common/controllers/experiment-controller",["require","common/controllers/interactive-metadata","common/validator","common/models/dataset"],function(e){var t=e("common/controllers/interactive-metadata"),n=e("common/validator"),r=e("common/models/dataset");return function(e,i){function o(){e=n.validateCompleteness(t.experiment,e),b=e.timeSeries,_=e.parameters.inputs,x=e.parameters.outputs,w=e.destinations,C=e.stateButtons,v=[],i.on("modelLoaded.experimentController",function(){g=i.getScriptingAPI(),m=i.getModel(),a()}),s()}function a(){m.defineParameter("experimentCleared",{initialValue:!1},function(){m.get("experimentCleared")&&(f(),m.set("experimentCleared",!1))}),m.defineParameter("experimentRunning",{initialValue:!1},function(){m.get("experimentRunning")?d():p()})}function s(){function e(){S=i.getComponent(C.startRun),A=i.getComponent(C.stopRun),k=i.getComponent(C.saveRun),P=i.getComponent(C.nextRun),E=i.getComponent(C.clearAll)}function t(){var e,t,n,r;for(O=[],M=[],e=0;e<w.length;e++){for(n=w[e],n.components=[],t=0;t<n.componentIds.length;t++)n.components.push(i.getComponent(n.componentIds[t]));switch(n.type){case"timeSeries":O.push(n);break;case"parameterSeries":M.push(n);break;default:throw new Error("Experiment destination: invalid destination type: "+n.type)}}for(L=void 0,e=0;e<O.length;e++)for(n=O[e],t=0;t<n.components.length;t++)if(r=n.components[t],void 0!==r.type&&"graph"===r.type)return void(L=r)}function n(){S.setAction("set('experimentRunning', true);"),A.setAction("set('experimentRunning', false);"),k.setAction(function(){var e,t,n;for(v.push(y),e=0;e<M.length;e++)for(n=M[e],t=0;t<n.components.length;t++)n.components[t].appendDataPropertiesToComponent();k.setDisabled(!0)}),P.setAction("set('experimentCleared', true);"),E.setAction(function(){i.reloadInteractive()})}e(),t(),n()}function l(){var e;if(L){for(e=0;e<v.length;e++)L.addDataSet(v[e].getData());L.update()}}function u(){for(var e=0;e<_.length;e++)m.unfreeze(_[e])}function c(){for(var e=0;e<_.length;e++)m.freeze(_[e])}function d(){S.setDisabled(!0),A.setDisabled(!1),k.setDisabled(!0),P.setDisabled(!0),E.setDisabled(!1),c(),y=new r({timeSeries:b},m),g.api.start()}function p(){S.setDisabled(!0),A.setDisabled(!0),k.setDisabled(!1),P.setDisabled(!1),g.api.stop()}function f(){S.setDisabled(!1),A.setDisabled(!0),k.setDisabled(!0),P.setDisabled(!0),m.set("experimentCleared",!1),i.reloadModel({propertiesToRetain:_,cause:"new-run"}),u(),l()}var h,m,g,v,y,b,_,x,w,C,T,S,A,k,P,E,O,M,L;return h={setOnLoadScript:function(e){T=e},serialize:function(){var t=$.extend(!0,{},e);return t}},o(),h}}),define("common/controllers/interactives-controller",["require","seedrandom","lab.config","arrays","fastclick","underscore","common/alert","common/validator","common/i18n","common/controllers/interactive-metadata","common/controllers/language-select","common/controllers/data-set","common/controllers/bar-graph-controller","common/controllers/graph-controller","common/controllers/export-controller","common/controllers/log-controller","common/controllers/scripting-api","common/controllers/button-controller","common/controllers/checkbox-controller","common/controllers/text-controller","common/controllers/image-controller","common/controllers/radio-controller","common/controllers/slider-controller","common/controllers/pulldown-controller","common/controllers/joystick-controller","common/controllers/color-indicator-controller","common/controllers/spectrometer-controller","common/controllers/numeric-output-controller","common/controllers/table-controller","common/controllers/parent-message-api","common/controllers/thermometer-controller","common/controllers/playback-controller","common/controllers/div-controller","common/dispatch-support","common/controllers/help-system","common/views/tooltip","common/cookies","common/controllers/setup-banner","common/controllers/about-dialog","common/controllers/share-dialog","common/controllers/credits-dialog","common/layout/semantic-layout","common/layout/templates","models/md2d/controllers/controller","models/signal-generator/controller","models/iframe/controller","models/sensor/controller","models/dual-sensor/controller","models/dual-sensor-connector/controller","models/sensor-connector/controller","models/labquest2/controller","models/energy2d/controllers/controller","common/controllers/experiment-controller"],function(e){function t(e){var n;if(null==e||"object"!=typeof e)return e;if(e instanceof Date)return n=new Date,n.setTime(e.getTime()),n;if(e instanceof Array){n=[];for(var r=0,i=e.length;r<i;r++)n[r]=t(e[r]);return n}if(e instanceof Object){n={};for(var o in e)e.hasOwnProperty(o)&&(n[o]=t(e[o]));return n}throw new Error("Unable to copy obj! Its type isn't supported.")}e("seedrandom");var n=e("lab.config"),r=e("arrays"),i=e("fastclick"),o=e("underscore"),a=e("common/alert"),s=e("common/validator"),l=e("common/i18n"),u=e("common/controllers/interactive-metadata"),c=e("common/controllers/language-select"),d=e("common/controllers/data-set"),p=e("common/controllers/bar-graph-controller"),f=e("common/controllers/graph-controller"),h=e("common/controllers/export-controller"),m=e("common/controllers/log-controller"),g=e("common/controllers/scripting-api"),v=e("common/controllers/button-controller"),y=e("common/controllers/checkbox-controller"),b=e("common/controllers/text-controller"),_=e("common/controllers/image-controller"),x=e("common/controllers/radio-controller"),w=e("common/controllers/slider-controller"),C=e("common/controllers/pulldown-controller"),T=e("common/controllers/joystick-controller"),S=e("common/controllers/color-indicator-controller"),A=e("common/controllers/spectrometer-controller"),k=e("common/controllers/numeric-output-controller"),P=e("common/controllers/table-controller"),E=e("common/controllers/parent-message-api"),O=e("common/controllers/thermometer-controller"),M=e("common/controllers/playback-controller"),L=e("common/controllers/div-controller"),N=e("common/dispatch-support"),R=e("common/controllers/help-system"),I=e("common/views/tooltip"),D=e("common/cookies"),B=e("common/controllers/setup-banner"),V=e("common/controllers/about-dialog"),j=e("common/controllers/share-dialog"),F=e("common/controllers/credits-dialog"),z=e("common/layout/semantic-layout"),G=e("common/layout/templates"),U={md2d:e("models/md2d/controllers/controller"),"signal-generator":e("models/signal-generator/controller"),"iframe-model":e("models/iframe/controller"),sensor:e("models/sensor/controller"),"dual-sensor":e("models/dual-sensor/controller"),"dual-sensor-connector":e("models/dual-sensor-connector/controller"),"sensor-connector":e("models/sensor-connector/controller"),labquest2:e("models/labquest2/controller"),energy2d:e("models/energy2d/controllers/controller")},q=e("common/controllers/experiment-controller"),H={text:b,image:_,button:v,checkbox:y,pulldown:C,radio:x,thermometer:O,barGraph:p,graph:f,slider:w,colorIndicator:S,joystick:T,spectrometer:A,numericOutput:k,table:P,div:L,playback:M};return function(e,p){function f(){ke=Pe.randomSeed,void 0===ke&&(Math.seedrandom(),ke=Math.random().toString()),Math.seedrandom(ke)}function v(e){if(Me[e])return Me[e];throw new Error("No model found with id "+e)}function y(){Se.isReady()&&Se.layoutInteractive()}function b(){ce.off("keydown.interactiveController"),se&&se.enableKeyboardHandlers()&&ce.on("keydown.interactiveController",function(e){var t=e.keycode||e.which;switch(t){case 13:e.preventDefault(),ye.api.start();break;case 32:e.preventDefault(),ye.api.isStopped()?ye.api.start():ye.api.stop();break;case 37:e.preventDefault(),ye.api.isStopped()?ye.api.stepBack():ye.api.stop();break;case 39:e.preventDefault(),ye.api.isStopped()?ye.api.stepForward():ye.api.stop()}})}function _(){var e,t,n,r,i,o;e="string"==typeof Pe.template?G[Pe.template]:Pe.template,t=Pe.layout,i=B(Ee,Pe,Te,we,Ce),r=i.components;for(n in r)r.hasOwnProperty(n)&&(n=r[n],n.modelLoadedCallback&&he.push($.proxy(n.modelLoadedCallback,n)));e=i.template.concat(e),e.forEach(function(t,n){e[n]=$.extend({},t)}),t=$.extend({},t,i.layout),r=$.extend({},Re,i.components),Se.initialize({$mainContainer:ce,$containersParent:de,containers:e,layout:t,components:r,aspectRatio:Pe.aspectRatio,fontScale:Pe.fontScale,padding:Pe.padding}),T()&&($(window).off("resize.lab-resize-handler"),$(window).on("resize.lab-resize-handler",function(){Ee.resize()})),o=function(){Ee.resize(),setTimeout(Ee.resize,50)},$(document).off(".lab-fullscreen-change"),$(document).on("fullscreenchange.lab-fullscreen-change",o).on("mozfullscreenchange.lab-fullscreen-change",o).on("webkitfullscreenchange.lab-fullscreen-change",o)}function x(e){var t,n=e.type,r=e.id;if(t=new H[n](e,Ee),!t.getViewContainer().hasClass("component"))throw new Error("Invalid Interactive Component implementation. Each component has to have 'component' class.");Re[r]=t,Ie.push(t),e.retainProperty&&null!=e.property&&De.push(e.property),t.modelLoadedCallback&&he.push($.proxy(t.modelLoadedCallback,t))}function w(e){return"string"==typeof e?e:e.join("\n")}function C(e){function t(e,t){var n,r,i;if(t)try{for(n=0,r=t.length;n<r;n++)t[n]=s.validateCompleteness(u[e],t[n])}catch(t){throw i="Incorrect "+e+" definition:\n"+t.message,a(i),new Error(i)}}var n,r,i,o,l,c;try{e=s.validateCompleteness(u.interactive,e)}catch(e){throw c="Incorrect interactive definition:\n"+e.message,a(c),new Error(c)}for(t("model",e.models),t("parameter",e.parameters),t("output",e.outputs),t("dataSet",e.dataSets),t("filteredOutput",e.filteredOutputs),t("helpTip",e.helpTips),i=e.models,n=0,r=i.length;n<r;n++)o=i[n],t("parameter",o.parameters),t("output",o.outputs),t("filteredOutput",o.filteredOutputs);e.experiment&&(ae=e.experiment,s.validateCompleteness(u.experimentTimeSeries,ae.timeSeries),t("experimentParameter",ae.parameters),t("experimentDestination",ae.destinations),t("experimentSavedRun",ae.savedRuns)),l=e.components;try{for(n=0,r=l.length;n<r;n++)l[n]=s.validateCompleteness(u[l[n].type],l[n])}catch(e){throw c="Incorrect "+l[n].type+" component definition:\n"+e.message,a(c),new Error(c)}if(e.exports)try{e.exports=s.validateCompleteness(u.exports,e.exports)}catch(e){throw c="Incorrect exports definition:\n"+e.message,a(c),new Error(c)}if(e.logging)try{e.logging=s.validateCompleteness(u.logging,e.logging)}catch(e){throw c="Incorrect logging definition:\n"+e.message,a(c),new Error(c)}return e}function T(){return"BODY"===ce.parent().prop("nodeName")}function S(){var e=Pe.theme;e=r.isArray(e)?e.map(function(e){return"lab-theme-"+e}).join(" "):e?"lab-theme-"+e:"",ce.alterClass("lab-theme-*",e)}function A(e){ce.empty(),de=$('<div class="lab-fastclick-container">'),de.appendTo(ce),i.attach(de[0]),de.append('<div class="lab-dialog-container">'),ge=!0,Ee.interactive=e,re=$.extend(!0,{},Ee.interactive),Ee.interactive=C(Ee.interactive),Pe=Ee.interactive,f(),S(),Oe=Pe.models;for(var t=0,n=Oe.length;t<n;t++)Me[Oe[t].id]=Oe[t];var r=Oe[0];r&&r.url?(M(r.id),P()):r&&r.model&&(P(),M(r.id,r.model))}function k(){Ie=[],Re={},me=[],he=[],De=[]}function P(){k(),fe=l(Pe.lang),c("#lang-icon",Ee),Te=new F(".lab-dialog-container",fe,Pe),Ce=new j(".lab-dialog-container",p,fe,Pe),we=Pe.about||Pe.subtitle?new V(".lab-dialog-container",fe,Pe):Te;var e=Ee.interactive.models[0];se=O(e.type,e.modelUrl,null),se.on("modelReset",W),ye=new g(Ee,null),se.ScriptingAPI&&ye.extend(se.ScriptingAPI),ye.exposeScriptingAPI(),ve={},Pe.dataSets.forEach(function(e){new d(e,Ee)}),Pe.helpTips.length>0&&(pe=new R(Pe.helpTips,de)),(Pe.helpOnLoad||Pe.aboutOnLoad)&&Ee.on("interactiveRendered.helpOnLoad",function(){function e(e){var t,n,r=0,i=e.length;if(0===i)return r;for(t=0;t<i;t++)n=e.charCodeAt(t),r=(r<<5)-r+n,r&=r;return r}Ee.on("interactiveRendered.helpOnLoad",null);var t=e(JSON.stringify(Pe));pe&&Pe.helpOnLoad&&!D.hasItem("lab-help-"+t)&&(pe.start(),D.setItem("lab-help-"+t,!0)),Pe.aboutOnLoad&&!D.hasItem("lab-about-"+t)&&(we.open(),D.setItem("lab-about-"+t,!0))}),I(ce);for(var t=Ee.interactive.components||[],n=0,r=t.length;n<r;n++)x(t[n]);be=new h(Ee),_e=new m({config:Pe.logging||s.validateCompleteness(u.logging,{}),componentByID:Re,additionalComponents:[we,Ce,Te,pe],boundProperties:Z(),interactivesController:Ee}),Pe.experiment&&(oe=new q(Pe.experiment,Ee)),_()}function O(e,t,n){var r,i=e||"md2d";if(null===U[i])throw new Error("Couldn't understand modelType '"+i+"'!");return r=new U[i](t,n,Ee)}function M(e,t,i,o){function a(e,t,n){function i(e,t){var n;for(n in e)void 0===t[n]?r.isArray(e[n])?t[n]=$.extend(!0,[],e[n]):"object"==typeof e[n]?t[n]=$.extend(!0,{},e[n]):t[n]=e[n]:"object"!=typeof t[n]||t[n]instanceof Array?t[n]instanceof Array&&e[n]instanceof Array&&(t[n]=$.extend(!0,e[n],t[n])):t[n]=i(e[n],t[n]);return t}var o,a;return a=$.extend(!0,{},n),a=i(e.viewOptions||{},a),o=$.extend(!0,{},t),o=i(e||{},o),o.viewOptions=a,o}function s(e,t,n,r){ie=$.extend(!0,{},t);var i=a(t,u,l);if(!se)throw new Error("REF something went wrong");se.reload(e,i,!0),le=se.model,b(),ye.bindModel(le),ye.exposeScriptingAPI(),xe.bindModel(le),L(),n&&le.set(n);for(var o=0;o<me.length;o++)me[o]();for(o=0;o<he.length;o++)he[o](le,ye);var s=null;Ee.currentModel.onLoad&&(s=ye.makeFunctionInScriptContext(w(Ee.currentModel.onLoad)))(),oe&&oe.setOnLoadScript(s),be.init(Pe.exports||te()),be.on("canExportData.interactivesController",function(){se.model.makeInvalidatingChange()}),be.modelCanExportData()&&(se.model.properties.controlButtonStyle="codap"),be.on("modelCanExportData.interactivesController",function(){se.model.properties.controlButtonStyle="codap"}),Be.modelLoaded(r||"initialLoad"),le.ready&&le.ready(),Se.setupModel(se),y(),se.initializeView(),Be.interactiveRendered(),ge=!1}var l,u,c,d=v(e);f(),ge||(c=J(i)),ue=e,Ee.currentModel=d,l=d.viewOptions?$.extend(!0,{},d.viewOptions):{controlButtons:"play"},d.modelOptions&&(u=$.extend(!0,{},d.modelOptions)),t?s(d.url,t,c,o):d.model?s(d.url,d.model,c,o):d.url&&$.get(n.modelsRootUrl+d.url).done(function(e){e="string"==typeof e?JSON.parse(e):e,s(d.url,e,c,o)}).fail(function(){t={type:"md2d",width:2.5,height:1.5,viewOptions:{backgroundColor:"rgba(245,200,200,255)",showClock:!1,textBoxes:[{text:"Model could not be loaded:",x:0,y:1,width:2.5,height:.25,fontScale:1.4,layer:1,frame:"rectangle",textAlign:"center",strokeOpacity:0,backgroundColor:"rgb(232,231,231)"},{text:d.url,x:0,y:.8,width:2.5,height:.25,fontScale:.9,layer:1,frame:"rectangle",textAlign:"center",strokeOpacity:0,backgroundColor:"rgb(232,231,231)"}]}},s(d.url,t,c,o)})}function L(){Q("basic",Ee.currentModel.outputs,Pe.outputs),K(Ee.currentModel.parameters,Pe.parameters),Q("filtered",Ee.currentModel.filteredOutputs,Pe.filteredOutputs)}function W(e){Ne||Y(e)}function Y(e){Be.modelReset(e)}function X(e){function t(){o||i!==r||e()}function n(){var e=!1;return{proceed:function(){e||(e=!0,i++,t())},cancel:function(){e||(e=!0,o=!0)}}}0===Le.length&&e();var r=Le.length,i=0,o=!1;Le.forEach(function(e){var t=n();e(le,t)||t.proceed()})}function Q(e,t,n){function r(e){if(e)for(var t=0;t<e.length;t++)a[e[t].name]=e[t]}if(t||n){var i,o,a={};r(n),r(t);for(i in a)if(a.hasOwnProperty(i))switch(o=a[i],e){case"basic":le.defineOutput(o.name,{label:o.label,unitType:o.unitType,unitName:o.unitName,unitPluralName:o.unitPluralName,unitAbbreviation:o.unitAbbreviation},ye.makeFunctionInScriptContext(w(o.value)));break;case"filtered":le.defineFilteredOutput(o.name,{label:o.label,unitType:o.unitType,unitName:o.unitName,unitPluralName:o.unitPluralName,unitAbbreviation:o.unitAbbreviation},o.property,o.type,o.period)}}}function K(e,n){if(e||n){var r,i,o,a,s={};for(r=(n||[]).concat(e||[]),i=0;i<r.length;i++)o=r[i],a=void 0,o.onChange&&(a=ye.makeFunctionInScriptContext("value",w(o.onChange))),le.defineParameter(o.name,{label:o.label,unitType:o.unitType,unitName:o.unitName,unitPluralName:o.unitPluralName,unitAbbreviation:o.unitAbbreviation},a),void 0!==o.initialValue&&(s[o.name]=t(o.initialValue));le.set(s)}}function J(e){var t;Pe.propertiesToRetain?t=Pe.propertiesToRetain:be.canExportData()&&(t=ne());var n=["useDuration","requestedDuration"].filter(function(e){return void 0!==le.properties[e]});e=(e||[]).concat(n);var r=o.uniq(o.flatten([t,De,e||[]])).filter(ee),i={};return r.forEach(function(e){i[e]=le.properties[e]}),i}function Z(){var e=o.pluck(Pe.components,"property"),t=o.pluck(o.where(Pe.components,{type:"graph"}),"properties");return o.without(o.uniq(o.flatten([e,t])),void 0)}function ee(e){return!!le&&!!le.isPropertyWritable&&le.isPropertyWritable(e)}function te(){var e=Z(),t=[],n=e.filter(ee),r=o.difference(e,n);return le&&"md2d"===le.properties.type&&(t="md2d"===le.properties.unitsScheme?["kineticEnergy","potentialEnergy","temperature"]:["kineticEnergy","potentialEnergy"]),r=o.uniq(r.concat(t)),{perRun:n,perTick:r}}function ne(){var e=Z(),t=e.filter(ee);return t}var re,ie,oe,ae,se,le,ue,ce,de,pe,fe,he,me,ge,ve,ye,be,_e,xe,we,Ce,Te,Se,Ae,ke,Pe={},Ee={},Oe=[],Me={},Le=[],Ne=!1,Re={},Ie=[],De=[],Be=new N("modelLoaded","interactiveRendered","modelReset","resize","interactiveRequested","interactiveWillReload");return Ae=function(){var e=-1;return function(){return e++}},Ee={get interactiveContainer(){return de},get scriptingAPI(){return ye},get helpSystem(){return pe},get i18n(){return fe},get modelController(){return se},get randomSeed(){return ke},get exportController(){return be},get defaultExports(){return te()},get propertiesToRetain(){return J()},get fontFamily(){return ce.css("font-family")},getModel:function(){return le},getDataSet:function(e){return ve[e]},addDataSet:function(e,t){me.push($.proxy(e.modelLoadedCallback,e)),t||(ve[e.name]=e)},getScriptingAPI:function(){return ye},getModelController:function(){return se},getComponent:function(e){
return Re[e]},getNextTabIndex:Ae,loadInteractive:A,requestInteractiveAt:function(e){Be.interactiveRequested(e)},reloadInteractive:function(){le.stop(),X(function(){Be.interactiveWillReload(),Ee.loadInteractive(re)})},loadModel:M,reloadModel:function(e){e||(e={}),e.cause||(e.cause="reload"),le.stop(),X(function(){f(),Ee.loadModel(ue,ie,e.propertiesToRetain,e.cause)})},resetModel:function(e){le.stop(),X(function(){e=e||{};var t=J(e.propertiesToRetain);Ne=!0,se.reset(e.cause),le.set(t),Y(e.cause),Ne=!1})},logAction:function(e,t){_e&&_e.logAction(e,t)},updateModelView:function(){se.updateView()},repaintModelView:function(){se.repaint()},resize:function(){y(),Be.resize()},on:function(e,t){"willResetModel"===e?Le.push(t):Be.on(e,t)},get:function(e){return Pe[e]},serialize:function(){var e,n,i;if(e={title:Pe.title,publicationStatus:Pe.publicationStatus,labEnvironment:Pe.labEnvironment,subtitle:Pe.subtitle,category:Pe.category,subCategory:Pe.subCategory,screenshot:Pe.screenshot,aspectRatio:Pe.aspectRatio,fontScale:Pe.fontScale,lang:Pe.lang,i18nMetadata:Pe.i18nMetadata,credits:Pe.credits,helpOnLoad:Pe.helpOnLoad,aboutOnLoad:Pe.aboutOnLoad,about:r.isArray(Pe.about)?$.extend(!0,[],Pe.about):Pe.about,theme:Pe.theme,showTopBar:Pe.showTopBar,showBottomBar:Pe.showBottomBar,padding:Pe.padding,models:$.extend(!0,[],Pe.models),propertiesToRetain:$.extend(!0,[],Pe.propertiesToRetain),parameters:$.extend(!0,[],Pe.parameters),outputs:$.extend(!0,[],Pe.outputs),filteredOutputs:$.extend(!0,[],Pe.filteredOutputs),helpTips:$.extend(!0,[],Pe.helpTips)},void 0!==le&&void 0!==le.get){var o=function(){for(var t=0,n=e.models.length;t<n;t++)if(e.models[t].id===ue)return e.models[t].parameters||[];return[]}(),a=e.parameters,s={};o.forEach(function(e){s[e.name]=!0;var n=le.get(e.name);void 0!==n&&(e.initialValue=t(n))}),a.forEach(function(e){if(!s[e.name]){var n=le.get(e.name);void 0!==n&&(e.initialValue=t(n))}})}void 0!==Pe.importedFrom&&(e.importedFrom=Pe.importedFrom),void 0!==Pe.exports&&(e.exports=$.extend(!0,{},Pe.exports)),void 0!==Pe.logging&&(e.logging=$.extend(!0,{},Pe.logging)),void 0!==Pe.experiment&&(e.experiment=$.extend(!0,{},Pe.experiment)),void 0!==Pe.randomSeed&&(e.randomSeed=Pe.randomSeed),e.dataSets=[];for(var l in ve)e.dataSets.push(ve[l].serialize());for(e.components=[],n=0,i=Ie.length;n<i;n++)Ie[n].serialize&&e.components.push(Ie[n].serialize());return e.layout=$.extend(!0,{},Pe.layout),"string"==typeof Pe.template?e.template=Pe.template:e.template=$.extend(!0,[],Pe.template),e},benchmarks:[{name:"interactive",numeric:!1,run:function(e){e(window.location.pathname+window.location.hash)}},{name:"layout (iterations)",numeric:!0,formatter:d3.format("g"),run:function(e){e(Se.layoutInteractive())}},{name:"layout (ms)",numeric:!0,formatter:d3.format("5.1f"),run:function(e){var t=+Date.now();Se.layoutInteractive(),e(Date.now()-t)}}],getLoadedModelId:function(){return ue},validateInteractive:C},ce=$(p),ce.addClass("lab-interactive-container"),Se=new z,Ee.on("resize.share-dialog",function(){Ce.updateIframeSize()}),xe=new E(Ee),null!=e&&A(e),Ee}}),define("grapher/public-api",["require","../lab.config","grapher/bar-graph/bar-graph-model","grapher/bar-graph/bar-graph-view","lab-grapher"],function(e){"use strict";var t=e("../lab.config"),n=e("grapher/bar-graph/bar-graph-model"),r=e("grapher/bar-graph/bar-graph-view"),i=e("lab-grapher");return window.Lab=window.Lab||{},window.Lab.grapher=window.Lab.grapher||{},window.Lab.grapher.BarGraphModel=n,window.Lab.grapher.BarGraphView=r,window.Lab.grapher.Graph=i,window.Lab.config=t,window.Lab.grapher}),define("import-export/netlogo-importer",["require","underscore"],function(e){function t(e){return e.units?e.label+" ("+e.units+")":e.label}var n=e("underscore"),r=["computationalInputs","computationalOutputs","studentInputs"];return{importRun:function(e,i){return"string"==typeof e&&(e=JSON.parse(e)),{perRunLabels:n.flatten(r.map(function(t){return e.description[t]})).map(t),perRunValues:n.flatten(r.map(function(t){return e.runs[i][t]})),perTickLabels:e.description.timeSeriesData.map(t),perTickValues:e.runs[i].timeSeriesData.map(function(e){return e.map(n.identity)})}},numberOfRuns:function(e){return"string"==typeof e&&(e=JSON.parse(e)),e.runs.length},timeStamps:function(e){return"string"==typeof e&&(e=JSON.parse(e)),n.pluck(e.runs,"timeStamp")},runHavingTimeStamp:function(e,t){"string"==typeof e&&(e=JSON.parse(e));for(var n=0;n<e.runs.length;n++)if(e.runs[n].timeStamp===t)return n;return null}}}),define("import-export/public-api",["require","import-export/dg-exporter","import-export/netlogo-importer"],function(e){"use strict";return window.Lab=window.Lab||{},window.Lab.importExport={version:"0.0.1",dgExporter:e("import-export/dg-exporter"),netlogoImporter:e("import-export/netlogo-importer")}}),define("public-api",["require","lab.version","lab.config","common/controllers/interactives-controller","common/benchmark/benchmark","grapher/public-api","import-export/public-api"],function(e){var t=e("lab.version"),n=e("lab.config"),r=e("common/controllers/interactives-controller"),i=e("common/benchmark/benchmark");e("grapher/public-api"),e("import-export/public-api"),window.Lab=window.Lab||{},window.Lab.version=t,window.Lab.config=n,window.Lab.InteractivesController=r,window.Lab.benchmark=i}),require(["public-api"],void 0,void 0,!0)}();
